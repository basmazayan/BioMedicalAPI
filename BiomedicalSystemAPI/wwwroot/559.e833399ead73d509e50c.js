"use strict";var ie=Object.defineProperty,le=Object.defineProperties,ue=Object.getOwnPropertyDescriptors,k=Object.getOwnPropertySymbols,de=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable,ee=(E,g,n)=>g in E?ie(E,g,{enumerable:!0,configurable:!0,writable:!0,value:n}):E[g]=n,W=(E,g)=>{for(var n in g||(g={}))de.call(g,n)&&ee(E,n,g[n]);if(k)for(var n of k(g))pe.call(g,n)&&ee(E,n,g[n]);return E},te=(E,g)=>le(E,ue(g));(self.webpackChunkbio_medical=self.webpackChunkbio_medical||[]).push([[559,1885],{60559:(E,g,n)=>{n.d(g,{V:()=>re});var h=n(49996),p=n(79076),_=n(30351),f=n(61414),N=(n(30627),n(22345)),O=n(18502),R=n(7808),S=n(30164),m=n(94911),U=(n(45072),n(55865),n(38650)),A=n(96410),j=n(88445),T=n(89719),Z=n(70157),w=n(2701),$=n(96583),M=n(46996),a=n(46613),l=n(24828),v=n(70658),x=n(35797),b=n(97073),V=n(85056),D=n(31885);function K(d,i,t){return L.apply(this,arguments)}function L(){return(L=(0,h.Z)(function*(d,i,t){if(!i||!i.resources)return;const e=i.portalItem===d.portalItem?new Set(d.paths):new Set;d.paths.length=0,d.portalItem=i.portalItem;const r=new Set(i.resources.toKeep.map(u=>u.resource.path)),s=new Set,o=[];r.forEach(u=>{e.delete(u),d.paths.push(u)});for(const u of i.resources.toUpdate)if(e.delete(u.resource.path),r.has(u.resource.path)||s.has(u.resource.path)){const{resource:F,content:ne,finish:se,error:ae}=u,q=(0,D.getSiblingOfSameTypeI)(F,(0,V.D)());d.paths.push(q.path),o.push(I({resource:q,content:ne,finish:se,error:ae},t))}else d.paths.push(u.resource.path),o.push(Q(u,t)),s.add(u.resource.path);for(const u of i.resources.toAdd)o.push(I(u,t)),d.paths.push(u.resource.path);if(e.forEach(u=>{const F=i.portalItem.resourceFromPath(u);o.push(F.portalItem.removeResource(F).catch(()=>{}))}),0===o.length)return;const c=yield(0,R.as)(o);(0,R.k_)(t);const y=c.filter(u=>"error"in u).map(u=>u.error);if(y.length>0)throw new f.Z("save:resources","Failed to save one or more resources",{errors:y})})).apply(this,arguments)}function I(d,i){return J.apply(this,arguments)}function J(){return(J=(0,h.Z)(function*(d,i){const t=yield(0,b.q6)(d.resource.portalItem.addResource(d.resource,d.content,i));if(!0!==t.ok)throw d.error&&d.error(t.error),t.error;d.finish&&d.finish(d.resource)})).apply(this,arguments)}function Q(d,i){return G.apply(this,arguments)}function G(){return(G=(0,h.Z)(function*(d,i){const t=yield(0,b.q6)(d.resource.update(d.content,i));if(!0!==t.ok)throw d.error(t.error),t.error;d.finish(d.resource)})).apply(this,arguments)}const z=N.Z.getLogger("esri.layers.mixins.SceneService"),re=d=>{let i=class extends d{constructor(){var t;super(...arguments),t=this,this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,R.Ds)(function(){var e=(0,h.Z)(function*(r,s,o){switch(r){case 0:return t._save(s);case 1:return t._saveAs(o,s)}});return function(r,s,o){return e.apply(this,arguments)}}())}readSpatialReference(t,e){return this._readSpatialReference(e)}_readSpatialReference(t){if(null!=t.spatialReference)return $.Z.fromJSON(t.spatialReference);{const e=t.store,r=e.indexCRS||e.geographicCRS,s=r&&parseInt(r.substring(r.lastIndexOf("/")+1,r.length),10);return null!=s?new $.Z(s):null}}readFullExtent(t,e,r){if(null!=t&&"object"==typeof t){const c=null==t.spatialReference?te(W({},t),{spatialReference:this._readSpatialReference(e)}):t;return Z.Z.fromJSON(c,r)}const s=e.store,o=this._readSpatialReference(e);return null==o||null==s||null==s.extent||!Array.isArray(s.extent)||s.extent.some(c=>c<X)?null:new Z.Z({xmin:s.extent[0],ymin:s.extent[1],xmax:s.extent[2],ymax:s.extent[3],spatialReference:o})}parseVersionString(t){const e={major:Number.NaN,minor:Number.NaN,versionString:t},r=t.split(".");return r.length>=2&&(e.major=parseInt(r[0],10),e.minor=parseInt(r[1],10)),e}readVersion(t,e){const r=e.store,s=null!=r.version?r.version.toString():"";return this.parseVersionString(s)}readTitlePortalItem(t){return"item-title"!==this.sublayerTitleMode?void 0:t}readTitleService(t,e){const r=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return(0,M.a7)(this.url,e.name);let s=e.name;if(!s&&this.url){const o=(0,M.Qc)(this.url);(0,O.pC)(o)&&(s=o.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&r&&(s=r+" - "+s),(0,M.ld)(s)}set url(t){const e=(0,M.XG)({layer:this,url:t,nonStandardUrlAllowed:!1,logger:z});this._set("url",e.url),null!=e.layerId&&this._set("layerId",e.layerId)}writeUrl(t,e,r,s){(0,M.wH)(this,t,"layers",e,s)}get parsedUrl(){const t=this._get("url");if(!t)return null;const e=(0,S.mN)(t);return null!=this.layerId&&(e.path=`${e.path}/layers/${this.layerId}`),e}_fetchIndexAndUpdateExtent(t,e){var r=this;return(0,h.Z)(function*(){r.indexInfo=(0,l.T)(r.parsedUrl.path,r.rootNode,t,r.apiKey,z,e),null==r.fullExtent||r.fullExtent.hasZ||r._updateExtent(yield r.indexInfo)})()}_updateExtent(t){if("page"===(null==t?void 0:t.type)){var e,r;const o=t.rootIndex%t.pageSize,c=null==(e=t.rootPage)||null==(r=e.nodes)?void 0:r[o];if(null==c||null==c.obb||null==c.obb.center||null==c.obb.halfSize)throw new f.Z("sceneservice:invalid-node-page","Invalid node page.");if(c.obb.center[0]<X||null==this.fullExtent||this.fullExtent.hasZ)return;const y=c.obb.halfSize,u=c.obb.center[2],F=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]);this.fullExtent.zmin=u-F,this.fullExtent.zmax=u+F}else if("node"===(null==t?void 0:t.type)){var s;const o=null==(s=t.rootNode)?void 0:s.mbs;if(!Array.isArray(o)||4!==o.length||o[0]<X)return;const c=o[2],y=o[3];this.fullExtent.zmin=c-y,this.fullExtent.zmax=c+y}}_fetchService(t){var e=this;return(0,h.Z)(function*(){if(null==e.url)throw new f.Z("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==e.layerId&&/SceneServer\/*$/i.test(e.url)){const r=yield e._fetchFirstLayerId(t);null!=r&&(e.layerId=r)}return e._fetchServiceLayer(t)})()}_fetchFirstLayerId(t){var e=this;return(0,h.Z)(function*(){const r=yield(0,_.default)(e.url,{query:{f:"json",token:e.apiKey},responseType:"json",signal:t});if(r.data&&Array.isArray(r.data.layers)&&r.data.layers.length>0)return r.data.layers[0].id})()}_fetchServiceLayer(t){var e=this;return(0,h.Z)(function*(){const r=yield(0,_.default)(e.parsedUrl.path,{query:{f:"json",token:e.apiKey},responseType:"json",signal:t});r.ssl&&(e.url=e.url.replace(/^http:/i,"https:"));let s=!1;if(r.data.layerType&&"Voxel"===r.data.layerType&&(s=!0),s)return e.read(r.data,{origin:"service",url:e.parsedUrl}),e._fetchVoxelServiceLayer();const o=r.data;e.read(o,{origin:"service",url:e.parsedUrl}),e.validateLayer(o)})()}_fetchVoxelServiceLayer(t){var e=this;return(0,h.Z)(function*(){const r=(yield(0,_.default)(e.parsedUrl.path+"/layer",{query:{f:"json",token:e.apiKey},responseType:"json",signal:t})).data;e.read(r,{origin:"service",url:e.parsedUrl}),e.validateLayer(r)})()}_ensureLoadBeforeSave(){var t=this;return(0,h.Z)(function*(){yield t.load(),"beforeSave"in t&&"function"==typeof t.beforeSave&&(yield t.beforeSave())})()}validateLayer(t){}_updateTypeKeywords(t,e,r){t.typeKeywords||(t.typeKeywords=[]);const s=e.getTypeKeywords();for(const o of s)t.typeKeywords.push(o);t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((o,c,y)=>y.indexOf(o)===c),1===r&&(t.typeKeywords=t.typeKeywords.filter(o=>"Hosted Service"!==o)))}_saveAs(t,e){var r=this;return(0,h.Z)(function*(){const s=W(W({},Y),e);let o=x.default.from(t);o||(z.error("_saveAs(): requires a portal item parameter"),yield Promise.reject(new f.Z("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),o.id&&(o=o.clone(),o.id=null);const c=o.portal||v.Z.getDefault();yield r._ensureLoadBeforeSave(),o.type=H,o.portal=c;const y={origin:"portal-item",url:null,messages:[],portal:c,portalItem:o,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},u={layers:[r.write({},y)]};return yield Promise.all(y.resources.pendingOperations),yield r._validateAgainstJSONSchema(u,y,s),o.url=r.url,o.title||(o.title=r.title),r._updateTypeKeywords(o,s,1),yield c._signIn(),yield c.user.addItem({item:o,folder:s&&s.folder,data:u}),yield K(r.resourceReferences,y,null),r.portalItem=o,(0,T.D)(y),y.portalItem=o,o})()}_save(t){var e=this;return(0,h.Z)(function*(){const r=W(W({},Y),t);e.portalItem||(z.error("_save(): requires the .portalItem property to be set"),yield Promise.reject(new f.Z("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))),e.portalItem.type!==H&&(z.error("_save(): Non-matching portal item type. Got "+e.portalItem.type+", expected "+H),yield Promise.reject(new f.Z("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${H}"`))),yield e._ensureLoadBeforeSave();const s={origin:"portal-item",url:e.portalItem.itemUrl&&(0,S.mN)(e.portalItem.itemUrl),messages:[],portal:e.portalItem.portal||v.Z.getDefault(),portalItem:e.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},o={layers:[e.write({},s)]};return yield Promise.all(s.resources.pendingOperations),yield e._validateAgainstJSONSchema(o,s,r),e.portalItem.url=e.url,e.portalItem.title||(e.portalItem.title=e.title),e._updateTypeKeywords(e.portalItem,r,0),yield e.portalItem.update({data:o}),yield K(e.resourceReferences,s,null),(0,T.D)(s),e.portalItem})()}_validateAgainstJSONSchema(t,e,r){return(0,h.Z)(function*(){let s=e.messages.filter(o=>"error"===o.type).map(o=>new f.Z(o.name,o.message,o.details));if(r&&r.validationOptions.ignoreUnsupported&&(s=s.filter(o=>"layer:unsupported"!==o.name&&"symbol:unsupported"!==o.name&&"symbol-layer:unsupported"!==o.name&&"property:unsupported"!==o.name&&"url:unsupported"!==o.name&&"scenemodification:unsupported"!==o.name)),r.validationOptions.enabled||oe){const o=(yield n.e(1422).then(n.bind(n,31422))).validate(t,r.portalItemLayerType);if(o.length>0){const c=`Layer item did not validate:\n${o.join("\n")}`;if(z.error(`_validateAgainstJSONSchema(): ${c}`),"throw"===r.validationOptions.failPolicy){const y=o.map(u=>new f.Z("sceneservice:schema-validation",u)).concat(s);throw new f.Z("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:y})}}}if(s.length>0)throw new f.Z("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:s})})()}};return(0,p._)([(0,m.Cb)(a.id)],i.prototype,"id",void 0),(0,p._)([(0,m.Cb)({type:$.Z})],i.prototype,"spatialReference",void 0),(0,p._)([(0,U.r)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],i.prototype,"readSpatialReference",null),(0,p._)([(0,m.Cb)({type:Z.Z})],i.prototype,"fullExtent",void 0),(0,p._)([(0,U.r)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],i.prototype,"readFullExtent",null),(0,p._)([(0,m.Cb)({readOnly:!0,type:w.Z})],i.prototype,"heightModelInfo",void 0),(0,p._)([(0,m.Cb)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],i.prototype,"minScale",void 0),(0,p._)([(0,m.Cb)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],i.prototype,"maxScale",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],i.prototype,"version",void 0),(0,p._)([(0,U.r)("version",["store.version"])],i.prototype,"readVersion",null),(0,p._)([(0,m.Cb)({type:String,json:{read:{source:"copyrightText"}}})],i.prototype,"copyright",void 0),(0,p._)([(0,m.Cb)({type:String,json:{read:!1}})],i.prototype,"sublayerTitleMode",void 0),(0,p._)([(0,m.Cb)({type:String})],i.prototype,"title",void 0),(0,p._)([(0,U.r)("portal-item","title")],i.prototype,"readTitlePortalItem",null),(0,p._)([(0,U.r)("service","title",["name"])],i.prototype,"readTitleService",null),(0,p._)([(0,m.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],i.prototype,"layerId",void 0),(0,p._)([(0,m.Cb)(a.HQ)],i.prototype,"url",null),(0,p._)([(0,j.c)("url")],i.prototype,"writeUrl",null),(0,p._)([(0,m.Cb)()],i.prototype,"parsedUrl",null),(0,p._)([(0,m.Cb)({readOnly:!0})],i.prototype,"store",void 0),(0,p._)([(0,m.Cb)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],i.prototype,"rootNode",void 0),i=(0,p._)([(0,A.j)("esri.layers.mixins.SceneService")],i),i},X=-1e38,oe=!1,H="Scene Service",Y={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}}},24828:(E,g,n)=>{n.d(g,{T:()=>P});var h=n(49996),p=n(30351),_=n(61414),f=n(18502);function P(O,R,S,m,C,B){return N.apply(this,arguments)}function N(){return(N=(0,h.Z)(function*(O,R,S,m,C,B){let U=null;if((0,f.pC)(S)){const T=`${O}/nodepages/`,Z=T+Math.floor(S.rootIndex/S.nodesPerPage);try{return{type:"page",rootPage:(yield(0,p.default)(Z,{query:{f:"json",token:m},responseType:"json",signal:B})).data,rootIndex:S.rootIndex,pageSize:S.nodesPerPage,lodMetric:S.lodSelectionMetricType,urlPrefix:T}}catch(w){(0,f.pC)(C)&&C.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",Z,w),U=w}}if(!R)return null;const A=`${O}/nodes/`,j=A+(R&&R.split("/").pop());try{return{type:"node",rootNode:(yield(0,p.default)(j,{query:{f:"json",token:m},responseType:"json",signal:B})).data,urlPrefix:A}}catch(T){throw new _.Z("sceneservice:root-node-missing","Root node missing.",{pageError:U,nodeError:T,url:j})}})).apply(this,arguments)}},31885:(E,g,n)=>{n.r(g),n.d(g,{addOrUpdateResource:()=>R,contentToBlob:()=>Z,fetchResources:()=>N,getSiblingOfSameType:()=>$,getSiblingOfSameTypeI:()=>M,removeAllResources:()=>B,removeResource:()=>m,splitPrefixFileNameAndExtension:()=>j});var h=n(49996),p=n(30351),_=n(61414),f=n(18502),P=n(30164);function N(a){return O.apply(this,arguments)}function O(){return(O=(0,h.Z)(function*(a,l={},v){yield a.load(v);const x=(0,P.v_)(a.itemUrl,"resources"),{start:b=1,num:V=10,sortOrder:D="asc",sortField:K="created"}=l,L={query:{start:b,num:V,sortOrder:D,sortField:K,token:a.apiKey},signal:(0,f.U2)(v,"signal")},I=yield a.portal._request(x,L);return{total:I.total,nextStart:I.nextStart,resources:I.resources.map(({created:J,size:Q,resource:G})=>({created:new Date(J),size:Q,resource:a.resourceFromPath(G)}))}})).apply(this,arguments)}function R(a,l,v,x){return S.apply(this,arguments)}function S(){return(S=(0,h.Z)(function*(a,l,v,x){if(!a.hasPath())throw new _.Z(`portal-item-resource-${l}:invalid-path`,"Resource does not have a valid path");const b=a.portalItem;yield b.load(x);const V=(0,P.v_)(b.userItemUrl,"add"===l?"addResources":"updateResources"),[D,K]=A(a.path),L=yield Z(v),I=new FormData;return D&&"."!==D&&I.append("resourcesPrefix",D),I.append("fileName",K),I.append("file",L,K),I.append("f","json"),(0,f.pC)(x)&&x.access&&I.append("access",x.access),yield b.portal._request(V,{method:"post",body:I,signal:(0,f.U2)(x,"signal")}),a})).apply(this,arguments)}function m(a,l,v){return C.apply(this,arguments)}function C(){return(C=(0,h.Z)(function*(a,l,v){if(!l.hasPath())throw new _.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield a.load(v);const x=(0,P.v_)(a.userItemUrl,"removeResources");yield a.portal._request(x,{method:"post",query:{resource:l.path},signal:(0,f.U2)(v,"signal")}),l.portalItem=null})).apply(this,arguments)}function B(a,l){return U.apply(this,arguments)}function U(){return(U=(0,h.Z)(function*(a,l){yield a.load(l);const v=(0,P.v_)(a.userItemUrl,"removeResources");return a.portal._request(v,{method:"post",query:{deleteAll:!0},signal:(0,f.U2)(l,"signal")})})).apply(this,arguments)}function A(a){const l=a.lastIndexOf("/");return-1===l?[".",a]:[a.slice(0,l),a.slice(l+1)]}function j(a){const[l,v]=function(a){const l=(0,P.Ml)(a);return(0,f.Wi)(l)?[a,""]:[a.slice(0,a.length-l.length-1),`.${l}`]}(a),[x,b]=A(l);return[x,b,v]}function Z(a){return w.apply(this,arguments)}function w(){return(w=(0,h.Z)(function*(a){return a instanceof Blob?a:(yield(0,p.default)(a.url,{responseType:"blob"})).data})).apply(this,arguments)}function $(a,l){if(!a.hasPath())return null;const[v,,x]=j(a.path);return a.portalItem.resourceFromPath((0,P.v_)(v,l+x))}function M(a,l){if(!a.hasPath())return null;const[v,,x]=j(a.path);return a.portalItem.resourceFromPath((0,P.v_)(v,l+x))}}}]);
//# sourceMappingURL=559.e833399ead73d509e50c.js.map