{"version":3,"file":"6830.e68edcc58130b28a4d21.js","mappings":"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","sources":["./node_modules/@arcgis/core/views/2d/engine/Bitmap.js","./node_modules/@arcgis/core/views/2d/engine/BitmapContainer.js","./node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js","./node_modules/@arcgis/core/views/2d/layers/support/ExportStrategy.js","./node_modules/@arcgis/core/views/2d/viewStateUtils.js","./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{b as e,c as i,r as s,j as r,m as h}from\"../../../chunks/mat3.js\";import{c as n}from\"../../../chunks/mat3f32.js\";import{f as u}from\"../../../chunks/vec2f32.js\";import{DisplayObject as o}from\"./DisplayObject.js\";import a from\"./ImageryBitmapSource.js\";import d from\"../../webgl/Texture.js\";function c(t){return t&&\"render\"in t}function l(t){return t&&!(\"render\"in t)}function x(t){const e=document.createElement(\"canvas\");return e.width=t.width,e.height=t.height,t.render(e.getContext(\"2d\")),e}function _(t,e,i){const s={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return e&&i&&(s.width=e,s.height=i),new d(t,s)}class g extends o{constructor(t=null,e,i=!0){super(),this.requestRenderOnSourceChangedEnabled=i,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.blendFunction=e,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){this._source=t,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t.context)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}_createTransforms(){return{dvs:n()}}setTransform(t){const n=e(this.transforms.dvs),[o,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),d=this.resolution/this.pixelRatio/t.resolution,c=d*this.width,l=d*this.height,x=Math.PI*this.rotation/180;i(n,n,u(o,a)),i(n,n,u(c/2,l/2)),s(n,n,-x),i(n,n,u(-c/2,-l/2)),r(n,n,u(c,l)),h(this.transforms.dvs,t.displayViewMat3,n)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,e){this._texture&&t.bindTexture(this._texture,e)}updateTexture(e){var i;if(!this.stage)return null==(i=this._texture)||i.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=_(e,this.sourceWidth,this.sourceHeight):this._texture=_(e));const s=this.source;if(s){if(this._texture.resize(this.sourceWidth,this.sourceHeight),c(s))if(s instanceof a){const e=s.getRenderedRasterPixels();this._texture.setData(t(e)?e.renderedRasterPixels:null)}else this._texture.setData(x(s));else l(s)&&this._texture.setData(s);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}export{g as Bitmap,c as isImageSource,x as rasterize};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{brushes as e}from\"./brushes.js\";import{WGLDrawPhase as r}from\"./webgl/enums.js\";import s from\"./webgl/WGLContainer.js\";class t extends s{get requiresDedicatedFBO(){return this.children.some((e=>\"additive\"===e.blendFunction))}prepareRenderPasses(s){const t=s.registerRenderPass({name:\"bitmap\",brushes:[e.bitmap],target:()=>this.children,drawPhase:r.MAP});return[...super.prepareRenderPasses(s),t]}}export{t as BitmapContainer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../core/maybe.js\";class i{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return e(this.pixelBlock)?this.pixelBlock.width:0}get height(){return e(this.pixelBlock)?this.pixelBlock.height:0}render(e){const i=this.pixelBlock;if(t(i))return;const l=this.filter({pixelBlock:i});if(t(l.pixelBlock))return;const r=l.pixelBlock.getAsRGBA(),o=e.createImageData(l.pixelBlock.width,l.pixelBlock.height);o.data.set(r),e.putImageData(o,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return t(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../core/Accessor.js\";import{debounce as i}from\"../../../../core/promiseUtils.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as r}from\"../../../../core/accessorSupport/decorators/subclass.js\";import s from\"../../../../geometry/Extent.js\";import{create as a}from\"../../../../geometry/support/aaBoundingRect.js\";import{getInfo as p}from\"../../../../geometry/support/spatialReferenceUtils.js\";import n from\"../../../../layers/support/TileInfo.js\";import{getOuterSize as m,getBBox as l}from\"../../viewStateUtils.js\";import{Bitmap as d}from\"../../engine/Bitmap.js\";import h from\"../../tiling/TileInfoView.js\";import c from\"../../tiling/TileKey.js\";const u=a(),g=[0,0],f=new c(0,0,0,0),x={container:null,fetchSource:null,requestUpdate:null,imageMaxWidth:2048,imageMaxHeight:2048,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1};let y=class extends e{constructor(t){super(t),this._imagePromise=null,this.bitmaps=[],this.hidpi=x.hidpi,this.imageMaxWidth=x.imageMaxWidth,this.imageMaxHeight=x.imageMaxHeight,this.imageRotationSupported=x.imageRotationSupported,this.imageNormalizationSupported=x.imageNormalizationSupported,this.update=i((async(t,e)=>{if(!t.stationary||this.destroyed)return null;const i=t.state,o=p(i.spatialReference),r=this.hidpi?t.pixelRatio:1,s=this.imageNormalizationSupported&&i.worldScreenWidth&&i.worldScreenWidth<i.size[0];s?(g[0]=i.worldScreenWidth,g[1]=i.size[1]):this.imageRotationSupported?(g[0]=i.size[0],g[1]=i.size[1]):m(g,i);const a=Math.floor(g[0]*r)>this.imageMaxWidth||Math.floor(g[1]*r)>this.imageMaxHeight,n=o&&(i.extent.xmin<o.valid[0]||i.extent.xmax>o.valid[1]),l=!this.imageNormalizationSupported&&n,d=!a&&!l,h=this.imageRotationSupported?i.rotation:0;if(d){const t=s?i.paddedViewState.center:i.center;this._imagePromise=this._singleExport(i,g,t,i.resolution,h,r,e)}else{let t=Math.min(this.imageMaxWidth,this.imageMaxHeight);l&&(t=Math.min(i.worldScreenWidth,t)),this._imagePromise=this._tiledExport(i,t,h,r,e)}return this._imagePromise.then((async t=>{if(this._imagePromise=null,!this.destroyed){this.bitmaps=null!=t?t:[];for(const e of this.container.children)t.includes(e)||e.fadeOut().then((()=>{e.remove()}));for(const e of t)this.container.addChild(e),e.fadeIn()}})).catch((t=>{throw this._imagePromise=null,t}))}),5e3)}destroy(){this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}updateExports(t){for(const e of this.container.children){if(!e.visible||!e.stage)return;t(e),e.invalidateTexture(),e.requestRender()}}async _export(t,e,i,o,r,s){const a=await this.fetchSource(t,Math.floor(e*r),Math.floor(i*r),{rotation:o,pixelRatio:r,signal:s}),p=new d(a,\"additive\");return p.x=t.xmin,p.y=t.ymax,p.resolution=t.width/e,p.rotation=o,p.pixelRatio=r,p}async _singleExport(t,e,i,o,r,a,p){l(u,i,o,e);const n=new s(u[0],u[1],u[2],u[3],t.spatialReference);return[await this._export(n,e[0],e[1],r,a,p)]}_tiledExport(t,e,i,o,r){const a=n.create({size:e,spatialReference:t.spatialReference,scales:[t.scale]}),p=new h(a),m=p.getTileCoverage(t);if(!m)return null;const l=[];return m.forEach(((a,n,m,d)=>{f.set(a,n,m,d),p.getTileBounds(u,f);const h=new s(u[0],u[1],u[2],u[3],t.spatialReference);l.push(this._export(h,e,e,i,o,r))})),Promise.all(l)}};t([o()],y.prototype,\"_imagePromise\",void 0),t([o()],y.prototype,\"bitmaps\",void 0),t([o()],y.prototype,\"container\",void 0),t([o()],y.prototype,\"fetchSource\",void 0),t([o()],y.prototype,\"hidpi\",void 0),t([o()],y.prototype,\"imageMaxWidth\",void 0),t([o()],y.prototype,\"imageMaxHeight\",void 0),t([o()],y.prototype,\"imageRotationSupported\",void 0),t([o()],y.prototype,\"imageNormalizationSupported\",void 0),t([o()],y.prototype,\"requestUpdate\",void 0),t([o()],y.prototype,\"updating\",null),y=t([r(\"esri.views.2d.layers.support.ExportStrategy\")],y);const S=y;export{S as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nconst t=Math.PI/180;function n(n){return n*t}function o(t,n,o){const{resolution:r,size:u}=o;return t[0]=r*(Math.round(n[0]/r)+u[0]%2*.5),t[1]=r*(Math.round(n[1]/r)+u[1]%2*.5),t}function r(t,o){const r=n(o.rotation),u=Math.abs(Math.cos(r)),a=Math.abs(Math.sin(r)),[s,c]=o.size;return t[0]=Math.round(c*a+s*u),t[1]=Math.round(c*u+s*a),t}function u(t,n,o,r){const[u,a]=n,[s,c]=r,i=.5*o;return t[0]=u-i*s,t[1]=a-i*c,t[2]=u+i*s,t[3]=a+i*c,t}function a(t,n){const[o,r,u,a]=t,[s,c,i,e]=n;return!(o>i||u<s||r>e||a<c)}export{a as bboxIntersects,u as getBBox,r as getOuterSize,o as snapToPixel};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/watchUtils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let c=class extends i{initialize(){this.handles.add(o(this,\"layer\",\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this.declaredClass).error(r)}))})),\"RefreshableLayerView\")}};return r([t()],c.prototype,\"layer\",void 0),c=r([a(\"esri.layers.mixins.RefreshableLayerView\")],c),c};export{i as RefreshableLayerView,i as default};\n"],"names":["_","t","e","debounce","i","property","o","subclass","r","s","create","a","getInfo","p","n","getOuterSize","m","getBBox","l","Bitmap","d","h","c","u","g","f","x","container","fetchSource","requestUpdate","imageMaxWidth","imageMaxHeight","imageRotationSupported","imageNormalizationSupported","hidpi","y","constructor","_imagePromise","bitmaps","update","stationary","destroyed","state","spatialReference","pixelRatio","worldScreenWidth","size","Math","floor","extent","xmin","valid","xmax","rotation","paddedViewState","center","_singleExport","resolution","min","_tiledExport","then","children","includes","fadeOut","remove","addChild","fadeIn","catch","destroy","updating","updateExports","visible","stage","invalidateTexture","requestRender","_export","signal","ymax","width","scales","scale","getTileCoverage","forEach","set","getTileBounds","push","Promise","all","prototype","S","default"],"sourceRoot":"webpack:///"}