{"version":3,"mappings":"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","names":["r","p","maxSize","y","I","i","m","constructor","super","renderChildren","this","createRenderParams","state","prepareRenderPasses","name","g","drawPhase","target","d","getStencilTarget","updateTransforms","setStencilReference","a","destroy","setTransform","c","fetchPopupFeatures","e","s","layer","M","Promise","reject","type","get","allSublayers","toArray","filter","minScale","t","maxScale","popupTemplate","popupEnabled","visible","o","map","createQuery","event","renderer","geometry","createFetchPopupFeaturesQueryGeometry","outFields","getRequiredFields","queryFeatures","features","then","concat","value","Boolean","prototype","_","w","l","arguments","_tileStrategy","_fetchQueue","initialize","tileInfo","spatialReference","equals","view","watch","doRefresh","addResolvingPromise","resampling","update","pause","resume","notifyChange","attach","tileServers","_tileInfoView","fullExtent","tileInfoView","concurrency","length","process","fetchTile","f","cachePolicy","acquireTile","releaseTile","requestUpdate","container","requestRender","detach","clear","removeAllChildren","moveStart","viewChange","moveEnd","updateRequested","suspended","reset","tiles","forEach","_enqueueTileFetch","isUpdating","_bitmapView","createTile","bitmap","x","getTileCoords","key","resolution","getTileResolution","width","height","size","addChild","abort","id","removeChild","once","tilemapCache","signal","resamplingLevel","_fetchImage","h","getTileParentId","u","W","n","fetchAvailabilityUpsample","level","row","col","has","push","source","error","T","P","L"],"sources":["./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","./node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js","./node_modules/@arcgis/core/views/2d/engine/webgl/TiledDisplayObject.js","./node_modules/@arcgis/core/views/layers/TileLayerView.js","./node_modules/@arcgis/core/views/2d/layers/TileLayerView2D.js","./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js","./node_modules/@arcgis/core/views/support/drapedUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}function n(t,n){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?e(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>\"size\"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s=\"touch\"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o=\"visualVariables\"in n?r(s,n.visualVariables):s;if(\"simple\"===n.type)return t(o,n.symbol);if(\"unique-value\"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}export{s as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/has.js\";import{WGLDrawPhase as r}from\"./enums.js\";import s from\"./WGLContainer.js\";import t from\"./brushes/WGLBrushInfo.js\";import n from\"./brushes/WGLBrushStencil.js\";const i=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;class o extends s{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(i),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:r}=e,s=super.createRenderParams(e);return s.requiredLevel=this._tileInfoView.getClosestInfoForScale(r.scale).level,s.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(r.scale),s}prepareRenderPasses(s){const i=super.prepareRenderPasses(s);return i.push(s.registerRenderPass({name:\"stencil\",brushes:[n],drawPhase:r.DEBUG|r.MAP|r.HIGHLIGHT,target:()=>this.getStencilTarget()})),e(\"esri-tiles-debug\")&&i.push(s.registerRenderPass({name:\"tileInfo\",brushes:[t],drawPhase:r.DEBUG,target:()=>this.children})),i}getStencilTarget(){return this.children}updateTransforms(e){for(const r of this.children){const s=this._tileInfoView.getTileResolution(r.key);r.setTransform(e,s)}}setStencilReference(){let e=1;for(const r of this.children)r.stencilRef=e++}}export{o as default,i as sortByLevel};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{s as t,m as s}from\"../../../../chunks/mat3.js\";import{DisplayObject as i}from\"../DisplayObject.js\";import e from\"../../tiling/TileKey.js\";class r extends i{constructor(t,s,i,r,h,o=r,n=h){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new e(t),this.x=s,this.y=i,this.width=r,this.height=h,this.rangeX=o,this.rangeY=n}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(i,e){const r=e/(i.resolution*i.pixelRatio),h=this.transforms.tileMat3,[o,n]=i.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*r,l=this.height/this.rangeY*r;t(h,a,0,0,0,l,0,o,n,1),s(this.transforms.dvs,i.displayViewMat3,h)}}export{r as TiledDisplayObject};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{eachAlways as o}from\"../../core/promiseUtils.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{calculateTolerance as p}from\"../../renderers/support/clickToleranceUtils.js\";const i=i=>{let c=class extends i{async fetchPopupFeatures(e,s){const{layer:a}=this;if(!e)return Promise.reject(new r(\"tilelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:a}));if(\"tile\"!==a.type)return Promise.reject(new r(\"tilelayerview:fetchPopupFeatures\",\"Layer type should be 'tile'\",{type:a.type}));const i=this.get(\"view.scale\"),c=a.allSublayers.toArray().filter((e=>{const r=0===e.minScale||i<=e.minScale,t=0===e.maxScale||i>=e.maxScale;return e.popupTemplate&&e.popupEnabled&&e.visible&&r&&t}));return o(c.map((async r=>{const o=r.createQuery(),a=t(s)?s.event:null,i=p({renderer:r.renderer,event:a});o.geometry=this.createFetchPopupFeaturesQueryGeometry(e,i),o.outFields=await r.popupTemplate.getRequiredFields();return(await r.queryFeatures(o)).features}))).then((e=>[].concat(...e.map((e=>e.value)).filter(Boolean))))}};return e([s()],c.prototype,\"layer\",void 0),c=e([a(\"esri.layers.mixins.TileLayerView\")],c),c};export{i as TileLayerView,i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Error.js\";import i from\"../../../core/Logger.js\";import{isAbortError as s}from\"../../../core/promiseUtils.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import{BitmapTileLayerView2D as l}from\"./BitmapTileLayerView2D.js\";import{LayerView2DMixin as o}from\"./LayerView2D.js\";import{createBlankImage as h,resampleImage as n}from\"./support/imageUtils.js\";import c from\"../tiling/TileInfoView.js\";import u from\"../tiling/TileKey.js\";import p from\"../tiling/TileQueue.js\";import f from\"../tiling/TileStrategy.js\";import m from\"../../layers/LayerView.js\";import{RefreshableLayerView as y}from\"../../layers/RefreshableLayerView.js\";import{TileLayerView as w}from\"../../layers/TileLayerView.js\";import{createQueryGeometry as g}from\"../../support/drapedUtils.js\";const d=i.getLogger(\"esri.views.2d.layers.TileLayerView2D\"),_=[0,0];let I=class extends(w(y(l(o(m))))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}initialize(){const e=this.layer.tileInfo,i=e&&e.spatialReference;let s;i||(s=new t(\"layerview:tiling-information-missing\",\"The layer doesn't provide tiling information\",{layer:this.layer})),i.equals(this.view.spatialReference)||(s=new t(\"layerview:spatial-reference-incompatible\",\"The spatial reference of this layer does not meet the requirements of the view\",{layer:this.layer})),this.watch(\"resampling\",(()=>{this.doRefresh()})),s&&this.addResolvingPromise(Promise.reject(s))}get resampling(){return!(\"resampling\"in this.layer)||!1!==this.layer.resampling}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange(\"updating\")}attach(){const e=\"tileServers\"in this.layer?this.layer.tileServers:null;this._tileInfoView=new c(this.layer.tileInfo,this.layer.fullExtent),this._fetchQueue=new p({tileInfoView:this._tileInfoView,concurrency:e&&10*e.length||10,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new f({cachePolicy:\"keep\",resampling:this.resampling,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this.requestUpdate(),this.container.requestRender(),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return g(e,t,this.view)}async doRefresh(){this.updateRequested||this.suspended||(this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>this._enqueueTileFetch(e))),this.notifyChange(\"updating\"))}isUpdating(){var e;return(null==(e=this._fetchQueue)?void 0:e.length)>0}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(_,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(t),this._bitmapView.addChild(t),this.requestUpdate(),t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e,t={}){const i=\"tilemapCache\"in this.layer?this.layer.tilemapCache:null,{signal:r,resamplingLevel:a=0}=t;if(!i)try{return await this._fetchImage(e,r)}catch(c){if(!s(c)&&!this.resampling)return h(this._tileInfoView.tileInfo.size);if(a<3){const i=this._tileInfoView.getTileParentId(e.id);if(i){const s=new u(i),r=await this.fetchTile(s,{...t,resamplingLevel:a+1});return n(this._tileInfoView,r,s,e)}}throw c}const l=new u(0,0,0,0);let o;try{if(await i.fetchAvailabilityUpsample(e.level,e.row,e.col,l,{signal:r}),l.level!==e.level&&!this.resampling)return h(this._tileInfoView.tileInfo.size);o=await this._fetchImage(l,r)}catch(c){if(s(c))throw c;o=await this._fetchImage(e,r)}return this.resampling?n(this._tileInfoView,o,l,e):o}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);e.bitmap.source=t,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once(\"attach\",(()=>this.requestUpdate()))}catch(t){s(t)||d.error(t)}this.requestUpdate()}}async _fetchImage(e,t){return this.layer.fetchTile(e.level,e.row,e.col,{signal:t})}};e([r()],I.prototype,\"resampling\",null),I=e([a(\"esri.views.2d.layers.TileLayerView2D\")],I);const T=I;export{T as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/watchUtils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let c=class extends i{initialize(){this.handles.add(o(this,\"layer\",\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this.declaredClass).error(r)}))})),\"RefreshableLayerView\")}};return r([t()],c.prototype,\"layer\",void 0),c=r([a(\"esri.layers.mixins.RefreshableLayerView\")],c),c};export{i as RefreshableLayerView,i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import{isSome as e,isNone as t}from\"../../core/maybe.js\";import{getMetersPerUnitForSR as r}from\"../../core/unitUtils.js\";import{calculateTolerance as n}from\"../../renderers/support/clickToleranceUtils.js\";import i from\"../../geometry/Extent.js\";function a(t,n,a,o=new i){let s;if(\"2d\"===a.type)s=n*a.resolution;else if(\"3d\"===a.type){const i=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?r(o)/r(a.spatialReference):n*i}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,i){const o=i.toMap(e);if(t(o))return!1;return a(o,n(),i,s).intersects(r)}const s=new i;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n"],"sourceRoot":"webpack:///","file":"3403.36bed6af5ffd1e67ee31.js"}