"use strict";var Fe=Object.defineProperty,M=Object.getOwnPropertySymbols,ve=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable,U=(F,p,s)=>p in F?Fe(F,p,{enumerable:!0,configurable:!0,writable:!0,value:s}):F[p]=s,S=(F,p)=>{for(var s in p||(p={}))ve.call(p,s)&&U(F,s,p[s]);if(M)for(var s of M(p))Ne.call(p,s)&&U(F,s,p[s]);return F};(self.webpackChunkbio_medical=self.webpackChunkbio_medical||[]).push([[7722],{57722:(F,p,s)=>{s.r(p),s.d(p,{default:()=>ce,inferFieldType:()=>G,inferFields:()=>V,inferLocationInfo:()=>P});var g=s(49996),q=(s(61243),s(30351)),v=s(61414),$=s(22345),A=s(25276),b=s(7808),Z=s(30164),Y=s(19784),z=s(27889),T=s(35169),W=s(3403),k=s(56499),B=s(82760),J=s(81091),H=s(79371),K=s(64740);const X=/^\s*"([\S\s]*)"\s*$/,_=/""/g,ee=[","," ",";","|","\t"];function*D(o,n,e){let t=0;for(;t<=o.length;){const i=o.indexOf(n,t),r=o.substring(t,i>-1?i:void 0);t+=r.length+n.length,e&&!r.trim()||(yield r)}}function O(o){const n=o.includes("\r\n")?"\r\n":"\n";return D(o,n,!0)}function te(o,n){return D(o,n,!1)}function*j(o,n,e,t=(()=>Object.create(null))){let i="",r="",a=0,d=t(),f=0;e:for(const l of o){const c=te(l,e);for(const m of c)if(i+=r+m,r="",a+=ie(m),a%2==0){if(a>0){const N=X.exec(i);if(!N){d=t(),f=0,i="",a=0;continue e}d[n[f]]=N[1].replace(_,'"'),f++}else d[n[f]]=i,f++;i="",a=0}else r=e;0===a?(yield d,d=t(),f=0):r="\n"}}function ie(o){let n=0,e=0;for(e=o.indexOf('"',e);e>=0;)n++,e=o.indexOf('"',e+1);return n}var w=s(45033),re=s(62419),oe=s(6663),le=s(96583);const se=(0,w.bU)("esriGeometryPoint"),ae=["csv"],ue=[0,0];class de{constructor(n,e){this.x=n,this.y=e}}class ce{constructor(){var n=this;this._queryEngine=null,this._snapshotFeatures=function(){var e=(0,g.Z)(function*(t){const i=yield n._fetch(t);return n._createFeatures(i)});return function(t){return e.apply(this,arguments)}}()}destroy(){var n;null==(n=this._queryEngine)||n.destroy(),this._queryEngine=null}load(n,e={}){var t=this;return(0,g.Z)(function*(){var i;t.loadOptions=n;const[r]=yield Promise.all([t._fetch(e.signal),t._checkProjection(null==n||null==(i=n.parsingOptions)?void 0:i.spatialReference)]),a=function(o,n){const e=n.parsingOptions||{},t={delimiter:e.delimiter,layerDefinition:null,locationInfo:{latitudeFieldName:e.latitudeField,longitudeFieldName:e.longitudeField}},i=O(o);let r=i.next().value;if(!r)throw new v.Z("csv-layer:empty-csv","CSV is empty",{csv:o});if(r=r.trim(),!e.delimiter){const l=function(o){const n=o.trim();let e=0,t="";for(const i of ee){const r=n.split(i).length;r>e&&(e=r,t=i)}return""===t?null:t}(r);if(!l)throw new v.Z("csv-layer:invalid-delimiter","Unable to detect the delimiter from CSV");t.delimiter=l}const a=r.split(t.delimiter).filter(l=>!!l),d=t.layerDefinition={name:(0,Z.vt)(n.url,ae)||"csv",drawingInfo:se,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:e.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:e.spatialReference||{wkid:102100}}};if(!e.latitudeField||!e.longitudeField){const l=P(a);if(!e.longitudeField&&!l.longitudeFieldName||!e.latitudeField&&!l.latitudeFieldName)throw new v.Z("csv-layer:location-fields-not-found","Unable to identify latitude and longitude fields from the CSV file");t.locationInfo={longitudeFieldName:e.longitudeField||l.longitudeFieldName,latitudeFieldName:e.latitudeField||l.latitudeFieldName}}const f=V(i,t.delimiter,a,t.locationInfo);if(e.fields&&e.fields.length){const l=new Map;for(const c of e.fields)l.set(c.name.toLowerCase(),c);for(const c of f){const m=l.get(c.name.toLowerCase());if(m){const N=c.name;Object.assign(c,m),c.name=N}}}if(d.fields=f,!d.fields.some(l=>"esriFieldTypeOID"===l.type&&(d.objectIdField=l.name,!0))){const l={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1};d.objectIdField=l.name,d.fields.unshift(l)}if(d.timeInfo){const l=new re.Z(d.fields),c=d.timeInfo;if(c.startTimeField){const m=l.get(c.startTimeField);m?(c.startTimeField=m.name,m.type="esriFieldTypeDate"):c.startTimeField=null}if(c.endTimeField){const m=l.get(c.endTimeField);m?(c.endTimeField=m.name,m.type="esriFieldTypeDate"):c.endTimeField=null}if(c.trackIdField){const m=l.get(c.trackIdField);c.trackIdField=m?m.name:null}c.startTimeField||c.endTimeField||(d.timeInfo=null)}return t}(r,n);t.locationInfo=a.locationInfo,t.delimiter=a.delimiter,t._queryEngine=t._createQueryEngine(a);const d=yield t._createFeatures(r);if(t._queryEngine.featureStore.addMany(d),a.layerDefinition.extent=t._queryEngine.fullExtent,a.layerDefinition.timeInfo){const{start:f,end:l}=t._queryEngine.timeExtent;a.layerDefinition.timeInfo.timeExtent=[f,l]}return a})()}applyEdits(){return(0,g.Z)(function*(){throw new v.Z("csv-layer:editing-not-supported","applyEdits() is not supported on CSVLayer")})()}queryFeatures(n={},e={}){var t=this;return(0,g.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQuery(n,e.signal)})()}queryFeatureCount(n={},e={}){var t=this;return(0,g.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForCount(n,e.signal)})()}queryObjectIds(n={},e={}){var t=this;return(0,g.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForIds(n,e.signal)})()}queryExtent(n={},e={}){var t=this;return(0,g.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForExtent(n,e.signal)})()}querySnapping(n,e={}){var t=this;return(0,g.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForSnapping(n,e.signal)})()}refresh(n){var e=this;return(0,g.Z)(function*(){var t;return e.loadOptions.customParameters=n,null==(t=e._snapshotTask)||t.abort(),e._snapshotTask=(0,b.vr)(e._snapshotFeatures),e._snapshotTask.promise.then(i=>{e._queryEngine.featureStore.clear(),i&&e._queryEngine.featureStore.addMany(i)},i=>{e._queryEngine.featureStore.clear(),(0,b.D_)(i)||$.Z.getLogger("esri.layers.CSVLayer").error(new v.Z("csv-layer:refresh","An error occurred during refresh",{error:i}))}),yield e._waitSnapshotComplete(),{extent:e._queryEngine.fullExtent,timeExtent:e._queryEngine.timeExtent}})()}_waitSnapshotComplete(){var n=this;return(0,g.Z)(function*(){if(n._snapshotTask&&!n._snapshotTask.finished){try{yield n._snapshotTask.promise}catch(e){}return n._waitSnapshotComplete()}})()}_fetch(n){var e=this;return(0,g.Z)(function*(){const{url:t,customParameters:i}=e.loadOptions;if(!t)throw new v.Z("csv-layer:invalid-source","url not defined");const r=(0,Z.mN)(t);return(yield(0,q.default)(r.path,{query:S(S({},r.query),i),responseType:"text",signal:n})).data})()}_createQueryEngine(n){const{objectIdField:e,fields:t,extent:i,timeInfo:r}=n.layerDefinition,a=new J.Z({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1});return new K.Z({fields:t,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:r,objectIdField:e,spatialReference:i.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:a})}_createFeatures(n){var e=this;return(0,g.Z)(function*(){const{latitudeFieldName:t,longitudeFieldName:i}=e.locationInfo,{objectIdField:r,fieldsIndex:a,spatialReference:d}=e._queryEngine;let f=[];const l=[],c=a.fields.filter(u=>u.name!==r).map(u=>u.name);let m=0;const N=O(n);N.next();const Q={};for(const u of a.fields)if("esriFieldTypeOID"!==u.type&&"esriFieldTypeGlobalID"!==u.type){const h=(0,oe.os)(u);void 0!==h&&(Q[u.name]=h)}const he=j(N,c,e.delimiter,(0,w.Dm)(Q,r));for(const u of he){const h=e._parseCoordinateValue(u[t]),I=e._parseCoordinateValue(u[i]);if(null!=I&&null!=h&&!isNaN(h)&&!isNaN(I)){u[t]=h,u[i]=I;for(const y in u)if(y!==t&&y!==i)if(a.isDateField(y)){const x=new Date(u[y]);u[y]=R(x,u[y])?x.getTime():null}else if(a.isNumericField(y)){const x=E(u[y]);isNaN(x)?u[y]=null:u[y]=x}u[r]=m,m++,f.push(new de(I,h)),l.push(u)}}if(!(0,T.fS)({wkid:4326},d))if((0,T.sS)(d))for(const u of f)[u.x,u.y]=(0,W.hG)(u.x,u.y,ue);else f=(0,Y.oj)(z.N,f,le.Z.WGS84,d,null);const L=[];for(let u=0;u<f.length;u++){const{x:h,y:I}=f[u],y=l[u];y[r]=u+1,L.push(new k.ZP(new B.Z([],[h,I]),y,null,y[r]))}return L})()}_parseCoordinateValue(n){if(null==n||""===n)return null;let e=E(n);return(isNaN(e)||Math.abs(e)>181)&&(e=parseFloat(n)),e}_checkProjection(n){return(0,g.Z)(function*(){try{yield(0,H._W)(T.Zn,n)}catch(e){throw new v.Z("csv-layer:projection-not-supported","Projection not supported")}})()}}const me=["lat","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point-y"],ye=["lon","lng","long","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point-x"];function P(o){const n=o.map(e=>e.toLowerCase());return{longitudeFieldName:o[n.indexOf(ye.find(e=>n.includes(e)))],latitudeFieldName:o[n.indexOf(me.find(e=>n.includes(e)))]}}function V(o,n,e,t){const i=[],r=j(o,e,n),a=[];for(const d of r){if(10===a.length)break;a.push(d)}for(const d of e)if(d===t.longitudeFieldName||d===t.latitudeFieldName)i.push({name:d,type:"esriFieldTypeDouble",alias:d});else{const f=G(a.map(c=>c[d])),l={name:d,type:null,alias:d};switch(f){case"integer":l.type="esriFieldTypeInteger";break;case"double":l.type="esriFieldTypeDouble";break;case"date":l.type="esriFieldTypeDate",l.length=36;break;default:l.type="esriFieldTypeString",l.length=255}i.push(l)}return i}function G(o){if(!o.length)return"string";const n=/[^+-.,0-9]/;return o.map(e=>{let t=!1;if(""!==e){if(n.test(e))t=!0;else{let i=E(e);if(!isNaN(i))return/[.,]/.test(e)||!Number.isInteger(i)||i>214783647||i<-214783648?"double":"integer";if(-1===e.indexOf("E"))t=!0;else{if(i=Number(e),!isNaN(i))return"double";if(-1===e.indexOf(","))t=!0;else{if(e=e.replace(",","."),i=Number(e),!isNaN(i))return"double";t=!0}}}return t?/^[-]?\d*[.,]?\d*$/.test(e)?"string":R(new Date(e),e)?"date":"string":"string"}}).reduce((e,t)=>void 0===e||e===t?t:"string"===e||"string"===t?"string":"double"===e||"double"===t?"double":void 0)}const pe=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,ge=Number.isNaN(new Date("technology 10").getTime());function R(o,n){if(!o||"[object Date]"!==Object.prototype.toString.call(o)||isNaN(o.getTime()))return!1;let e=!0;if(!ge&&/\d+\W*$/.test(n)){const t=n.match(/[a-zA-Z]{2,}/);if(t){let i=!1,r=0;for(;!i&&r<=t.length;)i=!pe.test(t[r]),r++;e=!i}}return e}const E=function(){const o=(0,A.lt)(),n=new RegExp("^"+o.regexp+"$"),e=new RegExp("["+o.group+"\\s\\xa0]","g"),t=o.factor;return function(i){const r=n.exec(i);if(o.factor=t,!r)return NaN;let a=r[1];if(!r[1]){if(!r[2])return NaN;a=r[2],o.factor*=-1}return a=a.replace(e,"").replace(o.decimal,"."),+a*o.factor}}()}}]);
//# sourceMappingURL=7722.130f900f251ff41a140b.js.map