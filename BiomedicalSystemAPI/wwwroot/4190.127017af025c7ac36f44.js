"use strict";(self.webpackChunkbio_medical=self.webpackChunkbio_medical||[]).push([[4190],{62642:(G,V,a)=>{a.d(V,{Z:()=>n});var v=a(30627),h=a(31620),R=a(84700),D=a(35138),T=a(50257);const b=(g,u)=>g.key.level-u.key.level!=0?g.key.level-u.key.level:g.key.row-u.key.row!=0?g.key.row-u.key.row:g.key.col-u.key.col;class n extends R.Z{constructor(u){super(),this._tileInfoView=u}get requiresDedicatedFBO(){return!1}renderChildren(u){this.sortChildren(b),this.setStencilReference(),super.renderChildren(u)}createRenderParams(u){const{state:y}=u,d=super.createRenderParams(u);return d.requiredLevel=this._tileInfoView.getClosestInfoForScale(y.scale).level,d.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(y.scale),d}prepareRenderPasses(u){const y=super.prepareRenderPasses(u);return y.push(u.registerRenderPass({name:"stencil",brushes:[T.Z],drawPhase:h.jx.DEBUG|h.jx.MAP|h.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,v.Z)("esri-tiles-debug")&&y.push(u.registerRenderPass({name:"tileInfo",brushes:[D.Z],drawPhase:h.jx.DEBUG,target:()=>this.children})),y}getStencilTarget(){return this.children}updateTransforms(u){for(const y of this.children){const d=this._tileInfoView.getTileResolution(y.key);y.setTransform(u,d)}}setStencilReference(){let u=1;for(const y of this.children)y.stencilRef=u++}}},62561:(G,V,a)=>{a.d(V,{I:()=>D});var v=a(72425),h=a(17821),R=a(5507);class D extends h.s{constructor(b,n,g,u,y,d=u,P=y){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new R.Z(b),this.x=n,this.y=g,this.width=u,this.height=y,this.rangeX=d,this.rangeY=P}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(b,n){const g=n/(b.resolution*b.pixelRatio),u=this.transforms.tileMat3,[y,d]=b.toScreenNoRotation([0,0],[this.x,this.y]),P=this.width/this.rangeX*g,_=this.height/this.rangeY*g;(0,v.s)(u,P,0,0,0,_,0,y,d,1),(0,v.m)(this.transforms.dvs,b.displayViewMat3,u)}}},34190:(G,V,a)=>{a.r(V),a.d(V,{default:()=>Oe});var v=a(49996),h=a(79076),R=a(99326),D=a(22345),T=a(7808),b=a(11652),n=a(94911),d=(a(45072),a(30627),a(55865),a(96410)),P=a(98101),_=a(78081),m=a(18502),S=a(7401),w=a(55008),O=a(67495),I=a(87266),X=a(87406),k=a(62561);class ne extends k.I{constructor(e,t,i,r,l,o=null){super(e,t,i,r,l),this.bitmap=new X.br(o,null,null),this.bitmap.coordScale=[r,l],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}setTransform(e,t){super.setTransform(e,t),this.bitmap.transforms.dvs=this.transforms.dvs}_createTransforms(){return{dvs:(0,I.c)(),tileMat3:(0,I.c)()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}var N=a(31620),$=a(62642);class he extends $.Z{constructor(){super(...arguments),this.isCustomTilingScheme=!1}createTile(e){const t=this._getTileBounds(e),[i,r]=this._tileInfoView.tileInfo.size;return new ne(e,t[0],t[3],i,r)}destroyTile(){}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (tile)",brushes:[O.U.raster],target:()=>this.children.map(i=>i.bitmap),drawPhase:N.jx.MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===N.jx.MAP&&super.doRender(e)}_getTileBounds(e){const t=this._tileInfoView.getTileBounds((0,S.Ue)(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:i}=this._tileInfoView,r=(0,w.ut)(i.spatialReference);if(r){const{resolution:l}=i.lodAt(e.level),o=r/l%i.size[0],c=o?(i.size[0]-o)*l:0;t[0]-=c*e.world,t[2]-=c*e.world}}return t}}a(61243);var ue=a(62091),ce=a(36262),de=a(77847),ye=a(87940),M=a(33135),me=a(85572),Q=a(11057),pe=(a(1153),a(71850)),fe=(a(5507),a(73795)),q=a(98548),ge=a(62965),ve=a(70157);const be=[0,0],ee=D.Z.getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let x=class extends ue.r{constructor(){super(...arguments),this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=null,this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._globalUpdateRequested=!1,this.container=null,this.layer=null,this.redrawOrRefetch=(0,T.Ds)((s,e)=>!this.previousLOD||this.layerView.suspended?Promise.resolve():s?this.doRefresh():this._redrawImage(e))}get useWebGLForProcessing(){var s;return null==(s=this._get("useWebGLForProcessing"))||s}set useWebGLForProcessing(s){this._set("useWebGLForProcessing",s)}get useProgressiveUpdate(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")}set useProgressiveUpdate(s){if(this._tileStrategy&&this.useProgressiveUpdate!==s){this._tileStrategy.destroy(),this.container.removeAllChildren();const e=this._getCacheSize(s);this._tileStrategy=new q.Z({cachePolicy:"purge",acquireTile:t=>this.acquireTile(t),releaseTile:t=>this.releaseTile(t),cacheSize:e,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",s),this.layerView.requestUpdate()}}update(s){this._fetchQueue.pause(),this._fetchQueue.state=s.state,this._tileStrategy.update(s),this._fetchQueue.resume();const{extent:e,resolution:t,scale:i}=s.state,r=this._tileInfoView.getClosestInfoForScale(i);if(this.layer.raster){var l;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const o=this._srcResolutions[r.level],c=e.toJSON?e:ve.Z.fromJSON(e);(0,M.Vx)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,c,t,o,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(l=this.previousLOD)?void 0:l.level)!==r.level&&(this.previousLOD=r,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()}));const s=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(s),this.layerView.requestUpdate()}get updating(){return this._fetchQueue.length>0||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}attach(){(0,ge.Z)().supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new pe.Z(this.layerView.tileInfo,this.layerView.fullExtent);const s=this._computeFetchConcurrency();this._fetchQueue=new fe.Z({tileInfoView:this._tileInfoView,concurrency:s,process:(t,i)=>this._fetchTile1(t,i)});const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new q.Z({cachePolicy:"purge",acquireTile:t=>this.acquireTile(t),releaseTile:t=>this.releaseTile(t),cacheSize:e,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}acquireTile(s){const e=this.container.createTile(s);return this._enqueueTileFetch(e),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,e}releaseTile(s){this._fetchQueue.abort(s.key.id),this.container.removeChild(s),s.once("detach",()=>{s.destroy(),this.layerView.requestUpdate()}),this.layerView.requestUpdate()}uninstall(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,this.notifyChange("updating"),(0,M.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}createEmptyTilePixelBlock(s=null){const e=null==s||s.join(",")===this._tileInfoView.tileInfo.size.join(",");if(e&&(0,m.pC)(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;s=s||this._tileInfoView.tileInfo.size;const[t,i]=s,r=new de.Z({width:t,height:i,pixels:[new Uint8Array(t*i)],mask:new Uint8Array(t*i),pixelType:"u8"});return e&&(this._emptyTilePixelBlock=r),r}_fetchTile1(s,e){const t=!(0,m.Wi)(e)&&e.signal,i=this.canUseWebGLForProcessing(),r={allowPartialFill:!0,datumTransformation:this.layerView.datumTransformation,interpolation:i?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:i,signal:(0,m.Wg)(t),srcResolution:this._srcResolutions[s.level],timeExtent:this.layerView.timeExtent,tileInfo:this.layerView.tileInfo};return this.fetchTile(s,r)}_getCacheSize(s){return s?40:0}_initializeTileInfo(){const s=this.layerView.view.spatialReference,e=new ce.Z({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:s}),{scales:t,srcResolutions:i,isCustomTilingScheme:r}=(0,Q.vF)(this.layer.rasterInfo,s),l=ye.Z.create({spatialReference:s,size:512,scales:t});(0===l.origin.x||l.origin.x>e.x)&&(l.origin=e),this._isCustomTilingScheme=r,this.layerView.set("tileInfo",l),this._srcResolutions=null!=i?i:[]}_computeFetchConcurrency(){const{blockBoundary:s}=this.layer.rasterInfo.storageInfo,e=s[s.length-1];return(e.maxCol-e.minCol+1)*(e.maxRow-e.minRow+1)>64?2:10}_enqueueTileFetch(s,e){var t=this;return(0,v.Z)(function*(){if(!t._fetchQueue.has(s.key.id)){try{const i=yield t._fetchQueue.push(s.key);t.notifyChange("updating");const{bandIds:r}=t.layer;let l=!t.useProgressiveUpdate||t.layerView.hasTilingEffects&&!t._globalSymbolizerParams;if(t._globalUpdateRequested&&!t.layerView.moving&&0===t._fetchQueue.length){l=!1;try{yield t._redrawImage(t._abortController&&t._abortController.signal)}catch(p){(0,T.D_)(p)&&ee.error(p)}t._globalUpdateRequested=!1}!t.canUseWebGLForProcessing()&&"rasterVF"!==t.type||t.layerView.hasTilingEffects||null!=t._symbolizerParams||t._updateSymbolizerParams();const o=t._tileInfoView.getTileCoords(be,s.key),c=t._tileInfoView.getTileResolution(s.key);yield t.updateTileSource(s,{source:i,symbolizerParams:t._symbolizerParams,globalSymbolizerParams:t._globalSymbolizerParams,suspended:l,bandIds:r,coords:o,resolution:c}),s.once("attach",()=>t.layerView.requestUpdate()),t.container.addChild(s)}catch(i){(0,T.D_)(i)||ee.error(i)}t.layerView.requestUpdate()}})()}_redrawImage(s){var e=this;return(0,v.Z)(function*(){if(0===e.container.children.length)return;yield e.updatingHandles.addPromise(e.layer.updateRenderer()),e.layerView.hasTilingEffects?yield e._updateGlobalSymbolizerParams(s):(e._updateSymbolizerParams(),e._globalSymbolizerParams=null);const t=e.container.children.map(function(){var i=(0,v.Z)(function*(r){return e.updateTileSymbolizerParameters(r,{local:e._symbolizerParams,global:e._globalSymbolizerParams})});return function(r){return i.apply(this,arguments)}}());yield(0,T.as)(t),e.container.requestRender()})()}_updateGlobalSymbolizerParams(s){var e=this;return(0,v.Z)(function*(){const t={srcResolution:e._srcResolutions[e.previousLOD.level],registryId:e._blockCacheRegistryId,signal:s},i=yield e.layer.fetchPixels(e.layerView.view.extent,e.layerView.view.width,e.layerView.view.height,t);if(!i||!i.pixelBlock)return;const r=e.layer.symbolizer.generateWebGLParameters({pixelBlock:(0,me.qF)(i.pixelBlock,e.layer.bandIds),isGCS:e.layerView.view.spatialReference.isGeographic,resolution:{x:e.previousLOD.resolution,y:e.previousLOD.resolution},bandIds:e.layer.bandIds});!e.canUseWebGLForProcessing()&&r&&"stretch"===r.type&&e.layer.renderer&&"raster-stretch"===e.layer.renderer.type&&(r.factor=r.factor.map(l=>255*l),r.outMin=Math.round(255*r.outMin),r.outMax=Math.round(255*r.outMax)),e._globalSymbolizerParams=r})()}_updateSymbolizerParams(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds})}_updateBlockCacheRegistry(s=!1){const{url:e,rasterInfo:t,raster:i}=this.layer,{multidimensionalDefinition:r}=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent}),l=null!=t&&t.multidimensionalInfo?i.getSliceIndex(r):null,o=(0,M.Rq)(e,l);if(o!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,M.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,M.z2)(o,this.layer.raster.rasterInfo),s){const c=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),p=this._srcResolutions[c.level];(0,M.Vx)(o,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,p,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=o}}doRefresh(){var s=this;return(0,v.Z)(function*(){yield s.updatingHandles.addPromise(s.layer.updateRenderer()),s.layerView.hasTilingEffects||s._updateSymbolizerParams(),s._updateBlockCacheRegistry(!0),s._fetchQueue.reset(),s.notifyChange("updating");const e=[];s._tileStrategy.tiles.forEach(t=>e.push(s._enqueueTileFetch(t))),yield(0,T.as)(e)})()}};(0,h._)([(0,n.Cb)()],x.prototype,"_globalUpdateRequested",void 0),(0,h._)([(0,n.Cb)()],x.prototype,"container",void 0),(0,h._)([(0,n.Cb)()],x.prototype,"layer",void 0),(0,h._)([(0,n.Cb)()],x.prototype,"layerView",void 0),(0,h._)([(0,n.Cb)()],x.prototype,"type",void 0),(0,h._)([(0,n.Cb)()],x.prototype,"useWebGLForProcessing",null),(0,h._)([(0,n.Cb)()],x.prototype,"useProgressiveUpdate",null),(0,h._)([(0,n.Cb)()],x.prototype,"updating",null),x=(0,h._)([(0,d.j)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],x);var te=a(28121);let B=class extends x{constructor(){super(...arguments),this.container=null,this.layer=null,this.type="raster"}canUseWebGLForProcessing(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&(0,te.JV)(this.layer))}fetchTile(s,e){return this.layer.fetchTile(s.level,s.row,s.col,e)}updateTileSource(s,e){var t=this;return(0,v.Z)(function*(){const{bandIds:i}=t.layer,r=t._getLayerInterpolation(),l=t.canUseWebGLForProcessing(),{source:o,symbolizerParams:c,globalSymbolizerParams:p,suspended:C,coords:E,resolution:F}=e,{bitmap:f}=s;if([f.x,f.y]=E,f.resolution=F,o&&(0,m.pC)(o)&&(0,m.pC)(o.pixelBlock)){const U={extent:o.extent,pixelBlock:o.pixelBlock};if(f.rawPixelData=U,l)f.source=o.pixelBlock,f.isRendereredSource=!1;else{const L=yield t.layer.applyRenderer(U,"stretch"===(null==p?void 0:p.type)?p:null);f.source=L,f.isRendereredSource=!0}f.symbolizerParameters=l?c:null,l?f.transformGrid||(f.transformGrid=o.transformGrid):f.transformGrid=null}else{const U=t.createEmptyTilePixelBlock();f.source=U,f.symbolizerParameters=l?c:null,f.transformGrid=null}f.bandIds=l?i:null,f.width=t._tileInfoView.tileInfo.size[0],f.height=t._tileInfoView.tileInfo.size[1],f.interpolation=r,f.suspended=C,f.invalidateTexture()})()}updateTileSymbolizerParameters(s,e){var t=this;return(0,v.Z)(function*(){const{local:i,global:r}=e,{bandIds:l}=t.layer,o=t._getLayerInterpolation(),c=t.canUseWebGLForProcessing(),{bitmap:p}=s,{rawPixelData:C}=p;!c&&(0,m.pC)(C)?(p.source=yield t.layer.applyRenderer(C,"stretch"===(null==r?void 0:r.type)?r:null),p.isRendereredSource=!0):(p.isRendereredSource&&(0,m.pC)(C)&&(p.source=C.pixelBlock),p.isRendereredSource=!1),p.symbolizerParameters=c?r||i:null,p.bandIds=c?l:null,p.interpolation=o,p.suspended=!1})()}install(s){this.container=new he(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,s.addChild(this.container)}uninstall(){this.container.removeAllChildren(),this.container.remove(),super.uninstall()}_getLayerInterpolation(){const s=this.layer.renderer.type;if("raster-colormap"===s||"unique-value"===s||"class-breaks"===s)return"nearest";const{interpolation:e}=this.layer,{renderer:t}=this.layer;return"raster-stretch"===t.type&&null!=t.colorRamp?"bilinear"===e||"cubic"===e?"bilinear":"nearest":e}};(0,h._)([(0,n.Cb)()],B.prototype,"container",void 0),(0,h._)([(0,n.Cb)()],B.prototype,"layer",void 0),(0,h._)([(0,n.Cb)()],B.prototype,"type",void 0),B=(0,h._)([(0,d.j)("esri.views.2d.layers.imagery.ImageryTileView2D")],B);const Pe=B;var W=a(24384),se=a(72425),ie=a(20316),we=(a(1907),a(59450),a(42909),a(30905),a(36079),a(86550)),Te=a(17821),_e=a(67201);class Ie extends Te.s{constructor(e=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.stencilRef=0,this.rawPixelData=null,this.width=null,this.source=e}destroy(){var e,t;(0,m.pC)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}get source(){return this._source}set source(e){this._source=e,this.invalidateVAO()}invalidateVAO(){var e,t;!this._vaoInvalidated&&(0,m.pC)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,(0,m.pC)(this.source)&&!(0,m.pC)(this.vaoData)){const{style:t}=this.symbolizerParameters;switch(t){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const i=(0,W.wF)(this.source,this.symbolizerParameters),r=this._createVectorFieldVAO(e.context,i);this.vaoData={magdir:r}}break;case"simple_scalar":{const i=(0,W.K)(this.source,this.symbolizerParameters),r=this._createVectorFieldVAO(e.context,i);this.vaoData={scalar:r}}break;case"wind_speed":{const i=(0,W.wF)(this.source,this.symbolizerParameters),r=this._createVectorFieldVAO(e.context,i),l=(0,W.K)(this.source,this.symbolizerParameters),o=this._createVectorFieldVAO(e.context,l);this.vaoData={magdir:r,scalar:o}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:(0,I.c)()}}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(e,t){const{vertexData:i,indexData:r}=t,l=ie.Z.createVertex(e,35044,new Float32Array(i)),o=ie.Z.createIndex(e,35044,new Uint32Array(r)),c=(0,_e.cM)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:5126,normalized:!1},{location:1,name:"a_offset",count:2,type:5126,normalized:!1},{location:2,name:"a_vv",count:2,type:5126,normalized:!1}]});return{vao:new we.Z(e,c.attributes,c.bufferLayouts,{geometry:l},o),elementCount:r.length}}}class Ce extends k.I{constructor(e,t,i,r,l,o=null){super(e,t,i,r,l),this.tileData=new Ie(o),this.tileData.coordScale=[r,l],this.tileData.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(e){this.tileData.stencilRef=e}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{dvs:(0,I.c)(),tileMat3:(0,I.c)()}}setTransform(e,t){super.setTransform(e,t);const i=t/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[l,o]=this.tileData.offset,c=[this.x+l*t,this.y-o*t],[p,C]=e.toScreenNoRotation([0,0],c),{symbolTileSize:E}=this.tileData.symbolizerParameters,F=Math.round((this.width-this.tileData.offset[0])/E)*E,f=Math.round((this.height-this.tileData.offset[1])/E)*E,U=F/this.rangeX*i,L=f/this.rangeY*i;(0,se.s)(r,U,0,0,0,L,0,p,C,1),(0,se.m)(this.transforms.dvs,e.displayViewMat3,r),this.tileData.transforms.dvs=this.transforms.dvs}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}var Re=a(18771);class Ve extends $.Z{constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}createTile(e){const t=this._tileInfoView.getTileBounds((0,S.Ue)(),e),[i,r]=this._tileInfoView.tileInfo.size;return new Ce(e,t[0],t[3],i,r)}destroyTile(){}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (vf tile)",brushes:[Re.Z],target:()=>this.children.map(i=>i.tileData),drawPhase:N.jx.MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===N.jx.MAP&&this.symbolTypes.forEach(t=>{e.renderPass=t,super.doRender(e)})}}let A=class extends x{constructor(){super(...arguments),this._handle=null,this.container=null,this.layer=null,this.type="rasterVF"}canUseWebGLForProcessing(){return!1}fetchTile(s,e){var t=this;return(0,v.Z)(function*(){const i=yield t.layer.fetchTile(s.level,s.row,s.col,e);return"vector-magdir"===t.layer.rasterInfo.dataType&&null!=i&&i.pixelBlock&&(i.pixelBlock=yield t.layer.convertVectorFieldData(i.pixelBlock,e)),i})()}updateTileSource(s,e){const t=e.symbolizerParams,{tileData:i}=s;i.key=s.key,i.width=this._tileInfoView.tileInfo.size[0],i.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:r}=t,{source:l}=e;if(i.offset=this._getTileSymbolOffset(i.key,r),(0,m.pC)(l)&&(0,m.pC)(l.pixelBlock)){const o={extent:l.extent,pixelBlock:l.pixelBlock};i.rawPixelData=o,i.source=this._sampleVectorFieldData(l.pixelBlock,t,i.offset),i.symbolizerParameters=t}else{const o=[Math.round((this._tileInfoView.tileInfo[0]-i.offset[0])/r),Math.round((this._tileInfoView.tileInfo[1]-i.offset[1])/r)],c=this.createEmptyTilePixelBlock(o);i.source=c,i.symbolizerParameters=t}return i.invalidateVAO(),Promise.resolve(null)}updateTileSymbolizerParameters(s,e){var t;const i=e.local,{symbolTileSize:r}=i,{tileData:l}=s;l.offset=this._getTileSymbolOffset(l.key,r);const o=l.symbolizerParameters.symbolTileSize;return l.symbolizerParameters=i,(0,m.pC)(null==(t=l.rawPixelData)?void 0:t.pixelBlock)&&o!==r&&(l.source=this._sampleVectorFieldData(l.rawPixelData.pixelBlock,l.symbolizerParameters,l.offset)),Promise.resolve(null)}install(s){this.container=new Ve(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=this.layer.watch("renderer",e=>this._updateSymbolType(e)),s.addChild(this.container)}uninstall(){this.container.removeAllChildren(),this._handle.remove(),this._handle=null,this.container.remove(),super.uninstall()}_getTileSymbolOffset(s,e){const t=s.col*this._tileInfoView.tileInfo.size[0]%e,i=s.row*this._tileInfoView.tileInfo.size[1]%e;return[t>e/2?e-t:-t,i>e/2?e-i:-i]}_sampleVectorFieldData(s,e,t){const{symbolTileSize:i}=e;return(0,W.nb)(s,"vector-uv",i,t)}_updateSymbolType(s){"vector-field"===s.type&&(this.container.symbolTypes="wind-barb"===s.style?["scalar","triangle"]:"simple-scalar"===s.style?["scalar"]:["triangle"])}};(0,h._)([(0,n.Cb)()],A.prototype,"container",void 0),(0,h._)([(0,n.Cb)()],A.prototype,"layer",void 0),(0,h._)([(0,n.Cb)()],A.prototype,"type",void 0),A=(0,h._)([(0,d.j)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],A);const xe=A;var Z=a(61414),De=a(46613),Ee=a(76388);const Se=s=>{let e=class extends s{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.fullExtent=null,this.tileInfo=null,this.datumTransformation=null}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}fetchPopupFeatures(t,i){var r=this;return(0,v.Z)(function*(){const{layer:l}=r;if(!t)return Promise.reject(new Z.Z("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:l}));const{popupEnabled:o}=l,c=(0,Ee.V)(l,i);if(!o||!(0,m.pC)(c))throw new Z.Z("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:o,popupTemplate:c});const p=[],{value:C,magdirValue:E}=yield l.identify(t,{timeExtent:r.timeExtent});let F="";if(C&&C.length){var f,U;F="imagery-tile"===l.type&&l.hasStandardTime()&&null!=C[0]?C.map(J=>l.getStandardTimeValue(J)).join(", "):C.join(", ");const L={ObjectId:0},ae="Raster.ServicePixelValue";L[ae]=r._formatAttributeValue(F,ae);const Y=null==(f=l.rasterInfo)||null==(U=f.attributeTable)?void 0:U.features;if(Y&&Y.length>0){const J=Y.filter(z=>{const K=z.attributes.value||z.attributes.Value||z.attributes.VALUE;return String(K)===F});if(J.length>0){const z=J[0];if(z)for(const K in z.attributes)if(z.attributes.hasOwnProperty(K)){const oe=r._rasterFieldPrefix+K;L[oe]=r._formatAttributeValue(z.attributes[K],oe)}}}const le=l.rasterInfo.dataType;"vector-magdir"!==le&&"vector-uv"!==le||(L["Raster.Magnitude"]=null==E?void 0:E[0],L["Raster.Direction"]=null==E?void 0:E[1]);const H=new R.Z(r.fullExtent.clone(),null,L);H.layer=l,H.sourceLayer=H.layer,p.push(H)}return p})()}updateFullExtent(){const t=this.layer.tileInfo;if(!t||!t.spatialReference)return Promise.reject(new Z.Z("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));if((0,m.Wi)(this.layer.fullExtent))return Promise.reject(new Z.Z("layerview:extent-missing","The layer doesn't provide a full extent.",{layer:this.layer}));const i=(0,Q._D)(this.layer.fullExtent,this.view.spatialReference,!1),r=(0,Q.tB)(this.layer.fullExtent,this.view.spatialReference,i);return null==r?Promise.reject(new Z.Z("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})):(this._set("fullExtent",r),this.datumTransformation||(this.datumTransformation=(0,Q._D)(this.layer.fullExtent,this.view.spatialReference,!0)),Promise.resolve())}_formatAttributeValue(t,i){if("string"==typeof t){const r=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,l=this._getFieldInfo(r,i),o=l&&l.format;if(o){let c,p;return t.trim().indexOf(",")>-1?(c=",",p=c+" ",this._formatDelimitedString(t,c,p,o)):t.trim().indexOf(" ")>-1?(c=p=" ",this._formatDelimitedString(t,c,p,o)):this._formatNumberFromString(t,o)}}return t}_getFieldInfo(t,i){if(!t||!t.length||!i)return;const r=i.toLowerCase();let l;return t.some(o=>!(!o.fieldName||o.fieldName.toLowerCase()!==r&&o.fieldName.toLowerCase()!==r.replace(/ /g,"_")||(l=o,0))),l}_formatDelimitedString(t,i,r,l){return t&&i&&r&&l?t.trim().split(i).map(o=>this._formatNumberFromString(o,l)).join(r):t}_formatNumberFromString(t,i){if(!t||!i)return t;const r=Number(t);return isNaN(r)?t:i.format(r)}};return(0,h._)([(0,n.Cb)()],e.prototype,"layer",void 0),(0,h._)([(0,n.Cb)(De.qG)],e.prototype,"timeExtent",void 0),(0,h._)([(0,n.Cb)()],e.prototype,"view",void 0),(0,h._)([(0,n.Cb)()],e.prototype,"fullExtent",void 0),(0,h._)([(0,n.Cb)()],e.prototype,"tileInfo",void 0),(0,h._)([(0,n.Cb)({readOnly:!0})],e.prototype,"hasTilingEffects",null),e=(0,h._)([(0,d.j)("esri.views.layers.ImageryTileLayerView")],e),e};var Ue=a(96121),Le=a(26263);const re=D.Z.getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let j=class extends(Se((0,Le.y)((0,_.y)(Ue.Z)))){constructor(){super(...arguments),this._useWebGLForProcessing=!0,this._useProgressiveUpdate=!0,this.subview=null}initialize(){const s=this.updateFullExtent();this.addResolvingPromise(s)}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(s){this._useWebGLForProcessing=s,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=s)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(s){this._useProgressiveUpdate=s,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=s)}update(s){this.subview.update(s),this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.handles.add([(0,b.YP)(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(s,e,t)=>{const i="multidimensionalDefinition"===t,r="interpolation"===t&&("majority"===s||"majority"===e)&&(0,te.JV)(this.layer),l="renderer"===t&&e.type!==s.type;l&&this._updateSubview();const o=i||r||l;this.subview.redrawOrRefetch(o).catch(c=>{(0,T.D_)(c)||re.error(c)}),this.notifyChange("updating")}),(0,b.S1)(this,["layer.blendMode"],s=>{this.subview&&(this.subview.container.blendMode=s)},!0),(0,b.S1)(this,["layer.effect"],s=>{this.subview&&(this.subview.container.effect=s)},!0),(0,b.S1)(this,"timeExtent",()=>{this.subview.redrawOrRefetch(!0).catch(s=>{(0,T.D_)(s)||re.error(s)})})],"attach")}detach(){this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this.subview.uninstall()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}hitTest(s,e){return(0,v.Z)(function*(){return[new R.Z({attributes:{},geometry:s.clone()})]})()}doRefresh(){return this.subview.doRefresh()}_updateSubview(){const s="vector-field"===this.layer.renderer.type?"rasterVF":"animated-flow"===this.layer.renderer.type?"rasterAnimatedFlow":"raster";if(this.subview){if(this.subview.type===s)return;this.subview.uninstall()}const{layer:e}=this;let t;t="rasterVF"===s?new xe({layer:e,layerView:this}):"rasterAnimatedFlow"===s?new P.Z({layer:e,layerView:this}):new Pe({layer:e,layerView:this}),"useWebGLForProcessing"in t&&(t.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in t&&(t.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in t&&(t.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD),t.attach(),t.install(this.container),t.container.blendMode=e.blendMode,t.container.effect=e.effect,this.subview=t,this.requestUpdate()}};(0,h._)([(0,n.Cb)()],j.prototype,"subview",void 0),(0,h._)([(0,n.Cb)()],j.prototype,"useWebGLForProcessing",null),(0,h._)([(0,n.Cb)()],j.prototype,"useProgressiveUpdate",null),j=(0,h._)([(0,d.j)("esri.views.2d.layers.ImageryTileLayerView2D")],j);const Oe=j},28121:(G,V,a)=>{a.d(V,{JV:()=>T,oq:()=>R});const h=new(a(74856).Xn)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function R(b){return h.toJSON(b)}function T(b){const{bandCount:n,attributeTable:g,colormap:u,pixelType:y}=b.rasterInfo;return 1===n&&(null!=g||null!=u||"u8"===y||"s8"===y)}},26263:(G,V,a)=>{a.d(V,{y:()=>y});var v=a(79076),h=a(22345),R=a(7808),D=a(11652),T=a(94911),u=(a(45072),a(30627),a(55865),a(96410));const y=d=>{let P=class extends d{initialize(){this.handles.add((0,D.on)(this,"layer","refresh",_=>{this.doRefresh(_.dataChanged).catch(m=>{(0,R.D_)(m)||h.Z.getLogger(this.declaredClass).error(m)})}),"RefreshableLayerView")}};return(0,v._)([(0,T.Cb)()],P.prototype,"layer",void 0),P=(0,v._)([(0,u.j)("esri.layers.mixins.RefreshableLayerView")],P),P}},76388:(G,V,a)=>{a.d(V,{V:()=>b,e:()=>D});var v=a(49996),h=a(18502),R=a(6663);function D(n){return T.apply(this,arguments)}function T(){return(T=(0,v.Z)(function*(n,g=n.popupTemplate){if(!(0,h.pC)(g))return[];const u=yield g.getRequiredFields(n.fieldsIndex),{lastEditInfoEnabled:y}=g,{objectIdField:d,typeIdField:P,globalIdField:_,relationships:m}=n;if(u.includes("*"))return["*"];const S=y?yield(0,R.CH)(n):[],w=(0,R.Q0)(n.fieldsIndex,[...u,...S]);return P&&w.push(P),w&&d&&n.fieldsIndex.has(d)&&-1===w.indexOf(d)&&w.push(d),w&&_&&n.fieldsIndex.has(_)&&-1===w.indexOf(_)&&w.push(_),m&&m.forEach(O=>{const{keyField:I}=O;w&&I&&n.fieldsIndex.has(I)&&-1===w.indexOf(I)&&w.push(I)}),w})).apply(this,arguments)}function b(n,g){return n.popupTemplate?n.popupTemplate:(0,h.pC)(g)&&g.defaultPopupTemplateEnabled&&(0,h.pC)(n.defaultPopupTemplate)?n.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=4190.127017af025c7ac36f44.js.map