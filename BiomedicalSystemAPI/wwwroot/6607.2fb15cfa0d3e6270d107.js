"use strict";var Ke=Object.defineProperty,Je=Object.defineProperties,He=Object.getOwnPropertyDescriptors,Ue=Object.getOwnPropertySymbols,We=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable,we=(W,V,u)=>V in W?Ke(W,V,{enumerable:!0,configurable:!0,writable:!0,value:u}):W[V]=u,de=(W,V)=>{for(var u in V||(V={}))We.call(V,u)&&we(W,u,V[u]);if(Ue)for(var u of Ue(V))Ge.call(V,u)&&we(W,u,V[u]);return W},fe=(W,V)=>Je(W,He(V));(self.webpackChunkbio_medical=self.webpackChunkbio_medical||[]).push([[6607,6648,9836],{56648:(W,V,u)=>{function h(b){return b=b||globalThis.location.hostname,S.some(_=>{var U;return null!=(null==(U=b)?void 0:U.match(_))})}function f(b,_){return b&&(_=_||globalThis.location.hostname)?null!=_.match(p)||null!=_.match(y)?b.replace("static.arcgis.com","staticdev.arcgis.com"):null!=_.match(F)||null!=_.match(c)?b.replace("static.arcgis.com","staticqa.arcgis.com"):b:b}u.d(V,{pJ:()=>f,XO:()=>h});const p=/^devext.arcgis.com$/,F=/^qaext.arcgis.com$/,y=/^[\w-]*\.mapsdevext.arcgis.com$/,c=/^[\w-]*\.mapsqa.arcgis.com$/,S=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,p,F,/^jsapps.esri.com$/,y,c]},91409:(W,V,u)=>{u.d(V,{ym:()=>ve,RF:()=>oe,vY:()=>c,J9:()=>Fe,U1:()=>xe,Ie:()=>he,G6:()=>be});var h=u(18502),f=u(70279);const p=(a,l,d)=>[l,d],F=(a,l,d)=>[l,d,a[2]],y=(a,l,d)=>[l,d,a[2],a[3]];function c(a){return a?{originPosition:"upper-left"===a.originPosition?"upperLeft":"lower-left"===a.originPosition?"lowerLeft":a.originPosition,scale:a.tolerance?[a.tolerance,a.tolerance]:[1,1],translate:(0,h.pC)(a.extent)?[a.extent.xmin,a.extent.ymax]:[0,0]}:null}function b({scale:a,translate:l},d){return Math.round((d-l[0])/a[0])}function _({scale:a,translate:l},d){return Math.round((l[1]-d)/a[1])}function U(a,l,d){const g=[];let E,z,L,K;for(let Y=0;Y<d.length;Y++){const X=d[Y];Y>0?(L=b(a,X[0]),K=_(a,X[1]),L===E&&K===z||(g.push(l(X,L-E,K-z)),E=L,z=K)):(E=b(a,X[0]),z=_(a,X[1]),g.push(l(X,E,z)))}return g.length>0?g:null}function A({scale:a,translate:l},d){return d*a[0]+l[0]}function x({scale:a,translate:l},d){return l[1]-d*a[1]}function N(a,l,d){const g=new Array(d.length);if(!d.length)return g;const[E,z]=a.scale;let L=A(a,d[0][0]),K=x(a,d[0][1]);g[0]=l(d[0],L,K);for(let Y=1;Y<d.length;Y++){const X=d[Y];L+=X[0]*E,K-=X[1]*z,g[Y]=l(X,L,K)}return g}function se(a,l,d){const g=new Array(d.length);for(let E=0;E<d.length;E++)g[E]=N(a,l,d[E]);return g}function J(a,l,d,g,E){return l.points=function(a,l,d,g){return U(a,d?g?y:F:g?F:p,l)}(a,d.points,g,E),l}function oe(a,l,d,g,E){return l.x=b(a,d.x),l.y=_(a,d.y),l!==d&&(g&&(l.z=d.z),E&&(l.m=d.m)),l}function ae(a,l,d,g,E){const z=function(a,l,d,g){const E=[],z=d?g?y:F:g?F:p;for(let L=0;L<l.length;L++){const K=U(a,z,l[L]);K&&K.length>=3&&E.push(K)}return E.length?E:null}(a,d.rings,g,E);return z?(l.rings=z,l):null}function q(a,l,d,g,E){const z=function(a,l,d,g){const E=[],z=d?g?y:F:g?F:p;for(let L=0;L<l.length;L++){const K=U(a,z,l[L]);K&&K.length>=2&&E.push(K)}return E.length?E:null}(a,d.paths,g,E);return z?(l.paths=z,l):null}function ve(a,l){return a&&l?(0,f.wp)(l)?oe(a,{},l,!1,!1):(0,f.l9)(l)?q(a,{},l,!1,!1):(0,f.oU)(l)?ae(a,{},l,!1,!1):(0,f.aW)(l)?J(a,{},l,!1,!1):(0,f.YX)(l)?function(a,l,d,g,E){return l.xmin=b(a,d.xmin),l.ymin=_(a,d.ymin),l.xmax=b(a,d.xmax),l.ymax=_(a,d.ymax),l!==d&&(g&&(l.zmin=d.zmin,l.zmax=d.zmax),E&&(l.mmin=d.mmin,l.mmax=d.mmax)),l}(a,{},l,!1,!1):null:null}function Fe(a,l,d,g,E){return(0,h.pC)(d)&&(l.points=function(a,l,d,g){return N(a,d?g?y:F:g?F:p,l)}(a,d.points,g,E)),l}function xe(a,l,d,g,E){return(0,h.Wi)(d)||(l.x=A(a,d.x),l.y=x(a,d.y),l!==d&&(g&&(l.z=d.z),E&&(l.m=d.m))),l}function he(a,l,d,g,E){return(0,h.pC)(d)&&(l.rings=function(a,l,d,g){return se(a,d?g?y:F:g?F:p,l)}(a,d.rings,g,E)),l}function be(a,l,d,g,E){return(0,h.pC)(d)&&(l.paths=function(a,l,d,g){return se(a,d?g?y:F:g?F:p,l)}(a,d.paths,g,E)),l}},98936:(W,V,u)=>{function h(y,c){return c?"xoffset"in c&&c.xoffset?Math.max(y,Math.abs(c.xoffset)):"yoffset"in c&&c.yoffset?Math.max(y,Math.abs(c.yoffset||0)):y:y}function Z(y,c){return"number"==typeof y?y:y&&y.stops&&y.stops.length?function(y){let c=0,S=0;for(let b=0;b<y.length;b++){const _=y[b].size;"number"==typeof _&&(c+=_,S++)}return c/S}(y.stops):c}function F(y){const c=y&&y.renderer,S="touch"===(y&&y.event&&y.event.pointerType)?9:6;if(!c)return S;const b="visualVariables"in c?function(y,c){if(!c)return y;const S=c.filter(B=>"size"===B.type).map(B=>{const{maxSize:Q,minSize:D}=B;return(Z(Q,y)+Z(D,y))/2});let b=0;const _=S.length;if(0===_)return y;for(let B=0;B<_;B++)b+=S[B];const U=Math.floor(b/_);return Math.max(U,y)}(S,c.visualVariables):S;if("simple"===c.type)return h(b,c.symbol);if("unique-value"===c.type){let _=b;return c.uniqueValueInfos.forEach(U=>{_=h(_,U.symbol)}),_}if("class-breaks"===c.type){let _=b;return c.classBreakInfos.forEach(U=>{_=h(_,U.symbol)}),_}return c.type,b}u.d(V,{k:()=>F})},92216:(W,V,u)=>{u.d(V,{a:()=>y});var h=u(61414),f=u(22345),Z=u(31620),p=u(67201);const F=f.Z.getLogger("esri.views.2d.engine.webgl");function y(c){return(0,p.hj)(c.minDataValue)&&(0,p.hj)(c.maxDataValue)&&null!=c.minSize&&null!=c.maxSize?Z.X.SIZE_MINMAX_VALUE:(c.expression&&"view.scale"===c.expression||c.valueExpression&&"$view.scale"===c.valueExpression)&&Array.isArray(c.stops)?Z.X.SIZE_SCALE_STOPS:(null!=c.field||c.expression&&"view.scale"!==c.expression||c.valueExpression&&"$view.scale"!==c.valueExpression)&&(Array.isArray(c.stops)||"levels"in c&&c.levels)?Z.X.SIZE_FIELD_STOPS:(null!=c.field||c.expression&&"view.scale"!==c.expression||c.valueExpression&&"$view.scale"!==c.valueExpression)&&null!=c.valueUnit?Z.X.SIZE_UNIT_VALUE:(F.error(new h.Z("mapview-bad-type","Found invalid size VisualVariable",c)),Z.X.NONE)}},93434:(W,V,u)=>{u.r(V),u.d(V,{default:()=>Be});var b,h=u(49996),f=u(79076),Z=u(99326),p=u(94911),y=(u(45072),u(30627)),S=(u(55865),u(96410));let _=b=class extends Z.Z{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const r=this.sourceLayer&&this.sourceLayer.featureReduction;return r&&"popupTemplate"in r&&r.popupEnabled?r.popupTemplate:null}getObjectId(){return this.objectId}clone(){return new b(de({objectId:this.objectId},this.cloneProperties()))}};(0,f._)([(0,p.Cb)({type:Boolean})],_.prototype,"isAggregate",void 0),(0,f._)([(0,p.Cb)({type:Number,json:{read:!0}})],_.prototype,"objectId",void 0),_=b=(0,f._)([(0,S.j)("esri.AggregateGraphic")],_);const U=_;u(61243);var Q=u(97750),D=u(61414),ne=u(60161),A=u(22345),x=u(18502),N=u(7808),se=u(7917),le=u(11652),ge=u(6897),ce=u(71590);let $=class extends ge.Z{constructor(e){super(e),this._filter=null,this.duration=(0,y.Z)("mapview-transitions-duration"),this._excludedEffectView=new ce.ZP(e),this._includedEffectView=new ce.ZP(e)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(e){this._get("featureEffect")!==e&&this._transitionTo(e)}get filter(){var e;return this._filter||(null==(e=(0,x.Wg)(this.featureEffect))?void 0:e.filter)||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(e){this._set("scale",e),this._excludedEffectView.scale=e,this._includedEffectView.scale=e}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}transitionStep(e,r){this._set("scale",r),this.transitioning?(this._includedEffectView.transitionStep(e,r),this._excludedEffectView.transitionStep(e,r),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=r,this._includedEffectView.scale=r)}end(){this._includedEffectView.end(),this._excludedEffectView.end(),this._filter=null}_transitionTo(e){const r=this._get("featureEffect"),i=(0,x.Wg)(e),s=(0,x.Wg)(null==i?void 0:i.includedEffect),o=(0,x.Wg)(null==i?void 0:i.excludedEffect),m=this._includedEffectView.canTransitionTo(s)&&this._excludedEffectView.canTransitionTo(o);this._includedEffectView.effect=s,this._excludedEffectView.effect=o,this._set("featureEffect",i),this._filter=(null==i?void 0:i.filter)||(null==r?void 0:r.filter)||null,m||this.end()}};(0,f._)([(0,p.Cb)()],$.prototype,"_filter",void 0),(0,f._)([(0,p.Cb)()],$.prototype,"_excludedEffectView",void 0),(0,f._)([(0,p.Cb)()],$.prototype,"_includedEffectView",void 0),(0,f._)([(0,p.Cb)()],$.prototype,"duration",void 0),(0,f._)([(0,p.Cb)()],$.prototype,"excludedEffects",null),(0,f._)([(0,p.Cb)()],$.prototype,"featureEffect",null),(0,f._)([(0,p.Cb)()],$.prototype,"filter",null),(0,f._)([(0,p.Cb)()],$.prototype,"hasEffects",null),(0,f._)([(0,p.Cb)()],$.prototype,"includedEffects",null),(0,f._)([(0,p.Cb)({value:0})],$.prototype,"scale",null),(0,f._)([(0,p.Cb)()],$.prototype,"transitioning",null),$=(0,f._)([(0,S.j)("esri.layers.effects.FeatureEffectView")],$);const pe=$;var P=u(90589),O=u(98936),M=u(42762),j=u(37995),ee=u(30603),J=u(78081),oe=u(40390);function q(){return(q=(0,h.Z)(function*(e,r){if(!e)return null;switch(e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":return new((yield Promise.all([u.e(5572),u.e(1529),u.e(4700),u.e(5468),u.e(8592),u.e(1340)]).then(u.bind(u,61770))).default)(r);case"heatmap":return new((yield Promise.all([u.e(5572),u.e(1529),u.e(4700),u.e(8592),u.e(6213)]).then(u.bind(u,34262))).default)(r)}})).apply(this,arguments)}var ve=u(75124),_e=u(90829),Fe=u(28123);function xe(e){return e.some(r=>r.globalId)}function he(e){return e.filter(r=>!r.error).map(r=>{var i;return null!=(i=r.objectId)?i:r.globalId})}function be(e,r){const i=new Set(e);for(const s of r.values())i.add(s);return i}function a(e,r){const i=new Set(e);for(const s of r.values())i.delete(s);return i}let l=class extends ge.Z{constructor(e){super(e),this._hasGlobalIds=!1}normalizeCtorArgs(e){return this._queueProcessor=new Fe.e({concurrency:1,process:e.process}),{}}destroy(){this._queueProcessor.clear()}get updating(){return this._queueProcessor.length>0}push(e){const r=this._queueProcessor,i=r.last();switch(e.type){case"update":case"refresh":if((null==i?void 0:i.type)===e.type)return;r.push(e).finally(()=>this.notifyChange("updating"));break;case"edit":{const s="processed-edit"===(null==i?void 0:i.type)?i:null;s&&r.popLast();const o=this._mergeEdits(s,e);for(const m of o)r.push(m).finally(()=>this.notifyChange("updating"));break}}this.notifyChange("updating")}_mergeEdits(e,r){var i,s;const{addedFeatures:o,deletedFeatures:m,updatedFeatures:v}=r.edits;if(this._hasGlobalIds=this._hasGlobalIds||xe(o)||xe(v)||xe(m),this._hasGlobalIds)return[e,{type:"processed-edit",edits:{addOrModified:[...o,...v],removed:m}}];const C=new Set(he(null!=(i=null==e?void 0:e.edits.addOrModified)?i:[])),R=new Set(he(null!=(s=null==e?void 0:e.edits.removed)?s:[])),T=new Set([...he(o),...he(v)]),I=new Set(he(m));return[{type:"processed-edit",edits:{addOrModified:Array.from(be(a(C,I),T)).map(w=>({objectId:w})),removed:Array.from(be(a(R,T),I)).map(w=>({objectId:w}))}}]}};(0,f._)([(0,p.Cb)({readOnly:!0})],l.prototype,"updating",null),l=(0,f._)([(0,S.j)("esri.views.2d.layers.support.FeatureCommandQueue")],l);const d=l;var g=u(67614),E=u(25304);let L=class extends g.D{constructor(e){super(e),this._startupResolver=(0,N.hh)(),this.isReady=!1}initialize(){this._controller=new AbortController,this.addResolvingPromise(this._startWorker(this._controller.signal))}destroy(){this._controller.abort(),this._connection&&this._connection.close()}set tileRenderer(e){this.client.tileRenderer=e}get closed(){return this._connection.closed}startup(e,r,i,s){var o=this;return(0,h.Z)(function*(){yield o.when();const m=o._controller.signal,v=function(e){return Array.isArray(e)}(i.source)?{transferList:i.source,signal:m}:void 0,C={service:i,config:r,tileInfo:e.tileInfo.toJSON(),tiles:s};yield o._connection.invoke("startup",C,v),o._startupResolver.resolve(),o._set("isReady",!0)})()}updateTiles(e){var r=this;return(0,h.Z)(function*(){return yield r._startupResolver.promise,(0,N.R8)(r._connection.invoke("updateTiles",e))})()}update(e){var r=this;return(0,h.Z)(function*(){const i={config:e};return yield r._startupResolver.promise,r._connection.invoke("update",i)})()}applyUpdate(e){var r=this;return(0,h.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("applyUpdate",e)})()}setHighlight(e){var r=this;return(0,h.Z)(function*(){return yield r._startupResolver.promise,(0,N.R8)(r._connection.invoke("controller.setHighlight",e))})()}refresh(e){var r=this;return(0,h.Z)(function*(){return yield r._startupResolver.promise,(0,N.R8)(r._connection.invoke("controller.refresh",e))})()}querySummaryStatistics(e,r,i){var s=this;return(0,h.Z)(function*(){return yield s._startupResolver.promise,s._connection.invoke("controller.querySummaryStatistics",{query:e.toJSON(),params:r},i)})()}queryUniqueValues(e,r,i){var s=this;return(0,h.Z)(function*(){return yield s._startupResolver.promise,s._connection.invoke("controller.queryUniqueValues",{query:e.toJSON(),params:r},i)})()}queryClassBreaks(e,r,i){var s=this;return(0,h.Z)(function*(){return yield s._startupResolver.promise,s._connection.invoke("controller.queryClassBreaks",{query:e.toJSON(),params:r},i)})()}queryHistogram(e,r,i){var s=this;return(0,h.Z)(function*(){return yield s._startupResolver.promise,s._connection.invoke("controller.queryHistogram",{query:e.toJSON(),params:r},i)})()}queryFeatures(e,r){var i=this;return(0,h.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.queryFeatures",e.toJSON(),r)})()}queryVisibleFeatures(e,r){var i=this;return(0,h.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.queryVisibleFeatures",e.toJSON(),r)})()}queryObjectIds(e,r){var i=this;return(0,h.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.queryObjectIds",e.toJSON(),r)})()}queryFeatureCount(e,r){var i=this;return(0,h.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.queryFeatureCount",e.toJSON(),r)})()}queryExtent(e,r){var i=this;return(0,h.Z)(function*(){return i._connection.invoke("controller.queryExtent",e.toJSON(),r)})()}queryLatestObservations(e,r){var i=this;return(0,h.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.queryLatestObservations",e.toJSON(),r)})()}queryStatistics(e){var r=this;return(0,h.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.queryStatistics",e)})()}getObjectId(e){var r=this;return(0,h.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.getObjectId",e)})()}getDisplayId(e){var r=this;return(0,h.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.getDisplayId",e)})()}getFeatures(e){var r=this;return(0,h.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.getFeatures",e)})()}getAggregates(){var e=this;return(0,h.Z)(function*(){return yield e._startupResolver.promise,e._connection.invoke("controller.getAggregates")})()}getAggregateValueRanges(){var e=this;return(0,h.Z)(function*(){return yield e._startupResolver.promise,e._connection.invoke("controller.getAggregateValueRanges")})()}mapValidDisplayIds(e){var r=this;return(0,h.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.mapValidDisplayIds",e)})()}onEdits(e){var r=this;return(0,h.Z)(function*(){return yield r._startupResolver.promise,(0,N.R8)(r._connection.invoke("controller.onEdits",e))})()}enableEvent(e,r){var i=this;return(0,h.Z)(function*(){return yield i._startupResolver.promise,(0,N.R8)(i._connection.invoke("controller.enableEvent",{name:e,value:r}))})()}_startWorker(e){var r=this;return(0,h.Z)(function*(){try{r._connection=yield(0,E.bA)("Pipeline",{client:r.client,strategy:"dedicated",signal:e})}catch(i){(0,N.H9)(i)}})()}};(0,f._)([(0,p.Cb)()],L.prototype,"isReady",void 0),(0,f._)([(0,p.Cb)()],L.prototype,"client",void 0),(0,f._)([(0,p.Cb)()],L.prototype,"tileRenderer",null),L=(0,f._)([(0,S.j)("esri.views.2d.layers.support.FeatureLayerProxy")],L);const K=L;var Y=u(28121),X=u(66645),ye=u(5507);class Ve{constructor(r){this._tiles=new Map,this.buffer=0,this.acquireTile=r.acquireTile,this.releaseTile=r.releaseTile,this.tileInfoView=r.tileInfoView,this.buffer=r.buffer}destroy(){}clear(){this._tiles.forEach(r=>this._releaseTile(r))}tileKeys(){const r=[];return this._tiles.forEach((i,s)=>r.push(s)),r}update(r){const i=this.tileInfoView.getTileCoverage(r.state,this.buffer,"closest"),{spans:s,lodInfo:o}=i,{level:m}=o,v=[],C=[],R=new Set,T=new Set;for(const{row:I,colFrom:w,colTo:G}of s)for(let H=w;H<=G;H++){const re=ye.Z.getId(m,I,o.normalizeCol(H),o.getWorldForColumn(H)),ie=this._getOrAcquireTile(v,re);R.add(re),ie.isReady?ie.visible=!0:T.add(ie.key)}return T.forEach(I=>this._addPlaceholders(R,I)),this._tiles.forEach(I=>{R.has(I.key.id)||(C.push(I.key.id),this._releaseTile(I))}),X.Z.pool.release(i),{hasMissingTiles:T.size>0,added:v,removed:C}}_getOrAcquireTile(r,i){if(!this._tiles.has(i)){const s=this.acquireTile(new ye.Z(i));r.push(i),this._tiles.set(i,s),s.visible=!1}return this._tiles.get(i)}_getTile(r){return this._tiles.get(r)}_releaseTile(r){this._tiles.delete(r.key.id),this.releaseTile(r)}_addPlaceholders(r,i){const s=this._addPlaceholderChildren(r,i);Math.abs(1-s)<1e-6||this._addPlaceholderParent(r,i)||(this._getTile(i.id).visible=!0)}_addPlaceholderChildren(r,i){let s=0;return this._tiles.forEach(o=>{s+=this._addPlaceholderChild(r,o,i)}),s}_addPlaceholderChild(r,i,s){return i.key.level<=s.level||!i.hasData||!s.contains(i.key)?0:(i.visible=!0,r.add(i.key.id),1/(1<<2*(i.key.level-s.level)))}_addPlaceholderParent(r,i){let s=i.getParentKey(),o=0,m=null;for(;(0,x.pC)(s);){if(r.has(s.id))return!0;const v=this._getTile(s.id);if(null!=v&&v.isReady)return v.visible=!0,r.add(v.key.id),!0;null!=v&&v.hasData&&v.patchCount>o&&(o=v.patchCount,m=v),s=s.getParentKey()}return!!m&&(m.visible=!0,r.add(m.key.id),!0)}}var Se=u(41395),Me=u(46613),Ze=u(47827),k=u(6663),Le=u(2999),Re=u(76388),Oe=u(89836);const Ce=A.Z.getLogger("esri.views.layers.FeatureLayerView"),Ae=e=>{let r=class extends e{constructor(...i){super(...i),this._updatingRequiredFieldsPromise=null,this.filter=null,this.timeExtent=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){(0,le.S1)(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","featureEffect","layer.timeInfo","layer.floorInfo","timeExtent"],()=>this._handleRequiredFieldsChange(),!0),(0,le.on)(this,"view.floors","change",()=>this._handleRequiredFieldsChange()),(0,le.on)(this,"layer.sublayer","change",()=>this._handleRequiredFieldsChange())}get availableFields(){const{layer:i,layer:{fieldsIndex:s},requiredFields:o}=this;return"outFields"in i&&i.outFields?(0,k.Q0)(s,[...(0,k.Lk)(s,i.outFields),...o]):(0,k.Q0)(s,o)}set effect(i){(0,Se.Mr)(Ce,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect=i}get effect(){return(0,Se.Mr)(Ce,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(i){void 0!==i?this._override("featureEffect",i):this._clearOverride("featureEffect")}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(i){Ce.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(i){throw new Error("missing implementation")}createQuery(){const i={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},s=(0,x.pC)(this.filter)?this.filter.createQuery(i):new j.Z(i);if("feature"===this.layer.type){const o=(0,Oe.cx)(this);(0,x.pC)(o)&&(s.where=s.where?`(${s.where}) AND (${o})`:o)}return(0,x.pC)(this.timeExtent)&&(s.timeExtent=(0,x.pC)(s.timeExtent)?s.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),s}queryFeatures(i,s){throw new Error("missing implementation")}queryObjectIds(i,s){throw new Error("missing implementation")}queryFeatureCount(i,s){throw new Error("missing implementation")}queryExtent(i,s){throw new Error("missing implementation")}fetchPopupFeatures(i,s){var o=this;return(0,h.Z)(function*(){const m=o.validateFetchPopupFeatures(s);if(m)throw m;return o.fetchClientPopupFeatures(s)})()}_loadArcadeModules(i){if(i.get("expressionInfos.length")||Array.isArray(i.content)&&i.content.some(s=>"expression"===s.type))return(0,Le.LC)()}_handleRequiredFieldsChange(){const i=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",i),i.then(()=>{this._updatingRequiredFieldsPromise===i&&this._set("_updatingRequiredFieldsPromise",null)})}_updateRequiredFields(){var i=this;return(0,h.Z)(function*(){if(!i.layer||!i.view)return;const s="3d"===i.view.type,{layer:o,layer:{fieldsIndex:m,objectIdField:v}}=i,C="renderer"in o&&o.renderer,R="orderBy"in o&&o.orderBy,T=o.featureReduction,I=new Set,w=yield(0,N.as)([C?C.collectRequiredFields(I,m):null,(0,k.Mu)(I,o),s?(0,k.vl)(I,o):null,(0,x.pC)(i.filter)?(0,k.Ll)(I,o,i.filter):null,(0,x.pC)(i.featureEffect)?(0,k.Ll)(I,o,i.featureEffect.filter):null,T?(0,k.ZV)(I,o,T):null,R?(0,k.Qj)(I,o,R):null]);if(o.timeInfo&&i.timeExtent&&(0,k.gd)(I,o.fieldsIndex,[o.timeInfo.startField,o.timeInfo.endField]),"feature"===o.type&&o.floorInfo&&(0,k.gd)(I,o.fieldsIndex,[o.floorInfo.floorField]),"subtype-group"===o.type){(0,k.AB)(I,m,o.subtypeField);const H=o.sublayers.map(re=>{var ie;return Promise.all([null==(ie=re.renderer)?void 0:ie.collectRequiredFields(I,m),(0,k.Mu)(I,re)])});yield(0,N.as)(H)}for(const H of w)H.error&&Ce.error(H.error);(0,k.AB)(I,m,v),s&&"displayField"in o&&o.displayField&&(0,k.AB)(I,m,o.displayField);const G=Array.from(I).sort();i._set("requiredFields",G)})()}validateFetchPopupFeatures(i){if((0,x.Wi)(i))return null;for(const s of i.clientGraphics){const o=s.layer;if("popupEnabled"in o&&!o.popupEnabled)return new D.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:o});if("popupTemplate"in o&&!(0,Re.V)(o,i))return new D.Z("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:o});if(s.isAggregate&&!(o.featureReduction&&"popupTemplate"in o.featureReduction&&o.featureReduction.popupEnabled&&o.featureReduction.popupTemplate))return new D.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:o})}}fetchClientPopupFeatures(i){var s=this;return(0,h.Z)(function*(){const o=(0,x.pC)(i)?i.clientGraphics:null;if(!o||0===o.length)return[];const m=new Array(o.length),v=new Map,C=yield s.createPopupQuery(i);for(let R=0;R<o.length;R++){const T=o[R];if(T.isAggregate){m[R]=T;continue}const{layer:I}=T;if(!("popupEnabled"in I))continue;const w=(0,k.Lk)(s.layer.fieldsIndex,C.outFields),G=(0,Re.V)(I,i);if(!(0,x.pC)(G))continue;const H=yield s._loadArcadeModules(G);H&&H.arcadeUtils.hasGeometryOperations(G)||!(0,k.R9)(w,T)?v.set(T.getObjectId(),R):m[R]=T}if("stream"===s.layer.type||0===v.size)return m.filter(Boolean);C.objectIds=Array.from(v.keys());try{const R=yield s.layer.queryFeatures(C);for(const T of R.features)m[v.get(T.getObjectId())]=T}catch(R){}return m.filter(Boolean)})()}createPopupQuery(i){var s=this;return(0,h.Z)(function*(){const o=s.layer.createQuery(),m=new Set;let v=!1;const C=(0,x.pC)(i)&&i.clientGraphics?i.clientGraphics.map(R=>R.layer):[s.layer];for(const R of C){if(!("popupEnabled"in R))continue;const T=(0,Re.V)(R,i);if(!(0,x.pC)(T))continue;const I=yield s._loadArcadeModules(T),w=I&&I.arcadeUtils.hasGeometryOperations(T);v=!("point"!==s.layer.geometryType&&!w);const G=yield(0,Re.e)(s.layer,T);for(const H of G)m.add(H)}if(o.returnGeometry=v,o.returnZ=v,o.returnM=v,o.outFields=Array.from(m),o.outSpatialReference=s.view.spatialReference,"feature"===s.layer.type){const R=(0,Oe.cx)(s);(0,x.pC)(R)&&(o.where=o.where?`(${o.where}) AND (${R})`:R)}return o})()}canResume(){return!(!super.canResume()||(0,x.pC)(this.timeExtent)&&this.timeExtent.isEmpty)}};return(0,f._)([(0,p.Cb)()],r.prototype,"_updatingRequiredFieldsPromise",void 0),(0,f._)([(0,p.Cb)({readOnly:!0})],r.prototype,"availableFields",null),(0,f._)([(0,p.Cb)()],r.prototype,"effect",null),(0,f._)([(0,p.Cb)({type:Ze.Z})],r.prototype,"featureEffect",null),(0,f._)([(0,p.Cb)({type:P.Z})],r.prototype,"filter",void 0),(0,f._)([(0,p.Cb)(Me.qG)],r.prototype,"timeExtent",void 0),(0,f._)([(0,p.Cb)()],r.prototype,"layer",void 0),(0,f._)([(0,p.Cb)({type:Number})],r.prototype,"maximumNumberOfFeatures",null),(0,f._)([(0,p.Cb)({readOnly:!0,type:Boolean})],r.prototype,"maximumNumberOfFeaturesExceeded",null),(0,f._)([(0,p.Cb)({readOnly:!0})],r.prototype,"requiredFields",void 0),(0,f._)([(0,p.Cb)()],r.prototype,"suspended",void 0),(0,f._)([(0,p.Cb)()],r.prototype,"view",void 0),r=(0,f._)([(0,S.j)("esri.views.layers.FeatureLayerView")],r),r};var Ne=u(96121),De=u(26263),je=u(7380),Pe=u(62965),ze=u(70157);function Te(e){return e&&"openPorts"in e}const me=A.Z.getLogger("esri.views.2d.layers.FeatureLayerView2D");let te=class extends(Ae((0,De.y)((0,J.y)(Ne.Z)))){constructor(){var e;super(...arguments),e=this,this._pipelineIsUpdating=!0,this._commandsQueue=new d({process:r=>{switch(r.type){case"processed-edit":return this._doEdit(r);case"refresh":return this._doRefresh(r.dataChanged);case"update":return this._doUpdate()}}}),this._visibilityOverrides=new Set,this._highlightIds=new Map,this._lastPixelBuffer=0,this._updateHighlight=(0,N.Ds)((0,h.Z)(function*(){return e._proxy.setHighlight(Array.from(e._highlightIds.keys()))})),this._uploadsLocked=!1,this._needsClusterSizeUpdate=!1,this.featureEffectView=new pe,this._lastDefinitionExpression=null}destroy(){var e,r;(0,x.Po)(this._updateClusterSizeTask,i=>i.remove()),null==(e=this._proxy)||e.destroy(),null==(r=this.tileRenderer)||r.destroy(),this._commandsQueue.destroy()}initialize(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.handles.add([this.on("valueRangesChanged",e=>{this._set("_aggregateValueRanges",e.valueRanges)}),(0,se.Ym)(()=>this.featureEffect,e=>{this.featureEffectView.featureEffect=e},{initial:!0,sync:!0})])}_initProxy(){var e=this;return(0,h.Z)(function*(){if("isTable"in e.layer&&e.layer.isTable)throw new D.Z("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:e.layer});e._proxy&&e._proxy.destroy();const r=e._createClientOptions();return e._set("_proxy",new K({client:r})),e._proxy.when()})()}_initServiceOptions(){var e=this;return(0,h.Z)(function*(){e._set("_serviceOptions",yield e._createServiceOptions())})()}get orderByFields(){return"stream"!==this._serviceOptions.type&&this._serviceOptions.orderByFields}get labelsVisible(){const e="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&e.some(r=>r.labelingInfo&&r.labelsVisible)}get queryMode(){return this._serviceOptions.type}get renderingConfigHash(){if(!this.layer)return null;const e=this.availableFields,r=this.layer,i=this.view.floors,{definitionExpression:s}=r,o="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,m="renderer"in r&&r.renderer,v="feature"===r.type?r.gdbVersion:void 0,C="feature"===r.type&&r.historicMoment?r.historicMoment.getTime():void 0,{timeExtent:R}=this,T="customParameters"in r?JSON.stringify(r.customParameters):void 0,I="apiKey"in r?r.apiKey:void 0,w="stream"===r.type?`${JSON.stringify(r.geometryDefinition)}${r.definitionExpression}`:null,G=JSON.stringify(this.clips),H=r.featureReduction&&r.featureReduction.toJSON(),re="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),ie="sublayers"in this.layer&&this.layer.sublayers.items.reduce((Ie,ue)=>Ie+`${ue.visible?1:0}.${JSON.stringify(ue.renderer)}.${ue.labelsVisible}\n.${JSON.stringify(ue.labelingInfo)}`,"");return JSON.stringify({orderBy:re,sublayerHash:ie,filterHash:(0,x.pC)(this.filter)&&this.filter.toJSON(),effectHash:(0,x.pC)(this.featureEffect)&&this.featureEffect.toJSON(),streamFilter:w,gdbVersion:v,definitionExpression:s,historicMoment:C,availableFields:e,renderer:m,labelingInfo:o,timeExtent:R,floors:i,clipsHash:G,featureReduction:H,customParameters:T,apiKey:I})}fetchPopupFeatures(e,r){var i=()=>super.fetchPopupFeatures,s=this;return(0,h.Z)(function*(){var o;if((0,x.pC)(r)&&0===r.clientGraphics.length)return[];if("cluster"!==(null==(o=s.layer.featureReduction)?void 0:o.type)){const m=(0,O.k)({renderer:"renderer"in s.layer&&s.layer.renderer,event:(0,x.pC)(r)&&r.event}),v=(0,je.K)(e,m,s.view),{features:C}=yield s.queryVisibleFeatures(new j.Z({geometry:v,outFields:["*"],returnGeometry:!0}));r=(0,x.pC)(r)?r:{};const R=new Set(r.clientGraphics.map(T=>T.getObjectId()));for(const T of C)R.has(T.getObjectId())||r.clientGraphics.push(T)}return i().call(s,e,r)})()}highlight(e){var r;let i;return e instanceof Z.Z?i=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?i=[e]:Array.isArray(e)&&e.length>0?i="number"==typeof e[0]||"string"==typeof e[0]?e:e.map(s=>null==s?void 0:s.getObjectId()):Q.Z.isCollection(e)&&e.length>0&&(i=e.map(s=>null==s?void 0:s.getObjectId()).toArray()),i=null==(r=i)?void 0:r.filter(s=>null!=s),i&&i.length?(this._addHighlight(i),{remove:()=>this._removeHighlight(i)}):{remove:()=>{}}}hasHighlight(){return!!this._highlightIds.size}hitTest(e,r){var i=this;return(0,h.Z)(function*(){if(!i.tileRenderer)return null;const s=yield i.tileRenderer.hitTest(r);if(0===s.length)return null;const{features:o,aggregates:m}=yield i._proxy.getFeatures(s);return[...m.map(v=>i._createHittestResult(U.fromJSON(v))),...o.map(v=>i._createHittestResult(Z.Z.fromJSON(v)))]})()}queryAggregates(){var e=this;return(0,h.Z)(function*(){return(yield e._proxy.getAggregates()).map(r=>U.fromJSON(r))})()}queryStatistics(){return this._proxy.queryStatistics()}querySummaryStatistics(e,r,i){var s=this;return(0,h.Z)(function*(){const o=fe(de({},r),{scale:s.view.scale});return s._proxy.querySummaryStatistics(s._cleanUpQuery(e),o,i)})()}queryUniqueValues(e,r,i){var s=this;return(0,h.Z)(function*(){const o=fe(de({},r),{scale:s.view.scale});return s._proxy.queryUniqueValues(s._cleanUpQuery(e),o,i)})()}queryClassBreaks(e,r,i){var s=this;return(0,h.Z)(function*(){const o=fe(de({},r),{scale:s.view.scale});return s._proxy.queryClassBreaks(s._cleanUpQuery(e),o,i)})()}queryHistogram(e,r,i){var s=this;return(0,h.Z)(function*(){const o=fe(de({},r),{scale:s.view.scale});return s._proxy.queryHistogram(s._cleanUpQuery(e),o,i)})()}queryFeatures(e,r){return this.queryFeaturesJSON(e,r).then(i=>{const s=M.default.fromJSON(i);return s.features.forEach(o=>this._setLayersForFeature(o)),s})}queryVisibleFeatures(e,r){return this._proxy.queryVisibleFeatures(this._cleanUpQuery(e),r).then(i=>{const s=M.default.fromJSON(i);return s.features.forEach(o=>this._setLayersForFeature(o)),s})}queryFeaturesJSON(e,r){return this._proxy.queryFeatures(this._cleanUpQuery(e),r)}queryObjectIds(e,r){return this._proxy.queryObjectIds(this._cleanUpQuery(e),r)}queryFeatureCount(e,r){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),r)}queryExtent(e,r){return this._proxy.queryExtent(this._cleanUpQuery(e),r).then(i=>({count:i.count,extent:ze.Z.fromJSON(i.extent)}))}setVisibility(e,r){r?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}update(e){if(!this._tileStrategy||!this.tileRenderer)return;const{hasMissingTiles:r,added:i,removed:s}=this._tileStrategy.update(e);(i.length||s.length)&&this._proxy.updateTiles({added:i,removed:s}),r&&this.requestUpdate(),this.notifyChange("updating")}attach(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this._tileStrategy=new Ve({acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add((0,le.S1)(this,"renderingConfigHash",()=>this._update()),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",e=>this._edit(e)),"attach")}detach(){this.container.removeAllChildren(),this.handles.remove("attach"),this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){var e;const r="renderer"in this.layer&&null!=this.layer.renderer,i=this._commandsQueue.updating,s=null!=this._updatingRequiredFieldsPromise,o=!this._proxy||!this._proxy.isReady,m=this._pipelineIsUpdating,v=null===this.tileRenderer||(null==(e=this.tileRenderer)?void 0:e.updating),C=r&&(i||s||o||m||v);return(0,y.Z)("esri-2d-log-updating")&&console.log(`Updating FLV2D: ${C}\n  -> hasRenderer ${r}\n  -> hasPendingCommand ${i}\n  -> updatingRequiredFields ${s}\n  -> updatingProxy ${o}\n  -> updatingPipeline ${m}\n  -> updatingTileRenderer ${v}\n`),C}_createClientOptions(){return{setUpdating:e=>{this._set("_pipelineIsUpdating",e)},emitEvent:e=>{this.emit(e.name,e.event)}}}_detectQueryMode(e){var r=this;return(0,h.Z)(function*(){var i;const s="path"in e,o="editingInfo"in r.layer&&(null==(i=r.layer.editingInfo)?void 0:i.lastEditDate),m=!!r.layer.refreshInterval,v=!o&&m;if(s&&("feature"===r.layer.type||"subtype-group"===r.layer.type)&&"point"===r.layer.geometryType&&r.layer.capabilities.query.supportsPagination&&!r.layer.capabilities.operations.supportsEditing&&!v&&(0,y.Z)("featurelayer-snapshot-enabled"))try{const C=yield r.layer.queryFeatureCount();if(C<=(0,y.Z)("featurelayer-snapshot-point-min-threshold"))return{mode:"snapshot",featureCount:C};const R=(0,y.Z)("featurelayer-snapshot-point-max-threshold"),T=(0,y.Z)("featurelayer-snapshot-point-coverage"),I=r.view.extent,w=(0,x.Wg)(r.layer.fullExtent),G=null==w?void 0:w.clone().intersection(I),H=(0,x.pC)(G)?G.width*G.height:0,re=(null==w?void 0:w.width)*(null==w?void 0:w.height),ie=0===re?0:H/re;if(C<=R&&ie>=T)return{mode:"snapshot",featureCount:C}}catch(C){me.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:C})}return{mode:"on-demand"}})()}_createServiceOptions(){var e=this;return(0,h.Z)(function*(){var r;const i=e.layer;if("stream"===i.type)return null;const{capabilities:s,objectIdField:o}=i,m=i.fields.map(ue=>ue.toJSON()),v=(0,x.pC)(i.fullExtent)&&i.fullExtent.toJSON(),C=(0,Y.oq)(i.geometryType),R=i.timeInfo&&i.timeInfo.toJSON()||null,T=i.spatialReference?i.spatialReference.toJSON():null,I="feature"===i.type?i.globalIdField:null;let w;"ogc-feature"===i.type?w=i.source.getFeatureDefinition():Te(i.source)?w=yield i.source.openPorts():i.parsedUrl&&(w=(0,ne.d9)(i.parsedUrl),"dynamicDataSource"in i&&i.dynamicDataSource&&(w.query={layer:JSON.stringify({source:i.dynamicDataSource})}));const G="datesInUnknownTimezone"in e.layer&&e.layer.datesInUnknownTimezone,H=null!=(r="subtypeField"in e.layer&&e.layer.subtypeField)?r:null,{mode:re,featureCount:ie}=yield e._detectQueryMode(w);let Ie=e.layer.objectIdField;if("feature"===e.layer.type&&(0,x.pC)(e.layer.orderBy)&&e.layer.orderBy.length){const ue=!e.layer.orderBy[0].valueExpression&&e.layer.orderBy[0].field;ue&&(Ie=ue)}return{type:re,timeReferenceUnknownClient:G,subtypeField:H,featureCount:ie,globalIdField:I,maxRecordCount:s.query.maxRecordCount,tileMaxRecordCount:s.query.tileMaxRecordCount,capabilities:s,fields:m,fullExtent:v,geometryType:C,objectIdField:o,source:w,timeInfo:R,spatialReference:T,orderByFields:Ie}})()}_createMemoryServiceOptions(e){var r=this;return(0,h.Z)(function*(){const i=yield e.openPorts();return fe(de({},r._createServiceOptions()),{type:"memory",source:i})})()}_cleanUpQuery(e){const r=j.Z.from(e)||this.createQuery();return r.outSpatialReference||(r.outSpatialReference=this.view.spatialReference),r}_update(){var e=this;return(0,h.Z)(function*(){return e._commandsQueue.push({type:"update"})})()}_edit(e){var r=this;return(0,h.Z)(function*(){if(r._validateEdit(e))return r._commandsQueue.push({type:"edit",edits:e})})()}doRefresh(e){var r=this;return(0,h.Z)(function*(){return r._commandsQueue.push({type:"refresh",dataChanged:e})})()}_validateEdit(e){const r="globalIdField"in this.layer&&this.layer.globalIdField,i=e.deletedFeatures.some(o=>-1===o.objectId||!o.objectId),s=r&&this.availableFields.includes(r);return i&&!s?(me.error(new D.Z("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${r} to be included the layer's outFields for updates to be reflected on the map`)),null):e}_doUpdate(){var e=this;return(0,h.Z)(function*(){try{if(e.destroyed||!e._hasRequiredSupport(e.layer)||!e._tileStrategy)return;const{featureEffectView:r,filter:i}=e;yield e._updateRequiredFields();const{renderer:s}=e._getEffectiveRenderer();e._set("_effectiveRenderer",s);const o=e._createSchemaConfig(),m=(0,Y.oq)(e.layer.geometryType),v=yield(0,ve.G)(s,m,e.view.resourceManager,e.layer.fields,e.layer.spatialReference,e.layer.featureReduction),C=e._createConfiguration(o,i,r.filter),R=e._lastDefinitionExpression!==C.definitionExpression;e._lastDefinitionExpression=C.definitionExpression,e._lastPixelBuffer=0===v?0:Math.max(v,e._lastPixelBuffer),C.schema.source.pixelBuffer=e._lastPixelBuffer;const T=e._createTileRendererHash(s);if("snapshot"===e._serviceOptions.type&&(C.schema.source.featureCount=e._serviceOptions.featureCount),T!==e._tileRendererHash){yield e._initTileRenderer(s);const I=e._serviceOptions;e.tileRenderer.onConfigUpdate(s);const w=e.layer;"stream"!==w.type&&Te(w.source)&&(I.source=yield w.source.openPorts()),"stream"===w.type&&(yield e._initServiceOptions());const G={added:e._tileStrategy.tileKeys(),removed:[]};yield e._proxy.startup(e.view.featuresTilingScheme,C,I,G),e.hasHighlight()&&(yield e._proxy.setHighlight(Array.from(e._highlightIds.keys()))),yield e._onceTilesUpdated(),e.tileRenderer.onConfigUpdate(s)}else{"snapshot"===e._serviceOptions.type&&R&&(C.schema.source.featureCount=yield e.layer.queryFeatureCount());const I=yield e._proxy.update(C);(I.mesh||I.targets.aggregate)&&e._lockGPUUploads();try{yield e._proxy.applyUpdate(I)}catch(w){(0,N.D_)(w)||me.error(w)}(I.mesh||I.targets.aggregate)&&e._unlockGPUUploads(),e.tileRenderer.onConfigUpdate(s),e._updateClusterSizeVariable(),e._forceAttributeTextureUpload()}e._tileRendererHash=T,e.tileRenderer.invalidateLabels(),e.requestUpdate()}catch(r){}})()}_doEdit(e){var r=this;return(0,h.Z)(function*(){try{yield r._proxy.onEdits(e)}catch(i){(0,N.D_)(i)}})()}_doRefresh(e){var r=this;return(0,h.Z)(function*(){r._lockGPUUploads();try{yield r._proxy.refresh(e)}catch(i){(0,N.D_)(i)}r._unlockGPUUploads()})()}_updateClusterSizeVariable(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)}_createUpdateClusterSizeTask(e,r){var i=this;return this.watch("_aggregateValueRanges",function(){var s=(0,h.Z)(function*(o){i._updateClusterEffectiveRendererSizeVariable(e,r,o),i._needsClusterSizeUpdate=!0,i._uploadsLocked||i._updateClusterSizeVariable()});return function(o){return s.apply(this,arguments)}}())}_updateClusterEffectiveRendererSizeVariable(e,r,i){var s=this;return(0,h.Z)(function*(){if(e.dynamicClusterSize&&"visualVariables"in e&&e.visualVariables){const o=(0,_e.os)(e.visualVariables);if((0,x.pC)(o)&&"cluster_count"===o.field){const m=e.visualVariables.indexOf(o);e.visualVariables[m]=(0,_e.aV)(r,i);const v=e.clone();v.dynamicClusterSize=!0,s._set("_effectiveRenderer",v)}}})()}_getEffectiveRenderer(){const e="renderer"in this.layer&&this.layer.renderer,r=this.layer.featureReduction;if((0,x.pC)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),r&&"cluster"===r.type&&(0,_e.yR)(e)){const i=r,s=[],o=(0,_e.S1)(s,e,i,this._aggregateValueRanges);return(0,x.Po)(this._updateClusterSizeTask,m=>m.remove()),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(o,i),{renderer:o,aggregateFields:s,featureReduction:r}}return{renderer:e,aggregateFields:[],featureReduction:null}}_acquireTile(e){const r=this.tileRenderer.acquireTile(e);return r.once("attach",()=>{this.requestUpdate()}),r}_releaseTile(e){this.tileRenderer.releaseTile(e)}_initTileRenderer(e){var r=this;return(0,h.Z)(function*(){const i=yield function(e,r){return q.apply(this,arguments)}(e,{layerView:r,tileInfoView:r.view.featuresTilingScheme,layer:r.layer});return r.tileRenderer&&(r._tileStrategy.clear(),r.tileRenderer.uninstall(r.container),r.tileRenderer.destroy(),r.tileRenderer=null),r.destroyed?null:(r._proxy.tileRenderer=i,r._set("tileRenderer",i),r.tileRenderer.install(r.container),r.tileRenderer.onConfigUpdate(e),r.requestUpdate(),r.tileRenderer)})()}_createTileRendererHash(e){return`${"heatmap"===e.type?"heatmap":"symbol"}.${"dot-density"===e.type}`}get hasFilter(){const e=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||e||!!this._visibilityOverrides.size||!!this.timeExtent}_injectOverrides(e){const r=(0,x.pC)(e)?e.timeExtent:null,i=(0,x.pC)(this.timeExtent)&&(0,x.pC)(r)?this.timeExtent.intersection(r):this.timeExtent||r;let s=null;const o="floorInfo"in this.layer&&this.layer.floorInfo;if(o){const v=(0,x.pC)(e)&&e.where;s=this._addFloorFilterClause(v)}if(!this._visibilityOverrides.size&&!i&&!o)return(0,x.pC)(e)?e.toJSON():null;(e=(0,x.pC)(e)&&e.clone()||new P.Z).timeExtent=i,s&&(e.where=s);const m=e.toJSON();return m.hiddenIds=Array.from(this._visibilityOverrides),m}_addFloorFilterClause(e){const r=this.layer;let i=e||"";if("floorInfo"in r&&r.floorInfo){var s;let o=this.view.floors;if(!o||!o.length)return i;null!=(s=r.floorInfo.viewAllLevelIds)&&s.length&&(o=r.floorInfo.viewAllLevelIds);const m=o.filter(R=>""!==R).map(R=>"'"+R+"'");m.push("''");const v=r.floorInfo.floorField;let C="("+v+" IN ({ids}) OR "+v+" IS NULL)";if(C=C.replace("{ids}",m.join(", ")),(0,x.pC)(i)&&i.includes(v)){let R=new RegExp("AND \\("+v+".*NULL\\)","g");i=i.replace(R,""),R=new RegExp("\\("+v+".*NULL\\)","g"),i=i.replace(R,""),i=i.replace(/\s+/g," ").trim()}i=""!==i?"("+i+") AND "+C:C}return""!==i?i:null}_createConfiguration(e,r,i){const s="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,o="feature"===this.layer.type?this.layer.gdbVersion:void 0,m=new Array(ee.m4),v=this._injectOverrides(r);m[0]=v,m[1]=(0,x.pC)(i)?i.toJSON():null;const C=(0,oe.createSchema)(e);if((0,x.Wi)(C))return null;const R=(0,Pe.Z)();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:o,historicMoment:s,devicePixelRatio:window.devicePixelRatio||1,filters:m,schema:C,supportsTextureFloat:R.supportsTextureFloat,maxTextureSize:R.maxTextureSize}}_hasRequiredSupport(e){var r;return!("renderer"in e&&"dot-density"===(null==(r=e.renderer)?void 0:r.type)&&!(0,Pe.Z)().supportsTextureFloat&&(me.error(new D.Z("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))}_onceTilesUpdated(){return this.requestUpdate(),(0,le.OY)(this,"_pipelineIsUpdating",!1)}_lockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())}_unlockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())}_forceAttributeTextureUpload(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}_createSchemaConfig(){const e="feature"===this.layer.type?this.layer.historicMoment:null,r="feature"===this.layer.type?this.layer.gdbVersion:null;return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:e,labelsVisible:"labelsVisible"in this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:r,pixelBuffer:0,orderBy:"orderBy"in this.layer&&this.layer.orderBy?this.layer.orderBy:null,customParameters:fe(de({},"customParameters"in this.layer?this.layer.customParameters:void 0),{token:"apiKey"in this.layer?this.layer.apiKey:void 0})}}_addHighlight(e){for(const r of e)if(this._highlightIds.has(r)){const i=this._highlightIds.get(r);this._highlightIds.set(r,i+1)}else this._highlightIds.set(r,1);this._updateHighlight().catch(r=>{(0,N.D_)(r)||me.error(r)})}_removeHighlight(e){for(const r of e)if(this._highlightIds.has(r)){const i=this._highlightIds.get(r)-1;0===i?this._highlightIds.delete(r):this._highlightIds.set(r,i)}this._updateHighlight().catch(r=>{(0,N.D_)(r)||me.error(r)})}_setLayersForFeature(e){const r=this.layer;e.layer=r,e.sourceLayer=r}_createHittestResult(e){return this._setLayersForFeature(e),(0,x.pC)(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}};(0,f._)([(0,p.Cb)()],te.prototype,"_serviceOptions",void 0),(0,f._)([(0,p.Cb)()],te.prototype,"_proxy",void 0),(0,f._)([(0,p.Cb)()],te.prototype,"_pipelineIsUpdating",void 0),(0,f._)([(0,p.Cb)()],te.prototype,"_effectiveRenderer",void 0),(0,f._)([(0,p.Cb)()],te.prototype,"_aggregateValueRanges",void 0),(0,f._)([(0,p.Cb)()],te.prototype,"_commandsQueue",void 0),(0,f._)([(0,p.Cb)()],te.prototype,"featureEffectView",void 0),(0,f._)([(0,p.Cb)()],te.prototype,"labelsVisible",null),(0,f._)([(0,p.Cb)({readOnly:!0})],te.prototype,"queryMode",null),(0,f._)([(0,p.Cb)()],te.prototype,"renderingConfigHash",null),(0,f._)([(0,p.Cb)()],te.prototype,"tileRenderer",void 0),(0,f._)([(0,p.Cb)()],te.prototype,"updating",void 0),te=(0,f._)([(0,S.j)("esri.views.2d.layers.FeatureLayerView2D")],te);const Be=te},90985:(W,V,u)=>{u.d(V,{xS:()=>pe,B3:()=>$});var h=u(49996),f=u(77600),Z=u(31620),p=u(23155);const F={marker:Z.LW.MARKER,fill:Z.LW.FILL,line:Z.LW.LINE,text:Z.LW.TEXT};class y{constructor(O,M,j,ee){const J={minScale:null==M?void 0:M.minScale,maxScale:null==M?void 0:M.maxScale},oe=(P=J).minScale||P.maxScale?P.minScale+"-"+P.maxScale:"";var P;this.layers=O,this.data=M,this.hash=this._createHash()+oe,this.rendererKey=j;const ae={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:"default"},vvFlags:j};for(const q of O){const ve=F[q.type];q.materialKey=(0,p.jj)(ve,ae),q.maxVVSize=ee,q.scaleInfo=J,q.templateHash+=oe}}get type(){return"expanded-cim"}_createHash(){let O="";for(const M of this.layers)O+=M.templateHash;return O}}var S=u(56648),b=u(61414),_=u(7808),U=u(30164),B=u(70658),Q=u(26912),D=u(80415);function ne(P,O,M){return A.apply(this,arguments)}function A(){return(A=(0,h.Z)(function*(P,O,M){if(!P.name)return Promise.reject(new b.Z("style-symbol-reference-name-missing","Missing name in style symbol reference"));if(P.styleName&&"Esri2DPointSymbolsStyle"===P.styleName)return x(P,M);try{return se(yield(0,D.n2)(P,O,M),P.name,O,M)}catch(j){return(0,_.k_)(j),null}})).apply(this,arguments)}function x(P,O){return N.apply(this,arguments)}function N(){return(N=(0,h.Z)(function*(P,O){const M=D.wm.replace(/\{SymbolName\}/gi,P.name);try{const j=yield(0,D.EJ)(M,O);return(0,D.KV)(j.data)}catch(j){return(0,_.k_)(j),null}})).apply(this,arguments)}function se(P,O,M,j){return le.apply(this,arguments)}function le(){return(le=(0,h.Z)(function*(P,O,M,j){const ee=P.data,J={portal:M&&M.portal||B.Z.getDefault(),url:(0,U.mN)(P.baseUrl),origin:"portal-item"},oe=ee.items.find(q=>q.name===O);if(!oe)throw new b.Z("symbolstyleutils:symbol-name-not-found",`The symbol name '${O}' could not be found`,{symbolName:O});let ae=(0,Q.f)((0,D.v9)(oe,"cimRef"),J);(0,S.XO)()&&(ae=(0,S.pJ)(ae));try{const q=yield(0,D.EJ)(ae,j);return(0,D.KV)(q.data)}catch(q){return(0,_.k_)(q),null}})).apply(this,arguments)}const ce=function(){var P=(0,h.Z)(function*(O,M,j){return new y(yield(0,f.c)(O.data,M,j),O.data,O.rendererKey,O.maxVVSize)});return function(M,j,ee){return P.apply(this,arguments)}}(),$=function(){var P=(0,h.Z)(function*(O,M,j,ee){if(!O)return null;if("cim"===O.type)return ce(O,M,j);if("web-style"===O.type){const J={type:"cim",data:yield ne(O,null,ee),rendererKey:O.rendererKey,maxVVSize:O.maxVVSize};return ce(J,M,j)}return O});return function(M,j,ee,J){return P.apply(this,arguments)}}();function pe(P){if(!P)return null;const{type:O,cim:M,url:j,materialHash:ee}=P,J={cim:M,type:O,mosaicHash:ee,url:j,size:null,dashTemplate:null,path:null,text:null,fontName:null};switch(O){case"marker":J.size=P.size,J.path=P.path;break;case"line":J.dashTemplate=P.dashTemplate;break;case"text":J.text=P.text,J.fontName=P.fontName}return J}},26263:(W,V,u)=>{u.d(V,{y:()=>_});var h=u(79076),f=u(22345),Z=u(7808),p=u(11652),F=u(94911),b=(u(45072),u(30627),u(55865),u(96410));const _=U=>{let B=class extends U{initialize(){this.handles.add((0,p.on)(this,"layer","refresh",Q=>{this.doRefresh(Q.dataChanged).catch(D=>{(0,Z.D_)(D)||f.Z.getLogger(this.declaredClass).error(D)})}),"RefreshableLayerView")}};return(0,h._)([(0,F.Cb)()],B.prototype,"layer",void 0),B=(0,h._)([(0,b.j)("esri.layers.mixins.RefreshableLayerView")],B),B}},76388:(W,V,u)=>{u.d(V,{V:()=>y,e:()=>p});var h=u(49996),f=u(18502),Z=u(6663);function p(c){return F.apply(this,arguments)}function F(){return(F=(0,h.Z)(function*(c,S=c.popupTemplate){if(!(0,f.pC)(S))return[];const b=yield S.getRequiredFields(c.fieldsIndex),{lastEditInfoEnabled:_}=S,{objectIdField:U,typeIdField:B,globalIdField:Q,relationships:D}=c;if(b.includes("*"))return["*"];const ne=_?yield(0,Z.CH)(c):[],A=(0,Z.Q0)(c.fieldsIndex,[...b,...ne]);return B&&A.push(B),A&&U&&c.fieldsIndex.has(U)&&-1===A.indexOf(U)&&A.push(U),A&&Q&&c.fieldsIndex.has(Q)&&-1===A.indexOf(Q)&&A.push(Q),D&&D.forEach(x=>{const{keyField:N}=x;A&&N&&c.fieldsIndex.has(N)&&-1===A.indexOf(N)&&A.push(N)}),A})).apply(this,arguments)}function y(c,S){return c.popupTemplate?c.popupTemplate:(0,f.pC)(S)&&S.defaultPopupTemplateEnabled&&(0,f.pC)(c.defaultPopupTemplate)?c.defaultPopupTemplate:null}},7380:(W,V,u)=>{u.d(V,{K:()=>F});u(61243);var f=u(18502),Z=u(55612),p=u(70157);function F(S,b,_,U=new p.Z){let B;if("2d"===_.type)B=b*_.resolution;else if("3d"===_.type){const N=_.overlayPixelSizeInMapUnits(S),se=_.basemapSpatialReference;B=(0,f.pC)(se)&&!se.equals(_.spatialReference)?(0,Z.c9)(se)/(0,Z.c9)(_.spatialReference):b*N}const Q=S.x-B,D=S.y-B,ne=S.x+B,A=S.y+B,{spatialReference:x}=_;return U.xmin=Math.min(Q,ne),U.ymin=Math.min(D,A),U.xmax=Math.max(Q,ne),U.ymax=Math.max(D,A),U.spatialReference=x,U}new p.Z},89836:(W,V,u)=>{function h(F){var y;const c=F.layer;return"floorInfo"in c&&null!=(y=c.floorInfo)&&y.floorField&&"floors"in F.view?p(F.view.floors,c.floorInfo.floorField):null}function f(F,y){var c;return"floorInfo"in y&&null!=(c=y.floorInfo)&&c.floorField?p(F,y.floorInfo.floorField):null}function Z(F,y){const{definitionExpression:c}=y;return F?c?`(${c}) AND (${F})`:F:c}function p(F,y){if(null==F||!F.length)return null;const c=F.filter(S=>""!==S).map(S=>`'${S}'`);return c.push("''"),`${y} IN (${c.join(",")}) OR ${y} IS NULL`}u.d(V,{Hp:()=>Z,cx:()=>h,ff:()=>f})}}]);
//# sourceMappingURL=6607.2fb15cfa0d3e6270d107.js.map