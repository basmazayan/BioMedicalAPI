{"version":3,"mappings":"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","names":["s","sublayers","i","a","v","l","id","o","u","maxSize","f","E","x","renderChildren","p","L","this","super","painter","c","b","_","y","d","initialize","exportImageParameters","layer","destroy","e","commitProperty","_get","fetchPopupFeatures","O","Promise","reject","r","get","m","minScale","maxScale","visible","forEach","popupEnabled","X","defaultPopupTemplateEnabled","t","unshift","sublayer","popupTemplate","toArray","reverse","map","all","load","catch","createQuery","event","renderer","createFetchPopupFeaturesQueryGeometry","geometry","outFields","n","type","view","floors","clone","where","_loadArcadeModules","arcadeUtils","hasGeometryOperations","maxAllowableOffset","width","queryFeatures","features","reduce","value","filter","canResume","timeExtent","isEmpty","Array","isArray","content","some","prototype","readOnly","g","h","constructor","arguments","_highlightGraphics","update","strategy","error","attach","imageMaxWidth","imageMaxHeight","version","_bitmapContainer","container","addChild","graphics","requestUpdateCallback","requestUpdate","featuresTilingScheme","fetchSource","fetchImage","bind","imageRotationSupported","imageNormalizationSupported","hidpi","handles","add","watch","detach","remove","removeAllChildren","moveStart","viewChange","moveEnd","highlight","doRefresh","isUpdating","updating","updateRequested","B","M","getRequiredFields","fieldsIndex","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","push","has","indexOf","keyField","defaultPopupTemplate","R","spatialReference","definitionExpression"],"sources":["./node_modules/@arcgis/core/layers/support/sublayerUtils.js","./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","./node_modules/@arcgis/core/views/2d/layers/graphics/HighlightGraphicContainer.js","./node_modules/@arcgis/core/views/layers/MapImageLayerView.js","./node_modules/@arcgis/core/views/2d/layers/MapImageLayerView2D.js","./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js","./node_modules/@arcgis/core/views/layers/support/popupUtils.js","./node_modules/@arcgis/core/views/support/drapedUtils.js","./node_modules/@arcgis/core/views/support/floorFilterUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nfunction e(e,n,i){const o=n.flatten((({sublayers:e})=>e)).length;if(o!==e.length)return!0;return!!e.some((e=>e.originIdOf(\"minScale\")>i||e.originIdOf(\"maxScale\")>i||e.originIdOf(\"renderer\")>i||e.originIdOf(\"labelingInfo\")>i||e.originIdOf(\"opacity\")>i||e.originIdOf(\"labelsVisible\")>i||e.originIdOf(\"source\")>i))||!r(e,n)}function n(e,n,i){return!!e.some((e=>{const n=e.source;return!(!n||\"map-layer\"===n.type&&n.mapLayerId===e.id&&(!n.gdbVersion||n.gdbVersion===i.gdbVersion))||e.originIdOf(\"renderer\")>2||e.originIdOf(\"labelingInfo\")>2||e.originIdOf(\"opacity\")>2||e.originIdOf(\"labelsVisible\")>2}))||!r(e,n)}function r(e,n){if(!e||!e.length)return!0;const r=n.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).map((e=>e.id)).toArray();if(e.length>r.length)return!1;let i=0;const o=r.length;for(const{id:t}of e){for(;i<o&&r[i]!==t;)i++;if(i>=o)return!1}return!0}function i(e){return!!e&&e.some((e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale))}export{n as isExportDynamic,i as isSublayerOverhaul,e as shouldWriteSublayerStructure};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}function n(t,n){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?e(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>\"size\"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s=\"touch\"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o=\"visualVariables\"in n?r(s,n.visualVariables):s;if(\"simple\"===n.type)return t(o,n.symbol);if(\"unique-value\"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}export{s as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../../../chunks/tslib.es6.js\";import\"../../../../core/Logger.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/set.js\";import{subclass as e}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{WGLDrawPhase as s}from\"../../engine/webgl/enums.js\";import t from\"./BaseGraphicContainer.js\";let o=class extends t{renderChildren(r){if(r.drawPhase!==s.HIGHLIGHT)return;if(this.attributeView.bindTextures(r.context),!this.children.some((r=>r.hasData)))return;super.renderChildren(r);const{painter:e}=r,t=e.effects.highlight;t.bind(r),r.context.setColorMask(!0,!0,!0,!0),r.context.clear(16384),this._renderChildren(r,t.defines.concat([\"highlightAll\"])),t.draw(r),t.unbind()}};o=r([e(\"esri.views.2d.layers.support.HighlightGraphicContainer\")],o);const i=o;export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{eachAlways as o}from\"../../core/promiseUtils.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as i}from\"../../layers/support/commonProperties.js\";import{ExportImageParameters as p}from\"../../layers/support/ExportImageParameters.js\";import{calculateTolerance as l}from\"../../renderers/support/clickToleranceUtils.js\";import{loadArcade as m}from\"../../support/arcadeOnDemand.js\";import{getRequiredFields as n,getFetchPopupTemplate as c}from\"./support/popupUtils.js\";import{getLayerFloorFilterClause as u}from\"../support/floorFilterUtils.js\";const y=y=>{let d=class extends y{initialize(){this.exportImageParameters=new p({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}async fetchPopupFeatures(e,s){const{layer:a}=this;if(!e)return Promise.reject(new r(\"mapimagelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:a}));const i=this.get(\"view.scale\"),p=[],m=async e=>{const r=0===e.minScale||i<=e.minScale,o=0===e.maxScale||i>=e.maxScale;if(e.visible&&r&&o)if(e.sublayers)e.sublayers.forEach(m);else if(e.popupEnabled){const r=c(e,{...s,defaultPopupTemplateEnabled:!1});t(r)&&p.unshift({sublayer:e,popupTemplate:r})}},y=a.sublayers.toArray().reverse().map(m);await Promise.all(y);const d=p.map((async({sublayer:r,popupTemplate:o})=>{await r.load().catch((()=>{}));const a=r.createQuery(),i=t(s)?s.event:null,p=l({renderer:r.renderer,event:i}),m=this.createFetchPopupFeaturesQueryGeometry(e,p);if(a.geometry=m,a.outFields=await n(r,o),\"map-image\"===this.layer.type&&\"floors\"in this.view){var c,y;const e=null==(c=this.view)||null==(y=c.floors)?void 0:y.clone(),o=u(e,r);t(o)&&(a.where=a.where?`(${a.where}) AND (${o})`:o)}const d=await this._loadArcadeModules(o);d&&d.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=m.width/p);return(await r.queryFeatures(a)).features}));return(await o(d)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\")||Array.isArray(e.content)&&e.content.some((e=>\"expression\"===e.type)))return m()}};return e([s()],d.prototype,\"exportImageParameters\",void 0),e([s({readOnly:!0})],d.prototype,\"exportImageVersion\",null),e([s()],d.prototype,\"layer\",void 0),e([s()],d.prototype,\"suspended\",void 0),e([s(i)],d.prototype,\"timeExtent\",void 0),d=e([a(\"esri.views.layers.MapImageLayerView\")],d),d};export{y as MapImageLayerView,y as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Logger.js\";import{isAbortError as r}from\"../../../core/promiseUtils.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{GraphicsCollection as a}from\"../../../support/GraphicsCollection.js\";import{BitmapContainer as o}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as h}from\"./LayerView2D.js\";import p from\"./graphics/GraphicsView2D.js\";import m from\"./graphics/HighlightGraphicContainer.js\";import n from\"./support/ExportStrategy.js\";import c from\"../../layers/LayerView.js\";import{MapImageLayerView as d}from\"../../layers/MapImageLayerView.js\";import{RefreshableLayerView as g}from\"../../layers/RefreshableLayerView.js\";import{createQueryGeometry as l}from\"../../support/drapedUtils.js\";const u=t.getLogger(\"esri.views.2d.layers.MapImageLayerView2D\");let f=class extends(d(g(h(c)))){constructor(){super(...arguments),this._highlightGraphics=new a}update(e){this.strategy.update(e).catch((e=>{r(e)||u.error(e)}))}attach(){const{imageMaxWidth:e,imageMaxHeight:t,version:r}=this.layer,i=r>=10.3,s=r>=10;this._bitmapContainer=new o,this.container.addChild(this._bitmapContainer);const a=new p({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new m(this.view.featuresTilingScheme)});this.container.addChild(a.container),this.strategy=new n({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:i,imageNormalizationSupported:s,hidpi:!0}),this.handles.add(this.watch(\"exportImageVersion\",(()=>this.requestUpdate())),\"exportImageVersion\"),this.handles.add(this.watch(\"view.floors\",(()=>this.requestUpdate())),\"view.floors\"),this.requestUpdate()}detach(){this.handles.remove(\"exportImageVersion\"),this.handles.remove(\"view.floors\"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}highlight(e,t){return this._highlightGraphics.add(e),{remove:()=>{this._highlightGraphics.remove(e)}}}createFetchPopupFeaturesQueryGeometry(e,t){return l(e,t,this.view)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,r,i){return this.layer.fetchImage(e,t,r,{timeExtent:this.timeExtent,floors:this.view.floors,...i})}};e([i()],f.prototype,\"strategy\",void 0),e([i()],f.prototype,\"updating\",void 0),f=e([s(\"esri.views.2d.layers.MapImageLayerView2D\")],f);const y=f;export{y as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/watchUtils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let c=class extends i{initialize(){this.handles.add(o(this,\"layer\",\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this.declaredClass).error(r)}))})),\"RefreshableLayerView\")}};return r([t()],c.prototype,\"layer\",void 0),c=r([a(\"esri.layers.mixins.RefreshableLayerView\")],c),c};export{i as RefreshableLayerView,i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l}from\"../../../layers/support/fieldUtils.js\";async function t(t,d=t.popupTemplate){if(!e(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes(\"*\"))return[\"*\"];const f=n?await p(t):[],r=l(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,t as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import{isSome as e,isNone as t}from\"../../core/maybe.js\";import{getMetersPerUnitForSR as r}from\"../../core/unitUtils.js\";import{calculateTolerance as n}from\"../../renderers/support/clickToleranceUtils.js\";import i from\"../../geometry/Extent.js\";function a(t,n,a,o=new i){let s;if(\"2d\"===a.type)s=n*a.resolution;else if(\"3d\"===a.type){const i=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?r(o)/r(a.spatialReference):n*i}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,i){const o=i.toMap(e);if(t(o))return!1;return a(o,n(),i,s).intersects(r)}const s=new i;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nfunction o(o){var n;const l=o.layer;if(\"floorInfo\"in l&&null!=(n=l.floorInfo)&&n.floorField&&\"floors\"in o.view){return r(o.view.floors,l.floorInfo.floorField)}return null}function n(o,n){var l;return\"floorInfo\"in n&&null!=(l=n.floorInfo)&&l.floorField?r(o,n.floorInfo.floorField):null}function l(o,n){const{definitionExpression:l}=n;return o?l?`(${l}) AND (${o})`:o:l}function r(o,n){if(null==o||!o.length)return null;const l=o.filter((o=>\"\"!==o)).map((o=>`'${o}'`));return l.push(\"''\"),`${n} IN (${l.join(\",\")}) OR ${n} IS NULL`}export{l as combineFloorsDefinitionExpression,o as getFloorFilterClause,n as getLayerFloorFilterClause};\n"],"sourceRoot":"webpack:///","file":"387.d2db8442823b2d05021e.js"}