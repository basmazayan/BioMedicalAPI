"use strict";var re=Object.defineProperty,ie=Object.defineProperties,se=Object.getOwnPropertyDescriptors,ee=Object.getOwnPropertySymbols,oe=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable,te=(E,f,l)=>f in E?re(E,f,{enumerable:!0,configurable:!0,writable:!0,value:l}):E[f]=l,V=(E,f)=>{for(var l in f||(f={}))oe.call(f,l)&&te(E,l,f[l]);if(ee)for(var l of ee(f))ae.call(f,l)&&te(E,l,f[l]);return E},ne=(E,f)=>ie(E,se(f));(self.webpackChunkbio_medical=self.webpackChunkbio_medical||[]).push([[3566],{33566:(E,f,l)=>{l.r(f),l.d(f,{default:()=>H});var g=l(49996),B=l(30351),R=l(61414),q=l(22345),L=l(18502),b=l(7808),w=l(70279),v=l(35169),S=l(42187),K=l(81091),D=l(79371),Q=l(64740),Z=l(98254),x=l(45033),m=l(6035),k=l(62419),N=l(34309),z=l(6663);const J={hasAttachments:!1,capabilities:"query, editing, create, delete, update",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsPercentileStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};class H{constructor(){var i=this;this._queryEngine=null,this._snapshotFeatures=function(){var s=(0,g.Z)(function*(r){const a=yield i._fetch(r);return i._createFeatures(a)});return function(r){return s.apply(this,arguments)}}()}destroy(){var i;null==(i=this._queryEngine)||i.destroy(),this._queryEngine=this._fieldsIndex=this._createDefaultAttributes=null}load(i,s={}){var r=this;return(0,g.Z)(function*(){r.loadOptions={url:i.url,customParameters:i.customParameters};const a=[];yield r._checkProjection(i.spatialReference);let d=null;i.url&&(d=yield r._fetch(null==s?void 0:s.signal));const _=(0,Z.my)(d,{geometryType:i.geometryType}),y=i.fields||_.fields||[],h=null!=i.hasZ?i.hasZ:_.hasZ,I=_.geometryType,e=i.objectIdField||_.objectIdFieldName||"__OBJECTID",t=i.spatialReference||v.Zn;let n=i.timeInfo;y===_.fields&&_.unknownFields.length>0&&a.push({name:"geojson-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:_.unknownFields}});let o=y.find(u=>u.name===e);o?("esriFieldTypeString"!==o.type&&(o.type="esriFieldTypeOID"),o.editable=!1,o.nullable=!1):(o={alias:e,name:e,type:"string"===_.objectIdFieldType?"esriFieldTypeString":"esriFieldTypeOID",editable:!1,nullable:!1},y.unshift(o));const c={};for(const u of y){if(null==u.name&&(u.name=u.alias),null==u.alias&&(u.alias=u.name),!u.name)throw new R.Z("geojson-layer:invalid-field-name","field name is missing",{field:u});if(!N.v.jsonValues.includes(u.type))throw new R.Z("geojson-layer:invalid-field-type",`invalid type for field "${u.name}"`,{field:u});if(u.name!==o.name){const F=(0,z.os)(u);void 0!==F&&(c[u.name]=F)}}r._fieldsIndex=new k.Z(y);const P=r._fieldsIndex.requiredFields.indexOf(o);if(P>-1&&r._fieldsIndex.requiredFields.splice(P,1),n){if(n.startTimeField){const u=r._fieldsIndex.get(n.startTimeField);u?(n.startTimeField=u.name,u.type="esriFieldTypeDate"):n.startTimeField=null}if(n.endTimeField){const u=r._fieldsIndex.get(n.endTimeField);u?(n.endTimeField=u.name,u.type="esriFieldTypeDate"):n.endTimeField=null}if(n.trackIdField){const u=r._fieldsIndex.get(n.trackIdField);u?n.trackIdField=u.name:(n.trackIdField=null,a.push({name:"geojson-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:n}}))}n.startTimeField||n.endTimeField||(a.push({name:"geojson-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:n}}),n=null)}const j=I?(0,x.bU)(I):null,p={warnings:a,featureErrors:[],layerDefinition:ne(V({},J),{drawingInfo:j,templates:(0,x.Hq)(c),extent:null,geometryType:I,objectIdField:e,fields:y,hasZ:!!h,timeInfo:n})};r._queryEngine=new Q.Z({fields:y,geometryType:I,hasM:!1,hasZ:h,objectIdField:e,spatialReference:t,timeInfo:n,featureStore:new K.Z({geometryType:I,hasM:!1,hasZ:h}),cacheSpatialQueries:!0}),r._createDefaultAttributes=(0,x.Dm)(c,e);const O=yield r._createFeatures(d);r._objectIdGenerator=r._createObjectIdGenerator(r._queryEngine,O);const T=r._normalizeFeatures(O,p.warnings,p.featureErrors);if(r._queryEngine.featureStore.addMany(T),p.layerDefinition.extent=r._queryEngine.fullExtent,p.layerDefinition.timeInfo){const{start:u,end:F}=r._queryEngine.timeExtent;p.layerDefinition.timeInfo.timeExtent=[u,F]}return p})()}applyEdits(i){var s=this;return(0,g.Z)(function*(){const{spatialReference:r,geometryType:a}=s._queryEngine;return yield Promise.all([(0,m.b)(r,a),(0,D._W)(i.adds,r),(0,D._W)(i.updates,r)]),yield s._waitSnapshotComplete(),s._applyEdits(i)})()}queryFeatures(i={},s={}){var r=this;return(0,g.Z)(function*(){return yield r._waitSnapshotComplete(),r._queryEngine.executeQuery(i,s.signal)})()}queryFeatureCount(i={},s={}){var r=this;return(0,g.Z)(function*(){return yield r._waitSnapshotComplete(),r._queryEngine.executeQueryForCount(i,s.signal)})()}queryObjectIds(i={},s={}){var r=this;return(0,g.Z)(function*(){return yield r._waitSnapshotComplete(),r._queryEngine.executeQueryForIds(i,s.signal)})()}queryExtent(i={},s={}){var r=this;return(0,g.Z)(function*(){return yield r._waitSnapshotComplete(),r._queryEngine.executeQueryForExtent(i,s.signal)})()}querySnapping(i,s={}){var r=this;return(0,g.Z)(function*(){return yield r._waitSnapshotComplete(),r._queryEngine.executeQueryForSnapping(i,s.signal)})()}refresh(i){var s=this;return(0,g.Z)(function*(){var r;return s.loadOptions.customParameters=i,null==(r=s._snapshotTask)||r.abort(),s._snapshotTask=(0,b.vr)(s._snapshotFeatures),s._snapshotTask.promise.then(a=>{s._queryEngine.featureStore.clear(),s._objectIdGenerator=s._createObjectIdGenerator(s._queryEngine,a);const d=s._normalizeFeatures(a);d&&s._queryEngine.featureStore.addMany(d)},a=>{s._queryEngine.featureStore.clear(),(0,b.D_)(a)||q.Z.getLogger("esri.layers.GeoJSONLayer").error(new R.Z("geojson-layer:refresh","An error occurred during refresh",{error:a}))}),yield s._waitSnapshotComplete(),{extent:s._queryEngine.fullExtent,timeExtent:s._queryEngine.timeExtent}})()}_createFeatures(i){var s=this;return(0,g.Z)(function*(){const{geometryType:r,hasZ:a,objectIdField:d}=s._queryEngine,_=(0,Z.lG)(i,{geometryType:r,hasZ:a,objectIdField:d});if(!(0,v.fS)(s._queryEngine.spatialReference,v.Zn))for(const y of _)(0,L.pC)(y.geometry)&&(y.geometry=(0,S.GH)((0,D.iV)((0,S.di)(y.geometry,s._queryEngine.geometryType,s._queryEngine.hasZ,!1),v.Zn,s._queryEngine.spatialReference)));return _})()}_waitSnapshotComplete(){var i=this;return(0,g.Z)(function*(){if(i._snapshotTask&&!i._snapshotTask.finished){try{yield i._snapshotTask.promise}catch(s){}return i._waitSnapshotComplete()}})()}_fetch(i){var s=this;return(0,g.Z)(function*(){const{url:r,customParameters:a}=s.loadOptions,d=(yield(0,B.default)(r,{responseType:"json",query:V({},a),signal:i})).data;return yield(0,Z.O3)(d),d})()}_normalizeFeatures(i,s,r){const{objectIdField:a}=this._queryEngine,d=[];for(const _ of i){const y=this._createDefaultAttributes(),h=(0,m.O0)(this._fieldsIndex,y,_.attributes,!0,s);h?null==r||r.push(h):(this._assignObjectId(y,_.attributes,!0),_.attributes=y,_.objectId=y[a],d.push(_))}return d}_applyEdits(i){const{adds:s,updates:r,deletes:a}=i,d={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(s&&s.length&&this._applyAddEdits(d,s),r&&r.length&&this._applyUpdateEdits(d,r),a&&a.length){for(const _ of a)d.deleteResults.push((0,m.d1)(_));this._queryEngine.featureStore.removeManyById(a)}return{extent:this._queryEngine.fullExtent,timeExtent:this._queryEngine.timeExtent,featureEditResults:d}}_applyAddEdits(i,s){const{addResults:r}=i,{geometryType:a,hasM:d,hasZ:_,objectIdField:y,spatialReference:h,featureStore:I}=this._queryEngine,e=[];for(const t of s){if(t.geometry&&a!==(0,w.Ji)(t.geometry)){r.push((0,m.av)("Incorrect geometry type."));continue}const n=this._createDefaultAttributes(),o=(0,m.O0)(this._fieldsIndex,n,t.attributes);if(o)r.push(o);else{if(this._assignObjectId(n,t.attributes),t.attributes=n,null!=t.uid){const c=t.attributes[y];i.uidToObjectId[t.uid]=c}(0,L.pC)(t.geometry)&&(t.geometry=(0,D.iV)((0,m.og)(t.geometry,h),t.geometry.spatialReference,h)),e.push(t),r.push((0,m.d1)(t.attributes[y]))}}I.addMany((0,S.Yn)([],e,a,_,d,y))}_applyUpdateEdits({updateResults:i},s){const{geometryType:r,hasM:a,hasZ:d,objectIdField:_,spatialReference:y,featureStore:h}=this._queryEngine;for(const I of s){const{attributes:e,geometry:t}=I,n=e&&e[_];if(null==n){i.push((0,m.av)(`Identifier field ${_} missing`));continue}if(!h.has(n)){i.push((0,m.av)(`Feature with object id ${n} missing`));continue}const o=(0,S.EI)(h.getFeature(n),r,d,a);if((0,L.pC)(t)){if(r!==(0,w.Ji)(t)){i.push((0,m.av)("Incorrect geometry type."));continue}o.geometry=(0,D.iV)((0,m.og)(t,y),t.spatialReference,y)}if(e){const c=(0,m.O0)(this._fieldsIndex,o.attributes,e);if(c){i.push(c);continue}}h.add((0,S.XA)(o,r,d,a,_)),i.push((0,m.d1)(n))}}_createObjectIdGenerator(i,s){const r=i.fieldsIndex.get(i.objectIdField);if("esriFieldTypeString"===r.type)return()=>r.name+"-"+Date.now().toString(16);let a=Number.NEGATIVE_INFINITY;for(const d of s)d.objectId&&(a=Math.max(a,d.objectId));return a=Math.max(0,a)+1,()=>a++}_assignObjectId(i,s,r=!1){const a=this._queryEngine.objectIdField;i[a]=r&&a in s?s[a]:this._objectIdGenerator()}_checkProjection(i){return(0,g.Z)(function*(){try{yield(0,D._W)(v.Zn,i)}catch(s){throw new R.Z("geojson-layer","Projection not supported")}})()}}},98254:(E,f,l)=>{l.d(f,{lG:()=>I,q9:()=>b,my:()=>h,O3:()=>y});var g=l(61414),B=l(56499),R=l(82760),q=l(6663);const L={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function b(e){return L[e]}function*w(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*v(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const n of t)yield*n}}function K(e){for(const t of e)if(t.length>2)return!0;return!1}function Z(e){let t=0;for(let n=0;n<e.length;n++){const o=e[n],c=e[(n+1)%e.length];t+=o[0]*c[1]-c[0]*o[1]}return t<=0}function x(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function m(e,t,n){switch(t.type){case"LineString":return function(e,t,n){return r(e,t.coordinates,n),e}(e,t,n);case"MultiLineString":return function(e,t,n){for(const o of t.coordinates)r(e,o,n);return e}(e,t,n);case"MultiPoint":return function(e,t,n){return r(e,t.coordinates,n),e}(e,t,n);case"MultiPolygon":return function(e,t,n){for(const o of t.coordinates){i(e,o[0],n);for(let c=1;c<o.length;c++)s(e,o[c],n)}return e}(e,t,n);case"Point":return function(e,t,n){return d(e,t.coordinates,n),e}(e,t,n);case"Polygon":return function(e,t,n){const o=t.coordinates;i(e,o[0],n);for(let c=1;c<o.length;c++)s(e,o[c],n);return e}(e,t,n)}}function i(e,t,n){const o=x(t);!function(e){return!Z(e)}(o)?r(e,o,n):a(e,o,n)}function s(e,t,n){const o=x(t);!function(e){return Z(e)}(o)?r(e,o,n):a(e,o,n)}function r(e,t,n){for(const o of t)d(e,o,n);e.lengths.push(t.length)}function a(e,t,n){for(let o=t.length-1;o>=0;o--)d(e,t[o],n);e.lengths.push(t.length)}function d(e,t,n){const[o,c,P]=t;e.coords.push(o,c),n.hasZ&&e.coords.push(P||0)}function _(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function y(e){if(!e)throw new g.Z("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new g.Z("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:t}=e;if(!t)return;const n="string"==typeof t?t:"name"===t.type?t.properties.name:"EPSG"===t.type?t.properties.code:null,o=new RegExp(".*(CRS84H?|4326)$","i");if(!n||!o.test(n))throw new g.Z("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}function h(e,t={}){const n=[],o=new Set,c=new Set;let P,j=!1,p=null,O=!1,{geometryType:T=null}=t,u=!1;for(const G of w(e)){const{geometry:W,properties:C,id:A}=G;if((!W||(T||(T=b(W.type)),b(W.type)===T))&&(j||(j=K(v(W))),O||(O=null!=A,O&&(P=typeof A,p=Object.keys(C).filter(U=>C[U]===A))),O&&null!=A&&(p.length>1?p=p.filter(U=>C[U]===A):1===p.length&&(p=C[p[0]]===A?p:[])),!u&&C)){let U=!0;for(const M in C){if(o.has(M))continue;const Y=C[M];if(null==Y){U=!1,c.add(M);continue}const X=_(Y);"unknown"!==X?(c.delete(M),o.add(M),n.push({name:M,alias:M,type:X})):c.add(M)}u=U}}const F=p&&1===p.length&&p[0]||null;if(F)for(const G of n)if(G.name===F&&(0,q.H7)(G)){G.type="esriFieldTypeOID";break}return{fields:n,geometryType:T,hasZ:j,objectIdFieldName:F,objectIdFieldType:P,unknownFields:Array.from(c)}}function I(e,t){return Array.from(function*(e,t={}){const{geometryType:n,objectIdField:o}=t;for(const P of e){var c;const{geometry:j,properties:p,id:O}=P;if(j&&b(j.type)!==n)continue;const T=p||{};let u=null!=(c=T[o])?c:null;o&&null!=O&&!T[o]&&(T[o]=u=O),yield new B.ZP(j?m(new R.Z,j,t):null,T,null,u)}}(w(e),t))}}}]);
//# sourceMappingURL=3566.ec54c287f0655bf0b6a4.js.map