{"version":3,"file":"2763.68e42d6878168ccae54d.js","mappings":"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","sources":["./node_modules/@arcgis/core/layers/graphics/sources/WFSSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Error.js\";import t from\"../../../core/Logger.js\";import{isSome as r,unwrap as s}from\"../../../core/maybe.js\";import{throwIfAborted as a,createTask as i,isAbortError as n}from\"../../../core/promiseUtils.js\";import{equals as o,WGS84 as u}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as p,convertToGeometry as h}from\"../featureConversionUtils.js\";import y from\"../data/FeatureStore.js\";import{project as l,checkProjectionSupport as c}from\"../data/projectionSupport.js\";import m from\"../data/QueryEngine.js\";import{validateGeoJSON as g,createOptimizedFeatures as _}from\"./geojson/geojson.js\";import{mixAttributes as f}from\"./support/sourceUtils.js\";import{getFeature as d}from\"../../ogc/wfsUtils.js\";import w from\"../../support/FieldsIndex.js\";class E{constructor(){this._queryEngine=null,this._customParameters=null,this._snapshotFeatures=async e=>{const{objectIdField:t}=this._queryEngine,s=await d(this._getFeatureUrl,this._featureType.typeName,this._getFeatureOutputFormat,{customParameters:this._customParameters,dateFields:this._queryEngine.fieldsIndex.dateFields.map((e=>e.name)),signal:e});await g(s),a(e);const i=_(s,{geometryType:this._queryEngine.geometryType,hasZ:!1,objectIdField:t});if(!o(this._queryEngine.spatialReference,u))for(const a of i)r(a.geometry)&&(a.geometry=p(l(h(a.geometry,this._queryEngine.geometryType,!1,!1),u,this._queryEngine.spatialReference)));let n=1;for(const r of i){const e={};f(this._fieldsIndex,e,r.attributes,!0),r.attributes=e,null==r.attributes[t]&&(r.objectId=r.attributes[t]=n++)}return i}}destroy(){var e;null==(e=this._queryEngine)||e.destroy(),this._queryEngine=null}async load(e,t){const{getFeatureUrl:r,getFeatureOutputFormat:i,spatialReference:n,fields:o,geometryType:u,featureType:p,objectIdField:h,customParameters:l}=e;this._featureType=p,this._customParameters=l,this._getFeatureUrl=r,this._getFeatureOutputFormat=i,this._fieldsIndex=new w(o),await this._checkProjection(n),a(t),this._queryEngine=new m({fields:o,geometryType:u,hasM:!1,hasZ:!1,objectIdField:h,spatialReference:n,timeInfo:null,featureStore:new y({geometryType:u,hasM:!1,hasZ:!1})});const c=await this._snapshotFeatures(s(t.signal));return this._queryEngine.featureStore.addMany(c),{extent:this._queryEngine.fullExtent}}async applyEdits(){throw new e(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(r){var s;return this._customParameters=r,null==(s=this._snapshotTask)||s.abort(),this._snapshotTask=i(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(r=>{this._queryEngine.featureStore.clear(),n(r)||t.getLogger(\"esri.layers.WFSLayer\").error(new e(\"wfs-layer:getfeature-error\",\"An error occurred during the GetFeature request\",{error:r}))})),await this._waitSnapshotComplete(),{extent:this._queryEngine.fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _checkProjection(t){try{await c(u,t)}catch{throw new e(\"unsupported-projection\",\"Projection not supported\",{spatialReference:t})}}}export{E as default};\n"],"names":["e","t","isSome","r","unwrap","s","throwIfAborted","a","createTask","i","isAbortError","n","equals","o","WGS84","u","convertFromGeometry","p","convertToGeometry","h","y","project","l","checkProjectionSupport","c","m","validateGeoJSON","g","createOptimizedFeatures","_","mixAttributes","f","getFeature","d","w","E","constructor","_queryEngine","_customParameters","_snapshotFeatures","objectIdField","_getFeatureUrl","_featureType","typeName","_getFeatureOutputFormat","customParameters","dateFields","fieldsIndex","map","name","signal","geometryType","hasZ","spatialReference","geometry","_fieldsIndex","attributes","objectId","destroy","load","getFeatureUrl","getFeatureOutputFormat","fields","featureType","_checkProjection","hasM","timeInfo","featureStore","addMany","extent","fullExtent","applyEdits","queryFeatures","_waitSnapshotComplete","executeQuery","queryFeatureCount","executeQueryForCount","queryObjectIds","executeQueryForIds","queryExtent","executeQueryForExtent","querySnapping","executeQueryForSnapping","refresh","_snapshotTask","abort","promise","then","clear","getLogger","error","finished","default"],"sourceRoot":"webpack:///"}