{"version":3,"mappings":"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","names":["f","s","_","i","constructor","super","arguments","e","this","attached","container","y","updateRequested","_graphicsView","_projectFullExtentPromise","_dataParameters","exportParametersVersion","extents","tileResolution","time","isOceanStyle","isOceanographic","type","_graphics","d","_updateGraphics","o","t","stationary","r","state","l","xmin","extent","ymin","xmax","ymax","spatialReference","size","n","timeExtent","requestAsImageElement","signal","_getProjectedFullExtent","c","layer","renderer","symbolTileSize","p","h","resolution","m","width","height","u","g","fetchImage","x","pixelData","pixelBlock","sizeVariables","a","minDataValue","maxDataValue","statistics","minValue","maxValue","_pixelData","clone","normalize","exportImageServiceParameters","version","JSON","stringify","flowRepresentation","style","_canReuseVectorFieldData","getGraphicsFromPixelData","rasterInfo","dataType","length","items","filter","geometry","some","intersects","removeMany","addMany","set","update","destroy","detach","isUpdating","catch","error","hitTest","attributes","attach","view","graphics","requestUpdateCallback","requestUpdate","featuresTilingScheme","removeChild","install","addChild","uninstall","updating","getPixelData","redraw","fullExtent","url","query","option","outSR","wkid","toJSON","data","featureCollection","layers","layerDefinition","Math","abs","prototype","w","E","z","ne","le","then","R","_fetchImage","oe","S","imagery","fetchPopupFeatures","popupEnabled","popupTemplate","getRequiredFields","outFields","outSpatialReference","returnTopmostRaster","showNoDataRecords","layerOptions","returnDomainValues","pixelSize","queryVisibleRasters","canResume","isEmpty","_exportImageVersion","initialize","handles","add","subview","blendMode","effect","increaseRasterJobHandlerUsage","_setSubView","watch","on","redrawOrRefetch","decreaseRasterJobHandlerUsage","remove","moveStart","viewChange","moveEnd","doRefresh","suspended","format","layerView","readOnly","v","fieldsIndex","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","push","has","indexOf","forEach","keyField","defaultPopupTemplateEnabled","defaultPopupTemplate"],"sources":["./node_modules/@arcgis/core/views/2d/layers/imagery/ImageryGraphicsView2D.js","./node_modules/@arcgis/core/views/2d/layers/imagery/ImageryView2D.js","./node_modules/@arcgis/core/views/layers/ImageryLayerView.js","./node_modules/@arcgis/core/views/2d/layers/ImageryLayerView2D.js","./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js","./node_modules/@arcgis/core/views/layers/support/popupUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../Graphic.js\";import r from\"../../../../request.js\";import i from\"../../../../core/Accessor.js\";import s from\"../../../../core/Logger.js\";import{isSome as a}from\"../../../../core/maybe.js\";import{debounce as o,isAbortError as n}from\"../../../../core/promiseUtils.js\";import{property as c}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{enumeration as p}from\"../../../../core/accessorSupport/decorators/enumeration.js\";import{subclass as h}from\"../../../../core/accessorSupport/decorators/subclass.js\";import l from\"../../../../geometry/Extent.js\";import{projectExtent as m}from\"../../../../layers/support/rasterFunctions/rasterProjectionHelper.js\";import{snapImageToSymbolTile as u}from\"../../../../layers/support/rasterFunctions/vectorFieldUtils.js\";import{GraphicsCollection as d}from\"../../../../support/GraphicsCollection.js\";import{Container as y}from\"../../engine/Container.js\";import g from\"../graphics/GraphicContainer.js\";import x from\"../graphics/GraphicsView2D.js\";const f=s.getLogger(\"esri.views.2d.layers.imagery.ImageryGraphicsView2D\");let _=class extends i{constructor(){super(...arguments),this.attached=!1,this.container=new y,this.updateRequested=!1,this._graphicsView=null,this._projectFullExtentPromise=null,this._dataParameters={exportParametersVersion:0,extents:[],tileResolution:0,time:\"\",isOceanStyle:!1,isOceanographic:!1},this.type=\"Graphics\",this._graphics=new d,this._updateGraphics=o((async(e,t)=>{if(!e.stationary)return;const r=e.state,i=new l({xmin:r.extent.xmin,ymin:r.extent.ymin,xmax:r.extent.xmax,ymax:r.extent.ymax,spatialReference:r.spatialReference}),[s,o]=e.state.size,n={};n.timeExtent=this.timeExtent,n.requestAsImageElement=!1,n.signal=t,null==this._projectFullExtentPromise&&(this._projectFullExtentPromise=this._getProjectedFullExtent(i.spatialReference));const c=\"vector-field\"===this.layer.renderer.type?this.layer.renderer.symbolTileSize:50,p=await this._projectFullExtentPromise,{extent:h,resolution:m,width:d,height:y}=u(i,s,o,c,p),g=await this.layer.fetchImage(h,d,y,n),x=this.layer.renderer;if(\"vector-field\"===x.type){const t=g.pixelData.pixelBlock,r=x.sizeVariables[0];!a(t)||r.minDataValue&&r.maxDataValue||(r.minDataValue=t.statistics[0].minValue,r.maxDataValue=t.statistics[0].maxValue),this._pixelData={extent:h,pixelBlock:t};const i=h.clone().normalize(),s={exportParametersVersion:this.layer.exportImageServiceParameters.version,extents:i,tileResolution:m,time:JSON.stringify(this.timeExtent||\"\"),isOceanStyle:\"flow-to\"===x.flowRepresentation,isOceanographic:\"ocean-current-kn\"===x.style||\"ocean-current-m\"===x.style},o=this._canReuseVectorFieldData(s)?this._dataParameters.extents:[],n=await x.getGraphicsFromPixelData(g.pixelData,\"vector-uv\"===this.layer.rasterInfo.dataType,o);if(o.length){const e=this._graphics.items.filter((e=>a(e.geometry)&&o.some((t=>t.intersects(e.geometry)))&&!i.some((t=>t.intersects(e.geometry)))));this._graphics.removeMany(e),this._graphics.addMany(n)}else this._graphics.set(\"items\",n);this._graphicsView.update(e),this._dataParameters=s}}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this._updateGraphics(e).catch((e=>{n(e)||f.error(e)}))}hitTest(e){return new t({attributes:{},geometry:e.clone(),layer:this.layer})}attach(){this._graphicsView=new x({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new g(this.view.featuresTilingScheme)}),this.attached=!0}detach(){this._graphics.destroy(),this._graphicsView.destroy(),this.container.removeChild(this._graphicsView.container),this._graphicsView=null}install(e){this.container.addChild(this._graphicsView.container),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._graphicsView.container),e.removeChild(this.container)}isUpdating(){return this._graphicsView.updating||this.updateRequested}getPixelData(){return this.updating?null:this._pixelData}redraw(){}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}async _getProjectedFullExtent(e){try{return await m(this.layer.fullExtent,e)}catch(t){try{const t=(await r(this.layer.url,{query:{option:\"footprints\",outSR:e.wkid||JSON.stringify(e.toJSON()),f:\"json\"}})).data.featureCollection.layers[0].layerDefinition.extent;return t?l.fromJSON(t):null}catch{return null}}}_canReuseVectorFieldData(e){const t=this._dataParameters.exportParametersVersion===e.exportParametersVersion,r=this._dataParameters.time===e.time,i=Math.abs(this._dataParameters.tileResolution-e.tileResolution)/e.tileResolution<.01,s=this._dataParameters.extents.some((t=>e.extents.some((e=>t.intersects(e))))),a=this._dataParameters.isOceanStyle===e.isOceanStyle,o=this._dataParameters.isOceanographic===e.isOceanographic;return t&&r&&i&&s&&a&&o}};e([c()],_.prototype,\"attached\",void 0),e([c()],_.prototype,\"container\",void 0),e([c()],_.prototype,\"layer\",void 0),e([c()],_.prototype,\"timeExtent\",void 0),e([c()],_.prototype,\"view\",void 0),e([c()],_.prototype,\"updateRequested\",void 0),e([c()],_.prototype,\"updating\",null),e([p({graphics:\"Graphics\"})],_.prototype,\"type\",void 0),_=e([h(\"esri.views.2d.layers.imagery.ImageryGraphicsView2D\")],_);const w=_;export{w as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../Graphic.js\";import r from\"../../../../core/Accessor.js\";import i from\"../../../../core/Logger.js\";import{isSome as s}from\"../../../../core/maybe.js\";import{isAbortError as o}from\"../../../../core/promiseUtils.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{enumeration as n}from\"../../../../core/accessorSupport/decorators/enumeration.js\";import{subclass as p}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{mosaicPixelData as l}from\"../../../../layers/support/rasterFunctions/pixelUtils.js\";import{BitmapContainer as c}from\"../../engine/BitmapContainer.js\";import{Container as h}from\"../../engine/Container.js\";import m from\"../../engine/ImageryBitmapSource.js\";import d from\"../support/ExportStrategy.js\";const u=i.getLogger(\"esri.views.2d.layers.imagery.ImageryView2D\");let y=class extends r{constructor(){super(...arguments),this.attached=!1,this.container=new h,this.updateRequested=!1,this.type=\"Imagery\",this._bitmapView=null}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this.strategy.update(e).catch((e=>{o(e)||u.error(e)}))}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren()}hitTest(e){return new t({attributes:{},geometry:e.clone(),layer:this.layer})}attach(){const e=this.layer.version>=10,t=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,r=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this._bitmapView=new c,this.strategy=new d({container:this._bitmapView,imageNormalizationSupported:e,imageMaxHeight:t,imageMaxWidth:r,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()}),this.attached=!0}install(e){this.container.addChild(this._bitmapView),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._bitmapView),e.removeChild(this.container)}redraw(){this.strategy.updateExports((e=>{e.source instanceof HTMLImageElement?e.requestRender():this.layer.applyRenderer({pixelBlock:e.source.pixelBlock}).then((t=>{const r=e.source;r.pixelBlock=t.pixelBlock,r.filter=e=>this.layer.applyFilter(e),this.container.requestRender()}))}))}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const e=this.strategy.bitmaps;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){const t=this.view.extent,r=e.map((e=>e.source)).filter((e=>e.extent&&e.extent.intersects(t))).map((e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}))),i=l(r,t);return s(i)?{extent:i.extent,pixelBlock:i.pixelBlock}:null}return null}_fetchImage(e,t,r,i){return(i=i||{}).timeExtent=this.timeExtent,i.requestAsImageElement=!0,this.layer.fetchImage(e,t,r,i).then((e=>e.imageElement?e.imageElement:this.layer.applyRenderer(e.pixelData,{signal:i.signal}).then((t=>{const r=new m(t.pixelBlock,t.extent.clone(),e.pixelData.pixelBlock);return r.filter=e=>this.layer.applyFilter(e),r}))))}};e([a()],y.prototype,\"attached\",void 0),e([a()],y.prototype,\"container\",void 0),e([a()],y.prototype,\"layer\",void 0),e([a()],y.prototype,\"strategy\",void 0),e([a()],y.prototype,\"timeExtent\",void 0),e([a()],y.prototype,\"view\",void 0),e([a()],y.prototype,\"updateRequested\",void 0),e([a()],y.prototype,\"updating\",null),e([n({imagery:\"Imagery\"})],y.prototype,\"type\",void 0),y=e([p(\"esri.views.2d.layers.imagery.ImageryView2D\")],y);const g=y;export{g as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import p from\"../../geometry/Point.js\";import{combinedViewLayerTimeExtentProperty as i}from\"../../layers/support/commonProperties.js\";import a from\"../../rest/support/Query.js\";import{getFetchPopupTemplate as n}from\"./support/popupUtils.js\";const u=u=>{let m=class extends u{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,o){const{layer:s}=this;if(!e)throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:s});const{popupEnabled:i}=s,u=n(s,o);if(!i||!t(u))throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:i,popupTemplate:u});const m=await u.getRequiredFields(),c=new a;c.timeExtent=this.timeExtent,c.geometry=e,c.outFields=m,c.outSpatialReference=e.spatialReference;const l=this.view.resolution,y=\"2d\"===this.view.type?new p(l,l,this.view.spatialReference):new p(.5*l,.5*l,this.view.spatialReference),{returnTopmostRaster:h,showNoDataRecords:w}=u.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},d={returnDomainValues:!0,returnTopmostRaster:h,pixelSize:y,showNoDataRecords:w,signal:t(o)?o.signal:null};return s.queryVisibleRasters(c,d).then((e=>e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}};return e([o()],m.prototype,\"layer\",void 0),e([o()],m.prototype,\"suspended\",void 0),e([o(i)],m.prototype,\"timeExtent\",void 0),e([o()],m.prototype,\"view\",void 0),m=e([s(\"esri.views.layers.ImageryLayerView\")],m),m};export{u as ImageryLayerView,u as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{init as t,watch as i}from\"../../../core/watchUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import a from\"../engine/flow/AnimatedFlowView2D.js\";import{LayerView2DMixin as h}from\"./LayerView2D.js\";import o from\"./imagery/ImageryGraphicsView2D.js\";import n from\"./imagery/ImageryView2D.js\";import{ImageryLayerView as l}from\"../../layers/ImageryLayerView.js\";import u from\"../../layers/LayerView.js\";import{RefreshableLayerView as w}from\"../../layers/RefreshableLayerView.js\";let p=class extends(l(w(h(u)))){constructor(){super(...arguments),this._exportImageVersion=-1}initialize(){this.handles.add([t(this,[\"layer.blendMode\",\"layer.effects\"],(e=>{this.subview&&(this.subview.container.blendMode=e)}),!0),t(this,\"layer.effect\",(e=>{this.subview&&(this.subview.container.effect=e)}),!0)])}get pixelData(){return this.updating?null:\"getPixelData\"in this.subview?this.subview.getPixelData():null}get updating(){return!!(!this.subview||\"updating\"in this.subview&&this.subview.updating)}async hitTest(e,t){return this.subview?\"hitTest\"in this.subview?[this.subview.hitTest(e)]:[]:null}update(e){var t;null==(t=this.subview)||t.update(e)}attach(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.handles.add([t(this,\"layer.exportImageServiceParameters.version\",(e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())})),this.watch(\"timeExtent\",(()=>{\"timeExtent\"in this.subview&&(this.subview.timeExtent=this.timeExtent),this.requestUpdate()})),this.layer.on(\"redraw\",(()=>{\"redraw\"in this.subview?this.subview.redraw():this.subview.redrawOrRefetch()})),i(this.layer,\"renderer\",(()=>this._setSubView()))],\"imagerylayerview-update\")}detach(){this.layer.decreaseRasterJobHandlerUsage(),this.subview.destroy(),this.handles.remove(\"imagerylayerview-update\"),this._exportImageVersion=-1}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}async doRefresh(){this.requestUpdate()}isUpdating(){return!this.subview||!this.suspended&&this.subview.updating}_setSubView(){var e,t;let i=\"Imagery\";\"vector-field\"===(null==(e=this.layer.renderer)?void 0:e.type)&&\"lerc\"===this.layer.format&&(i=\"Graphics\");var s,r;(\"animated-flow\"===(null==(t=this.layer.renderer)?void 0:t.type)&&(i=\"Flow\"),this.subview&&this.subview.type===i)||(null==(s=this.subview)||s.uninstall(this.container),null==(r=this.subview)||r.destroy(),this.subview=\"Imagery\"===i?new n({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):\"Graphics\"===i?new o({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new a({layer:this.layer,layerView:this}),this.subview.attach(),this.subview.install(this.container),this.subview.container.blendMode=this.layer.blendMode,this.subview.container.effect=this.layer.effect);this.requestUpdate()}};e([s()],p.prototype,\"pixelData\",null),e([s({readOnly:!0})],p.prototype,\"updating\",null),e([s()],p.prototype,\"subview\",void 0),p=e([r(\"esri.views.2d.layers.ImageryLayerView2D\")],p);const d=p;export{d as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/watchUtils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let c=class extends i{initialize(){this.handles.add(o(this,\"layer\",\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this.declaredClass).error(r)}))})),\"RefreshableLayerView\")}};return r([t()],c.prototype,\"layer\",void 0),c=r([a(\"esri.layers.mixins.RefreshableLayerView\")],c),c};export{i as RefreshableLayerView,i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l}from\"../../../layers/support/fieldUtils.js\";async function t(t,d=t.popupTemplate){if(!e(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes(\"*\"))return[\"*\"];const f=n?await p(t):[],r=l(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,t as getRequiredFields};\n"],"sourceRoot":"webpack:///","file":"8584.624d0a0d8c871ca7bf1b.js"}