"use strict";var fe=Object.defineProperty,pe=Object.defineProperties,ce=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertySymbols,me=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable,J=(I,d,r)=>d in I?fe(I,d,{enumerable:!0,configurable:!0,writable:!0,value:r}):I[d]=r,B=(I,d)=>{for(var r in d||(d={}))me.call(d,r)&&J(I,r,d[r]);if(Q)for(var r of Q(d))ye.call(d,r)&&J(I,r,d[r]);return I},X=(I,d)=>pe(I,ce(d));(self.webpackChunkbio_medical=self.webpackChunkbio_medical||[]).push([[387,9836],{20975:(I,d,r)=>{function g(a,s,e){return s.flatten(({sublayers:i})=>i).length!==a.length||(!!a.some(i=>i.originIdOf("minScale")>e||i.originIdOf("maxScale")>e||i.originIdOf("renderer")>e||i.originIdOf("labelingInfo")>e||i.originIdOf("opacity")>e||i.originIdOf("labelsVisible")>e||i.originIdOf("source")>e)||!v(a,s))}function u(a,s,e){return!!a.some(o=>{const i=o.source;return!(!i||"map-layer"===i.type&&i.mapLayerId===o.id&&(!i.gdbVersion||i.gdbVersion===e.gdbVersion))||o.originIdOf("renderer")>2||o.originIdOf("labelingInfo")>2||o.originIdOf("opacity")>2||o.originIdOf("labelsVisible")>2})||!v(a,s)}function v(a,s){if(!a||!a.length)return!0;const e=s.slice().reverse().flatten(({sublayers:l})=>l&&l.toArray().reverse()).map(l=>l.id).toArray();if(a.length>e.length)return!1;let o=0;const i=e.length;for(const{id:l}of a){for(;o<i&&e[o]!==l;)o++;if(o>=i)return!1}return!0}function E(a){return!!a&&a.some(s=>null!=s.minScale||s.layerDefinition&&null!=s.layerDefinition.minScale)}r.d(d,{FN:()=>u,ac:()=>E,QV:()=>g})},98936:(I,d,r)=>{function g(s,e){return e?"xoffset"in e&&e.xoffset?Math.max(s,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(s,Math.abs(e.yoffset||0)):s:s}function v(s,e){return"number"==typeof s?s:s&&s.stops&&s.stops.length?function(s){let e=0,o=0;for(let i=0;i<s.length;i++){const l=s[i].size;"number"==typeof l&&(e+=l,o++)}return e/o}(s.stops):e}function a(s){const e=s&&s.renderer,o="touch"===(s&&s.event&&s.event.pointerType)?9:6;if(!e)return o;const i="visualVariables"in e?function(s,e){if(!e)return s;const o=e.filter(f=>"size"===f.type).map(f=>{const{maxSize:C,minSize:M}=f;return(v(C,s)+v(M,s))/2});let i=0;const l=o.length;if(0===l)return s;for(let f=0;f<l;f++)i+=o[f];const h=Math.floor(i/l);return Math.max(h,s)}(o,e.visualVariables):o;if("simple"===e.type)return g(i,e.symbol);if("unique-value"===e.type){let l=i;return e.uniqueValueInfos.forEach(h=>{l=g(l,h.symbol)}),l}if("class-breaks"===e.type){let l=i;return e.classBreakInfos.forEach(h=>{l=g(l,h.symbol)}),l}return e.type,i}r.d(d,{k:()=>a})},30699:(I,d,r)=>{r.r(d),r.d(d,{default:()=>le});var g=r(49996),u=r(79076),v=r(22345),E=r(7808),a=r(94911),i=(r(45072),r(30627),r(55865),r(96410)),l=r(78779),h=r(23335),f=r(78081),C=r(42302),L=(r(72062),r(31620)),x=r(32468);let b=class extends x.Z{renderChildren(p){if(p.drawPhase!==L.jx.HIGHLIGHT||(this.attributeView.bindTextures(p.context),!this.children.some(P=>P.hasData)))return;super.renderChildren(p);const{painter:y}=p,c=y.effects.highlight;c.bind(p),p.context.setColorMask(!0,!0,!0,!0),p.context.clear(16384),this._renderChildren(p,c.defines.concat(["highlightAll"])),c.draw(p),c.unbind()}};b=(0,u._)([(0,i.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],b);const _=b;var R=r(62330),Y=r(96121),k=r(61414),S=r(18502),q=r(46613),ee=r(71995),te=r(98936),re=r(2999),F=r(76388),ne=r(89836);const se=p=>{let y=class extends p{initialize(){this.exportImageParameters=new ee.R({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var c;return null==(c=this.exportImageParameters)||c.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}fetchPopupFeatures(c,P){var O=this;return(0,g.Z)(function*(){const{layer:V}=O;if(!c)return Promise.reject(new k.Z("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:V}));const K=O.get("view.scale"),W=[],G=function(){var U=(0,g.Z)(function*(m){const T=0===m.minScale||K<=m.minScale,D=0===m.maxScale||K>=m.maxScale;if(m.visible&&T&&D)if(m.sublayers)m.sublayers.forEach(G);else if(m.popupEnabled){const j=(0,F.V)(m,X(B({},P),{defaultPopupTemplateEnabled:!1}));(0,S.pC)(j)&&W.unshift({sublayer:m,popupTemplate:j})}});return function(T){return U.apply(this,arguments)}}(),de=V.sublayers.toArray().reverse().map(G);yield Promise.all(de);const ue=W.map(function(){var U=(0,g.Z)(function*({sublayer:m,popupTemplate:T}){yield m.load().catch(()=>{});const D=m.createQuery(),j=(0,S.pC)(P)?P.event:null,Z=(0,te.k)({renderer:m.renderer,event:j}),H=O.createFetchPopupFeaturesQueryGeometry(c,Z);if(D.geometry=H,D.outFields=yield(0,F.e)(m,T),"map-image"===O.layer.type&&"floors"in O.view){var z,$;const he=null==(z=O.view)||null==($=z.floors)?void 0:$.clone(),w=(0,ne.ff)(he,m);(0,S.pC)(w)&&(D.where=D.where?`(${D.where}) AND (${w})`:w)}const N=yield O._loadArcadeModules(T);return N&&N.arcadeUtils.hasGeometryOperations(T)||(D.maxAllowableOffset=H.width/Z),(yield m.queryFeatures(D)).features});return function(m){return U.apply(this,arguments)}}());return(yield(0,E.as)(ue)).reduce((U,m)=>m.value?[...U,...m.value]:U,[]).filter(U=>null!=U)})()}canResume(){var c;return!(!super.canResume()||null!=(c=this.timeExtent)&&c.isEmpty)}_loadArcadeModules(c){if(c.get("expressionInfos.length")||Array.isArray(c.content)&&c.content.some(P=>"expression"===P.type))return(0,re.LC)()}};return(0,u._)([(0,a.Cb)()],y.prototype,"exportImageParameters",void 0),(0,u._)([(0,a.Cb)({readOnly:!0})],y.prototype,"exportImageVersion",null),(0,u._)([(0,a.Cb)()],y.prototype,"layer",void 0),(0,u._)([(0,a.Cb)()],y.prototype,"suspended",void 0),(0,u._)([(0,a.Cb)(q.qG)],y.prototype,"timeExtent",void 0),y=(0,u._)([(0,i.j)("esri.views.layers.MapImageLayerView")],y),y};var ae=r(26263),ie=r(7380);const oe=v.Z.getLogger("esri.views.2d.layers.MapImageLayerView2D");let A=class extends(se((0,ae.y)((0,f.y)(Y.Z)))){constructor(){super(...arguments),this._highlightGraphics=new l.J}update(p){this.strategy.update(p).catch(y=>{(0,E.D_)(y)||oe.error(y)})}attach(){const{imageMaxWidth:p,imageMaxHeight:y,version:c}=this.layer,P=c>=10.3,O=c>=10;this._bitmapContainer=new h.c,this.container.addChild(this._bitmapContainer);const V=new C.Z({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new _(this.view.featuresTilingScheme)});this.container.addChild(V.container),this.strategy=new R.Z({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:p,imageMaxHeight:y,imageRotationSupported:P,imageNormalizationSupported:O,hidpi:!0}),this.handles.add(this.watch("exportImageVersion",()=>this.requestUpdate()),"exportImageVersion"),this.handles.add(this.watch("view.floors",()=>this.requestUpdate()),"view.floors"),this.requestUpdate()}detach(){this.handles.remove("exportImageVersion"),this.handles.remove("view.floors"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}highlight(p,y){return this._highlightGraphics.add(p),{remove:()=>{this._highlightGraphics.remove(p)}}}createFetchPopupFeaturesQueryGeometry(p,y){return(0,ie.K)(p,y,this.view)}doRefresh(){var p=this;return(0,g.Z)(function*(){p.requestUpdate()})()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(p,y,c,P){return this.layer.fetchImage(p,y,c,B({timeExtent:this.timeExtent,floors:this.view.floors},P))}};(0,u._)([(0,a.Cb)()],A.prototype,"strategy",void 0),(0,u._)([(0,a.Cb)()],A.prototype,"updating",void 0),A=(0,u._)([(0,i.j)("esri.views.2d.layers.MapImageLayerView2D")],A);const le=A},26263:(I,d,r)=>{r.d(d,{y:()=>l});var g=r(79076),u=r(22345),v=r(7808),E=r(11652),a=r(94911),i=(r(45072),r(30627),r(55865),r(96410));const l=h=>{let f=class extends h{initialize(){this.handles.add((0,E.on)(this,"layer","refresh",C=>{this.doRefresh(C.dataChanged).catch(M=>{(0,v.D_)(M)||u.Z.getLogger(this.declaredClass).error(M)})}),"RefreshableLayerView")}};return(0,g._)([(0,a.Cb)()],f.prototype,"layer",void 0),f=(0,g._)([(0,i.j)("esri.layers.mixins.RefreshableLayerView")],f),f}},76388:(I,d,r)=>{r.d(d,{V:()=>s,e:()=>E});var g=r(49996),u=r(18502),v=r(6663);function E(e){return a.apply(this,arguments)}function a(){return(a=(0,g.Z)(function*(e,o=e.popupTemplate){if(!(0,u.pC)(o))return[];const i=yield o.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:l}=o,{objectIdField:h,typeIdField:f,globalIdField:C,relationships:M}=e;if(i.includes("*"))return["*"];const L=l?yield(0,v.CH)(e):[],x=(0,v.Q0)(e.fieldsIndex,[...i,...L]);return f&&x.push(f),x&&h&&e.fieldsIndex.has(h)&&-1===x.indexOf(h)&&x.push(h),x&&C&&e.fieldsIndex.has(C)&&-1===x.indexOf(C)&&x.push(C),M&&M.forEach(b=>{const{keyField:_}=b;x&&_&&e.fieldsIndex.has(_)&&-1===x.indexOf(_)&&x.push(_)}),x})).apply(this,arguments)}function s(e,o){return e.popupTemplate?e.popupTemplate:(0,u.pC)(o)&&o.defaultPopupTemplateEnabled&&(0,u.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},7380:(I,d,r)=>{r.d(d,{K:()=>a});r(61243);var u=r(18502),v=r(55612),E=r(70157);function a(o,i,l,h=new E.Z){let f;if("2d"===l.type)f=i*l.resolution;else if("3d"===l.type){const _=l.overlayPixelSizeInMapUnits(o),R=l.basemapSpatialReference;f=(0,u.pC)(R)&&!R.equals(l.spatialReference)?(0,v.c9)(R)/(0,v.c9)(l.spatialReference):i*_}const C=o.x-f,M=o.y-f,L=o.x+f,x=o.y+f,{spatialReference:b}=l;return h.xmin=Math.min(C,L),h.ymin=Math.min(M,x),h.xmax=Math.max(C,L),h.ymax=Math.max(M,x),h.spatialReference=b,h}new E.Z},89836:(I,d,r)=>{function g(a){var s;const e=a.layer;return"floorInfo"in e&&null!=(s=e.floorInfo)&&s.floorField&&"floors"in a.view?E(a.view.floors,e.floorInfo.floorField):null}function u(a,s){var e;return"floorInfo"in s&&null!=(e=s.floorInfo)&&e.floorField?E(a,s.floorInfo.floorField):null}function v(a,s){const{definitionExpression:e}=s;return a?e?`(${e}) AND (${a})`:a:e}function E(a,s){if(null==a||!a.length)return null;const e=a.filter(o=>""!==o).map(o=>`'${o}'`);return e.push("''"),`${s} IN (${e.join(",")}) OR ${s} IS NULL`}r.d(d,{Hp:()=>v,cx:()=>g,ff:()=>u})}}]);
//# sourceMappingURL=387.d2db8442823b2d05021e.js.map