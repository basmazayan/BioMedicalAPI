{"version":3,"file":"1635.574a2b04be876c64b0f0.js","mappings":"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","sources":["./node_modules/@arcgis/core/layers/support/Tilemap.js","./node_modules/@arcgis/core/layers/support/TilemapCache.js","./node_modules/@arcgis/core/layers/support/serviceTileInfoProperty.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport t from\"../../request.js\";import{constant as i}from\"../../core/arrayUtils.js\";import e from\"../../core/Error.js\";import{clone as a}from\"../../core/lang.js\";class l{constructor(){this.location={left:0,top:0,width:0,height:0},this._allAvailability=\"unknown\",this.byteSize=40}getAvailability(t,i){if(\"unknown\"!==this._allAvailability)return this._allAvailability;const e=(t-this.location.top)*this.location.width+(i-this.location.left),a=e%8,l=e>>3,o=this._tileAvailabilityBitSet;return l<0||l>o.length?\"unknown\":o[l]&1<<a?\"available\":\"unavailable\"}_updateFromData(t){const i=this.location.width,e=this.location.height;let a=!0,l=!0;const o=Math.ceil(i*e/8),n=new Uint8Array(o);let r=0;for(let s=0;s<t.length;s++){const i=s%8;t[s]?(l=!1,n[r]|=1<<i):a=!1,7===i&&++r}l?this._allAvailability=\"unavailable\":a?this._allAvailability=\"available\":(this._allAvailability=\"unknown\",this._tileAvailabilityBitSet=n,this.byteSize+=n.length)}static fromDefinition(a,o){const r=a.service.request||t,{row:s,col:h,width:c,height:m}=a,d={query:{f:\"json\"}};return o=o?{...d,...o}:d,r(n(a),o).then((t=>t.data)).catch((t=>{if(t&&t.details&&422===t.details.httpStatus)return{location:{top:s,left:h,width:c,height:m},valid:!0,data:i(c*m,0)};throw t})).then((t=>{if(t.location&&(t.location.top!==s||t.location.left!==h||t.location.width!==c||t.location.height!==m))throw new e(\"tilemap:location-mismatch\",\"Tilemap response for different location than requested\",{response:t,definition:{top:s,left:h,width:c,height:m}});return l.fromJSON(t)}))}static fromJSON(t){l.validateJSON(t);const i=new l;return i.location=Object.freeze(a(t.location)),i._updateFromData(t.data),Object.freeze(i)}static validateJSON(t){if(!t||!t.location)throw new e(\"tilemap:missing-location\",\"Location missing from tilemap response\");if(!1===t.valid)throw new e(\"tilemap:invalid\",\"Tilemap response was marked as invalid\");if(!t.data)throw new e(\"tilemap:missing-data\",\"Data missing from tilemap response\");if(!Array.isArray(t.data))throw new e(\"tilemap:data-mismatch\",\"Data must be an array of numbers\");if(t.data.length!==t.location.width*t.location.height)throw new e(\"tilemap:data-mismatch\",\"Number of data items does not match width/height of tilemap\")}}function o(t){return`${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}function n(t){let i;if(\"vector-tile\"===t.service.type)i=`${t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;else{const e=t.service.tileServers;i=`${e&&e.length?e[t.row%e.length]:t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}const e=t.service.query;return e&&(i=`${i}?${e}`),i}export{l as Tilemap,l as default,o as tilemapDefinitionId};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../request.js\";import i from\"../../core/Accessor.js\";import r from\"../../core/Error.js\";import{HandleOwnerMixin as l}from\"../../core/HandleOwner.js\";import s from\"../../core/Logger.js\";import a from\"../../core/LRUCache.js\";import o from\"../../core/PooledArray.js\";import{onAbort as n,isAbortError as c,isAborted as h,createAbortError as p}from\"../../core/promiseUtils.js\";import{waitTicks as m}from\"../../core/scheduling.js\";import{objectToQuery as u}from\"../../core/urlUtils.js\";import{init as f}from\"../../core/watchUtils.js\";import{property as v}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import{cast as y}from\"../../core/accessorSupport/decorators/cast.js\";import{subclass as b}from\"../../core/accessorSupport/decorators/subclass.js\";import{tilemapDefinitionId as d,Tilemap as _}from\"./Tilemap.js\";var g;const w=s.getLogger(\"esri.layers.support.TilemapCache\");let T=g=class extends(l(i)){constructor(e){super(e),this._pendingTilemapRequests={},this._availableLevels={},this.levels=5,this.cacheByteSize=2097152,this.request=t,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new a(this.cacheByteSize),this.handles.add([this.watch([\"layer.parsedUrl\",\"layer.tileServers?\",\"layer.apiKey?\",\"layer.customParameters?\"],(()=>this._initializeTilemapDefinition())),f(this,\"layer.tileInfo.lods\",(e=>this._initializeAvailableLevels(e)),!0)]),this._initializeTilemapDefinition()}castLevels(e){return e<=2?(w.error(\"Minimum levels for Tilemap is 3, but got \",e),3):e}get size(){return 1<<this.levels}fetchTilemap(e,t,i,l){if(!this._availableLevels[e])return Promise.reject(new r(\"tilemap-cache:level-unavailable\",`Level ${e} is unavailable in the service`));const s=this._tmpTilemapDefinition,a=this._tilemapFromCache(e,t,i,s);if(a)return Promise.resolve(a);const o=l&&l.signal;return l={...l,signal:null},new Promise(((e,t)=>{n(o,(()=>t(p())));const i=d(s);let r=this._pendingTilemapRequests[i];if(!r){r=_.fromDefinition(s,l).then((e=>(this._tilemapCache.put(i,e,e.byteSize),e)));const e=()=>delete this._pendingTilemapRequests[i];this._pendingTilemapRequests[i]=r,r.then(e,e)}r.then(e,t)}))}getAvailability(e,t,i){if(!this._availableLevels[e])return\"unavailable\";const r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):\"unknown\"}fetchAvailability(e,t,i,l){return this._availableLevels[e]?this.fetchTilemap(e,t,i,l).catch((e=>e)).then((l=>{if(l instanceof _){const s=l.getAvailability(t,i);return\"unavailable\"===s?Promise.reject(new r(\"tile-map:tile-unavailable\",\"Tile is not available\",{level:e,row:t,col:i})):s}if(c(l))throw l;return\"unknown\"})):Promise.reject(new r(\"tilemap-cache:level-unavailable\",`Level ${e} is unavailable in the service`))}fetchAvailabilityUpsample(e,t,i,r,l){r.level=e,r.row=t,r.col=i;const s=this.layer.tileInfo;s.updateTileInfo(r);const a=this.fetchAvailability(e,t,i,l).catch((e=>{if(c(e))throw e;if(s.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw e}));return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,l,a),a}async _fetchAvailabilityUpsamplePrefetch(e,t,i,r,l,s){if(!this._prefetchingEnabled)return;const a=`prefetch-${e}`;if(this.handles.has(a))return;const o=new AbortController;s.then((()=>o.abort()),(()=>o.abort()));let n=!1;const c={remove(){n||(n=!0,o.abort())}};if(this.handles.add(c,a),await m(10,o.signal).catch((()=>{})),n||(n=!0,this.handles.remove(a)),h(o))return;const p={id:e,level:t,row:i,col:r},u={...l,signal:o.signal},f=this.layer.tileInfo;for(let h=0;g._prefetches.length<g._maxPrefetch&&f.upsampleTile(p);++h){const e=this.fetchAvailability(p.level,p.row,p.col,u);g._prefetches.push(e);const t=()=>{g._prefetches.removeUnordered(e)};e.then(t,t)}}_initializeTilemapDefinition(){var e;if(!this.layer.parsedUrl)return;const{parsedUrl:t,apiKey:i,customParameters:r}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:t.path,query:u({...t.query,...r,token:null!=i?i:null==(e=t.query)?void 0:e.token}),tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,r){r.level=e,r.row=t-t%this.size,r.col=i-i%this.size;const l=d(r);return this._tilemapCache.get(l)}_initializeAvailableLevels(e){this._availableLevels={},e&&e.forEach((e=>this._availableLevels[e.level]=!0))}get test(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,i,r)=>!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}};T._maxPrefetch=4,T._prefetches=new o({initialSize:g._maxPrefetch}),e([v({constructOnly:!0,type:Number})],T.prototype,\"levels\",void 0),e([y(\"levels\")],T.prototype,\"castLevels\",null),e([v({readOnly:!0,type:Number})],T.prototype,\"size\",null),e([v({constructOnly:!0,type:Number})],T.prototype,\"cacheByteSize\",void 0),e([v({constructOnly:!0})],T.prototype,\"layer\",void 0),e([v({constructOnly:!0})],T.prototype,\"request\",void 0),T=g=e([b(\"esri.layers.support.TilemapCache\")],T);export{T as TilemapCache};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport e from\"./TileInfo.js\";const r={type:e,json:{origins:{service:{read:{source:[\"tileInfo\",\"minScale\",\"maxScale\",\"minLOD\",\"maxLOD\"],reader:n}}}}};function n(r,n,l,o){if(!r)return null;const{minScale:i,maxScale:t,minLOD:m,maxLOD:s}=n;if(null!=m&&null!=s)return o&&o.ignoreMinMaxLOD?e.fromJSON(r):e.fromJSON({...r,lods:r.lods.filter((({level:e})=>null!=e&&e>=m&&e<=s))});if(0!==i&&0!==t){const n=e=>Math.round(1e4*e)/1e4,l=i?n(i):1/0,o=t?n(t):-1/0;return e.fromJSON({...r,lods:r.lods.filter((e=>{const r=n(e.scale);return r<=l&&r>=o}))})}return e.fromJSON(r)}export{n as readServiceTileInfo,r as serviceTileInfoProperty};\n"],"names":["_","e","t","i","r","HandleOwnerMixin","l","s","a","o","onAbort","n","isAbortError","c","isAborted","h","createAbortError","p","waitTicks","m","objectToQuery","u","init","f","property","v","cast","y","subclass","b","tilemapDefinitionId","d","Tilemap","g","w","getLogger","T","constructor","_pendingTilemapRequests","_availableLevels","levels","cacheByteSize","request","_prefetchingEnabled","initialize","_tilemapCache","handles","add","watch","_initializeTilemapDefinition","_initializeAvailableLevels","castLevels","error","size","fetchTilemap","Promise","reject","_tmpTilemapDefinition","_tilemapFromCache","resolve","signal","fromDefinition","then","put","byteSize","getAvailability","fetchAvailability","catch","level","row","col","fetchAvailabilityUpsample","layer","tileInfo","updateTileInfo","upsampleTile","_fetchAvailabilityUpsamplePrefetch","id","has","AbortController","abort","remove","_prefetches","length","_maxPrefetch","push","removeUnordered","parsedUrl","apiKey","customParameters","clear","service","url","path","query","token","tileServers","type","width","height","get","forEach","test","prefetchingEnabled","hasTilemap","initialSize","constructOnly","Number","prototype","readOnly","TilemapCache"],"sourceRoot":"webpack:///"}