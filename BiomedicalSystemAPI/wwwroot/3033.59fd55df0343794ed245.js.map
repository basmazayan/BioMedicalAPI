{"version":3,"file":"3033.59fd55df0343794ed245.js","mappings":"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","sources":["./node_modules/@arcgis/core/views/2d/layers/features/processors/HeatmapProcessor.js","./node_modules/@arcgis/core/views/2d/layers/features/support/tileUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import\"../../../../../core/has.js\";import{isSome as t,andThen as s}from\"../../../../../core/maybe.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/arrayUtils.js\";import\"../../../../../core/accessorSupport/set.js\";import{subclass as r}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{diff as i}from\"../../../../../core/accessorSupport/diffUtils.js\";import{calculateHeatmapIntensityInfoReaders as o}from\"../../../../../renderers/support/heatmapUtils.js\";import{TILE_SIZE as a}from\"../../../engine/webgl/definitions.js\";import n from\"./BaseProcessor.js\";import{getPow2NeighborKey as d}from\"../support/tileUtils.js\";class p{constructor(e,t){this.offset=e,this.extent=t}}function c(e){const t=e.key,s=new Map,r=256,i=a,o=e.tileInfoView.tileInfo.isWrappable;return s.set(d(t,-1,-1,o).id,new p([-i,-i],[i-r,i-r,i,i])),s.set(d(t,0,-1,o).id,new p([0,-i],[0,i-r,i,i])),s.set(d(t,1,-1,o).id,new p([i,-i],[0,i-r,r,i])),s.set(d(t,-1,0,o).id,new p([-i,0],[i-r,0,i,i])),s.set(d(t,1,0,o).id,new p([i,0],[0,0,r,i])),s.set(d(t,-1,1,o).id,new p([-i,i],[i-r,0,i,r])),s.set(d(t,0,1,o).id,new p([0,i],[0,0,i,r])),s.set(d(t,1,1,o).id,new p([i,i],[0,0,r,r])),s}let l=class extends n{constructor(){super(...arguments),this.type=\"heatmap\",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on(\"update\",this.onTileUpdate.bind(this))])}async update(e,t){const s=t.schema.processors[0];if(\"heatmap\"!==s.type)return;i(this._schema,s)&&(e.mesh=!0,this._schema=s)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(e){const t={clear:!0};return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke(\"tileRenderer.onTileData\",{tileKey:e.id,data:t})}async onTileMessage(e,r,i){this._tileKeyToFeatureSets.has(e.key.id)||this._tileKeyToFeatureSets.set(e.key.id,new Map);const a=this._tileKeyToFeatureSets.get(e.key.id);if(t(r.addOrUpdate)&&r.addOrUpdate.hasFeatures&&a.set(r.addOrUpdate.instance,r),r.end){const t=[],r=c(e);this._tileKeyToFeatureSets.forEach(((i,o)=>{if(o===e.key.id)i.forEach((e=>s(e.addOrUpdate,(e=>t.push(e)))));else if(r.has(o)){const e=r.get(o),[a,n]=e.offset;i.forEach((e=>s(e.addOrUpdate,(e=>{const s=e.transform(a,n,1,1);t.push(s)}))))}}));const a=o(t,this._schema.mesh,512,512),n={tileKey:e.key.id,intensityInfo:a},d=[a.matrix];return this.remoteClient.invoke(\"tileRenderer.onTileData\",n,{...i,transferList:d})}}onTileError(e,t,s){return this.remoteClient.invoke(\"tileRenderer.onTileError\",{tileKey:e.id,error:t},s)}};l=e([r(\"esri.views.2d.layers.features.processors.HeatmapProcessor\")],l);const h=l;export{h as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{Tile as o}from\"./Tile.js\";function e(e,n,r){const t=e.tileInfoView.tileInfo.isWrappable,i=l(e.key,n,r,t);return new o(e.tileInfoView,i)}function l(o,e,l,n){const r=o.clone(),t=1<<r.level,i=r.col+e,c=r.row+l;return n&&i<0?(r.col=i+t,r.world-=1):i>=t?(r.col=i-t,r.world+=1):r.col=i,r.row=c,r}export{l as getPow2NeighborKey,e as getPow2NeighborTile};\n"],"names":["_","e","isSome","t","andThen","s","subclass","r","diff","i","calculateHeatmapIntensityInfoReaders","o","TILE_SIZE","a","n","getPow2NeighborKey","d","p","constructor","offset","extent","c","key","Map","tileInfoView","tileInfo","isWrappable","set","id","l","arguments","type","_tileKeyToFeatureSets","initialize","handles","add","tileStore","on","onTileUpdate","bind","update","schema","processors","_schema","mesh","removed","delete","onTileClear","clear","remoteClient","invoke","tileKey","data","onTileMessage","has","get","addOrUpdate","hasFeatures","instance","end","forEach","push","transform","intensityInfo","matrix","transferList","onTileError","error","h","default"],"sourceRoot":"webpack:///"}