{"version":3,"mappings":"olBAIuM,iIAAiI,gBAAgBA,IAAEC,eAAeC,wDAAwD,SAASC,kBAAkBC,wEAAwEC,sBAAsB,MAAMC,SAAQC,gCAAiC,kJAAkJC,uBAAuB,qCAAqC,oCAAoCC,wBAAwBC,KAACC,UAAYC,WAAQA,SAAMA,eAAWC,yCAAuCC,KAAC,kDAAmDL,yBAAyBM,KAACJ,UAAYC,WAAOC,4BAA0BG,EAAKC,mBAAmB,qBAAqBC,oBAAoB,8BAA8B,oDAAoDF,qBAAqBG,sBAAsB,QAAQ,sHCAhlC,gBAAgBP,IAAEX,+BAA+BC,gGAAgGF,IAACoB,4EAA6EC,UAAUjB,yDAAyDkB,kBAAkB,6KAA0KR,KAACP,wBAAsBO,KAACV,8RCAmO,MAAMgB,EAAE,CAAC,OAAO,OAAO,KAAK,KAAK,QAAQV,EAAE,CAAC,EAAE,GAAGa,EAAEC,cAAY,wCAAwC,IAAIC,EAAE,eAAcC,UAAEV,MAAEW,OAAE3B,QAAMC,cAAcC,SAAS0B,WAAWxB,KAAKyB,cAAc,KAAKzB,KAAK0B,YAAY,KAAK1B,KAAK2B,cAAc,IAAIC,IAAI5B,KAAK6B,MAAM,yBAAyB,GAAG7B,KAAK6B,MAAMC,YAAYC,gBAAgB,OAAO/B,KAAK6B,MAAMC,YAAYE,cAAc,MAAMC,EAAEjC,KAAKkC,oCAAoClC,KAAK6B,MAAMC,aAAa,OAAOG,GAAGjC,KAAK6B,MAAMC,YAAYC,gBAAgBE,EAAEE,GAAGF,GAAG,KAAKG,OAAOH,GAAGjC,KAAK0B,YAAYW,QAAQrC,KAAK0B,YAAYxB,MAAM+B,EAAE/B,MAAMF,KAAKyB,cAAcW,OAAOH,GAAGjC,KAAK0B,YAAYY,SAAStC,KAAKuC,aAAa,YAAYC,SAAS,IAAIxC,KAAKgC,cAAc,OAAO,MAAMS,SAASR,GAAGjC,KAAKgC,cAAchC,KAAK0C,cAAc,IAAIhC,IAAEuB,GAAGjC,KAAK0B,YAAY,IAAIlB,IAAE,CAACmC,aAAa3C,KAAK0C,cAAcE,YAAY,GAAGC,QAAQ,CAACZ,EAAEb,IAAIpB,KAAK8C,UAAUb,EAAEb,KAAKpB,KAAKyB,cAAc,IAAIsB,IAAE,CAACC,YAAY,OAAOC,YAAW,EAAGC,YAAYjB,GAAGjC,KAAKkD,YAAYjB,GAAGkB,YAAYlB,GAAGjC,KAAKmD,YAAYlB,GAAGU,aAAa3C,KAAK0C,gBAAgB1C,KAAKoD,QAAQC,IAAIrD,KAAKsD,MAAM,CAAC,4BAA4B,iBAAkB,IAAItD,KAAKuD,YAAavD,KAAKwD,eAAe1D,MAAM0C,SAASiB,SAAS,IAAIxB,EAAEb,EAAEtB,MAAM2D,SAASzD,KAAKoD,QAAQM,OAAO1D,KAAKwD,eAAe,OAAOvB,EAAEjC,KAAKyB,gBAAgBQ,EAAEhB,UAAU,OAAOG,EAAEpB,KAAK0B,cAAcN,EAAEH,UAAUjB,KAAK0B,YAAY1B,KAAKyB,cAAczB,KAAK0C,cAAc,KAAKiB,YAAY3D,KAAK4D,gBAAgBC,aAAa7D,KAAK4D,gBAAgBE,UAAU9D,KAAK4D,gBAAgBT,YAAYlB,GAAGjC,KAAK0B,YAAYqC,MAAM9B,EAAE+B,IAAI7B,IAAInC,KAAKiE,YAAYC,YAAYjC,GAAGA,EAAEkC,KAAK,SAAU,IAAIlC,EAAEhB,WAAYjB,KAAK4D,gBAAgBV,YAAYjB,GAAG,MAAMb,EAAEpB,KAAKiE,YAAYG,WAAWnC,GAAGoC,EAAEjD,EAAEkD,OAAO,OAAOD,EAAEE,EAAEF,EAAE/D,GAAGN,KAAK0C,cAAc8B,cAAclE,EAAEc,EAAE4C,KAAKK,EAAEI,WAAWzE,KAAK0C,cAAcgC,kBAAkBtD,EAAE4C,MAAMK,EAAEM,MAAMN,EAAEO,QAAQ5E,KAAK0C,cAAcD,SAASoC,KAAK7E,KAAK8E,kBAAkB1D,GAAGpB,KAAKiE,YAAYc,SAAS3D,GAAGpB,KAAK4D,gBAAgBxC,EAAQ4D,YAAW,qCAAC/C,EAAKgD,iBAAiBhD,EAAKiD,WAAWjD,EAAKsB,YAA5C,GAAuD4B,aAAa,OAAOnF,KAAK0B,YAAY0D,OAAO,EAAQtC,UAAUb,EAAEb,EAAE,IAAG,qCAAC,MAAMiE,EAAE,iBAAiBhB,EAAKxC,MAAMwC,EAAKxC,MAAMyD,aAAa,MAAMC,OAAOpF,EAAEqF,gBAAgB5E,EAAE,GAAGQ,EAAE,IAAIiE,EAAE,OAAOhB,EAAKoB,YAAYxD,EAAE9B,GAAG,MAAMoB,EAAE,IAAImE,IAAE,EAAE,EAAE,EAAE,GAAG,IAAIhF,EAAE,UAAU2E,EAAEM,0BAA0B1D,EAAE2D,MAAM3D,EAAE4D,IAAI5D,EAAE6D,IAAIvE,EAAE,CAACgE,OAAOpF,IAAIO,QAAQ2D,EAAKoB,YAAYlE,EAAEpB,SAASK,GAAG,MAAG6D,MAAE7D,GAAG,MAAMA,EAAE,GAAGI,EAAE,EAAE,CAAC,MAAMyD,EAAEA,EAAK3B,cAAcqD,gBAAgB9D,EAAEE,IAAI,GAAGkC,EAAE,CAAC,MAAMgB,EAAE,IAAIK,IAAErB,GAAGlE,QAAQkE,EAAKvB,UAAUuC,EAAEW,OAAI5E,GAAJ,CAAMoE,gBAAgB5E,EAAE,KAAI,OAAOqF,OAAE5B,EAAK3B,cAAcvC,EAAEkF,EAAEpD,IAAI,MAAMzB,EAAE,OAAOyF,OAAE5B,EAAK3B,cAAchC,EAAEa,EAAEU,IAAnf,GAAsfiE,YAAsC,OAAlBpG,MAAMoG,aAAqB,YAAYlE,cAAsB8C,kBAAkB7C,GAAE,qCAAC,IAAIoD,EAAK3D,YAAYyE,IAAIlE,EAAE+B,IAAI7B,IAAI,CAAC,IAAI,MAAMf,QAAQiE,EAAK3D,YAAY0E,KAAKnE,EAAE+B,KAAK/B,EAAEqC,OAAO+B,OAAOjF,EAAEa,EAAEqC,OAAOK,MAAMU,EAAK3C,cAAcD,SAASoC,KAAK,GAAG5C,EAAEqC,OAAOM,OAAOS,EAAK3C,cAAcD,SAASoC,KAAK,GAAG5C,EAAEkC,KAAK,SAAU,IAAIkB,EAAKzB,uBAAwBxC,IAAGiD,QAAEjD,IAAID,EAAEmF,MAAMlF,GAAGiE,EAAKzB,kBAAxR,GAA+S6B,YAAYxD,EAAEb,GAAE,qCAAC,OAAOiD,EAAKxC,MAAMiB,UAAUb,EAAE2D,MAAM3D,EAAE4D,IAAI5D,EAAE6D,IAAI,CAACP,OAAOnE,KAAzD,GAA6DmC,WAAWvD,KAAK0B,YAAY6E,QAAQvG,KAAKyB,cAAc+E,MAAMC,QAASxE,IAAI,IAAIA,EAAEqC,OAAO+B,OAAO,OAAO,MAAMjF,EAAE,CAACe,GAAGF,EAAE+B,IAAI7B,GAAGuE,WAAU,EAAGC,QAAQ3G,KAAK0B,YAAY0E,KAAKnE,EAAE+B,KAAK4C,KAAMxF,IAAIa,EAAEqC,OAAO+B,OAAOjF,IAAKyF,MAAOzF,KAAIiD,QAAEjD,KAAKa,EAAEqC,OAAO+B,OAAO,QAASS,QAAS,KAAK7E,EAAE8E,gBAAgB/G,KAAKuC,aAAa,YAAYnB,EAAEsF,WAAU,KAAO1G,KAAK2B,cAAcqF,IAAI/E,EAAEb,KAAMpB,KAAKuC,aAAa,YAAYL,oCAAoCD,GAAG,MAAMb,EAAEpB,KAAKiH,KAAKC,iBAAiB,IAAIjF,EAAEkF,eAAe,OAAO,KAAK,IAAI9C,EAAEpC,EAAEkF,eAAeC,KAAMnF,GAAGA,EAAEQ,SAASyE,iBAAiBG,OAAOjG,EAAEiG,MAAO,OAAOhD,GAAGjD,EAAEkG,gBAAgBjD,EAAEpC,EAAEkF,eAAeC,KAAMnF,GAAGjB,EAAEuG,QAAQtF,EAAEQ,SAASyE,iBAAiBG,OAAM,IAAMhD,OAAIpC,KAAE,EAACoD,WAAKhE,EAAEmG,UAAU,iBAAY,MAAQvF,KAAE,IAACoD,MAAE,CAACoC,UAAS,KAAMpG,EAAEmG,UAAU,gBAAgB,MAAMnG,KAAEY,KAAE,EAAC9B,OAAE,yCAAyCkB,GAAG,MAAMqG,EAAErG,sICA5sI,YAAY,sBAAsBsG,aAAa3H,kBAAiB,QAACA,2BAA6BA,2CAAyCJ,MAACgI,IAAKpH,cAAWR,iCAAiC,0BAA6B,SAAOU,KAAC,EAAE,WAACqC,iCAAkCrC,KAAC,EAAE,OAAC","names":["f","constructor","super","renderChildren","this","createRenderParams","state","r","prepareRenderPasses","name","y","drawPhase","c","target","o","E","a","getStencilTarget","updateTransforms","setStencilReference","d","destroy","setTransform","m","t","w","p","l","arguments","_tileStrategy","_fetchQueue","_tileRequests","Map","layer","activeLayer","tileMatrixSetId","tileMatrixSet","e","_getTileMatrixSetBySpatialReference","id","update","pause","resume","notifyChange","attach","tileInfo","_tileInfoView","tileInfoView","concurrency","process","fetchTile","u","cachePolicy","resampling","acquireTile","releaseTile","handles","add","watch","_refresh","declaredClass","detach","remove","moveStart","requestUpdate","viewChange","moveEnd","abort","key","_bitmapView","removeChild","once","createTile","i","bitmap","x","getTileCoords","resolution","getTileResolution","width","height","size","_enqueueTileFetch","addChild","doRefresh","updateRequested","suspended","isUpdating","length","s","tilemapCache","signal","resamplingLevel","_fetchImage","n","fetchAvailabilityUpsample","level","row","col","getTileParentId","j","h","canResume","has","push","source","error","reset","tiles","forEach","fulfilled","promise","then","catch","finally","requestRender","set","view","spatialReference","tileMatrixSets","find","wkid","isWebMercator","indexOf","prototype","readOnly","_","initialize","I"],"sources":["./node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js","./node_modules/@arcgis/core/views/2d/engine/webgl/TiledDisplayObject.js","./node_modules/@arcgis/core/views/2d/layers/WMTSLayerView2D.js","./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/has.js\";import{WGLDrawPhase as r}from\"./enums.js\";import s from\"./WGLContainer.js\";import t from\"./brushes/WGLBrushInfo.js\";import n from\"./brushes/WGLBrushStencil.js\";const i=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;class o extends s{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(i),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:r}=e,s=super.createRenderParams(e);return s.requiredLevel=this._tileInfoView.getClosestInfoForScale(r.scale).level,s.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(r.scale),s}prepareRenderPasses(s){const i=super.prepareRenderPasses(s);return i.push(s.registerRenderPass({name:\"stencil\",brushes:[n],drawPhase:r.DEBUG|r.MAP|r.HIGHLIGHT,target:()=>this.getStencilTarget()})),e(\"esri-tiles-debug\")&&i.push(s.registerRenderPass({name:\"tileInfo\",brushes:[t],drawPhase:r.DEBUG,target:()=>this.children})),i}getStencilTarget(){return this.children}updateTransforms(e){for(const r of this.children){const s=this._tileInfoView.getTileResolution(r.key);r.setTransform(e,s)}}setStencilReference(){let e=1;for(const r of this.children)r.stencilRef=e++}}export{o as default,i as sortByLevel};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{s as t,m as s}from\"../../../../chunks/mat3.js\";import{DisplayObject as i}from\"../DisplayObject.js\";import e from\"../../tiling/TileKey.js\";class r extends i{constructor(t,s,i,r,h,o=r,n=h){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new e(t),this.x=s,this.y=i,this.width=r,this.height=h,this.rangeX=o,this.rangeY=n}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(i,e){const r=e/(i.resolution*i.pixelRatio),h=this.transforms.tileMat3,[o,n]=i.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*r,l=this.height/this.rangeY*r;t(h,a,0,0,0,l,0,o,n,1),s(this.transforms.dvs,i.displayViewMat3,h)}}export{r as TiledDisplayObject};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Logger.js\";import{isAbortError as i}from\"../../../core/promiseUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import{BitmapTileLayerView2D as a}from\"./BitmapTileLayerView2D.js\";import{LayerView2DMixin as l}from\"./LayerView2D.js\";import{resampleImage as h}from\"./support/imageUtils.js\";import o from\"../tiling/TileInfoView.js\";import n from\"../tiling/TileKey.js\";import c from\"../tiling/TileQueue.js\";import u from\"../tiling/TileStrategy.js\";import f from\"../../layers/LayerView.js\";import{RefreshableLayerView as p}from\"../../layers/RefreshableLayerView.js\";const d=[102113,102100,3857,3785,900913],y=[0,0],m=t.getLogger(\"esri.views.2d.layers.WMTSLayerView2D\");let w=class extends(p(a(l(f)))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this._tileRequests=new Map,this.layer=null}get tileMatrixSet(){if(this.layer.activeLayer.tileMatrixSetId)return this.layer.activeLayer.tileMatrixSet;const e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(this.layer.activeLayer.tileMatrixSetId=e.id,e):null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange(\"updating\")}attach(){if(!this.tileMatrixSet)return;const{tileInfo:e}=this.tileMatrixSet;this._tileInfoView=new o(e),this._fetchQueue=new c({tileInfoView:this._tileInfoView,concurrency:16,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new u({cachePolicy:\"keep\",resampling:!0,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this.handles.add(this.watch([\"layer.activeLayer.styleId\",\"tileMatrixSet\"],(()=>this._refresh())),this.declaredClass),super.attach()}detach(){var e,t;super.detach(),this.handles.remove(this.declaredClass),null==(e=this._tileStrategy)||e.destroy(),null==(t=this._fetchQueue)||t.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(y,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(t),this._bitmapView.addChild(t),this.requestUpdate(),t}async doRefresh(){this.updateRequested||this.suspended||this._refresh()}isUpdating(){return this._fetchQueue.length>0}async fetchTile(e,t={}){const s=\"tilemapCache\"in this.layer?this.layer.tilemapCache:null,{signal:r,resamplingLevel:a=0}=t;if(!s)return this._fetchImage(e,r);const l=new n(0,0,0,0);let o;try{await s.fetchAvailabilityUpsample(e.level,e.row,e.col,l,{signal:r}),o=await this._fetchImage(l,r)}catch(c){if(i(c))throw c;if(a<3){const i=this._tileInfoView.getTileParentId(e.id);if(i){const s=new n(i),r=await this.fetchTile(s,{...t,resamplingLevel:a+1});return h(this._tileInfoView,r,s,e)}}throw c}return h(this._tileInfoView,o,l,e)}canResume(){const e=super.canResume();return e?null!==this.tileMatrixSet:e}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);e.bitmap.source=t,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once(\"attach\",(()=>this.requestUpdate()))}catch(t){i(t)||m.error(t)}this.requestUpdate()}}async _fetchImage(e,t){return this.layer.fetchTile(e.level,e.row,e.col,{signal:t})}_refresh(){this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>{if(!e.bitmap.source)return;const t={id:e.key.id,fulfilled:!1,promise:this._fetchQueue.push(e.key).then((t=>{e.bitmap.source=t})).catch((t=>{i(t)||(e.bitmap.source=null)})).finally((()=>{e.requestRender(),this.notifyChange(\"updating\"),t.fulfilled=!0}))};this._tileRequests.set(e,t)})),this.notifyChange(\"updating\")}_getTileMatrixSetBySpatialReference(e){const t=this.view.spatialReference;if(!e.tileMatrixSets)return null;let i=e.tileMatrixSets.find((e=>e.tileInfo.spatialReference.wkid===t.wkid));return!i&&t.isWebMercator&&(i=e.tileMatrixSets.find((e=>d.indexOf(e.tileInfo.spatialReference.wkid)>-1))),i}};e([s()],w.prototype,\"suspended\",void 0),e([s({readOnly:!0})],w.prototype,\"tileMatrixSet\",null),w=e([r(\"esri.views.2d.layers.WMTSLayerView2D\")],w);const _=w;export{_ as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/watchUtils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let c=class extends i{initialize(){this.handles.add(o(this,\"layer\",\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this.declaredClass).error(r)}))})),\"RefreshableLayerView\")}};return r([t()],c.prototype,\"layer\",void 0),c=r([a(\"esri.layers.mixins.RefreshableLayerView\")],c),c};export{i as RefreshableLayerView,i as default};\n"],"sourceRoot":"webpack:///","file":"1919.6fb572a0791ecf235f01.js"}