{"version":3,"mappings":"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","names":["O","hasAttachments","capabilities","useStandardizedQueries","supportsCoordinatesQuantization","supportsReturningQueryGeometry","advancedQueryCapabilities","supportsQueryAttachments","supportsStatistics","supportsPercentileStatistics","supportsReturningGeometryCentroid","supportsQueryWithDistance","supportsDistinct","supportsReturningQueryExtent","supportsReturningGeometryProperties","supportsHavingClause","supportsOrderBy","supportsPagination","supportsQueryWithResultType","supportsSqlExpression","supportsDisjointSpatialRel","constructor","this","_queryEngine","_snapshotFeatures","e","t","i","_fetch","_createFeatures","destroy","_fieldsIndex","_createDefaultAttributes","load","s","r","loadOptions","url","customParameters","_checkProjection","spatialReference","signal","n","_","geometryType","a","fields","l","hasZ","u","d","objectIdField","objectIdFieldName","p","o","c","timeInfo","unknownFields","length","push","name","message","details","y","find","type","editable","nullable","alias","objectIdFieldType","unshift","m","field","k","D","R","f","requiredFields","indexOf","splice","startTimeField","get","endTimeField","trackIdField","I","F","j","warnings","featureErrors","layerDefinition","ne","drawingInfo","templates","E","extent","g","hasM","featureStore","h","cacheSpatialQueries","b","T","_objectIdGenerator","_createObjectIdGenerator","w","_normalizeFeatures","addMany","fullExtent","start","end","timeExtent","applyEdits","Promise","all","adds","updates","_waitSnapshotComplete","_applyEdits","queryFeatures","executeQuery","queryFeatureCount","executeQueryForCount","queryObjectIds","executeQueryForIds","queryExtent","executeQueryForExtent","querySnapping","executeQueryForSnapping","refresh","_snapshotTask","abort","promise","then","clear","error","geometry","finished","responseType","query","V","data","attributes","_assignObjectId","objectId","deletes","addResults","deleteResults","updateResults","uidToObjectId","_applyAddEdits","_applyUpdateEdits","q","removeManyById","featureEditResults","x","uid","S","has","getFeature","add","fieldsIndex","Date","now","toString","Number","NEGATIVE_INFINITY","Math","max","LineString","N","z","J","H","$","Q","crs","G","U","P","B"],"sources":["./node_modules/@arcgis/core/layers/graphics/sources/geojson/GeoJSONSourceWorker.js","./node_modules/@arcgis/core/layers/graphics/sources/geojson/geojson.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport e from\"../../../../request.js\";import t from\"../../../../core/Error.js\";import s from\"../../../../core/Logger.js\";import{isSome as i}from\"../../../../core/maybe.js\";import{createTask as r,isAbortError as n}from\"../../../../core/promiseUtils.js\";import{getJsonType as a}from\"../../../../geometry/support/jsonUtils.js\";import{WGS84 as o,equals as l}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as u,convertToGeometry as d,convertFromFeatures as p,convertToFeature as c,convertFromFeature as y}from\"../../featureConversionUtils.js\";import h from\"../../data/FeatureStore.js\";import{checkProjectionSupport as m,project as f}from\"../../data/projectionSupport.js\";import g from\"../../data/QueryEngine.js\";import{inferLayerProperties as _,createOptimizedFeatures as I,validateGeoJSON as j}from\"./geojson.js\";import{createDrawingInfo as F,createDefaultTemplate as E,createDefaultAttributesFunction as b}from\"../support/clientSideDefaults.js\";import{loadGeometryEngineForSimplify as T,mixAttributes as w,createFeatureEditSuccessResult as q,createFeatureEditErrorResult as x,simplify as S}from\"../support/sourceUtils.js\";import R from\"../../../support/FieldsIndex.js\";import{kebabDict as k}from\"../../../support/fieldType.js\";import{getFieldDefaultValue as D}from\"../../../support/fieldUtils.js\";const O={hasAttachments:!1,capabilities:\"query, editing, create, delete, update\",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsPercentileStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};class C{constructor(){this._queryEngine=null,this._snapshotFeatures=async e=>{const t=await this._fetch(e);return this._createFeatures(t)}}destroy(){var e;null==(e=this._queryEngine)||e.destroy(),this._queryEngine=this._fieldsIndex=this._createDefaultAttributes=null}async load(e,s={}){this.loadOptions={url:e.url,customParameters:e.customParameters};const i=[];await this._checkProjection(e.spatialReference);let r=null;e.url&&(r=await this._fetch(null==s?void 0:s.signal));const n=_(r,{geometryType:e.geometryType}),a=e.fields||n.fields||[],l=null!=e.hasZ?e.hasZ:n.hasZ,u=n.geometryType,d=e.objectIdField||n.objectIdFieldName||\"__OBJECTID\",p=e.spatialReference||o;let c=e.timeInfo;a===n.fields&&n.unknownFields.length>0&&i.push({name:\"geojson-layer:unknown-field-types\",message:\"Some fields types couldn't be inferred from the features and were dropped\",details:{unknownFields:n.unknownFields}});let y=a.find((e=>e.name===d));y?(\"esriFieldTypeString\"!==y.type&&(y.type=\"esriFieldTypeOID\"),y.editable=!1,y.nullable=!1):(y={alias:d,name:d,type:\"string\"===n.objectIdFieldType?\"esriFieldTypeString\":\"esriFieldTypeOID\",editable:!1,nullable:!1},a.unshift(y));const m={};for(const o of a){if(null==o.name&&(o.name=o.alias),null==o.alias&&(o.alias=o.name),!o.name)throw new t(\"geojson-layer:invalid-field-name\",\"field name is missing\",{field:o});if(!k.jsonValues.includes(o.type))throw new t(\"geojson-layer:invalid-field-type\",`invalid type for field \"${o.name}\"`,{field:o});if(o.name!==y.name){const e=D(o);void 0!==e&&(m[o.name]=e)}}this._fieldsIndex=new R(a);const f=this._fieldsIndex.requiredFields.indexOf(y);if(f>-1&&this._fieldsIndex.requiredFields.splice(f,1),c){if(c.startTimeField){const e=this._fieldsIndex.get(c.startTimeField);e?(c.startTimeField=e.name,e.type=\"esriFieldTypeDate\"):c.startTimeField=null}if(c.endTimeField){const e=this._fieldsIndex.get(c.endTimeField);e?(c.endTimeField=e.name,e.type=\"esriFieldTypeDate\"):c.endTimeField=null}if(c.trackIdField){const e=this._fieldsIndex.get(c.trackIdField);e?c.trackIdField=e.name:(c.trackIdField=null,i.push({name:\"geojson-layer:invalid-timeInfo-trackIdField\",message:\"trackIdField is missing\",details:{timeInfo:c}}))}c.startTimeField||c.endTimeField||(i.push({name:\"geojson-layer:invalid-timeInfo\",message:\"startTimeField and endTimeField are missing\",details:{timeInfo:c}}),c=null)}const I=u?F(u):null,j={warnings:i,featureErrors:[],layerDefinition:{...O,drawingInfo:I,templates:E(m),extent:null,geometryType:u,objectIdField:d,fields:a,hasZ:!!l,timeInfo:c}};this._queryEngine=new g({fields:a,geometryType:u,hasM:!1,hasZ:l,objectIdField:d,spatialReference:p,timeInfo:c,featureStore:new h({geometryType:u,hasM:!1,hasZ:l}),cacheSpatialQueries:!0}),this._createDefaultAttributes=b(m,d);const T=await this._createFeatures(r);this._objectIdGenerator=this._createObjectIdGenerator(this._queryEngine,T);const w=this._normalizeFeatures(T,j.warnings,j.featureErrors);if(this._queryEngine.featureStore.addMany(w),j.layerDefinition.extent=this._queryEngine.fullExtent,j.layerDefinition.timeInfo){const{start:e,end:t}=this._queryEngine.timeExtent;j.layerDefinition.timeInfo.timeExtent=[e,t]}return j}async applyEdits(e){const{spatialReference:t,geometryType:s}=this._queryEngine;return await Promise.all([T(t,s),m(e.adds,t),m(e.updates,t)]),await this._waitSnapshotComplete(),this._applyEdits(e)}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(e){var i;return this.loadOptions.customParameters=e,null==(i=this._snapshotTask)||i.abort(),this._snapshotTask=r(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),this._objectIdGenerator=this._createObjectIdGenerator(this._queryEngine,e);const t=this._normalizeFeatures(e);t&&this._queryEngine.featureStore.addMany(t)}),(e=>{this._queryEngine.featureStore.clear(),n(e)||s.getLogger(\"esri.layers.GeoJSONLayer\").error(new t(\"geojson-layer:refresh\",\"An error occurred during refresh\",{error:e}))})),await this._waitSnapshotComplete(),{extent:this._queryEngine.fullExtent,timeExtent:this._queryEngine.timeExtent}}async _createFeatures(e){const{geometryType:t,hasZ:s,objectIdField:r}=this._queryEngine,n=I(e,{geometryType:t,hasZ:s,objectIdField:r});if(!l(this._queryEngine.spatialReference,o))for(const a of n)i(a.geometry)&&(a.geometry=u(f(d(a.geometry,this._queryEngine.geometryType,this._queryEngine.hasZ,!1),o,this._queryEngine.spatialReference)));return n}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _fetch(t){const{url:s,customParameters:i}=this.loadOptions,r=(await e(s,{responseType:\"json\",query:{...i},signal:t})).data;return await j(r),r}_normalizeFeatures(e,t,s){const{objectIdField:i}=this._queryEngine,r=[];for(const n of e){const e=this._createDefaultAttributes(),a=w(this._fieldsIndex,e,n.attributes,!0,t);a?null==s||s.push(a):(this._assignObjectId(e,n.attributes,!0),n.attributes=e,n.objectId=e[i],r.push(n))}return r}_applyEdits(e){const{adds:t,updates:s,deletes:i}=e,r={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(t&&t.length&&this._applyAddEdits(r,t),s&&s.length&&this._applyUpdateEdits(r,s),i&&i.length){for(const e of i)r.deleteResults.push(q(e));this._queryEngine.featureStore.removeManyById(i)}return{extent:this._queryEngine.fullExtent,timeExtent:this._queryEngine.timeExtent,featureEditResults:r}}_applyAddEdits(e,t){const{addResults:s}=e,{geometryType:r,hasM:n,hasZ:o,objectIdField:l,spatialReference:u,featureStore:d}=this._queryEngine,c=[];for(const p of t){if(p.geometry&&r!==a(p.geometry)){s.push(x(\"Incorrect geometry type.\"));continue}const t=this._createDefaultAttributes(),n=w(this._fieldsIndex,t,p.attributes);if(n)s.push(n);else{if(this._assignObjectId(t,p.attributes),p.attributes=t,null!=p.uid){const t=p.attributes[l];e.uidToObjectId[p.uid]=t}i(p.geometry)&&(p.geometry=f(S(p.geometry,u),p.geometry.spatialReference,u)),c.push(p),s.push(q(p.attributes[l]))}}d.addMany(p([],c,r,o,n,l))}_applyUpdateEdits({updateResults:e},t){const{geometryType:s,hasM:r,hasZ:n,objectIdField:o,spatialReference:l,featureStore:u}=this._queryEngine;for(const d of t){const{attributes:t,geometry:p}=d,h=t&&t[o];if(null==h){e.push(x(`Identifier field ${o} missing`));continue}if(!u.has(h)){e.push(x(`Feature with object id ${h} missing`));continue}const m=c(u.getFeature(h),s,n,r);if(i(p)){if(s!==a(p)){e.push(x(\"Incorrect geometry type.\"));continue}m.geometry=f(S(p,l),p.spatialReference,l)}if(t){const s=w(this._fieldsIndex,m.attributes,t);if(s){e.push(s);continue}}u.add(y(m,s,n,r,o)),e.push(q(h))}}_createObjectIdGenerator(e,t){const s=e.fieldsIndex.get(e.objectIdField);if(\"esriFieldTypeString\"===s.type)return()=>s.name+\"-\"+Date.now().toString(16);let i=Number.NEGATIVE_INFINITY;for(const r of t)r.objectId&&(i=Math.max(i,r.objectId));return i=Math.max(0,i)+1,()=>i++}_assignObjectId(e,t,s=!1){const i=this._queryEngine.objectIdField;e[i]=s&&i in t?t[i]:this._objectIdGenerator()}async _checkProjection(e){try{await m(o,e)}catch{throw new t(\"geojson-layer\",\"Projection not supported\")}}}export{C as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Error.js\";import t from\"../../OptimizedFeature.js\";import n from\"../../OptimizedGeometry.js\";import{isNumericField as o}from\"../../../support/fieldUtils.js\";const r={LineString:\"esriGeometryPolyline\",MultiLineString:\"esriGeometryPolyline\",MultiPoint:\"esriGeometryMultipoint\",Point:\"esriGeometryPoint\",Polygon:\"esriGeometryPolygon\",MultiPolygon:\"esriGeometryPolygon\"};function i(e){return r[e]}function*s(e){switch(e.type){case\"Feature\":yield e;break;case\"FeatureCollection\":for(const t of e.features)t&&(yield t)}}function*c(e){if(!e)return null;switch(e.type){case\"Point\":yield e.coordinates;break;case\"LineString\":case\"MultiPoint\":yield*e.coordinates;break;case\"MultiLineString\":case\"Polygon\":for(const t of e.coordinates)yield*t;break;case\"MultiPolygon\":for(const t of e.coordinates)for(const e of t)yield*e}}function*u(e,o={}){const{geometryType:r,objectIdField:s}=o;for(const u of e){var c;const{geometry:e,properties:l,id:f}=u;if(e&&i(e.type)!==r)continue;const a=l||{};let y=null!=(c=a[s])?c:null;s&&null!=f&&!a[s]&&(a[s]=y=f);const p=new t(e?d(new n,e,o):null,a,null,y);yield p}}function l(e){for(const t of e)if(t.length>2)return!0;return!1}function f(e){return!y(e)}function a(e){return y(e)}function y(e){let t=0;for(let n=0;n<e.length;n++){const o=e[n],r=e[(n+1)%e.length];t+=o[0]*r[1]-r[0]*o[1]}return t<=0}function p(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function d(e,t,n){switch(t.type){case\"LineString\":return g(e,t,n);case\"MultiLineString\":return m(e,t,n);case\"MultiPoint\":return h(e,t,n);case\"MultiPolygon\":return w(e,t,n);case\"Point\":return P(e,t,n);case\"Polygon\":return b(e,t,n)}}function g(e,t,n){return F(e,t.coordinates,n),e}function m(e,t,n){for(const o of t.coordinates)F(e,o,n);return e}function h(e,t,n){return F(e,t.coordinates,n),e}function w(e,t,n){for(const o of t.coordinates){j(e,o[0],n);for(let t=1;t<o.length;t++)S(e,o[t],n)}return e}function P(e,t,n){return M(e,t.coordinates,n),e}function b(e,t,n){const o=t.coordinates;j(e,o[0],n);for(let r=1;r<o.length;r++)S(e,o[r],n);return e}function j(e,t,n){const o=p(t);f(o)?G(e,o,n):F(e,o,n)}function S(e,t,n){const o=p(t);a(o)?G(e,o,n):F(e,o,n)}function F(e,t,n){for(const o of t)M(e,o,n);e.lengths.push(t.length)}function G(e,t,n){for(let o=t.length-1;o>=0;o--)M(e,t[o],n);e.lengths.push(t.length)}function M(e,t,n){const[o,r,i]=t;e.coords.push(o,r),n.hasZ&&e.coords.push(i||0)}function k(e){switch(typeof e){case\"string\":return\"esriFieldTypeString\";case\"number\":return\"esriFieldTypeDouble\";default:return\"unknown\"}}function O(t){if(!t)throw new e(\"geojson-layer:empty\",\"GeoJSON data is empty\");if(\"Feature\"!==t.type&&\"FeatureCollection\"!==t.type)throw new e(\"geojson-layer:unsupported-geojson-object\",\"missing or not supported GeoJSON object type\",{data:t});const{crs:n}=t;if(!n)return;const o=\"string\"==typeof n?n:\"name\"===n.type?n.properties.name:\"EPSG\"===n.type?n.properties.code:null,r=new RegExp(\".*(CRS84H?|4326)$\",\"i\");if(!o||!r.test(o))throw new e(\"geojson-layer:unsupported-crs\",\"unsupported GeoJSON 'crs' member\",{crs:n})}function T(e,t={}){const n=[],r=new Set,u=new Set;let f,a=!1,y=null,p=!1,{geometryType:d=null}=t,g=!1;for(const o of s(e)){const{geometry:e,properties:t,id:s}=o;if(!e||(d||(d=i(e.type)),i(e.type)===d)){if(!a){a=l(c(e))}if(p||(p=null!=s,p&&(f=typeof s,y=Object.keys(t).filter((e=>t[e]===s)))),p&&null!=s&&(y.length>1?y=y.filter((e=>t[e]===s)):1===y.length&&(y=t[y[0]]===s?y:[])),!g&&t){let e=!0;for(const o in t){if(r.has(o))continue;const i=t[o];if(null==i){e=!1,u.add(o);continue}const s=k(i);\"unknown\"!==s?(u.delete(o),r.add(o),n.push({name:o,alias:o,type:s})):u.add(o)}g=e}}}const m=y&&1===y.length&&y[0]||null;if(m)for(const i of n)if(i.name===m&&o(i)){i.type=\"esriFieldTypeOID\";break}return{fields:n,geometryType:d,hasZ:a,objectIdFieldName:m,objectIdFieldType:f,unknownFields:Array.from(u)}}function L(e,t){return Array.from(u(s(e),t))}export{L as createOptimizedFeatures,i as getGeometryType,T as inferLayerProperties,O as validateGeoJSON};\n"],"sourceRoot":"webpack:///","file":"3566.ec54c287f0655bf0b6a4.js"}