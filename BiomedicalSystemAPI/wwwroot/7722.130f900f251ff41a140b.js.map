{"version":3,"mappings":"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","names":["t","o","e","d","i","r","n","j","b","S","q","constructor","this","x","y","_queryEngine","_snapshotFeatures","_fetch","_createFeatures","destroy","load","loadOptions","Promise","all","signal","_checkProjection","parsingOptions","spatialReference","delimiter","layerDefinition","locationInfo","latitudeFieldName","latitudeField","longitudeFieldName","longitudeField","s","_","next","value","csv","trim","N","l","split","filter","u","name","a","url","drawingInfo","geometryType","objectIdField","fields","timeInfo","extent","xmin","Number","POSITIVE_INFINITY","ymin","xmax","NEGATIVE_INFINITY","ymax","wkid","P","V","length","Map","set","toLowerCase","get","Object","assign","some","type","alias","editable","nullable","unshift","T","startTimeField","endTimeField","trackIdField","D","_createQueryEngine","featureStore","addMany","fullExtent","start","end","timeExtent","applyEdits","queryFeatures","_waitSnapshotComplete","executeQuery","queryFeatureCount","executeQueryForCount","queryObjectIds","executeQueryForIds","queryExtent","executeQueryForExtent","querySnapping","executeQueryForSnapping","refresh","customParameters","_snapshotTask","abort","promise","then","clear","error","finished","path","query","responseType","data","h","hasM","hasZ","F","cacheSpatialQueries","fieldsIndex","m","map","g","I","w","_parseCoordinateValue","isNaN","isDateField","Date","L","getTime","isNumericField","M","push","v","c","f","E","p","Math","abs","parseFloat","O","k","indexOf","find","includes","R","test","isInteger","replace","reduce","G","Q","prototype","toString","call","match","RegExp","regexp","group","factor","exec","NaN","decimal"],"sources":["./node_modules/@arcgis/core/layers/graphics/sources/csv/csv.js","./node_modules/@arcgis/core/layers/graphics/sources/support/CSVSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nconst n=/^\\s*\"([\\S\\s]*)\"\\s*$/,t=/\"\"/g,e=\"\\n\",o=[\",\",\" \",\";\",\"|\",\"\\t\"];function*c(n,t,e){let o=0;for(;o<=n.length;){const c=n.indexOf(t,o),i=n.substring(o,c>-1?c:void 0);o+=i.length+t.length,e&&!i.trim()||(yield i)}}function i(n){const t=n.includes(\"\\r\\n\")?\"\\r\\n\":e;return c(n,t,!0)}function r(n,t){return c(n,t,!1)}function f(n){const t=n.trim();let e=0,c=\"\";for(const i of o){const n=t.split(i).length;n>e&&(e=n,c=i)}return\"\"===c?null:c}function*l(o,c,i,f=(()=>Object.create(null))){let l=\"\",u=\"\",d=0,g=f(),x=0;n:for(const h of o){const o=r(h,i);for(const e of o)if(l+=u+e,u=\"\",d+=s(e),d%2==0){if(d>0){const e=n.exec(l);if(!e){g=f(),x=0,l=\"\",d=0;continue n}g[c[x]]=e[1].replace(t,'\"'),x++}else g[c[x]]=l,x++;l=\"\",d=0}else u=i;0===d?(yield g,g=f(),x=0):u=e}}function s(n){let t=0,e=0;for(e=n.indexOf('\"',e);e>=0;)t++,e=n.indexOf('\"',e+1);return t}export{f as inferDelimiter,l as parseRows,r as readRowParts,i as readRows};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport\"../../../../geometry.js\";import e from\"../../../../request.js\";import t from\"../../../../core/Error.js\";import i from\"../../../../core/Logger.js\";import{_parseInfo as n}from\"../../../../core/number.js\";import{createTask as r,isAbortError as s}from\"../../../../core/promiseUtils.js\";import{urlToObject as o,getFilename as a}from\"../../../../core/urlUtils.js\";import{projectMany as l}from\"../../../../geometry/projection.js\";import{jsonAdapter as u}from\"../../../../geometry/geometryAdapters/json.js\";import{equals as d,isWebMercator as c,WGS84 as m}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{lngLatToXY as f}from\"../../../../geometry/support/webMercatorUtils.js\";import p from\"../../OptimizedFeature.js\";import y from\"../../OptimizedGeometry.js\";import h from\"../../data/FeatureStore.js\";import{checkProjectionSupport as g}from\"../../data/projectionSupport.js\";import F from\"../../data/QueryEngine.js\";import{readRows as _,parseRows as I,inferDelimiter as N}from\"../csv/csv.js\";import{createDefaultAttributesFunction as w,createDrawingInfo as b}from\"./clientSideDefaults.js\";import T from\"../../../support/FieldsIndex.js\";import{getFieldDefaultValue as x}from\"../../../support/fieldUtils.js\";import E from\"../../../../geometry/SpatialReference.js\";const j=b(\"esriGeometryPoint\"),S=[\"csv\"],q=[0,0];class v{constructor(e,t){this.x=e,this.y=t}}class C{constructor(){this._queryEngine=null,this._snapshotFeatures=async e=>{const t=await this._fetch(e);return this._createFeatures(t)}}destroy(){var e;null==(e=this._queryEngine)||e.destroy(),this._queryEngine=null}async load(e,t={}){var i;this.loadOptions=e;const[n]=await Promise.all([this._fetch(t.signal),this._checkProjection(null==e||null==(i=e.parsingOptions)?void 0:i.spatialReference)]),r=D(n,e);this.locationInfo=r.locationInfo,this.delimiter=r.delimiter,this._queryEngine=this._createQueryEngine(r);const s=await this._createFeatures(n);if(this._queryEngine.featureStore.addMany(s),r.layerDefinition.extent=this._queryEngine.fullExtent,r.layerDefinition.timeInfo){const{start:e,end:t}=this._queryEngine.timeExtent;r.layerDefinition.timeInfo.timeExtent=[e,t]}return r}async applyEdits(){throw new t(\"csv-layer:editing-not-supported\",\"applyEdits() is not supported on CSVLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(e){var n;return this.loadOptions.customParameters=e,null==(n=this._snapshotTask)||n.abort(),this._snapshotTask=r(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(e=>{this._queryEngine.featureStore.clear(),s(e)||i.getLogger(\"esri.layers.CSVLayer\").error(new t(\"csv-layer:refresh\",\"An error occurred during refresh\",{error:e}))})),await this._waitSnapshotComplete(),{extent:this._queryEngine.fullExtent,timeExtent:this._queryEngine.timeExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _fetch(i){const{url:n,customParameters:r}=this.loadOptions;if(!n)throw new t(\"csv-layer:invalid-source\",\"url not defined\");const s=o(n);return(await e(s.path,{query:{...s.query,...r},responseType:\"text\",signal:i})).data}_createQueryEngine(e){const{objectIdField:t,fields:i,extent:n,timeInfo:r}=e.layerDefinition,s=new h({geometryType:\"esriGeometryPoint\",hasM:!1,hasZ:!1});return new F({fields:i,geometryType:\"esriGeometryPoint\",hasM:!1,hasZ:!1,timeInfo:r,objectIdField:t,spatialReference:n.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:s})}async _createFeatures(e){const{latitudeFieldName:t,longitudeFieldName:i}=this.locationInfo,{objectIdField:n,fieldsIndex:r,spatialReference:s}=this._queryEngine;let o=[];const a=[],m=r.fields.filter((e=>e.name!==n)).map((e=>e.name));let h=0;const g=_(e);g.next();const F={};for(const l of r.fields)if(\"esriFieldTypeOID\"!==l.type&&\"esriFieldTypeGlobalID\"!==l.type){const e=x(l);void 0!==e&&(F[l.name]=e)}const N=I(g,m,this.delimiter,w(F,n));for(const l of N){const e=this._parseCoordinateValue(l[t]),s=this._parseCoordinateValue(l[i]);if(null!=s&&null!=e&&!isNaN(e)&&!isNaN(s)){l[t]=e,l[i]=s;for(const e in l)if(e!==t&&e!==i)if(r.isDateField(e)){const t=new Date(l[e]);l[e]=L(t,l[e])?t.getTime():null}else if(r.isNumericField(e)){const t=M(l[e]);isNaN(t)?l[e]=null:l[e]=t}l[n]=h,h++,o.push(new v(s,e)),a.push(l)}}if(!d({wkid:4326},s))if(c(s))for(const l of o)[l.x,l.y]=f(l.x,l.y,q);else o=l(u,o,E.WGS84,s,null);const b=[];for(let l=0;l<o.length;l++){const{x:e,y:t}=o[l],i=a[l];i[n]=l+1,b.push(new p(new y([],[e,t]),i,null,i[n]))}return b}_parseCoordinateValue(e){if(null==e||\"\"===e)return null;let t=M(e);return(isNaN(t)||Math.abs(t)>181)&&(t=parseFloat(e)),t}async _checkProjection(e){try{await g(m,e)}catch{throw new t(\"csv-layer:projection-not-supported\",\"Projection not supported\")}}}function D(e,i){const n=i.parsingOptions||{},r={delimiter:n.delimiter,layerDefinition:null,locationInfo:{latitudeFieldName:n.latitudeField,longitudeFieldName:n.longitudeField}},s=_(e);let o=s.next().value;if(!o)throw new t(\"csv-layer:empty-csv\",\"CSV is empty\",{csv:e});if(o=o.trim(),!n.delimiter){const e=N(o);if(!e)throw new t(\"csv-layer:invalid-delimiter\",\"Unable to detect the delimiter from CSV\");r.delimiter=e}const l=o.split(r.delimiter).filter((e=>!!e)),u=r.layerDefinition={name:a(i.url,S)||\"csv\",drawingInfo:j,geometryType:\"esriGeometryPoint\",objectIdField:null,fields:[],timeInfo:n.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:n.spatialReference||{wkid:102100}}};if(!n.latitudeField||!n.longitudeField){const e=P(l);if(!n.longitudeField&&!e.longitudeFieldName||!n.latitudeField&&!e.latitudeFieldName)throw new t(\"csv-layer:location-fields-not-found\",\"Unable to identify latitude and longitude fields from the CSV file\");r.locationInfo={longitudeFieldName:n.longitudeField||e.longitudeFieldName,latitudeFieldName:n.latitudeField||e.latitudeFieldName}}const d=V(s,r.delimiter,l,r.locationInfo);if(n.fields&&n.fields.length){const e=new Map;for(const t of n.fields)e.set(t.name.toLowerCase(),t);for(const t of d){const i=e.get(t.name.toLowerCase());if(i){const e=t.name;Object.assign(t,i),t.name=e}}}u.fields=d;if(!u.fields.some((e=>\"esriFieldTypeOID\"===e.type&&(u.objectIdField=e.name,!0)))){const e={name:\"__OBJECTID\",alias:\"__OBJECTID\",type:\"esriFieldTypeOID\",editable:!1,nullable:!1};u.objectIdField=e.name,u.fields.unshift(e)}if(u.timeInfo){const e=new T(u.fields),t=u.timeInfo;if(t.startTimeField){const i=e.get(t.startTimeField);i?(t.startTimeField=i.name,i.type=\"esriFieldTypeDate\"):t.startTimeField=null}if(t.endTimeField){const i=e.get(t.endTimeField);i?(t.endTimeField=i.name,i.type=\"esriFieldTypeDate\"):t.endTimeField=null}if(t.trackIdField){const i=e.get(t.trackIdField);t.trackIdField=i?i.name:null}t.startTimeField||t.endTimeField||(u.timeInfo=null)}return r}const O=[\"lat\",\"latitude\",\"latitude83\",\"latdecdeg\",\"lat_dd\",\"y\",\"ycenter\",\"point-y\"],k=[\"lon\",\"lng\",\"long\",\"longitude\",\"longitude83\",\"longdecdeg\",\"long_dd\",\"x\",\"xcenter\",\"point-x\"];function P(e){const t=e.map((e=>e.toLowerCase()));return{longitudeFieldName:e[t.indexOf(k.find((e=>t.includes(e))))],latitudeFieldName:e[t.indexOf(O.find((e=>t.includes(e))))]}}function V(e,t,i,n){const r=[],s=I(e,i,t),o=[];for(const a of s){if(10===o.length)break;o.push(a)}for(const a of i)if(a===n.longitudeFieldName||a===n.latitudeFieldName)r.push({name:a,type:\"esriFieldTypeDouble\",alias:a});else{const e=R(o.map((e=>e[a]))),t={name:a,type:null,alias:a};switch(e){case\"integer\":t.type=\"esriFieldTypeInteger\";break;case\"double\":t.type=\"esriFieldTypeDouble\";break;case\"date\":t.type=\"esriFieldTypeDate\",t.length=36;break;default:t.type=\"esriFieldTypeString\",t.length=255}r.push(t)}return r}function R(e){if(!e.length)return\"string\";const t=/[^+-.,0-9]/;return e.map((e=>{let i=!1;if(\"\"!==e){if(t.test(e))i=!0;else{let t=M(e);if(!isNaN(t))return/[.,]/.test(e)||!Number.isInteger(t)||t>214783647||t<-214783648?\"double\":\"integer\";if(-1===e.indexOf(\"E\"))i=!0;else{if(t=Number(e),!isNaN(t))return\"double\";if(-1===e.indexOf(\",\"))i=!0;else{if(e=e.replace(\",\",\".\"),t=Number(e),!isNaN(t))return\"double\";i=!0}}}if(i){if(!/^[-]?\\d*[.,]?\\d*$/.test(e)){return L(new Date(e),e)?\"date\":\"string\"}return\"string\"}return\"string\"}})).reduce(((e,t)=>void 0===e||e===t?t:\"string\"===e||\"string\"===t?\"string\":\"double\"===e||\"double\"===t?\"double\":void 0))}const G=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,Q=Number.isNaN(new Date(\"technology 10\").getTime());function L(e,t){if(!e||\"[object Date]\"!==Object.prototype.toString.call(e)||isNaN(e.getTime()))return!1;let i=!0;if(!Q&&/\\d+\\W*$/.test(t)){const e=t.match(/[a-zA-Z]{2,}/);if(e){let t=!1,n=0;for(;!t&&n<=e.length;)t=!G.test(e[n]),n++;i=!t}}return i}const M=function(){const e=n(),t=new RegExp(\"^\"+e.regexp+\"$\"),i=new RegExp(\"[\"+e.group+\"\\\\s\\\\xa0]\",\"g\"),r=e.factor;return function(n){const s=t.exec(n);if(e.factor=r,!s)return NaN;let o=s[1];if(!s[1]){if(!s[2])return NaN;o=s[2],e.factor*=-1}return o=o.replace(i,\"\").replace(e.decimal,\".\"),+o*e.factor}}();export{C as default,R as inferFieldType,V as inferFields,P as inferLocationInfo};\n"],"sourceRoot":"webpack:///","file":"7722.130f900f251ff41a140b.js"}