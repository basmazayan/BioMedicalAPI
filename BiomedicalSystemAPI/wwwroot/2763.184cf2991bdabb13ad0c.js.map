{"version":3,"mappings":"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","names":["constructor","this","_queryEngine","_customParameters","_snapshotFeatures","e","objectIdField","t","s","d","_getFeatureUrl","_featureType","typeName","_getFeatureOutputFormat","customParameters","dateFields","fieldsIndex","map","name","signal","g","a","i","_","geometryType","hasZ","o","spatialReference","u","r","geometry","p","l","h","n","f","_fieldsIndex","attributes","objectId","destroy","load","getFeatureUrl","getFeatureOutputFormat","fields","featureType","w","_checkProjection","m","hasM","timeInfo","featureStore","y","c","addMany","extent","fullExtent","applyEdits","queryFeatures","_waitSnapshotComplete","executeQuery","queryFeatureCount","executeQueryForCount","queryObjectIds","executeQueryForIds","queryExtent","executeQueryForExtent","querySnapping","executeQueryForSnapping","refresh","_snapshotTask","abort","promise","then","clear","error","finished"],"sources":["./node_modules/@arcgis/core/layers/graphics/sources/WFSSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Error.js\";import t from\"../../../core/Logger.js\";import{isSome as r,unwrap as s}from\"../../../core/maybe.js\";import{throwIfAborted as a,createTask as i,isAbortError as n}from\"../../../core/promiseUtils.js\";import{equals as o,WGS84 as u}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as p,convertToGeometry as h}from\"../featureConversionUtils.js\";import y from\"../data/FeatureStore.js\";import{project as l,checkProjectionSupport as c}from\"../data/projectionSupport.js\";import m from\"../data/QueryEngine.js\";import{validateGeoJSON as g,createOptimizedFeatures as _}from\"./geojson/geojson.js\";import{mixAttributes as f}from\"./support/sourceUtils.js\";import{getFeature as d}from\"../../ogc/wfsUtils.js\";import w from\"../../support/FieldsIndex.js\";class E{constructor(){this._queryEngine=null,this._customParameters=null,this._snapshotFeatures=async e=>{const{objectIdField:t}=this._queryEngine,s=await d(this._getFeatureUrl,this._featureType.typeName,this._getFeatureOutputFormat,{customParameters:this._customParameters,dateFields:this._queryEngine.fieldsIndex.dateFields.map((e=>e.name)),signal:e});await g(s),a(e);const i=_(s,{geometryType:this._queryEngine.geometryType,hasZ:!1,objectIdField:t});if(!o(this._queryEngine.spatialReference,u))for(const a of i)r(a.geometry)&&(a.geometry=p(l(h(a.geometry,this._queryEngine.geometryType,!1,!1),u,this._queryEngine.spatialReference)));let n=1;for(const r of i){const e={};f(this._fieldsIndex,e,r.attributes,!0),r.attributes=e,null==r.attributes[t]&&(r.objectId=r.attributes[t]=n++)}return i}}destroy(){var e;null==(e=this._queryEngine)||e.destroy(),this._queryEngine=null}async load(e,t){const{getFeatureUrl:r,getFeatureOutputFormat:i,spatialReference:n,fields:o,geometryType:u,featureType:p,objectIdField:h,customParameters:l}=e;this._featureType=p,this._customParameters=l,this._getFeatureUrl=r,this._getFeatureOutputFormat=i,this._fieldsIndex=new w(o),await this._checkProjection(n),a(t),this._queryEngine=new m({fields:o,geometryType:u,hasM:!1,hasZ:!1,objectIdField:h,spatialReference:n,timeInfo:null,featureStore:new y({geometryType:u,hasM:!1,hasZ:!1})});const c=await this._snapshotFeatures(s(t.signal));return this._queryEngine.featureStore.addMany(c),{extent:this._queryEngine.fullExtent}}async applyEdits(){throw new e(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(r){var s;return this._customParameters=r,null==(s=this._snapshotTask)||s.abort(),this._snapshotTask=i(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(r=>{this._queryEngine.featureStore.clear(),n(r)||t.getLogger(\"esri.layers.WFSLayer\").error(new e(\"wfs-layer:getfeature-error\",\"An error occurred during the GetFeature request\",{error:r}))})),await this._waitSnapshotComplete(),{extent:this._queryEngine.fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _checkProjection(t){try{await c(u,t)}catch{throw new e(\"unsupported-projection\",\"Projection not supported\",{spatialReference:t})}}}export{E as default};\n"],"sourceRoot":"webpack:///","file":"2763.184cf2991bdabb13ad0c.js"}