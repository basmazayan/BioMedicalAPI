"use strict";(self.webpackChunkbio_medical=self.webpackChunkbio_medical||[]).push([[8584],{98584:(N,b,t)=>{t.r(b),t.d(b,{default:()=>ge});var y=t(49996),s=t(79076),v=t(11652),o=t(94911),d=(t(45072),t(30627),t(55865),t(96410)),I=t(98101),T=t(78081),g=t(99326),x=t(30351),f=t(6897),E=t(22345),R=t(18502),h=t(7808),S=t(73358),P=t(70157),q=t(11057),k=t(24384),ee=t(78779),z=t(99345),te=t(84853),ie=t(42302);const se=E.Z.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D");let c=class extends f.Z{constructor(){var e;super(...arguments),e=this,this.attached=!1,this.container=new z.W,this.updateRequested=!1,this._graphicsView=null,this._projectFullExtentPromise=null,this._dataParameters={exportParametersVersion:0,extents:[],tileResolution:0,time:"",isOceanStyle:!1,isOceanographic:!1},this.type="Graphics",this._graphics=new ee.J,this._updateGraphics=(0,h.Ds)(function(){var i=(0,y.Z)(function*(a,n){if(!a.stationary)return;const r=a.state,u=new P.Z({xmin:r.extent.xmin,ymin:r.extent.ymin,xmax:r.extent.xmax,ymax:r.extent.ymax,spatialReference:r.spatialReference}),[w,m]=a.state.size,C={};C.timeExtent=e.timeExtent,C.requestAsImageElement=!1,C.signal=n,null==e._projectFullExtentPromise&&(e._projectFullExtentPromise=e._getProjectedFullExtent(u.spatialReference));const D="vector-field"===e.layer.renderer.type?e.layer.renderer.symbolTileSize:50,O=yield e._projectFullExtentPromise,{extent:B,resolution:A,width:G,height:W}=(0,k.BH)(u,w,m,D,O),L=yield e.layer.fetchImage(B,G,W,C),M=e.layer.renderer;if("vector-field"===M.type){const Z=L.pixelData.pixelBlock,j=M.sizeVariables[0];!(0,R.pC)(Z)||j.minDataValue&&j.maxDataValue||(j.minDataValue=Z.statistics[0].minValue,j.maxDataValue=Z.statistics[0].maxValue),e._pixelData={extent:B,pixelBlock:Z};const Y=B.clone().normalize(),X={exportParametersVersion:e.layer.exportImageServiceParameters.version,extents:Y,tileResolution:A,time:JSON.stringify(e.timeExtent||""),isOceanStyle:"flow-to"===M.flowRepresentation,isOceanographic:"ocean-current-kn"===M.style||"ocean-current-m"===M.style},_=e._canReuseVectorFieldData(X)?e._dataParameters.extents:[],$=yield M.getGraphicsFromPixelData(L.pixelData,"vector-uv"===e.layer.rasterInfo.dataType,_);if(_.length){const xe=e._graphics.items.filter(K=>(0,R.pC)(K.geometry)&&_.some(J=>J.intersects(K.geometry))&&!Y.some(J=>J.intersects(K.geometry)));e._graphics.removeMany(xe),e._graphics.addMany($)}else e._graphics.set("items",$);e._graphicsView.update(a),e._dataParameters=X}});return function(a,n){return i.apply(this,arguments)}}())}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this._updateGraphics(e).catch(i=>{(0,h.D_)(i)||se.error(i)})}hitTest(e){return new g.Z({attributes:{},geometry:e.clone(),layer:this.layer})}attach(){this._graphicsView=new ie.Z({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new te.Z(this.view.featuresTilingScheme)}),this.attached=!0}detach(){this._graphics.destroy(),this._graphicsView.destroy(),this.container.removeChild(this._graphicsView.container),this._graphicsView=null}install(e){this.container.addChild(this._graphicsView.container),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._graphicsView.container),e.removeChild(this.container)}isUpdating(){return this._graphicsView.updating||this.updateRequested}getPixelData(){return this.updating?null:this._pixelData}redraw(){}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}_getProjectedFullExtent(e){var i=this;return(0,y.Z)(function*(){try{return yield(0,q.tB)(i.layer.fullExtent,e)}catch(a){try{const n=(yield(0,x.default)(i.layer.url,{query:{option:"footprints",outSR:e.wkid||JSON.stringify(e.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return n?P.Z.fromJSON(n):null}catch(n){return null}}})()}_canReuseVectorFieldData(e){const i=this._dataParameters.exportParametersVersion===e.exportParametersVersion,a=this._dataParameters.time===e.time,n=Math.abs(this._dataParameters.tileResolution-e.tileResolution)/e.tileResolution<.01,r=this._dataParameters.extents.some(m=>e.extents.some(C=>m.intersects(C))),u=this._dataParameters.isOceanStyle===e.isOceanStyle,w=this._dataParameters.isOceanographic===e.isOceanographic;return i&&a&&n&&r&&u&&w}};(0,s._)([(0,o.Cb)()],c.prototype,"attached",void 0),(0,s._)([(0,o.Cb)()],c.prototype,"container",void 0),(0,s._)([(0,o.Cb)()],c.prototype,"layer",void 0),(0,s._)([(0,o.Cb)()],c.prototype,"timeExtent",void 0),(0,s._)([(0,o.Cb)()],c.prototype,"view",void 0),(0,s._)([(0,o.Cb)()],c.prototype,"updateRequested",void 0),(0,s._)([(0,o.Cb)()],c.prototype,"updating",null),(0,s._)([(0,S.J)({graphics:"Graphics"})],c.prototype,"type",void 0),c=(0,s._)([(0,d.j)("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],c);const ae=c;var re=t(85572),ne=t(23335),oe=t(89001),le=t(62330);const he=E.Z.getLogger("esri.views.2d.layers.imagery.ImageryView2D");let p=class extends f.Z{constructor(){super(...arguments),this.attached=!1,this.container=new z.W,this.updateRequested=!1,this.type="Imagery",this._bitmapView=null}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this.strategy.update(e).catch(i=>{(0,h.D_)(i)||he.error(i)})}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren()}hitTest(e){return new g.Z({attributes:{},geometry:e.clone(),layer:this.layer})}attach(){const e=this.layer.version>=10,i=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,a=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this._bitmapView=new ne.c,this.strategy=new le.Z({container:this._bitmapView,imageNormalizationSupported:e,imageMaxHeight:i,imageMaxWidth:a,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()}),this.attached=!0}install(e){this.container.addChild(this._bitmapView),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._bitmapView),e.removeChild(this.container)}redraw(){this.strategy.updateExports(e=>{e.source instanceof HTMLImageElement?e.requestRender():this.layer.applyRenderer({pixelBlock:e.source.pixelBlock}).then(i=>{const a=e.source;a.pixelBlock=i.pixelBlock,a.filter=n=>this.layer.applyFilter(n),this.container.requestRender()})})}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const e=this.strategy.bitmaps;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){const i=this.view.extent,a=e.map(r=>r.source).filter(r=>r.extent&&r.extent.intersects(i)).map(r=>({extent:r.extent,pixelBlock:r.originalPixelBlock})),n=(0,re.Kh)(a,i);return(0,R.pC)(n)?{extent:n.extent,pixelBlock:n.pixelBlock}:null}return null}_fetchImage(e,i,a,n){return(n=n||{}).timeExtent=this.timeExtent,n.requestAsImageElement=!0,this.layer.fetchImage(e,i,a,n).then(r=>r.imageElement?r.imageElement:this.layer.applyRenderer(r.pixelData,{signal:n.signal}).then(u=>{const w=new oe.Z(u.pixelBlock,u.extent.clone(),r.pixelData.pixelBlock);return w.filter=m=>this.layer.applyFilter(m),w}))}};(0,s._)([(0,o.Cb)()],p.prototype,"attached",void 0),(0,s._)([(0,o.Cb)()],p.prototype,"container",void 0),(0,s._)([(0,o.Cb)()],p.prototype,"layer",void 0),(0,s._)([(0,o.Cb)()],p.prototype,"strategy",void 0),(0,s._)([(0,o.Cb)()],p.prototype,"timeExtent",void 0),(0,s._)([(0,o.Cb)()],p.prototype,"view",void 0),(0,s._)([(0,o.Cb)()],p.prototype,"updateRequested",void 0),(0,s._)([(0,o.Cb)()],p.prototype,"updating",null),(0,s._)([(0,S.J)({imagery:"Imagery"})],p.prototype,"type",void 0),p=(0,s._)([(0,d.j)("esri.views.2d.layers.imagery.ImageryView2D")],p);const de=p;var H=t(61414),Q=t(36262),pe=t(46613),ue=t(37995),ce=t(76388);const ye=e=>{let i=class extends e{constructor(){super(...arguments),this.view=null}fetchPopupFeatures(a,n){var r=this;return(0,y.Z)(function*(){const{layer:u}=r;if(!a)throw new H.Z("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:u});const{popupEnabled:w}=u,m=(0,ce.V)(u,n);if(!w||!(0,R.pC)(m))throw new H.Z("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:w,popupTemplate:m});const C=yield m.getRequiredFields(),D=new ue.Z;D.timeExtent=r.timeExtent,D.geometry=a,D.outFields=C,D.outSpatialReference=a.spatialReference;const O=r.view.resolution,B="2d"===r.view.type?new Q.Z(O,O,r.view.spatialReference):new Q.Z(.5*O,.5*O,r.view.spatialReference),{returnTopmostRaster:A,showNoDataRecords:G}=m.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},W={returnDomainValues:!0,returnTopmostRaster:A,pixelSize:B,showNoDataRecords:G,signal:(0,R.pC)(n)?n.signal:null};return u.queryVisibleRasters(D,W).then(L=>L)})()}canResume(){var a;return!(!super.canResume()||null!=(a=this.timeExtent)&&a.isEmpty)}};return(0,s._)([(0,o.Cb)()],i.prototype,"layer",void 0),(0,s._)([(0,o.Cb)()],i.prototype,"suspended",void 0),(0,s._)([(0,o.Cb)(pe.qG)],i.prototype,"timeExtent",void 0),(0,s._)([(0,o.Cb)()],i.prototype,"view",void 0),i=(0,s._)([(0,d.j)("esri.views.layers.ImageryLayerView")],i),i};var me=t(96121),ve=t(26263);let U=class extends(ye((0,ve.y)((0,T.y)(me.Z)))){constructor(){super(...arguments),this._exportImageVersion=-1}initialize(){this.handles.add([(0,v.S1)(this,["layer.blendMode","layer.effects"],e=>{this.subview&&(this.subview.container.blendMode=e)},!0),(0,v.S1)(this,"layer.effect",e=>{this.subview&&(this.subview.container.effect=e)},!0)])}get pixelData(){return this.updating?null:"getPixelData"in this.subview?this.subview.getPixelData():null}get updating(){return!!(!this.subview||"updating"in this.subview&&this.subview.updating)}hitTest(e,i){var a=this;return(0,y.Z)(function*(){return a.subview?"hitTest"in a.subview?[a.subview.hitTest(e)]:[]:null})()}update(e){var i;null==(i=this.subview)||i.update(e)}attach(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.handles.add([(0,v.S1)(this,"layer.exportImageServiceParameters.version",e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())}),this.watch("timeExtent",()=>{"timeExtent"in this.subview&&(this.subview.timeExtent=this.timeExtent),this.requestUpdate()}),this.layer.on("redraw",()=>{"redraw"in this.subview?this.subview.redraw():this.subview.redrawOrRefetch()}),(0,v.YP)(this.layer,"renderer",()=>this._setSubView())],"imagerylayerview-update")}detach(){this.layer.decreaseRasterJobHandlerUsage(),this.subview.destroy(),this.handles.remove("imagerylayerview-update"),this._exportImageVersion=-1}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}doRefresh(){var e=this;return(0,y.Z)(function*(){e.requestUpdate()})()}isUpdating(){return!this.subview||!this.suspended&&this.subview.updating}_setSubView(){var e,i;let a="Imagery";var n,r;"vector-field"===(null==(e=this.layer.renderer)?void 0:e.type)&&"lerc"===this.layer.format&&(a="Graphics"),"animated-flow"===(null==(i=this.layer.renderer)?void 0:i.type)&&(a="Flow"),this.subview&&this.subview.type===a||(null==(n=this.subview)||n.uninstall(this.container),null==(r=this.subview)||r.destroy(),this.subview="Imagery"===a?new de({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"Graphics"===a?new ae({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new I.Z({layer:this.layer,layerView:this}),this.subview.attach(),this.subview.install(this.container),this.subview.container.blendMode=this.layer.blendMode,this.subview.container.effect=this.layer.effect),this.requestUpdate()}};(0,s._)([(0,o.Cb)()],U.prototype,"pixelData",null),(0,s._)([(0,o.Cb)({readOnly:!0})],U.prototype,"updating",null),(0,s._)([(0,o.Cb)()],U.prototype,"subview",void 0),U=(0,s._)([(0,d.j)("esri.views.2d.layers.ImageryLayerView2D")],U);const ge=U},26263:(N,b,t)=>{t.d(b,{y:()=>T});var y=t(79076),s=t(22345),v=t(7808),o=t(11652),V=t(94911),I=(t(45072),t(30627),t(55865),t(96410));const T=g=>{let x=class extends g{initialize(){this.handles.add((0,o.on)(this,"layer","refresh",f=>{this.doRefresh(f.dataChanged).catch(E=>{(0,v.D_)(E)||s.Z.getLogger(this.declaredClass).error(E)})}),"RefreshableLayerView")}};return(0,y._)([(0,V.Cb)()],x.prototype,"layer",void 0),x=(0,y._)([(0,I.j)("esri.layers.mixins.RefreshableLayerView")],x),x}},76388:(N,b,t)=>{t.d(b,{V:()=>F,e:()=>o});var y=t(49996),s=t(18502),v=t(6663);function o(l){return V.apply(this,arguments)}function V(){return(V=(0,y.Z)(function*(l,d=l.popupTemplate){if(!(0,s.pC)(d))return[];const I=yield d.getRequiredFields(l.fieldsIndex),{lastEditInfoEnabled:T}=d,{objectIdField:g,typeIdField:x,globalIdField:f,relationships:E}=l;if(I.includes("*"))return["*"];const R=T?yield(0,v.CH)(l):[],h=(0,v.Q0)(l.fieldsIndex,[...I,...R]);return x&&h.push(x),h&&g&&l.fieldsIndex.has(g)&&-1===h.indexOf(g)&&h.push(g),h&&f&&l.fieldsIndex.has(f)&&-1===h.indexOf(f)&&h.push(f),E&&E.forEach(S=>{const{keyField:P}=S;h&&P&&l.fieldsIndex.has(P)&&-1===h.indexOf(P)&&h.push(P)}),h})).apply(this,arguments)}function F(l,d){return l.popupTemplate?l.popupTemplate:(0,s.pC)(d)&&d.defaultPopupTemplateEnabled&&(0,s.pC)(l.defaultPopupTemplate)?l.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=8584.624d0a0d8c871ca7bf1b.js.map