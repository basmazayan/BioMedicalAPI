"use strict";var Fr=Object.defineProperty,jr=Object.defineProperties,Dr=Object.getOwnPropertyDescriptors,qt=Object.getOwnPropertySymbols,Ar=Object.prototype.hasOwnProperty,Vr=Object.prototype.propertyIsEnumerable,Xt=(Pe,ye,h)=>ye in Pe?Fr(Pe,ye,{enumerable:!0,configurable:!0,writable:!0,value:h}):Pe[ye]=h,Q=(Pe,ye)=>{for(var h in ye||(ye={}))Ar.call(ye,h)&&Xt(Pe,h,ye[h]);if(qt)for(var h of qt(ye))Vr.call(ye,h)&&Xt(Pe,h,ye[h]);return Pe},_e=(Pe,ye)=>jr(Pe,Dr(ye));(self.webpackChunkbio_medical=self.webpackChunkbio_medical||[]).push([[1510],{41510:(Pe,ye,h)=>{h.r(ye),h.d(ye,{default:()=>Or});var j,o=h(79076),yt=h(24093),U=h(18502),Ye=h(32810),Ie=h(7808),l=h(94911),me=(h(45072),h(30627),h(55865)),he=h(96410),X=h(88445),$e=h(2045),W=h(49996),et=h(61243),ot=h(99326),Ae=h(88057),Y=h(30351),ge=h(61414),pe=h(74856),ue=h(60161),at=h(22345),Ke=h(30164),ce=h(95774),ie=h(38650),O=h(46613),_=h(81751),P=h(41147),J=h(73358);const D=new Set(["raster","raster2","dem","fillraster"]),a=new Set(["rasters"]),f=n=>n&&n.rasterFunction?b.fromJSON(n):n,m=n=>n&&n instanceof b?n.toJSON():n,d=n=>(null==n?void 0:n.functionName)&&!n.declaredClass,g=n=>d(n)?new b(n):n;var y,n;(n=y||(y={}))[n.MOSAIC=0]="MOSAIC",n[n.GROUP=1]="GROUP",n[n.ITEM=2]="ITEM";let b=j=class extends P.wq{constructor(n){super(n),this.functionName=null,this.outputPixelType="unknown",this.variableName=null,this.description=null,this.functionDefinition=null,this.thumbnail=null}set functionArguments(n){if(n){const i=Object.keys(n);if(i.some(e=>D.has(e.toLowerCase())&&d(n[e]))||i.some(e=>a.has(e.toLowerCase())&&Array.isArray(n[e])&&n[e].some(t=>d(t)))){n=(0,ue.d9)(n);for(const e of i)D.has(e.toLowerCase())?n[e]=g(n[e]):a.has(e.toLowerCase())&&Array.isArray(n[e])&&(n[e]=n[e].map(t=>g(t)))}}this._set("functionArguments",n)}readFunctionArguments(n,i){return(n=>{if(null==n)return null;n=(0,ue.d9)(n);const i={};for(const e of Object.keys(n))D.has(e.toLowerCase())?i[e]=f(n[e]):a.has(e.toLowerCase())&&Array.isArray(n[e])?i[e]=n[e].map(f):i[e]=n[e];return i})(i.arguments||i.rasterFunctionArguments)}writeFunctionArguments(n,i,e){const t={};for(const r of Object.keys(n))D.has(r.toLowerCase())?t[r]=m(n[r]):a.has(r.toLowerCase())&&Array.isArray(n[r])?t[r]=n[r].map(m):t[r]=m(n[r]);this.functionDefinition?i.arguments=t:i[e]=t}readFunctionName(n,i){const e=i.rasterFunctionInfos;return i.name||(e&&e.length&&"None"!==e[0].name?e[0].name:i.rasterFunction)}writeFunctionName(n,i,e){this.functionDefinition?i.name=n:i[e]=n}readFunctionType(n){return y[n]}writeFunctionType(n,i,e){i[e]=y[n]}clone(){return new j({functionName:this.functionName,functionArguments:(0,ue.d9)(this.functionArguments),outputPixelType:this.outputPixelType,variableName:this.variableName,description:this.description,functionType:this.functionType,functionDefinition:this.functionDefinition,thumbnail:this.thumbnail})}};(0,o._)([(0,l.Cb)({json:{type:Object,write:{target:"rasterFunctionArguments"}}})],b.prototype,"functionArguments",null),(0,o._)([(0,ie.r)("functionArguments",["rasterFunctionArguments","arguments"])],b.prototype,"readFunctionArguments",null),(0,o._)([(0,X.c)("functionArguments")],b.prototype,"writeFunctionArguments",null),(0,o._)([(0,l.Cb)({json:{type:String,write:{target:"rasterFunction"}}})],b.prototype,"functionName",void 0),(0,o._)([(0,ie.r)("functionName",["rasterFunction","rasterFunctionInfos","name"])],b.prototype,"readFunctionName",null),(0,o._)([(0,X.c)("functionName")],b.prototype,"writeFunctionName",null),(0,o._)([(0,J.J)({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),(0,l.Cb)({json:{default:"unknown"}})],b.prototype,"outputPixelType",void 0),(0,o._)([(0,l.Cb)({type:String,json:{read:!0,write:!0}})],b.prototype,"variableName",void 0),(0,o._)([(0,l.Cb)({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],b.prototype,"description",void 0),(0,o._)([(0,l.Cb)({json:{origins:{"web-document":{read:!1,write:!1}}}})],b.prototype,"functionType",void 0),(0,o._)([(0,ie.r)("functionType")],b.prototype,"readFunctionType",null),(0,o._)([(0,X.c)("functionType")],b.prototype,"writeFunctionType",null),(0,o._)([(0,l.Cb)({type:Object,json:{read:{source:"function"},write:{target:"function"},origins:{"web-document":{read:!1,write:!1}}}})],b.prototype,"functionDefinition",void 0),(0,o._)([(0,l.Cb)({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],b.prototype,"thumbnail",void 0),b=j=(0,o._)([(0,he.j)("esri.layers.support.RasterFunction")],b);const C=b;var v=h(29122),I=h(5929),S=h(1557);const w={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},N={simple_scalar:"Simple Scalar",wind_barb:"Wind Barb",single_arrow:"Single Arrow",beaufort_kn:"Beaufort Wind (Knots)",beaufort_m:"Beaufort Wind (MetersPerSecond)",ocean_current_m:"Ocean Current (MetersPerSecond)",ocean_current_kn:"Ocean Current (Knots)"},T=new Set(["raster-stretch","unique-value","class-breaks","raster-shaded-relief","vector-field","raster-colormap"]);function z(n){return T.has(n.type)}function q(n,i){if(!n||!i)return(0,ue.d9)(n||i);const e=(0,ue.d9)(n);return"none"!==i.functionName.toLowerCase()&&(re(e.functionArguments).Raster=i),e}function ae(n,i){switch(i=i||{},n.type){case"raster-stretch":return function(n,i){const e=new C;e.functionName="Stretch";const t=E[I.v.toJSON(n.stretchType)],r="u8",s={StretchType:t,Statistics:Ve(n.statistics),DRA:n.dynamicRangeAdjustment,UseGamma:n.useGamma,Gamma:n.gamma,ComputeGamma:n.computeGamma};if(null!=n.outputMin&&(s.Min=n.outputMin),null!=n.outputMax&&(s.Max=n.outputMax),t===E.standardDeviation?(s.NumberOfStandardDeviations=n.numberOfStandardDeviations,e.outputPixelType=r):t===E.percentClip?(s.MinPercent=n.minPercent,s.MaxPercent=n.maxPercent,e.outputPixelType=r):t===E.minMax?e.outputPixelType=r:t===E.sigmoid&&(s.SigmoidStrengthLevel=n.sigmoidStrengthLevel),e.functionArguments=s,e.variableName="Raster",n.colorRamp){const p=n.colorRamp,u=new C,c=(0,v.Uh)(p);return c?u.functionArguments={colorRamp:c}:!i.convertColorRampToColormap||"algorithmic"!==p.type&&"multipart"!==p.type?u.functionArguments={colorRamp:n.colorRamp.toJSON()}:u.functionArguments={Colormap:(0,v.Jw)(p,256)},u.variableName="Raster",u.functionName="Colormap",u.functionArguments.Raster=e,u}return e}(n,i);case"class-breaks":return function(n,i){const e=[],t=[],r=[],s=[],p=1e-6,{pixelType:u,rasterAttributeTable:c}=i,x=c&&c.features,R=G(c);if(x&&Array.isArray(x)&&n.classBreakInfos){n.classBreakInfos.forEach((B,Ue)=>{const xe=B.symbol.color;let oe;xe.a&&x.forEach(ee=>{oe=ee.attributes[n.field],(oe>=B.minValue&&oe<B.maxValue||Ue===n.classBreakInfos.length-1&&oe>=B.minValue)&&s.push([ee.attributes[R],xe.r,xe.g,xe.b])})});const V=u?se(s,u):s,L=new C;return L.functionName="Colormap",L.functionArguments={},L.functionArguments.Colormap=V,L.variableName="Raster",L}n.classBreakInfos.forEach((V,L)=>{const B=V.symbol&&V.symbol.color;B.a?(0===L?e.push(V.minValue,V.maxValue+p):e.push(V.minValue+p,V.maxValue+p),t.push(L),s.push([L,B.r,B.g,B.b])):r.push(V.minValue,V.maxValue)});const F=u?se(s,u):s,A=new C;A.functionName="Remap",A.functionArguments={InputRanges:e,OutputValues:t,NoDataRanges:r},A.variableName="Raster";const Z=new C;return Z.functionName="Colormap",Z.functionArguments={Colormap:F,Raster:A},Z}(n,i);case"unique-value":return function(n,i){var e;const t=[],{pixelType:r,rasterAttributeTable:s}=i,p=s&&s.features,u=G(s),c=null==(e=n.defaultSymbol)?void 0:e.color;let x=!1;if(n.uniqueValueInfos&&(p?p.forEach(A=>{var Z;const V=null==(Z=n.uniqueValueInfos.find(L=>String(A.attributes[n.field])===String(L.value)))?void 0:Z.symbol.color;V?t.push([A.attributes[u],V.r,V.g,V.b]):c&&t.push([A.attributes[u],c.r,c.g,c.b])}):n.uniqueValueInfos.forEach(A=>{var Z;if(null==(Z=A.symbol.color)||!Z.a)return;const V=A.symbol.color;isNaN(+A.value)?x=!0:t.push([+A.value,V.r,V.g,V.b])})),x)return null;const R=r&&t.length>0?se(t,r):t,F=new C;return F.functionName="Colormap",F.functionArguments={},F.functionArguments.Colormap=R,F.variableName="Raster",F}(n,i);case"raster-colormap":return function(n,i){const e=n.extractColormap();if(!e||0===e.length)return;const{pixelType:t}=i,r=t?se(e,t):e,s=new C;return s.functionName="Colormap",s.functionArguments={},s.functionArguments.Colormap=r,s}(n,i);case"vector-field":return function(n,i){const e=new C;e.functionName="VectorFieldRenderer";const{dataType:t,bandProperties:r}=i,s="vector-uv"===t;let p,u;r&&2===r.length&&(p=r.map(A=>A.BandName.toLowerCase()).indexOf("magnitude"),u=r.map(A=>A.BandName.toLowerCase()).indexOf("direction")),-1!==p&&null!==p||(p=0,u=1);const c="arithmetic"===n.rotationType?1:2,x="flow-from"===n.flowRepresentation?0:1,R=n.visualVariables?n.visualVariables.filter(A=>"Magnitude"===A.field)[0]:new S.Z,F={magnitudeBandID:p,directionBandID:u,isUVComponents:s,referenceSystem:c,massFlowAngleRepresentation:x,symbolTileSize:50,symbolTileSizeUnits:100,calculationMethod:"Vector Average",symbologyName:N[n.style.toLowerCase().replace("-","_")],minimumMagnitude:R.minDataValue,maximumMagnitude:R.maxDataValue,minimumSymbolSize:R.minSize,maximumSymbolSize:R.maxSize};return e.functionArguments=F,e}(n,i);case"raster-shaded-relief":return function(n,i){if("elevation"!==i.dataType)return new C;const e=new C;e.functionName="Hillshade";const t="traditional"===n.hillshadeType?0:1,r="none"===n.scalingType?1:3,s={HillshadeType:t,SlopeType:r,ZFactor:n.zFactor};return 0===t&&(s.Azimuth=n.azimuth,s.Altitude=n.altitude),3===r&&(s.PSPower=n.pixelSizePower,s.PSZFactor=n.pixelSizeFactor),e.functionArguments=s,e.variableName="Raster",n.colorRamp&&(e.functionName="ShadedRelief",s.Colormap=(0,v.Jw)(n.colorRamp,256)),e}(n,i);case"animated-flow":throw new Error("Unsupported rendering rule.")}}function re(n){const i=n.Raster;return i&&"esri.layers.support.RasterFunction"===i.declaredClass?re(i.functionArguments):n}const E={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9};function se(n,i){const e=w[String(i).toLowerCase()];return e&&n.push([Math.floor(e[0]-1),0,0,0],[Math.ceil(e[1]+1),0,0,0]),n}function G(n){if(!n)return;const{fields:i}=n,e=i&&i.find(t=>t&&t.name&&"value"===t.name.toLowerCase());return e&&e.name}function Ve(n){const i=[];return n.forEach(e=>{const t=e;if(Array.isArray(t))i.push(t);else{if(null==t.min||null==t.max)return;const r=[t.min,t.max,t.avg||0,t.stddev||0];i.push(r)}}),i}var ze,Je=h(43465),Re=h(36262);const Ee=(0,pe.wY)()({MT_FIRST:"first",MT_LAST:"last",MT_MIN:"min",MT_MAX:"max",MT_MEAN:"mean",MT_BLEND:"blend",MT_SUM:"sum"}),ke=(0,pe.wY)()({esriMosaicNone:"none",esriMosaicCenter:"center",esriMosaicNadir:"nadir",esriMosaicViewpoint:"viewpoint",esriMosaicAttribute:"attribute",esriMosaicLockRaster:"lock-raster",esriMosaicNorthwest:"northwest",esriMosaicSeamline:"seamline"});let fe=ze=class extends P.wq{constructor(n){super(n),this.ascending=!0,this.itemRenderingRule=null,this.lockRasterIds=null,this.method=null,this.multidimensionalDefinition=null,this.objectIds=null,this.operation=null,this.sortField=null,this.sortValue=null,this.viewpoint=null,this.where=null}readAscending(n,i){return null!=i.ascending?i.ascending:null==i.sortAscending||i.sortAscending}readMethod(n,i){return function(n){let i;switch(n?n.toLowerCase().replace("esrimosaic",""):""){case"byattribute":case"attribute":i="esriMosaicAttribute";break;case"lockraster":i="esriMosaicLockRaster";break;case"center":i="esriMosaicCenter";break;case"northwest":i="esriMosaicNorthwest";break;case"nadir":i="esriMosaicNadir";break;case"viewpoint":i="esriMosaicViewpoint";break;case"seamline":i="esriMosaicSeamline";break;default:i="esriMosaicNone"}return ke.fromJSON(i)}(i.mosaicMethod||i.defaultMosaicMethod)}readOperation(n,i){const e=i.mosaicOperation,t=i.mosaicOperator&&i.mosaicOperator.toLowerCase(),r=e||(t?Ee.toJSON(t):null);return Ee.fromJSON(r)||"first"}castSortValue(n){return null==n||"string"==typeof n||"number"==typeof n?n:`${n}`}clone(){return new ze({ascending:this.ascending,itemRenderingRule:(0,ue.d9)(this.itemRenderingRule),lockRasterIds:(0,ue.d9)(this.lockRasterIds),method:this.method,multidimensionalDefinition:(0,ue.d9)(this.multidimensionalDefinition),objectIds:(0,ue.d9)(this.objectIds),operation:this.operation,sortField:this.sortField,sortValue:this.sortValue,viewpoint:(0,ue.d9)(this.viewpoint),where:this.where})}};(0,o._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],fe.prototype,"ascending",void 0),(0,o._)([(0,ie.r)("ascending",["ascending","sortAscending"])],fe.prototype,"readAscending",null),(0,o._)([(0,l.Cb)({type:C,json:{write:!0}})],fe.prototype,"itemRenderingRule",void 0),(0,o._)([(0,l.Cb)({type:[me.z8],json:{write:{overridePolicy(){return{enabled:"lock-raster"===this.method}}}}})],fe.prototype,"lockRasterIds",void 0),(0,o._)([(0,l.Cb)({type:String,json:{type:ke.jsonValues,write:{target:"mosaicMethod",writer:ke.write}}})],fe.prototype,"method",void 0),(0,o._)([(0,ie.r)("method",["mosaicMethod","defaultMosaicMethod"])],fe.prototype,"readMethod",null),(0,o._)([(0,l.Cb)({type:[_.Z],json:{write:!0}})],fe.prototype,"multidimensionalDefinition",void 0),(0,o._)([(0,l.Cb)({type:[me.z8],json:{name:"fids",write:!0}})],fe.prototype,"objectIds",void 0),(0,o._)([(0,l.Cb)({json:{type:Ee.jsonValues,read:{reader:Ee.read},write:{target:"mosaicOperation",writer:Ee.write}}})],fe.prototype,"operation",void 0),(0,o._)([(0,ie.r)("operation",["mosaicOperation","mosaicOperator"])],fe.prototype,"readOperation",null),(0,o._)([(0,l.Cb)({type:String,json:{write:{overridePolicy(){return{enabled:"attribute"===this.method}}}}})],fe.prototype,"sortField",void 0),(0,o._)([(0,l.Cb)({type:[String,Number],json:{write:{allowNull:!0,overridePolicy(){return{enabled:"attribute"===this.method,allowNull:!0}}}}})],fe.prototype,"sortValue",void 0),(0,o._)([(0,Je.p)("sortValue")],fe.prototype,"castSortValue",null),(0,o._)([(0,l.Cb)({type:Re.Z,json:{write:!0}})],fe.prototype,"viewpoint",void 0),(0,o._)([(0,l.Cb)({type:String,json:{write:!0}})],fe.prototype,"where",void 0),fe=ze=(0,o._)([(0,he.j)("esri.layers.support.MosaicRule")],fe);const Ce=fe;var be=h(92015);let le=class extends P.wq{constructor(){super(...arguments),this.layer=null,this.adjustAspectRatio=void 0,this.bandIds=void 0,this.compression=void 0,this.compressionQuality=void 0,this.compressionTolerance=.01,this.format=null,this.interpolation=null,this.noData=null,this.noDataInterpretation=void 0,this.pixelType=void 0,this.lercVersion=2}writeAdjustAspectRatio(n,i,e){this.layer.version<10.3||(i[e]=n)}writeCompressionQuality(n,i,e){this.format&&this.format.toLowerCase().indexOf("jpg")>-1&&null!=n&&(i[e]=n)}writeCompressionTolerance(n,i,e){"lerc"===this.format&&null!=n&&(i[e]=n)}writeLercVersion(n,i,e){"lerc"===this.format&&this.layer.version>=10.5&&(i[e]=n)}get version(){const n=this.layer;return n.commitProperty("bandIds"),n.commitProperty("format"),n.commitProperty("compressionQuality"),n.commitProperty("compressionTolerance"),n.commitProperty("interpolation"),n.commitProperty("noData"),n.commitProperty("noDataInterpretation"),n.commitProperty("mosaicRule"),n.commitProperty("renderingRule"),n.commitProperty("adjustAspectRatio"),n.commitProperty("pixelFilter"),n.commitProperty("renderer"),n.commitProperty("definitionExpression"),(this._get("version")||0)+1}set version(n){this._set("version",n)}get mosaicRule(){const n=this.layer;let i=n.mosaicRule;const e=n.definitionExpression;return i?e&&e!==i.where&&(i=i.clone(),i.where=e):e&&(i=new Ce({where:e})),i}get renderingRule(){const n=this.layer;let i=n.renderingRule;const e=n.pixelFilter,t=!n.format||n.format.indexOf("jpg")>-1||n.format.indexOf("png")>-1;return i=this._addResampleRasterFunction(i),t&&!e&&(i=this.combineRendererWithRenderingRule()),i}combineRendererWithRenderingRule(){var n;const i=this.layer,{rasterInfo:e,renderingRule:t,renderer:r}=i;return r&&z(r)?q(ae(r,{rasterAttributeTable:e.attributeTable,pixelType:e.pixelType,dataType:e.dataType,bandProperties:null==(n=e.keyProperties)?void 0:n.BandProperties,convertColorRampToColormap:i.version<10.6}),t):t}_addResampleRasterFunction(n){var i;if("vector-field"!==(null==(i=this.layer.renderer)?void 0:i.type)||"Resample"===(null==n?void 0:n.functionName))return n;const e="esriImageServiceDataTypeVector-UV"===this.layer.serviceDataType?7:10;return q(new C({functionName:"Resample",functionArguments:{ResamplingType:e,InputCellSize:{x:this.layer.pixelSizeX,y:this.layer.pixelSizeY}}}),n)}};(0,o._)([(0,l.Cb)()],le.prototype,"layer",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],le.prototype,"adjustAspectRatio",void 0),(0,o._)([(0,X.c)("adjustAspectRatio")],le.prototype,"writeAdjustAspectRatio",null),(0,o._)([(0,l.Cb)({json:{write:!0}}),(0,ce.B)("layer.bandIds")],le.prototype,"bandIds",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],le.prototype,"compression",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}}),(0,ce.B)("layer.compressionQuality")],le.prototype,"compressionQuality",void 0),(0,o._)([(0,X.c)("compressionQuality")],le.prototype,"writeCompressionQuality",null),(0,o._)([(0,l.Cb)({json:{write:!0}}),(0,ce.B)("layer.compressionTolerance")],le.prototype,"compressionTolerance",void 0),(0,o._)([(0,X.c)("compressionTolerance")],le.prototype,"writeCompressionTolerance",null),(0,o._)([(0,l.Cb)({json:{write:!0}}),(0,ce.B)("layer.format")],le.prototype,"format",void 0),(0,o._)([(0,l.Cb)({type:String,json:{read:{reader:be.c.read},write:{writer:be.c.write}}}),(0,ce.B)("layer.interpolation")],le.prototype,"interpolation",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}}),(0,ce.B)("layer.noData")],le.prototype,"noData",void 0),(0,o._)([(0,l.Cb)({type:String,json:{read:{reader:be.k.read},write:{writer:be.k.write}}}),(0,ce.B)("layer.noDataInterpretation")],le.prototype,"noDataInterpretation",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],le.prototype,"pixelType",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],le.prototype,"lercVersion",void 0),(0,o._)([(0,X.c)("lercVersion")],le.prototype,"writeLercVersion",null),(0,o._)([(0,l.Cb)({type:Number})],le.prototype,"version",null),(0,o._)([(0,l.Cb)({json:{write:!0}})],le.prototype,"mosaicRule",null),(0,o._)([(0,l.Cb)({json:{write:!0}})],le.prototype,"renderingRule",null),le=(0,o._)([(0,he.j)("esri.layers.mixins.ExportImageServiceParameters")],le);var Fe=h(66536),lt=h(62419),ut=h(77847),qe=h(42492),pt=h(87066),ct=h(10464),St=h(24384),gt=h(52291),Yt=h(72029),wt=h(31582),Se=h(16727),Be=h(96583);let tt=class extends P.wq{constructor(){super(...arguments),this.north=null,this.up=null,this.spatialReference=null}};(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],tt.prototype,"north",void 0),(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],tt.prototype,"up",void 0),(0,o._)([(0,l.Cb)({type:Be.Z,json:{write:!0}})],tt.prototype,"spatialReference",void 0),tt=(0,o._)([(0,he.j)("esri.rest.support.ImageAngleResult")],tt);const $t=tt;var It=h(42762);let Te=class extends P.wq{constructor(){super(...arguments),this.catalogItemVisibilities=null,this.catalogItems=null,this.location=null,this.name=null,this.objectId=null,this.processedValues=null,this.properties=null,this.value=null}};(0,o._)([(0,l.Cb)({json:{write:!0}})],Te.prototype,"catalogItemVisibilities",void 0),(0,o._)([(0,l.Cb)({type:It.default,json:{write:!0}})],Te.prototype,"catalogItems",void 0),(0,o._)([(0,l.Cb)({type:Re.Z,json:{write:!0}})],Te.prototype,"location",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],Te.prototype,"name",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],Te.prototype,"objectId",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],Te.prototype,"processedValues",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],Te.prototype,"properties",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],Te.prototype,"value",void 0),Te=(0,o._)([(0,he.j)("esri.rest.support.ImageIdentifyResult")],Te);const er=Te;let Le=class extends P.wq{constructor(){super(...arguments),this.attributes=null,this.location=null,this.locationId=null,this.rasterId=null,this.resolution=null,this.pixelValue=null}};(0,o._)([(0,l.Cb)({json:{write:!0}})],Le.prototype,"attributes",void 0),(0,o._)([(0,l.Cb)({type:Re.Z,json:{write:!0}})],Le.prototype,"location",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],Le.prototype,"locationId",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],Le.prototype,"rasterId",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],Le.prototype,"resolution",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],Le.prototype,"pixelValue",void 0),Le=(0,o._)([(0,he.j)("esri.rest.support.ImageSample")],Le);const tr=Le;let vt=class extends P.wq{constructor(){super(...arguments),this.samples=null}};(0,o._)([(0,l.Cb)({type:[tr],json:{write:!0}})],vt.prototype,"samples",void 0),vt=(0,o._)([(0,he.j)("esri.rest.support.ImageSampleResult")],vt);const rr=vt;let Rt=class extends P.wq{constructor(){super(...arguments),this.geometries=null}};(0,o._)([(0,l.Cb)({json:{write:!0}})],Rt.prototype,"geometries",void 0),Rt=(0,o._)([(0,he.j)("esri.rest.support.ImagePixelLocationResult")],Rt);const ir=Rt;function Zt(n){const i=null==n?void 0:n.time;if(i&&(null!=i.start||null!=i.end)){const e=[];null!=i.start&&e.push(i.start),null!=i.end&&-1===e.indexOf(i.end)&&e.push(i.end),n.time=e.join(",")}}function zt(n,i,e){return Ct.apply(this,arguments)}function Ct(){return(Ct=(0,W.Z)(function*(n,i,e){const t=(0,Se.en)(n),r=i.geometry?[i.geometry]:[],s=yield(0,wt.aX)(r),p=i.toJSON();Zt(p);const u=s&&s[0];(0,U.pC)(u)&&(p.geometry=u.toJSON());const c=(0,Se.cv)(Q(_e(Q({},t.query),{f:"json"}),p));return(0,Se.lA)(c,e)})).apply(this,arguments)}function Mt(){return(Mt=(0,W.Z)(function*(n,i,e){var t;const r=i.toJSON();(0,U.pC)(r.angleName)&&(r.angleName=r.angleName.join(",")),(0,U.pC)(i.point)&&null!=(t=i.point.spatialReference)&&t.imageCoordinateSystem&&(r.point.spatialReference=Ft(i.point.spatialReference)),(0,U.pC)(i.spatialReference)&&i.spatialReference.imageCoordinateSystem&&(r.spatialReference=Qt(i.spatialReference));const s=(0,Se.en)(n),p=(0,Se.cv)(Q(_e(Q({},s.query),{f:"json"}),r)),u=(0,Se.lA)(p,e),{data:c}=yield(0,Y.default)(`${s.path}/computeAngles`,u);return c.spatialReference=c.spatialReference?null!=c.spatialReference.geodataXform?new Be.Z({wkid:0,imageCoordinateSystem:c.spatialReference}):Be.Z.fromJSON(c.spatialReference):null,"NaN"===c.north&&(c.north=null),"NaN"===c.up&&(c.up=null),new $t(c)})).apply(this,arguments)}function _t(){return(_t=(0,W.Z)(function*(n,i,e){const t=i.toJSON(),{geometries:r}=i;for(let R=0;R<r.length;R++){var s;null!=(s=r[R].spatialReference)&&s.imageCoordinateSystem&&(t.geometries.geometries[R].spatialReference=Ft(r[R].spatialReference))}const p=(0,Se.en)(n),u=(0,Se.cv)(Q(_e(Q({},p.query),{f:"json"}),t)),c=(0,Se.lA)(u,e),{data:x}=yield(0,Y.default)(`${p.path}/computePixelLocation`,c);return ir.fromJSON(x)})).apply(this,arguments)}function Pt(){return(Pt=(0,W.Z)(function*(n,i,e){const t=yield zt(n,i,e),r=(0,Se.en)(n),{data:s}=yield(0,Y.default)(`${r.path}/computeStatisticsHistograms`,t),{statistics:p}=s;return null!=p&&p.length&&p.forEach(u=>{u.avg=u.mean,u.stddev=u.standardDeviation}),{statistics:p,histograms:s.histograms}})).apply(this,arguments)}function Nt(){return(Nt=(0,W.Z)(function*(n,i,e){const t=yield zt(n,i,e),r=(0,Se.en)(n),{data:s}=yield(0,Y.default)(`${r.path}/computeHistograms`,t);return{histograms:s.histograms}})).apply(this,arguments)}function Tt(){return(Tt=(0,W.Z)(function*(n,i,e){var t,r;const s=i.toJSON();Zt(s),null!=(t=s.outFields)&&t.length&&(s.outFields=s.outFields.join(","));const p=yield(0,wt.aX)(i.geometry),u=null==p?void 0:p[0];(0,U.pC)(u)&&(s.geometry=u.toJSON());const c=(0,Se.en)(n),x=(0,Se.cv)(Q(_e(Q({},c.query),{f:"json"}),s)),R=(0,Se.lA)(x,e),{data:F}=yield(0,Y.default)(`${c.path}/getSamples`,R),A=null==F||null==(r=F.samples)?void 0:r.map(Z=>{const V="NaN"===Z.value||""===Z.value?null:Z.value.split(" ").map(L=>Number(L));return _e(Q({},Z),{pixelValue:V})});return rr.fromJSON({samples:A})})).apply(this,arguments)}function Bt(n,i,e){return Ot.apply(this,arguments)}function Ot(){return(Ot=(0,W.Z)(function*(n,i,e){const t=(0,Se.en)(n),r=i.geometry?[i.geometry]:[];return(0,wt.aX)(r).then(s=>{const p=i.toJSON(),u=s&&s[0];(0,U.pC)(u)&&(p.geometry=JSON.stringify(u.toJSON()));const c=(0,Se.cv)(Q(_e(Q({},t.query),{f:"json"}),p)),x=(0,Se.lA)(c,e);return(0,Y.default)(t.path+"/identify",x)}).then(s=>er.fromJSON(s.data))})).apply(this,arguments)}function Ft(n){const{imageCoordinateSystem:i}=n;if(i){const{id:e,referenceServiceName:t}=i;return null!=e?t?{icsid:e,icsns:t}:{icsid:e}:{ics:i}}return n.toJSON()}function Qt(n,i){const e=Ft(n),{icsid:t,icsns:r,wkid:s}=e;return null!=t?null==r||null!=i&&i.toLowerCase().includes("/"+r.toLowerCase()+"/")?`0:${t}`:JSON.stringify(e):s?s.toString():JSON.stringify(e)}h(55612),h(77871),h(86398),h(39442);var Dt,ur=h(80819),dt=h(70157),pr=(h(20119),h(43245)),cr=h(38535),jt=(h(23926),h(46996),h(96545),h(35169),h(37995)),dr=h(40525),mr=h(42700);h(42187),h(39358),h(4688);let Xe=Dt=class extends P.wq{constructor(){super(...arguments),this.angleNames=null,this.point=null,this.spatialReference=null,this.rasterId=null}clone(){return new Dt((0,ue.d9)({angleNames:this.angleNames,point:this.point,spatialReference:this.spatialReference,rasterId:this.rasterId}))}};(0,o._)([(0,l.Cb)({type:[String],json:{name:"angleName",write:!0}})],Xe.prototype,"angleNames",void 0),(0,o._)([(0,l.Cb)({type:Re.Z,json:{write:!0}})],Xe.prototype,"point",void 0),(0,o._)([(0,l.Cb)({type:Be.Z,json:{write:!0}})],Xe.prototype,"spatialReference",void 0),(0,o._)([(0,l.Cb)({type:me.z8,json:{write:!0}})],Xe.prototype,"rasterId",void 0),Xe=Dt=(0,o._)([(0,he.j)("esri.rest.support.ImageAngleParameters")],Xe);const hr=Xe;var Vt,At=h(85362),mt=h(70279);let je=Vt=class extends P.wq{constructor(){super(...arguments),this.geometry=null,this.mosaicRule=null,this.renderingRule=null,this.pixelSize=null,this.raster=void 0,this.timeExtent=null}writeGeometry(n,i,e){null!=n&&(i.geometryType=(0,mt.Ji)(n),i[e]=n.toJSON())}clone(){return new Vt((0,ue.d9)({geometry:this.geometry,mosaicRule:this.mosaicRule,renderingRule:this.renderingRule,pixelSize:this.pixelSize,raster:this.raster,timeExtent:this.timeExtent}))}};(0,o._)([(0,l.Cb)({types:et.qM,json:{read:mt.im}})],je.prototype,"geometry",void 0),(0,o._)([(0,X.c)("geometry")],je.prototype,"writeGeometry",null),(0,o._)([(0,l.Cb)({type:Ce,json:{write:!0}})],je.prototype,"mosaicRule",void 0),(0,o._)([(0,l.Cb)({type:C,json:{write:!0}})],je.prototype,"renderingRule",void 0),(0,o._)([(0,l.Cb)({type:Re.Z,json:{write:!0}})],je.prototype,"pixelSize",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],je.prototype,"raster",void 0),(0,o._)([(0,l.Cb)({type:At.Z,json:{read:{source:"time"},write:{target:"time"}}})],je.prototype,"timeExtent",void 0),je=Vt=(0,o._)([(0,he.j)("esri.rest.support.ImageHistogramParameters")],je);const Ht=je;var Jt;let de=Jt=class extends P.wq{constructor(){super(...arguments),this.geometry=null,this.renderingRules=null,this.pixelSize=null,this.returnGeometry=!0,this.returnCatalogItems=!0,this.returnPixelValues=!0,this.maxItemCount=null,this.timeExtent=null,this.raster=void 0,this.viewId=void 0}writeGeometry(n,i,e){null!=n&&(i.geometryType=(0,mt.Ji)(n),i[e]=JSON.stringify(n.toJSON()))}set mosaicRule(n){let i=n;i&&i.mosaicMethod&&(i=Ce.fromJSON(_e(Q({},i.toJSON()),{mosaicMethod:i.mosaicMethod,mosaicOperation:i.mosaicOperation}))),this._set("mosaicRule",i)}writeMosaicRule(n,i,e){null!=n&&(i[e]=JSON.stringify(n.toJSON()))}set renderingRule(n){let i=n;i&&i.rasterFunction&&(i=C.fromJSON(_e(Q({},i.toJSON()),{rasterFunction:i.rasterFunction,rasterFunctionArguments:i.rasterFunctionArguments}))),this._set("renderingRule",i)}writeRenderingRule(n,i,e){null!=n&&(i[e]=JSON.stringify(n.toJSON()))}writeRenderingRules(n,i,e){null!=n&&(i[e]=JSON.stringify(n.map(t=>t.toJSON())))}writePixelSize(n,i,e){null!=n&&(i[e]=JSON.stringify(n))}writeTimeExtent(n,i,e){if(null!=n){const t=(0,U.pC)(n.start)?n.start.getTime():null,r=(0,U.pC)(n.end)?n.end.getTime():null;i[e]=null!=t?null!=r?`${t},${r}`:`${t}`:null}}clone(){return new Jt((0,ue.d9)({geometry:this.geometry,mosaicRule:this.mosaicRule,renderingRule:this.renderingRule,pixelSize:this.pixelSize,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,returnPixelValues:this.returnPixelValues,maxItemCount:this.maxItemCount,raster:this.raster,viewId:this.viewId,timeExtent:this.timeExtent}))}};(0,o._)([(0,l.Cb)({json:{write:!0}})],de.prototype,"geometry",void 0),(0,o._)([(0,X.c)("geometry")],de.prototype,"writeGeometry",null),(0,o._)([(0,l.Cb)({type:Ce,json:{write:!0}})],de.prototype,"mosaicRule",null),(0,o._)([(0,X.c)("mosaicRule")],de.prototype,"writeMosaicRule",null),(0,o._)([(0,l.Cb)({type:C,json:{write:!0}})],de.prototype,"renderingRule",null),(0,o._)([(0,X.c)("renderingRule")],de.prototype,"writeRenderingRule",null),(0,o._)([(0,l.Cb)({type:[C],json:{write:!0}})],de.prototype,"renderingRules",void 0),(0,o._)([(0,X.c)("renderingRules")],de.prototype,"writeRenderingRules",null),(0,o._)([(0,l.Cb)({type:Re.Z,json:{write:!0}})],de.prototype,"pixelSize",void 0),(0,o._)([(0,X.c)("pixelSize")],de.prototype,"writePixelSize",null),(0,o._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],de.prototype,"returnGeometry",void 0),(0,o._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],de.prototype,"returnCatalogItems",void 0),(0,o._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],de.prototype,"returnPixelValues",void 0),(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],de.prototype,"maxItemCount",void 0),(0,o._)([(0,l.Cb)({type:At.Z,json:{write:{target:"time"}}})],de.prototype,"timeExtent",void 0),(0,o._)([(0,X.c)("timeExtent")],de.prototype,"writeTimeExtent",null),(0,o._)([(0,l.Cb)({json:{write:!0}})],de.prototype,"raster",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],de.prototype,"viewId",void 0),de=Jt=(0,o._)([(0,he.j)("esri.rest.support.ImageIdentifyParameters")],de);const Gt=de;var Et;let rt=Et=class extends P.wq{constructor(){super(...arguments),this.geometries=null,this.rasterId=null}writeGeometry(n,i,e){i.geometries={geometryType:"esriGeometryPoint",geometries:n.map(t=>t.toJSON())}}clone(){return new Et({geometries:this.geometries.map(n=>n.clone()),rasterId:this.rasterId})}};(0,o._)([(0,l.Cb)({type:[Re.Z],json:{write:!0}})],rt.prototype,"geometries",void 0),(0,o._)([(0,X.c)("geometries")],rt.prototype,"writeGeometry",null),(0,o._)([(0,l.Cb)({type:me.z8,json:{write:!0}})],rt.prototype,"rasterId",void 0),rt=Et=(0,o._)([(0,he.j)("esri.rest.support.ImagePixelLocationParameters")],rt);const fr=rt;var Lt;let we=Lt=class extends P.wq{constructor(){super(...arguments),this.geometry=null,this.interpolation="nearest",this.mosaicRule=null,this.outFields=null,this.pixelSize=null,this.returnFirstValueOnly=!0,this.sampleDistance=null,this.sampleCount=null,this.sliceId=null,this.timeExtent=null}writeGeometry(n,i,e){null!=n&&(i.geometryType=(0,mt.Ji)(n),i[e]=n.toJSON())}set locations(n){if(null!=n&&n.length){const i=new pr.Z({spatialReference:n[0].spatialReference});i.points=n.map(e=>[e.x,e.y]),this._set("locations",n),this.geometry=i}}clone(){return new Lt((0,ue.d9)({geometry:this.geometry,locations:this.locations,interpolation:this.interpolation,mosaicRule:this.mosaicRule,outFields:this.outFields,raster:this.raster,returnFirstValueOnly:this.returnFirstValueOnly,sampleDistance:this.sampleDistance,sampleCount:this.sampleCount,sliceId:this.sliceId,pixelSize:this.pixelSize,timeExtent:this.timeExtent}))}};(0,o._)([(0,l.Cb)({types:et.qM,json:{read:mt.im}})],we.prototype,"geometry",void 0),(0,o._)([(0,X.c)("geometry")],we.prototype,"writeGeometry",null),(0,o._)([(0,l.Cb)({type:String,json:{type:be.c.jsonValues,read:be.c.read,write:be.c.write}})],we.prototype,"interpolation",void 0),(0,o._)([(0,l.Cb)({type:Ce,json:{write:!0}})],we.prototype,"mosaicRule",void 0),(0,o._)([(0,l.Cb)({type:[String],json:{write:!0}})],we.prototype,"outFields",void 0),(0,o._)([(0,l.Cb)({type:Re.Z,json:{write:!0}})],we.prototype,"pixelSize",void 0),(0,o._)([(0,l.Cb)({type:String,json:{write:!0}})],we.prototype,"raster",void 0),(0,o._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],we.prototype,"returnFirstValueOnly",void 0),(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],we.prototype,"sampleDistance",void 0),(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],we.prototype,"sampleCount",void 0),(0,o._)([(0,l.Cb)({type:Number,json:{write:!0}})],we.prototype,"sliceId",void 0),(0,o._)([(0,l.Cb)({type:At.Z,json:{read:{source:"time"},write:{target:"time"}}})],we.prototype,"timeExtent",void 0),we=Lt=(0,o._)([(0,he.j)("esri.rest.support.ImageSampleParameters")],we);const yr=we;var gr=h(62013);const Wt=at.Z.getLogger("esri.layers.mixins.ArcGISImageService"),Ut=(0,pe.wY)()({U1:"u1",U2:"u2",U4:"u4",U8:"u8",S8:"s8",U16:"u16",S16:"s16",U32:"u32",S32:"s32",F32:"f32",F64:"f64",C64:"c64",C128:"c128",UNKNOWN:"unknown"}),vr=new Set(["png","png8","png24","png32","jpg","bmp","gif","jpgpng","lerc","tiff"]),Rr=(0,l.Eg)(me.q9,{min:0,max:255});const br=n=>{let i=class extends n{constructor(){super(...arguments),this._functionRasterInfos={},this._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},this._symbolizer=null,this._defaultServiceMosaicRule=null,this._serviceSourceType=null,this._serviceSupportsMosaicRule=null,this.rasterAttributeTableFieldPrefix="Raster.",this.adjustAspectRatio=null,this.bandCount=null,this.bandIds=void 0,this.capabilities=null,this.compressionQuality=void 0,this.compressionTolerance=.01,this.copyright=null,this.definitionExpression=null,this.exportImageServiceParameters=null,this.rasterInfo=null,this.fields=null,this.fullExtent=null,this.hasMultidimensions=!1,this.imageMaxHeight=4100,this.imageMaxWidth=4100,this.interpolation=void 0,this.minScale=0,this.maxScale=0,this.multidimensionalInfo=null,this.noData=null,this.noDataInterpretation=void 0,this.objectIdField=null,this.geometryType="polygon",this.typeIdField=null,this.types=[],this.pixelSizeX=null,this.pixelSizeY=null,this.pixelFilter=null,this.raster=void 0,this.viewId=void 0,this.renderer=null,this.rasterAttributeTable=null,this.rasterFunctionInfos=null,this.serviceDataType=null,this.spatialReference=null,this.pixelType=null,this.serviceRasterInfo=null,this.sourceJSON=null,this.url=null,this.version=null}initialize(){this._set("exportImageServiceParameters",new le({layer:this}))}readDefaultServiceMosaicRule(e,t){return this._serviceSupportsMosaicRule?Ce.fromJSON(t):null}readServiceSourceType(e,t){return this._isMosaicDataset(t)?"mosaic-dataset":"raster-dataset"}readServiceSupportsMosaicRule(e,t){return this._isMosaicRuleSupported(t)}get rasterFunctionNamesIndex(){const e=new Map;return!this.rasterFunctionInfos||(0,U.pC)(this.rasterFunctionInfos)&&this.rasterFunctionInfos.length<1||(0,U.pC)(this.rasterFunctionInfos)&&this.rasterFunctionInfos.forEach(t=>{e.set(t.name.toLowerCase().replace(/ /gi,"_"),t.name)}),e}readBandIds(e,t){if(Array.isArray(e)&&e.length>0&&e.every(r=>"number"==typeof r))return e}readCapabilities(e,t){return this._readCapabilities(t)}writeCompressionQuality(e,t,r){null!=e&&"lerc"!==this.format&&(t[r]=e)}writeCompressionTolerance(e,t,r){"lerc"===this.format&&null!=e&&(t[r]=e)}get fieldsIndex(){return this.fields?new lt.Z(this.fields):null}set format(e){e&&vr.has(e.toLowerCase())&&this._set("format",e.toLowerCase())}readFormat(e,t){return"esriImageServiceDataTypeVector-UV"===t.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===t.serviceDataType||null!=this.pixelFilter?"lerc":"jpgpng"}readMinScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}readMaxScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}set mosaicRule(e){let t=e;t&&t.mosaicMethod&&(t=Ce.fromJSON(_e(Q({},t.toJSON()),{mosaicMethod:t.mosaicMethod,mosaicOperation:t.mosaicOperation}))),this._set("mosaicRule",t)}readMosaicRule(e,t){const r=e||t.mosaicRule;return r?Ce.fromJSON(r):this._isMosaicRuleSupported(t)?Ce.fromJSON(t):null}writeMosaicRule(e,t,r){let s=this.mosaicRule;const p=this.definitionExpression;s?p&&p!==s.where&&(s=s.clone(),s.where=p):p&&(s=new Ce({where:p})),this._isValidCustomizedMosaicRule(s)&&(t[r]=s.toJSON())}writeNoData(e,t,r){null!=e&&"number"==typeof e&&(t[r]=Rr(e))}readObjectIdField(e,t){if(!e){const r=t.fields.filter(s=>"esriFieldTypeOID"===s.type||"oid"===s.type);e=r&&r[0]&&r[0].name}return e}get parsedUrl(){return this.url?(0,Ke.mN)(this.url):null}readRenderer(e,t,r){var s,p;const u=null==t||null==(s=t.layerDefinition)||null==(p=s.drawingInfo)?void 0:p.renderer,c=(0,Ae.ij)(u,r);return null==c?null:("vector-field"===c.type&&t.symbolTileSize&&!u.symbolTileSize&&(c.symbolTileSize=t.symbolTileSize),z(c)||Wt.warn("ArcGISImageService","Imagery layer doesn't support given renderer type."),c)}writeRenderer(e,t,r){t.layerDefinition=t.layerDefinition||{},t.layerDefinition.drawingInfo=t.layerDefinition.drawingInfo||{},t.layerDefinition.drawingInfo.renderer=e.toJSON(),"vector-field"===e.type&&(t.symbolTileSize=e.symbolTileSize)}get rasterFields(){const e=this.rasterAttributeTableFieldPrefix||"Raster.",t=new Fe.Z({name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"string"}),r=new Fe.Z({name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"string"}),s=new Fe.Z({name:"Raster.ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"string"});let p=this.fields?(0,ue.d9)(this.fields):[];p.push(r),this.capabilities.operations.supportsQuery&&this.fields&&this.fields.length>0&&p.push(t),this.version>=10.4&&(0,U.pC)(this.rasterFunctionInfos)&&this.rasterFunctionInfos.some(c=>"none"===c.name.toLowerCase())&&p.push(s),(0,U.pC)(this.rasterFunctionInfos)&&this.rasterFunctionInfos.filter(c=>"none"!==c.name.toLowerCase()).forEach(c=>{p.push(new Fe.Z({name:"Raster.ServicePixelValue."+c.name,alias:c.name,domain:null,editable:!1,length:50,type:"string"}))}),null==this.pixelFilter||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(p.push(new Fe.Z({name:"Raster.Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"double"})),p.push(new Fe.Z({name:"Raster.Direction",alias:"Direction",domain:null,editable:!1,type:"double"})));const u=this.rasterInfo.attributeTable&&this.rasterInfo.attributeTable.fields||null;if(u&&u.length>0){const c=u.filter(x=>"esriFieldTypeOID"!==x.type&&"value"!==x.name.toLowerCase()).map(x=>{const R=(0,ue.d9)(x);return R.name=e+x.name,R});p=p.concat(c)}return p}set renderingRule(e){let t=e;t&&t.rasterFunction&&(t=C.fromJSON(_e(Q({},t.toJSON()),{rasterFunction:t.rasterFunction,rasterFunctionArguments:t.rasterFunctionArguments}))),this._set("renderingRule",t)}readRenderingRule(e,t){const r=t.rasterFunctionInfos;return t.renderingRule||r&&r.length&&"None"!==r[0].name?C.fromJSON(t.renderingRule||{rasterFunctionInfos:t.rasterFunctionInfos}):null}writeRenderingRule(e,t,r){this._isRFTJson(e)||(t[r]=e.toJSON())}readSpatialReference(e,t){const r=e||t.extent.spatialReference;return r?Be.Z.fromJSON(r):null}readPixelType(e){return Ut.fromJSON(e)||e}writePixelType(e,t,r){((0,U.Wi)(this.serviceRasterInfo)||this.pixelType!==this.serviceRasterInfo.pixelType)&&(t[r]=Ut.toJSON(e))}readVersion(e,t){let r=t.currentVersion;return r||(r=t.hasOwnProperty("fields")||t.hasOwnProperty("timeInfo")?10:9.3),r}applyFilter(e){let t=e;return this.pixelFilter&&(t=this._clonePixelData(e),this.pixelFilter(t)),t}applyRenderer(e,t){var r=this;return(0,W.Z)(function*(){let s=e;if(!r._isPicture()&&r.renderer&&r._symbolizer&&!r.pixelFilter){const p=JSON.stringify(r._cachedRendererJson)!==JSON.stringify(r.renderer.toJSON()),u=r._rasterJobHandler.instance,{bandIds:c}=r;if(u){p&&(r._symbolizer.bind(),yield u.updateSymbolizer(r._symbolizer,t),r._cachedRendererJson=r.renderer.toJSON());const x=yield u.symbolize(Q({bandIds:c},e),t);s={extent:e.extent,pixelBlock:x}}else s={extent:e.extent,pixelBlock:r._symbolizer.symbolize(Q({bandIds:c},e))}}return s})()}destroy(){this._shutdownJobHandler()}increaseRasterJobHandlerUsage(){this._rasterJobHandler.refCount++}decreaseRasterJobHandlerUsage(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()}computeAngles(e,t){var r=this;return(0,W.Z)(function*(){if(yield r._fetchCapabilities(null==t?void 0:t.signal),!r.capabilities.operations.supportsComputeAngles)throw new ge.Z("imagery-layer:compute-angles","this operation is not supported on the input image service");return e=(0,me.TJ)(hr,e).clone(),function(n,i,e){return Mt.apply(this,arguments)}(r.url,e,r._getRequestOptions(t))})()}computePixelSpaceLocations(e,t){var r=this;return(0,W.Z)(function*(){if(yield r._fetchCapabilities(null==t?void 0:t.signal),!r.capabilities.operations.supportsComputePixelLocation)throw new ge.Z("imagery-layer:compute-pixel-space-locations","this operation is not supported on the input image service");return e=(0,me.TJ)(fr,e).clone(),function(n,i,e){return _t.apply(this,arguments)}(r.url,e,r._getRequestOptions(t))})()}computeHistograms(e,t){var r=this;return(0,W.Z)(function*(){if(yield r._fetchCapabilities(null==t?void 0:t.signal),!r.capabilities.operations.supportsComputeHistograms)throw new ge.Z("imagery-layer:compute-histograms","this operation is not supported on the input image service");e=(0,me.TJ)(Ht,e).clone();const{raster:s,mosaicRule:p,renderingRule:u}=r;return u&&null==e.renderingRule&&(e.renderingRule=u),p&&null==e.mosaicRule&&(e.mosaicRule=p),s&&null==e.raster&&(e.raster=s),function(n,i,e){return Nt.apply(this,arguments)}(r.url,e,r._getRequestOptions(t))})()}computeStatisticsHistograms(e,t){var r=this;return(0,W.Z)(function*(){if(yield r._fetchCapabilities(null==t?void 0:t.signal),!r.capabilities.operations.supportsComputeStatisticsHistograms)throw new ge.Z("imagery-layer:compute-statistics-histograms","this operation is not supported on the input image service");e=(0,me.TJ)(Ht,e).clone();const{raster:s,mosaicRule:p,renderingRule:u}=r;return u&&null==e.renderingRule&&(e.renderingRule=u),p&&null==e.mosaicRule&&(e.mosaicRule=p),s&&null==e.raster&&(e.raster=s),function(n,i,e){return Pt.apply(this,arguments)}(r.url,e,r._getRequestOptions(t))})()}getField(e){const{fieldsIndex:t}=this;return(0,U.pC)(t)?t.get(e):void 0}getFieldDomain(e,t){const r=this.getField(e);return r?r.domain:null}fetchImage(e,t,r,s={}){if(null==e||null==t||null==r)return Promise.reject(new ge.Z("imagery-layer:fetch-image","Insufficient parameters for requesting an image. A valid extent, width and height values are required."));const p=this.renderer||this._symbolizer?this.generateRasterInfo(this.renderingRule,{signal:s.signal}):null;return(0,Ie.gx)(p).then(u=>{u&&(this.rasterInfo=u);const c={imageServiceParameters:this.getExportImageServiceParameters(e,t,r,s.timeExtent),imageProps:{extent:e,width:t,height:r,format:this.format},requestAsImageElement:s.requestAsImageElement&&!this.pixelFilter||!1,signal:s.signal};return this._requestArrayBuffer(c)})}fetchKeyProperties(e){const t=e&&e.renderingRule&&e.renderingRule.toJSON();return(0,Y.default)(this.parsedUrl.path+"/keyProperties",{query:this._getQueryParams({renderingRule:this.version>=10.3&&t?JSON.stringify(t):null})}).then(r=>r.data)}fetchRasterAttributeTable(e){const t=e&&e.renderingRule&&e.renderingRule.toJSON();return this.version<10.1?Promise.reject(new ge.Z("#fetchRasterAttributeTable()","Failed to get rasterAttributeTable")):(0,Y.default)(this.parsedUrl.path+"/rasterAttributeTable",{query:this._getQueryParams({renderingRule:this.version>=10.3&&t?JSON.stringify(t):null})}).then(r=>It.default.fromJSON(r.data))}getCatalogItemRasterInfo(e,t){var r=this;return(0,W.Z)(function*(){const s=(0,Y.default)(r.parsedUrl.path+"/"+e+"/info",Q({query:r._getQueryParams()},t)).then(R=>R.data),p=(0,Y.default)(r.parsedUrl.path+"/"+e+"/info/keyProperties",Q({query:r._getQueryParams()},t)).then(R=>R.data).catch(()=>{}),u=yield Promise.all([s,p]);if(!u[0])return;const c=dt.Z.fromJSON(u[0].extent),x=u[0].statistics?u[0].statistics.map(R=>({min:R[0],max:R[1],avg:R[2],stddev:R[3]})):null;return new qe.Z({bandCount:u[0].bandCount,extent:c,spatialReference:c.sr,pixelSize:new Re.Z({x:u[0].pixelSizeX,y:u[0].pixelSizeY,spatialReference:c.sr}),pixelType:u[0].pixelType.toLowerCase(),statistics:x,histograms:u[0].histograms,keyProperties:u[1]||{}})})()}getCatalogItemICSInfo(e,t){var r=this;return(0,W.Z)(function*(){const{data:s}=yield(0,Y.default)(r.parsedUrl.path+"/"+e+"/info/ics",Q({query:r._getQueryParams()},t)),p=s&&s.ics;if(!p)return;let u=null;try{u=(yield(0,Y.default)(r.parsedUrl.path+"/"+e+"/info",Q({query:r._getQueryParams()},t))).data.extent}catch(te){}if(!u||!u.spatialReference)return{ics:p,icsToPixelTransform:null,icsExtent:null,northDirection:null};const c=r.version>=10.7?(0,Y.default)(r.parsedUrl.path+"/"+e+"/info/icstopixel",Q({query:r._getQueryParams()},t)).then(te=>te.data).catch(()=>({})):{},x=u.spatialReference,R={geometries:JSON.stringify({geometryType:"esriGeometryEnvelope",geometries:[u]}),inSR:x.wkid||JSON.stringify(x),outSR:"0:"+e},F=(0,Y.default)(r.parsedUrl.path+"/project",Q({query:r._getQueryParams(R)},t)).then(te=>te.data).catch(()=>({})),Z=(u.xmin+u.xmax)/2,V=(u.ymax-u.ymin)/6,L=u.ymin+V,B=[];for(let te=0;te<5;te++)B.push({x:Z,y:L+V*te});const Ue={geometries:JSON.stringify({geometryType:"esriGeometryPoint",geometries:B}),inSR:x.wkid||JSON.stringify(x),outSR:"0:"+e},xe=(0,Y.default)(r.parsedUrl.path+"/project",Q({query:r._getQueryParams(Ue)},t)).then(te=>te.data).catch(()=>({})),oe=yield Promise.all([c,F,xe]);let ee=oe[0].ipxf;if(null==ee){var Oe,Qe,xt;const te=null==(Oe=p.geodataXform)?void 0:Oe.xf_0;"topup"===(null==te||null==(Qe=te.name)?void 0:Qe.toLowerCase())&&6===(null==te||null==(xt=te.coefficients)?void 0:xt.length)&&(ee={affine:{name:"ics [sensor: Frame] to pixel (column, row) transformation",coefficients:te.coefficients,cellsizeRatio:0,type:"GeometricXform"}})}const Ze=dt.Z.fromJSON(oe[1]&&oe[1].geometries&&oe[1].geometries[0]);Ze&&(Ze.spatialReference=new Be.Z({wkid:0,imageCoordinateSystem:p}));const Me=oe[2].geometries?oe[2].geometries.filter(te=>null!=te&&null!=te.x&&null!=te.y&&"NaN"!==te.x&&"NaN"!==te.y):[],it=Me.length;if(it<3)return{ics:p,icsToPixelTransform:ee,icsExtent:Ze,northDirection:null};let nt=0,De=0,ht=0,st=0;for(let te=0;te<it;te++)nt+=Me[te].x,De+=Me[te].y,ht+=Me[te].x*Me[te].x,st+=Me[te].x*Me[te].y;const He=(it*st-nt*De)/(it*ht-nt*nt);let ft=0;const Kt=Me[4].x>Me[0].x,kt=Me[4].y>Me[0].y;return He===1/0?ft=kt?90:270:0===He?ft=Kt?0:180:He>0?ft=Kt?180*Math.atan(He)/Math.PI:180*Math.atan(He)/Math.PI+180:He<0&&(ft=kt?180+180*Math.atan(He)/Math.PI:360+180*Math.atan(He)/Math.PI),{ics:p,icsToPixelTransform:ee,icsExtent:Ze,northDirection:ft}})()}generateRasterInfo(e,t){var r=this;return(0,W.Z)(function*(){if((!e||"none"===e.functionName.toLowerCase()||r._isVectorFieldResampleFunction(e))&&(0,U.pC)(r.serviceRasterInfo))return r.serviceRasterInfo;const s=function(n){if(!n)return null;const i=JSON.stringify(n).match(/"rasterFunction":"(.*?")/gi),e=null==i?void 0:i.map(t=>t.replace('"rasterFunction":"',"").replace('"',""));return e?e.join("/"):null}(e);if(r._functionRasterInfos[s])return r._functionRasterInfos[s];const p=r._generateRasterInfo(e,t);r._functionRasterInfos[s]=p;try{return yield p}catch(u){return r._functionRasterInfos[s]=null,null}})()}getExportImageServiceParameters(e,t,r,s){const p=Qt((e=e.clone().shiftCentralMeridian()).spatialReference,this.parsedUrl.path);(0,U.pC)(this.serviceRasterInfo)&&this.pixelType!==this.serviceRasterInfo.pixelType&&(this.exportImageServiceParameters.pixelType=this.pixelType);const u=this.exportImageServiceParameters.toJSON(),{bandIds:c,noData:x}=u;let{renderingRule:R}=u;const F=this.renderingRule&&"none"!==this.renderingRule.functionName.toLowerCase(),A=!this.renderer||"raster-stretch"===this.renderer.type;if(null!=c&&c.length&&F&&A){const L={rasterFunction:"ExtractBand",rasterFunctionArguments:{BandIds:c}};if("Stretch"===R.rasterFunction)L.rasterFunctionArguments.Raster=R.rasterFunctionArguments.Raster,R.rasterFunctionArguments.Raster=L;else if("Colormap"===R.rasterFunction){const B=R.rasterFunctionArguments.Raster;"Stretch"===(null==B?void 0:B.rasterFunction)?(L.rasterFunctionArguments.Raster=B.rasterFunctionArguments.Raster,B.rasterFunctionArguments.Raster=L):(L.rasterFunctionArguments.Raster=B,R.rasterFunctionArguments.Raster=L)}else L.rasterFunctionArguments.Raster=R,R=L;u.bandIds=void 0}else u.bandIds=null==c?void 0:c.join(",");x instanceof Array&&x.length>0&&(u.noData=x.join(","));const Z=this._serviceSupportsMosaicRule?this._combineMosaicRuleWithTimeExtent(this.exportImageServiceParameters.mosaicRule,s):null;u.mosaicRule=Z&&JSON.stringify(Z),u.renderingRule=R&&JSON.stringify(R);const V={};if(s){const{start:L,end:B}=s.toJSON();L&&B&&L===B?V.time=""+L:null==L&&null==B||(V.time=`${null==L?"null":L},${null==B?"null":B}`)}return Q(Q({bbox:e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:p,imageSR:p,size:t+","+r},u),V)}getSamples(e,t){var r=this;return(0,W.Z)(function*(){if(yield r._fetchCapabilities(null==t?void 0:t.signal),!r.capabilities.operations.supportsGetSamples)throw new ge.Z("imagery-layer:get-samples","getSamples operation is not supported on the input image service");e=(0,me.TJ)(yr,e).clone();const{raster:s}=r;return s&&null==e.raster&&(e.raster=s),function(n,i,e){return Tt.apply(this,arguments)}(r.url,e,r._getRequestOptions(t))})()}identify(e,t){var r=this;return(0,W.Z)(function*(){if(yield r._fetchCapabilities(null==t?void 0:t.signal),!r.capabilities.operations.supportsIdentify)throw new ge.Z("imagery-layer:query-rasters","query operation is not supported on the input image service");e=(0,me.TJ)(Gt,e).clone();const{raster:s,mosaicRule:p,renderingRule:u}=r;if(u&&null==e.renderingRule&&(e.renderingRule=u),p&&null==e.mosaicRule){const c=r._combineMosaicRuleWithTimeExtent(p,e.timeExtent);e.mosaicRule=(0,U.Wg)(c)}return s&&null==e.raster&&(e.raster=s),Bt(r.url,e,r._getRequestOptions(t))})()}createQuery(){const e=new jt.Z;return e.outFields=["*"],e.returnGeometry=!0,e.where=this.definitionExpression||"1=1",e}queryRasters(e,t){var r=this;return(0,W.Z)(function*(){return({query:e,requestOptions:t}=yield r._prepareForQuery(e,t)),(0,mr.e)(r.url,e,t)})()}queryObjectIds(e,t){var r=this;return(0,W.Z)(function*(){return({query:e,requestOptions:t}=yield r._prepareForQuery(e,t)),(0,dr.G)(r.url,e,t)})()}queryRasterCount(e,t){var r=this;return(0,W.Z)(function*(){return({query:e,requestOptions:t}=yield r._prepareForQuery(e,t)),(0,ur.P)(r.url,e,t)})()}queryVisibleRasters(e,t){if(!e)return Promise.reject(new ge.Z("imagery-layer: query-visible-rasters","missing query parameter"));const{pixelSize:r,returnDomainValues:s,returnTopmostRaster:p,showNoDataRecords:u}=t||{pixelSize:null,returnDomainValues:!1,returnTopmostRaster:!1,showNoDataRecords:!1};let c=!1,x=null,R=null;const F="raster.servicepixelvalue",A=this.rasterFunctionNamesIndex;if((0,U.pC)(e.outFields)&&(c=e.outFields.some(oe=>-1===oe.toLowerCase().indexOf(F)),this.version>=10.4)){const oe=e.outFields.filter(ee=>ee.toLowerCase().indexOf(F)>-1&&ee.length>F.length).map(ee=>{const Oe=ee.slice(F.length+1);return[this._updateRenderingRulesFunctionName(Oe,A),Oe]});x=oe.map(ee=>new C({functionName:ee[0]})),R=oe.map(ee=>ee[1]),0===x.length?this.renderingRule?(x.push(this.renderingRule),R.push(this.renderingRule.functionName)):x=null:this.renderingRule&&!x.some(ee=>ee.functionName===this.renderingRule.functionName)&&(x.push(this.renderingRule),R.push(this.renderingRule.functionName))}const Z=(0,U.Wi)(e.outSpatialReference)||e.outSpatialReference.equals(this.spatialReference),V=e.timeExtent||this.timeExtent,L=this._combineMosaicRuleWithTimeExtent(this.exportImageServiceParameters.mosaicRule,V),B=this._getQueryParams({geometry:e.geometry,timeExtent:V,mosaicRule:L,renderingRule:this.version<10.4?this.renderingRule:null,renderingRules:x,pixelSize:r,returnCatalogItems:c,returnGeometry:Z,raster:this.raster,maxItemCount:p?1:null});delete B.f;const Ue=new Gt(B),xe=this.generateRasterInfo(this.renderingRule);return new Promise(oe=>{xe.then(()=>{Bt(this.url,Ue,{signal:null==t?void 0:t.signal,query:Q({},this.customParameters)}).then(ee=>{var Oe;const Qe=e.outFields,xt=ee.value.toLowerCase().indexOf("nodata")>-1;if(c&&!Z&&null!=ee&&null!=(Oe=ee.catalogItems)&&Oe.features.length&&(u||!xt)){const Ze=this.objectIdField||"ObjectId",Me=ee.catalogItems.features,it=Me.map(De=>De.attributes&&De.attributes[Ze]),nt=new jt.Z({objectIds:it,returnGeometry:!0,outSpatialReference:e.outSpatialReference,outFields:[Ze]});return this.queryRasters(nt).then(De=>{De&&De.features&&De.features.length>0&&De.features.forEach(ht=>{Me.forEach(st=>{st.attributes[Ze]===ht.attributes[Ze]&&(st.geometry=new cr.Z(ht.geometry),st.geometry.spatialReference=e.outSpatialReference)})}),oe(this._processVisibleRastersResponse(ee,{returnDomainValues:s,templateRRFunctionNames:R,showNoDataRecords:u,templateFields:Qe}))}).catch(()=>{throw new ge.Z("imagery-layer:query-visible-rasters","encountered error when querying visible rasters geometry")})}oe(this._processVisibleRastersResponse(ee,{returnDomainValues:s,templateRRFunctionNames:R,showNoDataRecords:u,templateFields:Qe}))}).catch(()=>{throw new ge.Z("imagery-layer:query-visible-rasters","encountered error when querying visible rasters")})})})}fetchVariableStatisticsHistograms(e,t){var r=this;return(0,W.Z)(function*(){const s=(0,Y.default)(r.parsedUrl.path+"/statistics",{query:r._getQueryParams({variable:e}),signal:t}).then(c=>{var x;return null==(x=c.data)?void 0:x.statistics}),p=(0,Y.default)(r.parsedUrl.path+"/histograms",{query:r._getQueryParams({variable:e}),signal:t}).then(c=>{var x;return null==(x=c.data)?void 0:x.histograms}),u=yield Promise.all([s,p]);return u[0]&&u[0].forEach(c=>{c.avg=c.mean,c.stddev=c.standardDeviation}),{statistics:u[0]||null,histograms:u[1]||null}})()}createStreamlinesMesh(e,t){var r=this;return(0,W.Z)(function*(){const s=r._rasterJobHandler.instance;return s?s.createStreamlinesMesh(e,t):(0,gr.z_)(e.rendererSettings,e.flowData,(0,U.pC)(t.signal)?t.signal:(new AbortController).signal)})()}_fetchService(e){var t=this;return(0,W.Z)(function*(){yield t._fetchServiceInfo(e),(0,U.pC)(t.serviceRasterInfo)&&!t.rasterInfo&&(t.rasterInfo=t.serviceRasterInfo);const r=t.sourceJSON,s=(0,U.pC)(t.serviceRasterInfo)?Promise.resolve(t.serviceRasterInfo):t._fetchAuxiliaryRasterInfo({serviceInfo:r,signal:e}).then(c=>(t._set("serviceRasterInfo",c),c)),p=t.renderingRule&&"none"!==t.renderingRule.functionName.toLowerCase()?t.generateRasterInfo(t.renderingRule,{signal:e}):null,u=t._getRasterFunctionInfos();return Promise.all([s,p,u]).then(c=>{c[1]?t._set("rasterInfo",c[1]):t._set("rasterInfo",c[0]),c[2]&&t._set("rasterFunctionInfos",c[2]),t.renderer&&!t._isSupportedRenderer(t.renderer)&&(t.renderer=null,Wt.warn("ArcGISImageService","Switching to the default renderer. Renderer applied is not valid for this Imagery Layer")),t._configDefaultRenderer(),t.watch("renderer",()=>t._configDefaultRenderer()),t.watch("renderingRule",R=>{(t.renderer||t._symbolizer||t.popupEnabled&&t.popupTemplate)&&t.generateRasterInfo(R).then(F=>{F&&(t.rasterInfo=F)})});const x=(0,U.pC)(t.serviceRasterInfo)&&t.serviceRasterInfo.multidimensionalInfo;x&&t._updateMultidimensionalDefinition(x)})})()}_combineMosaicRuleWithTimeExtent(e,t){const r=this.timeInfo;if((0,U.Wi)(e)||(0,U.Wi)(this.multidimensionalInfo)||(0,U.Wi)(t)||(0,U.Wi)(null==r?void 0:r.startField))return e;const{startField:s}=r;var p;if(e=e.clone(),"mosaic-dataset"===this._serviceSourceType)return e.multidimensionalDefinition=null==(p=e.multidimensionalDefinition)?void 0:p.filter(Z=>Z.dimensionName!==s),this._cleanupMultidimensionalDefinition(e);e.multidimensionalDefinition=e.multidimensionalDefinition||[];const u=e.multidimensionalDefinition.filter(Z=>Z.dimensionName===s),c=(0,U.pC)(t.start)?t.start.getTime():null,x=(0,U.pC)(t.end)?t.end.getTime():null,R=null==c||null==x||c===x,F=R?[c||x]:[[c,x]],A=this.version>=10.8;if(u.length)u.forEach(Z=>{Z.dimensionName===s&&(A?(Z.dimensionName=null,Z.isSlice=null,Z.values=null):(Z.isSlice=R,Z.values=F))});else if(!A){const Z=e.multidimensionalDefinition.filter(V=>null!=V.variableName&&null==V.dimensionName);Z.length?Z.forEach(V=>{V.dimensionName=s,V.isSlice=R,V.values=F}):e.multidimensionalDefinition.push(new _.Z({variableName:"",dimensionName:s,isSlice:R,values:F}))}return this._cleanupMultidimensionalDefinition(e)}_cleanupMultidimensionalDefinition(e){return(0,U.Wi)(e)?null:(e.multidimensionalDefinition&&(e.multidimensionalDefinition=e.multidimensionalDefinition.filter(t=>!(!t.variableName&&!t.dimensionName)),0===e.multidimensionalDefinition.length&&(e.multidimensionalDefinition=null)),"mosaic-dataset"!==this._serviceSourceType&&null==e.multidimensionalDefinition?null:e)}_prepareForQuery(e,t){var r=this;return(0,W.Z)(function*(){var s;if(yield r._fetchCapabilities(null==(s=t)?void 0:s.signal),!r.capabilities.operations.supportsQuery)throw new ge.Z("imagery-layer:query-rasters","query operation is not supported on the input image service");return e=(0,U.pC)(e)?(0,me.TJ)(jt.Z,e):r.createQuery(),t=r._getRequestOptions(t),r.raster&&(t.query=_e(Q({},t.query),{raster:r.raster})),{query:e,requestOptions:t}})()}_initJobHandler(){var e=this;return(0,W.Z)(function*(){if(null!=e._rasterJobHandler.connectionPromise)return e._rasterJobHandler.connectionPromise;const t=new pt.Z;e._rasterJobHandler.connectionPromise=t.initialize().then(()=>{e._rasterJobHandler.instance=t},()=>null),yield e._rasterJobHandler.connectionPromise})()}_shutdownJobHandler(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0}_isSupportedRenderer(e){const{rasterInfo:t,renderingRule:r}=this;return"unique-value"===e.type&&r&&"none"!==r.functionName.toLowerCase()&&1===t.bandCount&&["u8","s8"].includes(t.pixelType)||(0,gt.U0)(this.rasterInfo).includes(this.renderer.type)}_fetchCapabilities(e){var t=this;return(0,W.Z)(function*(){return t.capabilities||(yield t._fetchServiceInfo(e)),t.capabilities})()}_fetchServiceInfo(e){var t=this;return(0,W.Z)(function*(){var r;let s=t.sourceJSON;if(!s){const{data:p,ssl:u}=yield(0,Y.default)(t.parsedUrl.path,{query:t._getQueryParams(),signal:e});s=p,t.sourceJSON=s,u&&(t.url=t.url.replace(/^http:/i,"https:"))}if((null==(r=s.capabilities)?void 0:r.toLowerCase().split(",").map(p=>p.trim()).indexOf("tilesonly"))>-1)throw new ge.Z("imagery-layer:fetch-service-info","use ImageryTileLayer to open tiles-only image services");t.read(s,{origin:"service",url:t.parsedUrl})})()}_isMosaicDataset(e){var t;return e.serviceSourceType?"esriImageServiceSourceTypeMosaicDataset"===e.serviceSourceType:(null==(t=e.fields)?void 0:t.length)>0}_isMosaicRuleSupported(e){var t;if(!e)return!1;const r=this._isMosaicDataset(e),s=e.currentVersion>=10.71&&e.hasMultidimensions&&e.timeInfo&&!(e.objectIdField&&(null==(t=e.fields)?void 0:t.length)>1);return r||s}_isVectorFieldResampleFunction(e){if(!(0,U.pC)(e))return!1;const{functionName:t,functionArguments:r}=e,s="resample"===t.toLowerCase(),p=(null==r?void 0:r.ResampleType)||(null==r?void 0:r.resampleType);return s&&(7===p||10===p)}_isPicture(){return!this.format||this.format.indexOf("jpg")>-1||this.format.indexOf("png")>-1}_configDefaultRenderer(){if(!this._isPicture()&&!this.pixelFilter){if(!this.bandIds&&this.rasterInfo.bandCount>=3){const r=(0,gt.YD)(this.rasterInfo);!r||3===this.rasterInfo.bandCount&&0===r[0]&&1===r[1]&&2===r[2]||(this.bandIds=r)}var e,t;this.renderer||(this.renderer=(0,gt.Ob)(this.rasterInfo,{bandIds:this.bandIds,variableName:this.renderingRule?null:null==(e=this.mosaicRule)||null==(t=e.multidimensionalDefinition)?void 0:t[0].variableName})),this._symbolizer?(this._symbolizer.rendererJSON=(0,gt.ol)(this.renderer.toJSON()),this._symbolizer.rasterInfo=this.rasterInfo):this._symbolizer=new Yt.Z({rendererJSON:this.renderer.toJSON(),rasterInfo:this.rasterInfo}),this._symbolizer.bind().success||(this._symbolizer=null)}}_clonePixelData(e){return null==e?e:{extent:e.extent&&e.extent.clone(),pixelBlock:(0,U.pC)(e.pixelBlock)&&e.pixelBlock.clone()}}_getQueryParams(e){const{raster:t,viewId:r}=this;return Q(Q({raster:t,viewId:r,f:"json"},e),this.customParameters)}_getRequestOptions(e){return _e(Q({},e),{query:Q(Q({},null==e?void 0:e.query),this.customParameters)})}_decodePixelBlock(e,t,r){return this._rasterJobHandler.instance?this._rasterJobHandler.instance.decode({data:e,options:t}):(0,ct.Jx)(e,t,r)}_fetchMultidimensionalInfo(e){var t=this;return(0,W.Z)(function*(){var r;const s=yield(0,Y.default)(t.parsedUrl.path+"/multidimensionalInfo",{query:t._getQueryParams(),signal:e}).then(p=>{var u;return null==(u=p.data)?void 0:u.multidimensionalInfo});return null!=(r=s.variables)&&r.length&&s.variables.forEach(p=>{var u;null!=(u=p.statistics)&&u.length&&p.statistics.forEach(c=>{c.avg=c.mean,c.stddev=c.standardDeviation})}),s})()}_getRasterFunctionInfos(e){var t=this;return(0,W.Z)(function*(){const r=t.sourceJSON.rasterFunctionInfos;return t.serviceRasterInfo?r:r&&t.version>=10.3?1===r.length&&"none"===r[0].name.toLowerCase()?r:(0,Y.default)(t.parsedUrl.path+"/rasterFunctionInfos",{query:t._getQueryParams(),signal:e}).then(s=>{var p;return null==(p=s.data)?void 0:p.rasterFunctionInfos}):null})()}_fetchAuxiliaryRasterInfo(e){const t=e&&e.serviceInfo;if(!t)return Promise.reject(new ge.Z("imagery-layer:fetch-metadata","valid serviceInfo is required"));const r=e.renderingRule?JSON.stringify(e.renderingRule.toJSON()):null,s=e.signal,p=!!(t.hasRasterAttributeTable&&this.version>=10.1)&&(0,Y.default)(this.parsedUrl.path+"/rasterAttributeTable",{query:this._getQueryParams({renderingRule:this.version>=10.1?r:null}),signal:s}).then(F=>It.default.fromJSON(F.data)).catch(()=>null),u=!!(t.hasColormap&&this.version>=10.1)&&(0,Y.default)(this.parsedUrl.path+"/colormap",{query:this._getQueryParams({renderingRule:this.version>=10.6?r:null}),signal:s}).then(F=>{var A;return null==(A=F.data)?void 0:A.colormap}),c=!!(t.hasHistograms&&this.version>=10.1)&&(0,Y.default)(this.parsedUrl.path+"/histograms",{query:this._getQueryParams({renderingRule:this.version>=10.1?r:null}),signal:s}).then(F=>{var A;return null==(A=F.data)?void 0:A.histograms}),x=this.version>=10.3&&(0,Y.default)(this.parsedUrl.path+"/keyProperties",{query:this._getQueryParams({renderingRule:r}),signal:s}).then(F=>F.data).catch(()=>{}),R=!!(t.hasMultidimensions&&this.version>=10.3)&&this._fetchMultidimensionalInfo();return Promise.all([p,u,c,x,R]).then(F=>{let A=null;if(t.minValues&&t.minValues.length===t.bandCount){A=[];for(let B=0;B<t.minValues.length;B++)A.push({min:t.minValues[B],max:t.maxValues[B],avg:t.meanValues[B],stddev:t.stdvValues[B]})}const Z=Math.ceil((t.extent.xmax-t.extent.xmin)/t.pixelSizeX-.1),V=Math.ceil((t.extent.ymax-t.extent.ymin)/t.pixelSizeY-.1),L=Be.Z.fromJSON(t.spatialReference||t.extent.spatialReference);return new qe.Z({width:Z,height:V,bandCount:t.bandCount,extent:dt.Z.fromJSON(t.extent),spatialReference:L,pixelSize:new Re.Z({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:L}),pixelType:t.pixelType.toLowerCase(),statistics:A,attributeTable:F[0]||null,colormap:F[1]||null,histograms:F[2]||null,keyProperties:F[3]||{},multidimensionalInfo:F[4]||null})})}_requestArrayBuffer(e){const{imageProps:t,requestAsImageElement:r,signal:s}=e;if(r&&!this.pixelFilter&&t.format&&t.format.indexOf("png")>-1)return(0,Y.default)(this.parsedUrl.path+"/exportImage",{responseType:"image",query:this._getQueryParams(Q({f:"image"},e.imageServiceParameters)),signal:s}).then(c=>({imageElement:c.data,params:t}));const p=this._initJobHandler(),u=(0,Y.default)(this.parsedUrl.path+"/exportImage",{responseType:"array-buffer",query:this._getQueryParams(Q({f:"image"},e.imageServiceParameters)),signal:s});return Promise.all([u,p]).then(c=>{const x=c[0].data,R=t.format||"jpgpng";let F=R;if("bsq"!==F&&"bip"!==F&&(F=(0,ct.y6)(x)),!F)throw new ge.Z("imagery-layer:fetch-image","unsupported format signature "+String.fromCharCode.apply(null,new Uint8Array(x)));const A="gif"===R||"bmp"===R||R.indexOf("png")>-1&&("png"===F||"jpg"===F),Z={signal:s};return A?(0,ct.Jx)(x,Q({useCanvas:!0},t),Z).then(V=>({pixelData:{pixelBlock:V,extent:t.extent},params:t})):this._decodePixelBlock(x,{width:t.width,height:t.height,planes:null,pixelType:null,noDataValue:null,format:R},Z).then(V=>({pixelData:{pixelBlock:V,extent:t.extent},params:t}))})}_generateRasterInfo(e,t){var r=this;return(0,W.Z)(function*(){const{data:s}=yield(0,Y.default)(r.parsedUrl.path,Q({query:r._getQueryParams({renderingRule:e})},t));return yield r._fetchAuxiliaryRasterInfo(Q({serviceInfo:s,renderingRule:e},t))})()}_isValidCustomizedMosaicRule(e){return e&&JSON.stringify(e.toJSON())!==JSON.stringify(this._defaultServiceMosaicRule&&this._defaultServiceMosaicRule.toJSON())}_updateMultidimensionalDefinition(e){if(this._isValidCustomizedMosaicRule(this.mosaicRule))return;const t=e.variables[0].dimensions,s=[];for(const p in t)if(t.hasOwnProperty(p)){const u=t[p],c=u.extent;let x=!0,R=[c[0]];u.hasRanges&&!0===u.hasRanges?(x=!1,R=[u.values[0]]):"stdz"===u.name.toLowerCase()&&Math.abs(c[1])<=Math.abs(c[0])&&(R=[c[1]]),s.push(new _.Z({variableName:"",dimensionName:t[p].name,isSlice:x,values:R}))}if(s.length>0){this.mosaicRule=this.mosaicRule||new Ce;const p=this.mosaicRule.multidimensionalDefinition;(!p||p&&p.length<=0)&&(this.mosaicRule.multidimensionalDefinition=s)}}_formatAttributeValue(e,t){if("string"==typeof e){const r=this.popupTemplate&&this.popupTemplate.fieldInfos,s=this._getFieldInfo(r,t),p=s&&s.format;if(p){let u,c;return e.trim().indexOf(",")>-1?(u=",",c=u+" ",this._formatDelimitedString(e,u,c,p)):e.trim().indexOf(" ")>-1?(u=c=" ",this._formatDelimitedString(e,u,c,p)):this._formatNumberFromString(e,p)}}return e}_getFieldInfo(e,t){if(!e||!e.length||!t)return;const r=t.toLowerCase();let s;return e.some(p=>!(!p.fieldName||p.fieldName.toLowerCase()!==r&&p.fieldName.toLowerCase()!==r.replace(/ /g,"_")||(s=p,0))),s}_formatDelimitedString(e,t,r,s){return e&&t&&r&&s?e.trim().split(t).map(p=>this._formatNumberFromString(p,s)).join(r):e}_formatNumberFromString(e,t){if(!e||!t)return e;const r=Number(e);return isNaN(r)?e:t.format(r)}_processVisibleRastersResponse(e,t){t=t||{};const r=e.value,{templateRRFunctionNames:s,showNoDataRecords:p,returnDomainValues:u,templateFields:c}=t,x=e.processedValues;let R=e.catalogItems&&e.catalogItems.features,F=e.properties&&e.properties.Values&&e.properties.Values.map(xe=>xe.replace(/ /gi,", "))||[];const A=this.objectIdField||"ObjectId",Z="string"==typeof r&&r.toLowerCase().indexOf("nodata")>-1,V=[];if(r&&!R&&!Z){const xe={};xe[A]=0,F=[r],R=[new ot.Z(this.fullExtent,null,xe)]}if(!R)return[];let L,B,Ue;this._updateResponseFieldNames(R,c),Z&&!p&&(R=[]);for(let xe=0;xe<R.length;xe++){if(L=R[xe],null!=r){if(B=F[xe],Ue=this.renderingRule&&x&&x.length>0&&s&&s.length>0&&s.indexOf(this.renderingRule.functionName)>-1?x[s.indexOf(this.renderingRule.functionName)]:r,"nodata"===B.toLowerCase()&&!p)continue;const oe="Raster.ItemPixelValue",ee="Raster.ServicePixelValue";L.attributes[oe]=this._formatAttributeValue(B,oe),L.attributes[ee]=this._formatAttributeValue(Ue,ee),this._updateFeatureWithMagDirValues(L,B);const Oe=this.fields&&this.fields.length>0;let Qe=this.renderingRule&&(0,U.pC)(this.serviceRasterInfo)&&this.serviceRasterInfo.attributeTable?Oe?B:r:Ue;this.renderingRule||(Qe=Oe?B:r),this._updateFeatureWithRasterAttributeTableValues(L,Qe)}if(L.sourceLayer=this,u&&this._updateFeatureWithDomainValues(L),s&&x&&s.length===x.length)for(let oe=0;oe<s.length;oe++){const ee="Raster.ServicePixelValue."+s[oe];L.attributes[ee]=this._formatAttributeValue(x[oe],ee)}V.push(R[xe])}return V}_updateFeatureWithRasterAttributeTableValues(e,t){const r=this.rasterInfo&&this.rasterInfo.attributeTable||(0,U.pC)(this.serviceRasterInfo)&&this.serviceRasterInfo.attributeTable,s=r&&r.features;if(!s)return;const p=r.fields,u=p.map(R=>R.name).filter(R=>"value"===R.toLowerCase()),c=u&&u[0];if(!c)return;const x=s.filter(R=>R.attributes[c]===(null!=t?parseInt(t,10):null));x&&x[0]&&p.forEach(R=>{const F=this.rasterAttributeTableFieldPrefix+R.name;e.attributes[F]=this._formatAttributeValue(x[0].attributes[R.name],F)})}_updateFeatureWithMagDirValues(e,t){if("esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType)return;const r=t.split(/,\s*/).map(x=>parseFloat(x)),s=r.map(x=>[x]),p=r.map(x=>({minValue:x,maxValue:x,noDataValue:null})),u=new ut.Z({height:1,width:1,pixelType:"f32",pixels:s,statistics:p});null!=this.pixelFilter&&this.pixelFilter({pixelBlock:u,extent:new dt.Z(0,0,0,0,this.spatialReference)});const c="esriImageServiceDataTypeVector-MagDir"===this.serviceDataType?[u.pixels[0][0],u.pixels[1][0]]:(0,St.Tg)([u.pixels[0][0],u.pixels[1][0]]);e.attributes["Raster.Magnitude"]=c[0],e.attributes["Raster.Direction"]=c[1]}_updateFeatureWithDomainValues(e){const t=this.fields&&this.fields.filter(r=>r.domain&&"coded-value"===r.domain.type);null!=t&&t.forEach(r=>{const s=e.attributes[r.name];if(null!=s){const p=r.domain.codedValues.filter(u=>u.code===s)[0];p&&(e.attributes[r.name]=p.name)}})}_updateResponseFieldNames(e,t){if(!t||t.length<1)return;const r=this.fieldsIndex;(0,U.pC)(r)&&e.forEach(s=>{if(s&&s.attributes)for(const p of t)if(r.has(p)){const u=r.get(p).name;u!==p&&(s.attributes[p]=s.attributes[u],delete s.attributes[u])}})}_updateRenderingRulesFunctionName(e,t){if(!e||e.length<1)return;if("Raw"===e)return e.replace("Raw","None");const r=e.toLowerCase().replace(/ /gi,"_");return t.has(r)?t.get(r):e}_isRFTJson(e){return e.name&&e.arguments&&e.function&&e.hasOwnProperty("functionType")}_readCapabilities(e){const t=e.capabilities?e.capabilities.toLowerCase().split(",").map(F=>F.trim()):["image","catalog"],{currentVersion:r,advancedQueryCapabilities:s,maxRecordCount:p}=e,u=t.indexOf("image")>-1,c="esriImageServiceDataTypeElevation"===e.serviceDataType,x=!!(e.spatialReference||e.extent&&e.extent.spatialReference),R=t.includes("edit");return{data:{supportsAttachment:!1},operations:{supportsComputeHistograms:u,supportsExportImage:u,supportsIdentify:u,supportsMeasure:t.indexOf("mensuration")>-1&&x,supportsDownload:t.indexOf("download")>-1,supportsQuery:t.indexOf("catalog")>-1&&e.fields&&e.fields.length>0,supportsGetSamples:r>=10.2&&u,supportsProject:r>=10.3&&u,supportsComputeStatisticsHistograms:r>=10.4&&u,supportsQueryBoundary:r>=10.6&&u,supportsCalculateVolume:r>=10.7&&c,supportsComputePixelLocation:r>=10.7&&t.indexOf("catalog")>-1,supportsComputeAngles:r>=10.91,supportsAdd:R,supportsDelete:R,supportsEditing:R,supportsUpdate:R,supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsChangeTracking:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsExceedsLimitStatistics:!1},query:{maxRecordCount:p,maxRecordCountFactor:void 0,supportsStatistics:!(null==s||!s.supportsStatistics),supportsOrderBy:!(null==s||!s.supportsOrderBy),supportsDistinct:!(null==s||!s.supportsDistinct),supportsPagination:!(null==s||!s.supportsPagination),supportsStandardizedQueriesOnly:!(null==s||!s.useStandardizedQueries),supportsPercentileStatistics:!(null==s||!s.supportsPercentileStatistics),supportsCentroid:!(null==s||!s.supportsReturningGeometryCentroid),supportsDistance:!(null==s||!s.supportsQueryWithDistance),supportsExtent:!(null==s||!s.supportsReturningQueryExtent),supportsGeometryProperties:!(null==s||!s.supportsReturningGeometryProperties),supportsHavingClause:!(null==s||!s.supportsHavingClause),supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsMaxRecordCountFactor:!1,supportsSqlExpression:!1,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!1,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!1,supportsCacheHint:!1,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}}};return(0,o._)([(0,l.Cb)()],i.prototype,"_functionRasterInfos",void 0),(0,o._)([(0,l.Cb)()],i.prototype,"_rasterJobHandler",void 0),(0,o._)([(0,l.Cb)()],i.prototype,"_symbolizer",void 0),(0,o._)([(0,l.Cb)({dependsOn:["_serviceSupportsMosaicRule"]})],i.prototype,"_defaultServiceMosaicRule",void 0),(0,o._)([(0,ie.r)("_defaultServiceMosaicRule",["defaultMosaicMethod"])],i.prototype,"readDefaultServiceMosaicRule",null),(0,o._)([(0,l.Cb)()],i.prototype,"_cachedRendererJson",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],i.prototype,"_serviceSourceType",void 0),(0,o._)([(0,ie.r)("_serviceSourceType",["serviceSourceType","fields"])],i.prototype,"readServiceSourceType",null),(0,o._)([(0,l.Cb)({readOnly:!0})],i.prototype,"_serviceSupportsMosaicRule",void 0),(0,o._)([(0,ie.r)("_serviceSupportsMosaicRule",["currentVersion","fields"])],i.prototype,"readServiceSupportsMosaicRule",null),(0,o._)([(0,l.Cb)()],i.prototype,"rasterAttributeTableFieldPrefix",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],i.prototype,"rasterFunctionNamesIndex",null),(0,o._)([(0,l.Cb)()],i.prototype,"adjustAspectRatio",void 0),(0,o._)([(0,l.Cb)({readOnly:!0}),(0,ce.B)("serviceRasterInfo.bandCount")],i.prototype,"bandCount",void 0),(0,o._)([(0,l.Cb)({type:[me.z8],json:{write:!0}})],i.prototype,"bandIds",void 0),(0,o._)([(0,ie.r)("bandIds")],i.prototype,"readBandIds",null),(0,o._)([(0,l.Cb)({readOnly:!0,json:{read:!1}})],i.prototype,"capabilities",void 0),(0,o._)([(0,ie.r)("service","capabilities",["capabilities","currentVersion","serviceDataType"])],i.prototype,"readCapabilities",null),(0,o._)([(0,l.Cb)({type:Number})],i.prototype,"compressionQuality",void 0),(0,o._)([(0,X.c)("compressionQuality")],i.prototype,"writeCompressionQuality",null),(0,o._)([(0,l.Cb)({type:Number})],i.prototype,"compressionTolerance",void 0),(0,o._)([(0,X.c)("compressionTolerance")],i.prototype,"writeCompressionTolerance",null),(0,o._)([(0,l.Cb)({json:{read:{source:"copyrightText"}}})],i.prototype,"copyright",void 0),(0,o._)([(0,l.Cb)({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],i.prototype,"definitionExpression",void 0),(0,o._)([(0,l.Cb)({readOnly:!0,constructOnly:!0})],i.prototype,"exportImageServiceParameters",void 0),(0,o._)([(0,l.Cb)()],i.prototype,"rasterInfo",void 0),(0,o._)([(0,l.Cb)({readOnly:!0,type:[Fe.Z]})],i.prototype,"fields",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],i.prototype,"fieldsIndex",null),(0,o._)([(0,l.Cb)({type:["png","png8","png24","png32","jpg","bmp","gif","jpgpng","lerc","tiff"],json:{write:!0}})],i.prototype,"format",null),(0,o._)([(0,ie.r)("service","format",["serviceDataType"])],i.prototype,"readFormat",null),(0,o._)([(0,l.Cb)({type:dt.Z})],i.prototype,"fullExtent",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],i.prototype,"hasMultidimensions",void 0),(0,o._)([(0,l.Cb)({json:{read:{source:"maxImageHeight"}}})],i.prototype,"imageMaxHeight",void 0),(0,o._)([(0,l.Cb)({json:{read:{source:"maxImageWidth"}}})],i.prototype,"imageMaxWidth",void 0),(0,o._)([(0,l.Cb)({type:String,json:{type:be.c.jsonValues,read:be.c.read,write:be.c.write}})],i.prototype,"interpolation",void 0),(0,o._)([(0,l.Cb)()],i.prototype,"minScale",void 0),(0,o._)([(0,ie.r)("service","minScale")],i.prototype,"readMinScale",null),(0,o._)([(0,l.Cb)()],i.prototype,"maxScale",void 0),(0,o._)([(0,ie.r)("service","maxScale")],i.prototype,"readMaxScale",null),(0,o._)([(0,l.Cb)({type:Ce})],i.prototype,"mosaicRule",null),(0,o._)([(0,ie.r)("mosaicRule",["mosaicRule","defaultMosaicMethod"])],i.prototype,"readMosaicRule",null),(0,o._)([(0,X.c)("mosaicRule")],i.prototype,"writeMosaicRule",null),(0,o._)([(0,l.Cb)({readOnly:!0}),(0,ce.B)("serviceRasterInfo.multidimensionalInfo")],i.prototype,"multidimensionalInfo",void 0),(0,o._)([(0,l.Cb)({json:{type:me.z8}})],i.prototype,"noData",void 0),(0,o._)([(0,X.c)("noData")],i.prototype,"writeNoData",null),(0,o._)([(0,l.Cb)({type:String,json:{type:be.k.jsonValues,read:be.k.read,write:be.k.write}})],i.prototype,"noDataInterpretation",void 0),(0,o._)([(0,l.Cb)({type:String,readOnly:!0,json:{read:{source:["fields"]}}})],i.prototype,"objectIdField",void 0),(0,o._)([(0,ie.r)("objectIdField")],i.prototype,"readObjectIdField",null),(0,o._)([(0,l.Cb)({})],i.prototype,"geometryType",void 0),(0,o._)([(0,l.Cb)({})],i.prototype,"typeIdField",void 0),(0,o._)([(0,l.Cb)({})],i.prototype,"types",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],i.prototype,"parsedUrl",null),(0,o._)([(0,l.Cb)({readOnly:!0}),(0,ce.B)("serviceRasterInfo.pixelSize.x")],i.prototype,"pixelSizeX",void 0),(0,o._)([(0,l.Cb)({readOnly:!0}),(0,ce.B)("serviceRasterInfo.pixelSize.y")],i.prototype,"pixelSizeY",void 0),(0,o._)([(0,l.Cb)({type:Function})],i.prototype,"pixelFilter",void 0),(0,o._)([(0,l.Cb)()],i.prototype,"raster",void 0),(0,o._)([(0,l.Cb)()],i.prototype,"viewId",void 0),(0,o._)([(0,l.Cb)({types:Ae.dr,json:{name:"layerDefinition.drawingInfo.renderer",origins:{"web-scene":{types:Ae.FK,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:e=>({enabled:e&&"vector-field"!==e.type&&"animated-flow"!==e.type})}}}}})],i.prototype,"renderer",void 0),(0,o._)([(0,ie.r)("renderer")],i.prototype,"readRenderer",null),(0,o._)([(0,X.c)("renderer")],i.prototype,"writeRenderer",null),(0,o._)([(0,l.Cb)(O.Oh)],i.prototype,"opacity",void 0),(0,o._)([(0,l.Cb)({readOnly:!0}),(0,ce.B)("serviceRasterInfo.attributeTable")],i.prototype,"rasterAttributeTable",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],i.prototype,"rasterFields",null),(0,o._)([(0,l.Cb)({constructOnly:!0})],i.prototype,"rasterFunctionInfos",void 0),(0,o._)([(0,l.Cb)({type:C})],i.prototype,"renderingRule",null),(0,o._)([(0,ie.r)("renderingRule",["renderingRule","rasterFunctionInfos"])],i.prototype,"readRenderingRule",null),(0,o._)([(0,X.c)("renderingRule")],i.prototype,"writeRenderingRule",null),(0,o._)([(0,l.Cb)()],i.prototype,"serviceDataType",void 0),(0,o._)([(0,l.Cb)({readOnly:!0,type:Be.Z})],i.prototype,"spatialReference",void 0),(0,o._)([(0,ie.r)("spatialReference",["spatialReference","extent"])],i.prototype,"readSpatialReference",null),(0,o._)([(0,l.Cb)({json:{type:Ut.jsonValues}})],i.prototype,"pixelType",void 0),(0,o._)([(0,ie.r)("pixelType")],i.prototype,"readPixelType",null),(0,o._)([(0,X.c)("pixelType")],i.prototype,"writePixelType",null),(0,o._)([(0,l.Cb)({constructOnly:!0,type:qe.Z})],i.prototype,"serviceRasterInfo",void 0),(0,o._)([(0,l.Cb)()],i.prototype,"sourceJSON",void 0),(0,o._)([(0,l.Cb)(O.HQ)],i.prototype,"url",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],i.prototype,"version",void 0),(0,o._)([(0,ie.r)("version",["currentVersion","fields","timeInfo"])],i.prototype,"readVersion",null),i=(0,o._)([(0,he.j)("esri.layers.mixins.ArcGISImageService")],i),i};var Sr=h(41122),wr=h(88945),Ir=h(52166),Cr=h(46839),Mr=h(32617),_r=h(77883),Pr=h(41099),Nr=h(77932),Tr=h(81569);let Ne=class extends((0,wr.h)((0,Nr.n)((0,_r.Q)((0,Pr.M)((0,Cr.q)((0,Mr.I)(br((0,Ir.N)((0,Sr.Y)((0,Ye.R)($e.Z))))))))))){constructor(...n){super(...n),this.legendEnabled=!0,this.isReference=null,this.operationalLayerType="ArcGISImageServiceLayer",this.popupEnabled=!0,this.popupTemplate=null,this.type="imagery"}normalizeCtorArgs(n,i){return"string"==typeof n?Q({url:n},i):n}load(n){const i=(0,U.pC)(n)?n.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},n).catch(Ie.r9).then(()=>this._fetchService(i))),Promise.resolve(this)}writeOperationalLayerType(n,i,e){var t;const r="vector-field"===(null==(t=this.renderer)?void 0:t.type);i[e]=r?"ArcGISImageServiceVectorLayer":"ArcGISImageServiceLayer"}get defaultPopupTemplate(){return this.createPopupTemplate()}createPopupTemplate(n){const i=this.rasterFields,e=this.title,t=new Set;let r=!1,s=!1;this.capabilities&&(r=this.capabilities.operations.supportsQuery&&this.fields&&this.fields.length>0,s=r&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType));const p=new Set;r&&(p.add("raster.itempixelvalue"),s&&p.add("raster.magnitude").add("raster.direction"));for(const u of i){const c=u.name.toLowerCase();p.has(c)||c.indexOf("raster.servicepixelvalue.")>-1||t.add(u.name)}return(0,Tr.eZ)({fields:i,title:e},_e(Q({},n),{visibleFieldNames:t}))}queryFeatures(n,i){return this.queryRasters(n,i).then(e=>{if(null!=e&&e.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e})}queryFeatureCount(n,i){return this.queryRasterCount(n,i)}redraw(){this.emit("redraw")}};(0,o._)([(0,l.Cb)(O.rn)],Ne.prototype,"legendEnabled",void 0),(0,o._)([(0,l.Cb)({type:["show","hide"]})],Ne.prototype,"listMode",void 0),(0,o._)([(0,l.Cb)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],Ne.prototype,"isReference",void 0),(0,o._)([(0,l.Cb)({type:["ArcGISImageServiceLayer"],json:{origins:{"web-map":{type:["ArcGISImageServiceLayer","ArcGISImageServiceVectorLayer"],read:!1,write:{target:"layerType",ignoreOrigin:!0}}}}})],Ne.prototype,"operationalLayerType",void 0),(0,o._)([(0,X.c)("web-map","operationalLayerType")],Ne.prototype,"writeOperationalLayerType",null),(0,o._)([(0,l.Cb)(O.C_)],Ne.prototype,"popupEnabled",void 0),(0,o._)([(0,l.Cb)({type:yt.Z,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Ne.prototype,"popupTemplate",void 0),(0,o._)([(0,l.Cb)({readOnly:!0})],Ne.prototype,"defaultPopupTemplate",null),(0,o._)([(0,l.Cb)({readOnly:!0,json:{read:!1}})],Ne.prototype,"type",void 0),Ne=(0,o._)([(0,he.j)("esri.layers.ImageryLayer")],Ne);const Or=Ne},24384:(Pe,ye,h)=>{h.d(ye,{KC:()=>W,QI:()=>et,wF:()=>j,K:()=>J,Yx:()=>me,nb:()=>D,BH:()=>ot,NL:()=>We,Tg:()=>X});var o=h(74856),yt=h(18502),U=h(77847),Ye=h(85572);const Ie=new Map;Ie.set("meter-per-second",1),Ie.set("kilometer-per-hour",.277778),Ie.set("knots",.514444),Ie.set("feet-per-second",.3048),Ie.set("mile-per-hour",.44704);const l=180/Math.PI,We=new o.Xn({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function me(a,f){return Ie.get(a)/Ie.get(f)||1}function he(a){return(450-a)%360}function X(a,f="geographic"){const[m,d]=a,g=Math.sqrt(m*m+d*d);let y=Math.atan2(d,m)*l;return y=(360+y)%360,"geographic"===f&&(y=he(y)),[g,y]}function $e(a,f="geographic"){let m=a[1];"geographic"===f&&(m=he(m)),m%=360;const d=a[0];return[d*Math.cos(m/l),d*Math.sin(m/l)]}function W(a,f,m="geographic",d=1){if(!(0,Ye.nk)(a))return a;const{pixels:g,width:y,height:M}=a,b=y*M,C=g[0],v=g[1],I=U.Z.createEmptyBand(a.pixelType,b),S=U.Z.createEmptyBand(a.pixelType,b);let w=0;for(let T=0;T<M;T++)for(let z=0;z<y;z++)"vector-uv"===f?([I[w],S[w]]=X([C[w],v[w]],m),I[w]*=d):([I[w],S[w]]=$e([C[w],v[w]],m),I[w]*=d,S[w]*=d),w++;const N=new U.Z({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:[I,S]});return N.updateStatistics(),N}function et(a,f,m=1){if(1===m||!(0,Ye.nk)(a))return a;const d=a.clone(),{pixels:g,width:y,height:M}=d,b=g[0],C=g[1];let v=0;for(let I=0;I<M;I++)for(let S=0;S<y;S++)"vector-uv"===f?(b[v]*=m,C[v]*=m):b[v]*=m,v++;return d.updateStatistics(),d}function ot(a,f,m,d,g){if(!(0,yt.pC)(g)||!g.spatialReference.equals(a.spatialReference))return{extent:a,width:f,height:m,resolution:a.width/f};const y=g.xmin,M=g.ymax;d=Math.max(d||0,30);const b=Math.ceil(f*(1/d)),C=Math.ceil(m*(1/d)),v=((a.xmax-a.xmin)/b+(a.ymax-a.ymin)/C)/2;return a.xmin=y+Math.floor((a.xmin-y)/v)*v,a.xmax=y+Math.ceil((a.xmax-y)/v)*v,a.ymin=M+Math.floor((a.ymin-M)/v)*v,a.ymax=M+Math.ceil((a.ymax-M)/v)*v,{extent:a,width:Math.round(a.width/v),height:Math.round(a.height/v),resolution:v}}const Ae=function(a=0,f=0,m=Math.PI,d=!0){d&&(m=(2*Math.PI-m)%(2*Math.PI));const g=d?-1:1,y=13*g,M=-7*g,b=-2*g,C=-16*g,v=29,[I,S]=pe(0,f+y,m,v),[w,N]=pe(a-5.5,f+M,m,v),[T,z]=pe(a+5.5,f+M,m,v),[q,ae]=pe(a-1.5,f+b,m,v),[re,E]=pe(a+1.5,f+b,m,v),[ne,K]=pe(a-1.5,f+C,m,v),[H,k]=pe(a+1.5,f+C,m,v);return[I,S,w,N,q,ae,re,E,T,z,ne,K,H,k]}(0,0,0);function ge(a=0,f=Math.PI,m=!0){m&&(f=(2*Math.PI-f)%(2*Math.PI));const g=m?-1:1,y=5*g,M=20*g,b=25*g,C=45,N=2*g;let[T,z]=[5,0-M],[q,ae]=[T+2,z],[re,E]=[q-0,ae+N],[ne,K]=[-5,0-b],[H,k]=[ne+0,K-N],se=Math.ceil(a/5),G=Math.floor(se/10);se-=8*G;const $=[],ve=[];for(let be=0;be<se/2;be++,G--){G<=0&&se%2==1&&be===(se-1)/2&&(ne=0,H=ne+0,K=(K+z)/2,k=K-N);const[le,Fe]=pe(ne,K,f,C);if(G>0){const[lt,ut]=pe(q,K,f,C),[qe,pt]=pe(T,z,f,C);$.push(lt),$.push(ut),$.push(le),$.push(Fe),$.push(qe),$.push(pt)}else{const[lt,ut]=pe(q,ae,f,C),[qe,pt]=pe(re,E,f,C),[ct,St]=pe(H,k,f,C);ve.push(le),ve.push(Fe),ve.push(ct),ve.push(St),ve.push(qe),ve.push(pt),ve.push(lt),ve.push(ut)}K+=y,z+=y,ae+=y,E+=y,k+=y}const[Ve,Je]=pe(5,0+M,f,C),[ze,Ee]=pe(7,0+M,f,C),[ke,bt]=pe(5,0-b,f,C),[fe,Ce]=pe(7,0-b,f,C);return{pennants:$,barbs:ve,shaft:[Ve,Je,ze,Ee,ke,bt,fe,Ce]}}function pe(a,f,m,d=1){const g=Math.sqrt(a*a+f*f)/d,y=(2*Math.PI+Math.atan2(f,a))%(2*Math.PI);return[g,(2*Math.PI+y-m)%(2*Math.PI)]}const ue=[0,1,3,6,10,16,21,27,33,40,47,55,63],at=[0,.5,1,1.5,2],Ke=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function ce(a,f,m,d){const g=me(d||"knots",m);let y;for(y=1;y<f.length;y++)if(y===f.length-1){if(a<f[y]*g)break}else if(a<=f[y]*g)break;return Math.min(y-1,f.length-2)}function ie(a,f,m,d,g){let y=0;switch(f){case"beaufort_kn":y=ce(a,ue,"knots",m);break;case"beaufort_km":y=ce(a,ue,"kilometer-per-hour",m);break;case"beaufort_ft":y=ce(a,ue,"feet-per-second",m);break;case"beaufort_m":y=ce(a,ue,"meter-per-second",m);break;case"classified_arrow":y=ce(a,g,d,m);break;case"ocean_current_m":y=ce(a,at,"meter-per-second",m);break;case"ocean_current_kn":y=ce(a,Ke,"knots",m)}return y}const _=[];function J(a,f){let d=0,g=0;const{width:y,height:M,mask:b}=a,C=a.pixels[0],v=[],I=[],S="wind_speed"===f.style?5:Number.MAX_VALUE;for(let w=0;w<M;w++)for(let N=0;N<y;N++){const T=w*y+N;if((!b||b[w*y+N])&&C[T]<S){for(let q=0;q<4;q++)v[d++]=(N+.5)/y,v[d++]=(w+.5)/M,v[d++]=q<2?-.5:.5,v[d++]=q%2==0?-.5:.5,v[d++]=0,v[d++]=C[T];const z=4*(d/24-1);I[g++]=z,I[g++]=z+1,I[g++]=z+2,I[g++]=z+1,I[g++]=z+2,I[g++]=z+3}}return{vertexData:new Float32Array(v),indexData:new Uint32Array(I)}}function j(a,f){return"simple_scalar"===f.style?J(a,f):"wind_speed"===f.style?function(a,f){if(0===_.length)for(let T=0;T<30;T++)_.push(ge(5*T,0));const m=me(We.fromJSON(f.inputUnit),"knots"),{width:d,height:g,mask:y}=a,M=a.pixels[0],b=a.pixels[1],v=[],I=[];let S=0,w=0;for(let T=0;T<g;T++)for(let z=0;z<d;z++){const q=T*d+z,ae=M[q]*m;if((!y||y[T*d+z])&&ae>=5){var N;const re=null!=(N=(b[q]+360)%360/180*Math.PI)?N:2*Math.PI*Math.random(),{pennants:E,barbs:ne,shaft:K}=_[Math.min(Math.floor(ae/5),29)];if(E.length+ne.length===0)continue;let H=v.length/6;const k=(z+.5)/d,se=(T+.5)/g;for(let G=0;G<E.length;G+=2)v[S++]=k,v[S++]=se,v[S++]=E[G],v[S++]=E[G+1]+re,v[S++]=0,v[S++]=ae;for(let G=0;G<ne.length;G+=2)v[S++]=k,v[S++]=se,v[S++]=ne[G],v[S++]=ne[G+1]+re,v[S++]=0,v[S++]=ae;for(let G=0;G<K.length;G+=2)v[S++]=k,v[S++]=se,v[S++]=K[G],v[S++]=K[G+1]+re,v[S++]=0,v[S++]=ae;for(let G=0;G<E.length/6;G++)I[w++]=H,I[w++]=H+1,I[w++]=H+2,H+=3;for(let G=0;G<ne.length/8;G++)I[w++]=H,I[w++]=H+1,I[w++]=H+2,I[w++]=H+1,I[w++]=H+2,I[w++]=H+3,H+=4;I[w++]=H+0,I[w++]=H+1,I[w++]=H+2,I[w++]=H+1,I[w++]=H+3,I[w++]=H+2,H+=4}}return{vertexData:new Float32Array(v),indexData:new Uint32Array(I)}}(a,f):function(a,f){const{style:m,inputUnit:d,outputUnit:g,breakValues:y}=f,M=We.fromJSON(d),b=We.fromJSON(g);let I=0,S=0;const{width:w,height:N,mask:T}=a,z=a.pixels[0],q=a.pixels[1],ae=T?T.filter(K=>K>0).length:w*N,re=new Float32Array(42*ae),E=new Uint32Array(15*ae);for(let K=0;K<N;K++)for(let H=0;H<w;H++){const k=K*w+H;if(!T||T[K*w+H]){var ne;const se=null!=(ne=(q[k]+360)%360/180*Math.PI)?ne:2*Math.PI*Math.random(),G=ie(z[k],m,M,b,y);for(let ve=0;ve<Ae.length;ve+=2)re[I++]=(H+.5)/w,re[I++]=(K+.5)/N,re[I++]=Ae[ve],re[I++]=Ae[ve+1]+se,re[I++]=G,re[I++]=z[k];const $=7*(I/42-1);E[S++]=$,E[S++]=$+1,E[S++]=$+2,E[S++]=$+0,E[S++]=$+4,E[S++]=$+3,E[S++]=$+0,E[S++]=$+2,E[S++]=$+3,E[S++]=$+2,E[S++]=$+5,E[S++]=$+3,E[S++]=$+5,E[S++]=$+6,E[S++]=$+3}}return{vertexData:re,indexData:E}}(a,f)}function D(a,f,m,d=[0,0],g=.5){const{width:y,height:M,mask:b}=a,[C,v]=a.pixels,[I,S]=d,w=Math.round((y-I)/m),N=Math.round((M-S)/m),T=w*N,z=new Float32Array(T),q=new Float32Array(T),ae=new Uint8Array(T),re="vector-uv"===f;for(let ne=0;ne<N;ne++)for(let K=0;K<w;K++){let H=0;const k=ne*w+K,se=Math.max(0,ne*m+S),G=Math.max(0,K*m+I),$=Math.min(M,se+m),ve=Math.min(y,G+m);for(let Ve=se;Ve<$;Ve++)for(let Je=G;Je<ve;Je++){const Re=Ve*y+Je;if(!b||b[Re]){H++;const ze=re?[C[Re],v[Re]]:[C[Re],(360+v[Re])%360],[Ee,ke]=re?ze:$e(ze);z[k]+=Ee,q[k]+=ke}}if(H>=($-se)*(ve-G)*(1-g)){ae[k]=1;const[Ve,Je]=X([z[k]/H,q[k]/H]);z[k]=Ve,q[k]=Je}else ae[k]=0,z[k]=0,q[k]=0}const E=new U.Z({width:w,height:N,pixels:[z,q],mask:ae});return E.updateStatistics(),E}},62013:(Pe,ye,h)=>{h.d(ye,{z_:()=>$e,KK:()=>at});var o=h(49996),U=(h(61243),h(22345)),Ye=h(88415),Ie=h(18502),l=h(7808),Ge=h(46255),We=h(35169),me=h(70157);const he=U.Z.getLogger("esri.views.2d.engine.flow.dataUtils");function $e(O,_,P){return W.apply(this,arguments)}function W(){return(W=(0,o.Z)(function*(O,_,P){const J=performance.now(),j=et(O,_),D=performance.now(),a=Ae(O,j,_.width,_.height),f=performance.now(),m=ge(a,!0),d=performance.now(),g=pe(m),y=performance.now();if(O.profile){const M={"_createFlowFieldFromData()":Math.round(D-J),"_getStreamlines()":Math.round(f-D),"createAnimatedLinesData()":Math.round(d-f),"createLinesMesh()":Math.round(y-d),"Total elapsed time":Math.round(y-J)};he.info("createStreamlinesMesh profile",M)}return yield Promise.resolve(),(0,l.k_)(P),g})).apply(this,arguments)}function et(O,_){const P=function(O,_,P,J){if(0===J)return O;const j=Math.round(3*J),D=new Array(2*j+1);let a=0;for(let d=-j;d<=j;d++){const g=Math.exp(-d*d/(J*J));D[d+j]=g,a+=g}for(let d=-j;d<=j;d++)D[d+j]/=a;const f=new Float32Array(O.length);for(let d=0;d<P;d++)for(let g=0;g<_;g++){let y=0,M=0;for(let b=-j;b<=j;b++){if(g+b<0||g+b>=_)continue;const C=D[b+j];y+=C*O[2*(d*_+(g+b))+0],M+=C*O[2*(d*_+(g+b))+1]}f[2*(d*_+g)+0]=y,f[2*(d*_+g)+1]=M}const m=new Float32Array(O.length);for(let d=0;d<_;d++)for(let g=0;g<P;g++){let y=0,M=0;for(let b=-j;b<=j;b++){if(g+b<0||g+b>=P)continue;const C=D[b+j];y+=C*f[2*((g+b)*_+d)+0],M+=C*f[2*((g+b)*_+d)+1]}m[2*(g*_+d)+0]=y,m[2*(g*_+d)+1]=M}return m}(_.data,_.width,_.height,O.smoothing);return O.interpolate?(J,j)=>{const D=Math.floor(J),a=Math.floor(j);if(D<0||D>=_.width)return[0,0];if(a<0||a>=_.height)return[0,0];const f=J-D,m=j-a,d=D,g=a,y=D<_.width-1?D+1:D,M=a<_.height-1?a+1:a,b=P[2*(g*_.width+d)],C=P[2*(g*_.width+y)],v=P[2*(M*_.width+d)],I=P[2*(M*_.width+y)],S=P[2*(g*_.width+d)+1],w=P[2*(g*_.width+y)+1];return[(b*(1-m)+v*m)*(1-f)+(C*(1-m)+I*m)*f,(S*(1-m)+P[2*(M*_.width+d)+1]*m)*(1-f)+(w*(1-m)+P[2*(M*_.width+y)+1]*m)*f]}:(J,j)=>{const D=Math.round(J),a=Math.round(j);return D<0||D>=_.width||a<0||a>=_.height?[0,0]:[P[2*(a*_.width+D)+0],P[2*(a*_.width+D)+1]]}}function ot(O,_,P,J,j,D,a,f,m){const d=[];let g,y,M=P,b=J,C=0;d.push({x:M,y:b,t:C});for(let v=0;v<O.verticesPerLine;v++){let[I,S]=_(M,b);I*=O.velocityScale,S*=O.velocityScale;const w=Math.sqrt(I*I+S*S);if(w<O.minSpeedThreshold)return d;const N=I/w,T=S/w;if(M+=N*O.segmentLength,b+=T*O.segmentLength,C+=O.segmentLength/w,Math.acos(N*g+T*y)>O.maxTurnAngle)return d;if(O.mergeLines){const z=Math.round(M*m),q=Math.round(b*m);if(z<0||z>a-1||q<0||q>f-1)return d;const ae=D[q*a+z];if(-1!==ae&&ae!==j)return d;D[q*a+z]=j}d.push({x:M,y:b,t:C}),g=N,y=T}return d}function Ae(O,_,P,J){const j=[],D=new Ge.Z,a=1/Math.max(O.lineCollisionWidth,1),f=Math.round(P*a),m=Math.round(J*a),d=new Int32Array(f*m);for(let y=0;y<d.length;y++)d[y]=-1;const g=[];for(let y=0;y<J;y+=O.lineSpacing)for(let M=0;M<P;M+=O.lineSpacing)g.push({x:M,y,sort:D.getFloat()});g.sort((y,M)=>y.sort-M.sort);for(const{x:y,y:M}of g)if(D.getFloat()<O.density){const b=ot(O,_,y,M,j.length,d,f,m,a);if(b.length<2)continue;j.push(b)}return j}function ge(O,_){const P=new Ge.Z,J=O.reduce((m,d)=>m+d.length,0),j=new Float32Array(3*J),D=new Array(O.length);let a=0,f=0;for(const m of O){const d=a;for(const g of m)j[3*a+0]=g.x,j[3*a+1]=g.y,j[3*a+2]=g.t,a++;D[f++]={startVertex:d,numberOfVertices:m.length,totalTime:m[m.length-1].t,timeSeed:_?P.getFloat():0}}return{lineVertices:j,lineDescriptors:D}}function pe(O,_=10){const{lineVertices:P,lineDescriptors:J}=O;let j=0,D=0;for(const M of J)j+=2*M.numberOfVertices,D+=6*(M.numberOfVertices-1);const a=new Float32Array(8*j),f=new Uint32Array(D);let m=0,d=0;function y(M,b,C,v,I,S,w){const N=8*m;let T=0;a[N+T++]=M,a[N+T++]=b,a[N+T++]=1,a[N+T++]=C,a[N+T++]=S,a[N+T++]=w,a[N+T++]=v,a[N+T++]=I,m++,a[N+T++]=M,a[N+T++]=b,a[N+T++]=-1,a[N+T++]=C,a[N+T++]=S,a[N+T++]=w,a[N+T++]=-v,a[N+T++]=-I,m++}for(const M of J){const{totalTime:b,timeSeed:C}=M;let v=null,I=null,S=null,w=null,N=null;for(let T=0;T<M.numberOfVertices;T++){const z=P[3*(M.startVertex+T)+0],q=P[3*(M.startVertex+T)+1],ae=P[3*(M.startVertex+T)+2];let re=null,E=null,ne=null,K=null;if(T>0){re=z-v,E=q-I;const H=Math.sqrt(re*re+E*E);if(re/=H,E/=H,T>1){let k=re+w,se=E+N;const G=Math.sqrt(k*k+se*se);k/=G,se/=G;const $=Math.min(1/(k*re+se*E),_);k*=$,se*=$,ne=-se,K=k}else ne=-E,K=re;null!==ne&&null!==K&&(y(v,I,S,ne,K,b,C),f[d++]=m-2,f[d++]=m,f[d++]=m-1,f[d++]=m,f[d++]=m+1,f[d++]=m-1)}v=z,I=q,S=ae,w=re,N=E}y(v,I,S,-N,w,b,C)}return{vertexData:a,indexData:f}}function ue(O,_){const P=_.pixels,{width:J,height:j}=_,D=new Float32Array(J*j*2);if("vector-uv"===O)for(let a=0;a<J*j;a++)D[2*a+0]=P[0][a],D[2*a+1]=-P[1][a];else if("vector-magdir"===O)for(let a=0;a<J*j;a++){const f=P[0][a],m=(0,Ye.Vl)(P[1][a]),d=Math.cos(m-Math.PI/2),g=Math.sin(m-Math.PI/2);D[2*a+0]=d*f,D[2*a+1]=g*f}return{data:D,width:J,height:j}}function at(O,_,P,J,j){return Ke.apply(this,arguments)}function Ke(){return(Ke=(0,o.Z)(function*(O,_,P,J,j){const D=(0,We.C5)(_.spatialReference);if(!D)return ce(O,_,P,J,j);const[a,f]=D.valid,m=f-a,d=Math.ceil(_.width/m),g=_.width/d,y=Math.round(P/d);let M=_.xmin;const b=[];for(let S=0;S<d;S++){const w=new me.Z({xmin:M,xmax:M+g,ymin:_.ymin,ymax:_.ymax,spatialReference:_.spatialReference});b.push(ce(O,w,y,J,j)),M+=g}const C=yield Promise.all(b),v={data:new Float32Array(P*J*2),width:P,height:J};let I=0;for(const S of C){for(let w=0;w<S.height;w++)for(let N=0;N<S.width;N++)I+N>=P||(v.data[2*(w*P+I+N)+0]=S.data[2*(w*S.width+N)+0],v.data[2*(w*P+I+N)+1]=S.data[2*(w*S.width+N)+1]);I+=S.width}return v})).apply(this,arguments)}function ce(O,_,P,J,j){return ie.apply(this,arguments)}function ie(){return(ie=(0,o.Z)(function*(O,_,P,J,j){if("imagery"===O.type){yield O.load({signal:j});const f=O.rasterInfo.dataType,m=yield O.fetchImage(_,P,J,{signal:j});return!m||(0,Ie.Wi)(m.pixelData)||(0,Ie.Wi)(m.pixelData.pixelBlock)?{data:new Float32Array(P*J*2),width:P,height:J}:ue(f,m.pixelData.pixelBlock)}yield O.load({signal:j});const D=O.rasterInfo.dataType,a=yield O.fetchPixels(_,P,J,{signal:j});return!a||(0,Ie.Wi)(a.pixelBlock)?{data:new Float32Array(P*J*2),width:P,height:J}:ue(D,a.pixelBlock)})).apply(this,arguments)}}}]);
//# sourceMappingURL=1510.d6a2d59ff1fad0c92d39.js.map