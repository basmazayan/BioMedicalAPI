"use strict";var $=Object.defineProperty,X=Object.defineProperties,Y=Object.getOwnPropertyDescriptors,A=Object.getOwnPropertySymbols,w=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable,S=(m,p,a)=>p in m?$(m,p,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[p]=a,y=(m,p)=>{for(var a in p||(p={}))w.call(p,a)&&S(m,a,p[a]);if(A)for(var a of A(p))ee.call(p,a)&&S(m,a,p[a]);return m},h=(m,p)=>X(m,Y(p));(self.webpackChunkbio_medical=self.webpackChunkbio_medical||[]).push([[1383],{91343:(m,p,a)=>{a.d(p,{g:()=>d});const d={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},42087:(m,p,a)=>{a.r(p),a.d(p,{default:()=>H});var d=a(49996),g=a(79076),C=(a(61243),a(99326)),R=a(30351),j=a(85362),F=a(61414),P=a(30627),U=a(74856),q=a(23412),D=a(18502),x=a(47914),L=a(7808),b=a(30164),M=a(94911),Z=(a(45072),a(55865),a(96410)),B=a(70157),W=a(70279),K=a(45033),Q=a(84512),J=a(75975),N=a(75330),G=a(96583);const z=new U.Xn({originalAndCurrentFeatures:"original-and-current-features",none:"none"});function T(){return(T=(0,d.Z)(function*(r){return"string"==typeof r?(0,b.sJ)(r)||{data:r}:new Promise((t,e)=>{const s=new FileReader;s.readAsDataURL(r),s.onload=()=>t((0,b.sJ)(s.result)),s.onerror=n=>e(n)})})).apply(this,arguments)}const k=new Set(["Feature Layer","Table"]);let I=class extends q.Z{constructor(){var r;super(...arguments),r=this,this.type="feature-layer",this.refresh=(0,L.Ds)((0,d.Z)(function*(){var t,e;yield r.load();const s=null==(t=r.sourceJSON.editingInfo)?void 0:t.lastEditDate;if(null==s)return{dataChanged:!0,updates:{}};try{yield r._fetchService(null)}catch(u){return{dataChanged:!0,updates:{}}}const n=s!==(null==(e=r.sourceJSON.editingInfo)?void 0:e.lastEditDate);return{dataChanged:n,updates:n?{editingInfo:r.sourceJSON.editingInfo,extent:r.sourceJSON.extent}:null}}))}load(r){const t=(0,D.pC)(r)?r.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:r}},parsedUrl:t,dynamicDataSource:e,infoFor3D:s,gdbVersion:n,spatialReference:u,fieldsIndex:i}=this.layer,l=(0,P.Z)("featurelayer-pbf")&&r&&(0,D.Wi)(s)?"pbf":"json";return new N.Z({url:t.path,format:l,fieldsIndex:i,infoFor3D:s,dynamicDataSource:e,gdbVersion:n,sourceSpatialReference:u})}addAttachment(r,t){var e=this;return(0,d.Z)(function*(){yield e.load();const s=r.attributes[e.layer.objectIdField],n=e.layer.parsedUrl.path+"/"+s+"/addAttachment",u=e._getLayerRequestOptions(),i=e._getFormDataForAttachment(t,u.query);try{const l=yield(0,R.default)(n,{body:i});return e._createFeatureEditResult(l.data.addAttachmentResult)}catch(l){throw e._createAttachmentErrorResult(s,l)}})()}updateAttachment(r,t,e){var s=this;return(0,d.Z)(function*(){yield s.load();const n=r.attributes[s.layer.objectIdField],u=s.layer.parsedUrl.path+"/"+n+"/updateAttachment",i=s._getLayerRequestOptions({query:{attachmentId:t}}),l=s._getFormDataForAttachment(e,i.query);try{const o=yield(0,R.default)(u,{body:l});return s._createFeatureEditResult(o.data.updateAttachmentResult)}catch(o){throw s._createAttachmentErrorResult(n,o)}})()}applyEdits(r,t){var e=this;return(0,d.Z)(function*(){yield e.load();const s=r.addFeatures.map(e._serializeFeature,e),n=r.updateFeatures.map(e._serializeFeature,e),u=e._getFeatureIds(r.deleteFeatures,null==t?void 0:t.globalIdUsed);(0,Q.P)(s,n,e.layer.spatialReference);const i=[],l=[],o=[...r.deleteAttachments];for(const E of r.addAttachments)i.push(yield e._serializeAttachment(E));for(const E of r.updateAttachments)l.push(yield e._serializeAttachment(E));const c=i.length||l.length||o.length?{adds:i,updates:l,deletes:o}:null,_={gdbVersion:(null==t?void 0:t.gdbVersion)||e.layer.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,returnEditMoment:null==t?void 0:t.returnEditMoment,usePreviousEditMoment:null==t?void 0:t.usePreviousEditMoment,sessionId:null==t?void 0:t.sessionId};null!=t&&t.returnServiceEditsOption?(_.edits=JSON.stringify([{id:e.layer.layerId,adds:s,updates:n,deletes:u,attachments:c}]),_.returnServiceEditsOption=z.toJSON(null==t?void 0:t.returnServiceEditsOption),_.returnServiceEditsInSourceSR=null==t?void 0:t.returnServiceEditsInSourceSR):(_.adds=s.length?JSON.stringify(s):null,_.updates=n.length?JSON.stringify(n):null,_.deletes=u.length?null!=t&&t.globalIdUsed?JSON.stringify(u):u.join(","):null,_.attachments=c&&JSON.stringify(c));const f=e._getLayerRequestOptions({method:"post",query:_}),v=null!=t&&t.returnServiceEditsOption?e.layer.url:e.layer.parsedUrl.path,O=yield(0,R.default)(v+"/applyEdits",f);return e._createEditsResult(O)})()}deleteAttachments(r,t){var e=this;return(0,d.Z)(function*(){yield e.load();const s=r.attributes[e.layer.objectIdField],n=e.layer.parsedUrl.path+"/"+s+"/deleteAttachments";try{return(yield(0,R.default)(n,e._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(e._createFeatureEditResult)}catch(u){throw e._createAttachmentErrorResult(s,u)}})()}fetchRecomputedExtents(r={}){var t=this;const e=r.signal;return this.load({signal:e}).then((0,d.Z)(function*(){const s=t._getLayerRequestOptions(h(y({},r),{query:{returnUpdates:!0}})),{layerId:n,url:u}=t.layer,{data:i}=yield(0,R.default)(`${u}/${n}`,s),{id:l,extent:o,fullExtent:c,timeExtent:_}=i,f=o||c;return{id:l,fullExtent:f&&B.Z.fromJSON(f),timeExtent:_&&j.Z.fromJSON({start:_[0],end:_[1]})}}))}queryAttachments(r,t={}){var e=this;return(0,d.Z)(function*(){const{parsedUrl:s}=e.layer,n=s.path;yield e.load();const u=e._getLayerRequestOptions(t);if(!e.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:i}=r,l=[];for(const o of i){const c=n+"/"+o+"/attachments";l.push((0,R.default)(c,u))}return Promise.all(l).then(o=>i.map((c,_)=>({parentObjectId:c,attachmentInfos:o[_].data.attachmentInfos}))).then(o=>(0,J.O)(o,n))}return e.queryTask.executeAttachmentQuery(r,u)})()}queryFeatures(r,t){var e=this;return(0,d.Z)(function*(){return yield e.load(),e.queryTask.execute(r,h(y({},t),{query:e._createRequestQueryOptions(t)}))})()}queryFeaturesJSON(r,t){var e=this;return(0,d.Z)(function*(){return yield e.load(),e.queryTask.executeJSON(r,h(y({},t),{query:e._createRequestQueryOptions(t)}))})()}queryObjectIds(r,t){var e=this;return(0,d.Z)(function*(){return yield e.load(),e.queryTask.executeForIds(r,h(y({},t),{query:e._createRequestQueryOptions(t)}))})()}queryFeatureCount(r,t){var e=this;return(0,d.Z)(function*(){return yield e.load(),e.queryTask.executeForCount(r,h(y({},t),{query:e._createRequestQueryOptions(t)}))})()}queryExtent(r,t){var e=this;return(0,d.Z)(function*(){return yield e.load(),e.queryTask.executeForExtent(r,h(y({},t),{query:e._createRequestQueryOptions(t)}))})()}queryRelatedFeatures(r,t){var e=this;return(0,d.Z)(function*(){return yield e.load(),e.queryTask.executeRelationshipQuery(r,h(y({},t),{query:e._createRequestQueryOptions(t)}))})()}queryRelatedFeaturesCount(r,t){var e=this;return(0,d.Z)(function*(){return yield e.load(),e.queryTask.executeRelationshipQueryForCount(r,h(y({},t),{query:e._createRequestQueryOptions(t)}))})()}queryTopFeatures(r,t){var e=this;return(0,d.Z)(function*(){return yield e.load(),e.queryTask.executeTopFeaturesQuery(r,h(y({},t),{query:e._createRequestQueryOptions(t)}))})()}queryTopObjectIds(r,t){var e=this;return(0,d.Z)(function*(){return yield e.load(),e.queryTask.executeForTopIds(r,h(y({},t),{query:e._createRequestQueryOptions(t)}))})()}queryTopExtents(r,t){var e=this;return(0,d.Z)(function*(){return yield e.load(),e.queryTask.executeForTopExtents(r,h(y({},t),{query:e._createRequestQueryOptions(t)}))})()}queryTopCount(r,t){var e=this;return(0,d.Z)(function*(){return yield e.load(),e.queryTask.executeForTopCount(r,h(y({},t),{query:e._createRequestQueryOptions(t)}))})()}_createRequestQueryOptions(r){const t=y(h(y({},this.layer.customParameters),{token:this.layer.apiKey}),null==r?void 0:r.query);return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}_fetchService(r,t){var e=this;return(0,d.Z)(function*(){if(!r){const{data:n}=yield(0,R.default)(e.layer.parsedUrl.path,e._getLayerRequestOptions({query:(0,P.Z)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:t}));r=n}e.sourceJSON=e._patchServiceJSON(r);const s=r.type;if(!k.has(s))throw new F.Z("feature-layer-source:unsupported-type",`Source type "${s}" is not supported`)})()}_patchServiceJSON(r){var t;if("Table"!==r.type&&r.geometryType&&(null==r||null==(t=r.drawingInfo)||!t.renderer)&&!r.defaultSymbol){const e=(0,K.bU)(r.geometryType).renderer;(0,x.RB)("drawingInfo.renderer",e,r)}return"esriGeometryMultiPatch"===r.geometryType&&r.infoFor3D&&(r.geometryType="mesh"),r}_serializeFeature(r){const{geometry:t,attributes:e}=r;return(0,D.Wi)(t)?{attributes:e}:"mesh"===t.type||"extent"===t.type?null:{geometry:t.toJSON(),attributes:e}}_serializeAttachment(r){var t=this;return(0,d.Z)(function*(){const{feature:e,attachment:s}=r,{globalId:n,name:u,contentType:i,data:l,uploadId:o}=s,c={globalId:n,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(e&&(c.parentGlobalId="attributes"in e?e.attributes&&e.attributes[t.layer.globalIdField]:e.globalId),o)c.uploadId=o;else if(l){const _=yield function(r){return T.apply(this,arguments)}(l);c.contentType=_.mediaType,c.data=_.data,l instanceof File&&(c.name=l.name)}return u&&(c.name=u),i&&(c.contentType=i),c})()}_getFeatureIds(r,t){const e=r[0];return e?this._canUseGlobalIds(t,r)?this._getGlobalIdsFromFeatureIdentifier(r):"objectId"in e?this._getObjectIdsFromFeatureIdentifier(r):this._getIdsFromFeatures(r):[]}_getIdsFromFeatures(r){const t=this.layer.objectIdField;return r.map(e=>e.attributes&&e.attributes[t])}_canUseGlobalIds(r,t){return r&&"globalId"in t[0]}_getObjectIdsFromFeatureIdentifier(r){return r.map(t=>t.objectId)}_getGlobalIdsFromFeatureIdentifier(r){return r.map(t=>t.globalId)}_createEditsResult(r){var t;const e=r.data,{layerId:s}=this.layer,n=[];let u=null;if(Array.isArray(e))for(const o of e)n.push({id:o.id,editedFeatures:o.editedFeatures}),o.id===s&&(u={addResults:o.addResults,updateResults:o.updateResults,deleteResults:o.deleteResults,attachments:o.attachments,editMoment:o.editMoment});else u=e;const i=null==(t=u)?void 0:t.attachments,l={addFeatureResults:u.addResults?u.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:u.updateResults?u.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:u.deleteResults?u.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:i&&i.addResults?i.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:i&&i.updateResults?i.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:i&&i.deleteResults?i.deleteResults.map(this._createFeatureEditResult,this):[]};if(u.editMoment&&(l.editMoment=u.editMoment),n.length>0){l.editedFeatureResults=[];for(const o of n){const{adds:c,updates:_,deletes:f,spatialReference:v}=o.editedFeatures,O=v?new G.Z(v):null;l.editedFeatureResults.push({layerId:o.id,editedFeatures:{adds:(null==c?void 0:c.map(E=>this._createEditedFeature(E,O)))||[],updates:(null==_?void 0:_.map(E=>({original:this._createEditedFeature(E[0],O),current:this._createEditedFeature(E[1],O)})))||[],deletes:(null==f?void 0:f.map(E=>this._createEditedFeature(E,O)))||[],spatialReference:O}})}}return l}_createEditedFeature(r,t){return new C.Z({attributes:r.attributes,geometry:(0,W.im)(h(y({},r.geometry),{spatialReference:t}))})}_createFeatureEditResult(r){const t=!0===r.success?null:r.error||{code:void 0,description:void 0};return{objectId:r.objectId,globalId:r.globalId,error:t?new F.Z("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_createAttachmentErrorResult(r,t){const e=t.details.messages&&t.details.messages[0]||t.message,s=t.details.httpStatus||t.details.messageCode;return{objectId:r,globalId:null,error:new F.Z("feature-layer-source:attachment-failure",e,{code:s})}}_getFormDataForAttachment(r,t){const e=r instanceof FormData?r:r&&r.elements?new FormData(r):null;if(e)for(const s in t){const n=t[s];null!=n&&(e.set?e.set(s,n):e.append(s,n))}return e}_getLayerRequestOptions(r={}){const{parsedUrl:t,gdbVersion:e,dynamicDataSource:s}=this.layer;return h(y({},r),{query:y(h(y({gdbVersion:e,layer:s?JSON.stringify({source:s}):void 0},t.query),{f:"json"}),this._createRequestQueryOptions(r)),responseType:"json"})}};(0,g._)([(0,M.Cb)()],I.prototype,"type",void 0),(0,g._)([(0,M.Cb)({constructOnly:!0})],I.prototype,"layer",void 0),(0,g._)([(0,M.Cb)({readOnly:!0})],I.prototype,"queryTask",null),I=(0,g._)([(0,Z.j)("esri.layers.graphics.sources.FeatureLayerSource")],I);const H=I}}]);
//# sourceMappingURL=1383.b4d9bcd246953c42409f.js.map